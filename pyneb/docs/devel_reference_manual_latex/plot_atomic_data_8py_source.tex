\hypertarget{plot_atomic_data_8py}{\section{plot\-Atomic\-Data.\-py}
\label{plot_atomic_data_8py}\index{pyneb/plot/plot\-Atomic\-Data.\-py@{pyneb/plot/plot\-Atomic\-Data.\-py}}
}

\begin{DoxyCode}
\hypertarget{plot_atomic_data_8py_source_l00001}{}\hyperlink{namespacepyneb_1_1plot_1_1plot_atomic_data}{00001} \textcolor{stringliteral}{"""@module plotAtomicData}
00002 \textcolor{stringliteral}{Module to plot the atomic data}
00003 \textcolor{stringliteral}{"""} 
00004 
00005 \textcolor{keyword}{import} pyneb \textcolor{keyword}{as} pn
00006 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np
00007 \textcolor{keyword}{import} string
00008 \textcolor{keywordflow}{if} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]:
00009     \textcolor{keyword}{import} matplotlib \textcolor{keyword}{as} mpl
00010     \textcolor{keyword}{import} matplotlib.pyplot \textcolor{keyword}{as} plt
00011     \textcolor{keyword}{import} matplotlib.ticker
00012     \textcolor{keyword}{from} matplotlib.ticker \textcolor{keyword}{import} MaxNLocator
00013 
00014 \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils_1_1misc}{pyneb.utils.misc} \textcolor{keyword}{import} int\_to\_roman, parseAtom
00015 
\hypertarget{plot_atomic_data_8py_source_l00016}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot}{00016} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot}{DataPlot}(object):
00017     \textcolor{stringliteral}{"""}
00018 \textcolor{stringliteral}{    Plot transition probabilities and collision strengths from different data sets}
00019 \textcolor{stringliteral}{    }
00020 \textcolor{stringliteral}{    """}
00021     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af4b7b5510131c31e072909a6d20637c3}{\_\_init\_\_}(self, elem=None, spec=None, all\_data=[], atom=None, n\_tem\_points=10000, 
\hypertarget{plot_atomic_data_8py_source_l00022}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af4b7b5510131c31e072909a6d20637c3}{00022}                  ref\_tem=\textcolor{keywordtype}{None}, OmegaInterp=\textcolor{stringliteral}{'Cheb'},NLevels=\textcolor{keywordtype}{None}):
00023         \textcolor{stringliteral}{"""}
00024 \textcolor{stringliteral}{    Parameters:}
00025 \textcolor{stringliteral}{        - elem         atomic elem }
00026 \textcolor{stringliteral}{        - spec       ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
00027 \textcolor{stringliteral}{        - atom        e.g. 'O3'}
00028 \textcolor{stringliteral}{        - all\_data       dictionary of all\_data to be compared (see above for format)}
00029 \textcolor{stringliteral}{        - [n\_tem\_points] number of points in the fit (default=100; increase if fit is not smooth)}
00030 \textcolor{stringliteral}{        - [ref\_tem]      array of temperature values to be signaled in the plots}
00031 \textcolor{stringliteral}{        - OmegaInterp    interpolating function between Omega values ('Cheb' [default], 'Linear')}
00032 \textcolor{stringliteral}{    }
00033 \textcolor{stringliteral}{    Example:}
00034 \textcolor{stringliteral}{        dataplot = pn.DataPlot('O', 3) # initializes the plot}
00035 \textcolor{stringliteral}{        dataplot.plotA() # transition probabilities plot }
00036 \textcolor{stringliteral}{        dataplot.plotRelA() # relative transition probabilities plot}
00037 \textcolor{stringliteral}{        dataplot.plotOmega() # collision strength plot    }
00038 \textcolor{stringliteral}{}
00039 \textcolor{stringliteral}{        }
00040 \textcolor{stringliteral}{        """}
00041         colors = np.array([\textcolor{stringliteral}{'}\textcolor{stringliteral}{r', '}g', 'b', 'm', 'c', 'y'])
\hypertarget{plot_atomic_data_8py_source_l00042}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{00042}         self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling} = \textcolor{stringliteral}{'DataPlot'}
00043         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{plot_atomic_data_8py_source_l00044}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af5bbbf002544d1336f7f673a6e777f2e}{00044}             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af5bbbf002544d1336f7f673a6e777f2e}{atom} = str.capitalize(atom)
\hypertarget{plot_atomic_data_8py_source_l00045}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{00045}             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af5bbbf002544d1336f7f673a6e777f2e}{atom})[0]
\hypertarget{plot_atomic_data_8py_source_l00046}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{00046}             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af5bbbf002544d1336f7f673a6e777f2e}{atom})[1])
00047         \textcolor{keywordflow}{else}:
00048             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem} = str.capitalize(elem)
00049             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec} = int(spec)
00050             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af5bbbf002544d1336f7f673a6e777f2e}{atom} = self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem} + str(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec})
00051 
00052         old\_data = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af5bbbf002544d1336f7f673a6e777f2e}{atom})
00053         \textcolor{comment}{# Check if matplotlib installed}
00054         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]:
00055             pn.log\_.warn(\textcolor{stringliteral}{'Matplotlib not installed!'}, calling=self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling})
00056 
00057         \textcolor{comment}{# Separate omega and A data sets    }
00058         atom\_data = []
00059         coll\_data = []
00060         \textcolor{keywordflow}{if} all\_data == []:
00061             all\_data = pn.atomicData.getAllAvailableFiles(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_af5bbbf002544d1336f7f673a6e777f2e}{atom})
00062         i\_colors = 0    
00063         \textcolor{keywordflow}{for} file\_ \textcolor{keywordflow}{in} all\_data:
00064             ID = file\_.split(\textcolor{stringliteral}{'\_'})[-1]
00065             type\_ = (file\_.split(\textcolor{stringliteral}{'\_'})[2]).split(\textcolor{stringliteral}{'.'})[0]
00066             \textcolor{keywordflow}{if} type\_ \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'atom'}, \textcolor{stringliteral}{'coll'}]:
00067                 data\_list = type\_ + \textcolor{stringliteral}{'\_data'}
00068                 vars()[data\_list].append(\{\textcolor{stringliteral}{'ID'}: ID, \textcolor{stringliteral}{'file\_'}: file\_, \textcolor{stringliteral}{'type'}: type\_, \textcolor{stringliteral}{'color'}: colors[i\_colors
       % len(colors)]\})
00069                 i\_colors += 1
00070                 
\hypertarget{plot_atomic_data_8py_source_l00071}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{00071}         self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data} = atom\_data
\hypertarget{plot_atomic_data_8py_source_l00072}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a50a9af3695633a64c66d082ed67d1bfb}{00072}         self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a50a9af3695633a64c66d082ed67d1bfb}{coll\_data} = coll\_data
00073 
00074         \textcolor{comment}{# Temperature values to be signaled by vertical lines in omega plots. Can be changed by defining
       ref\_tem}
00075         \textcolor{keywordflow}{if} ref\_tem \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{plot_atomic_data_8py_source_l00076}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa260990b7c3556dc48741f6ae9516894}{00076}             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa260990b7c3556dc48741f6ae9516894}{ref\_tem} = np.log10([5000., 10000., 20000.]) 
00077         \textcolor{keywordflow}{else}:
00078             self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa260990b7c3556dc48741f6ae9516894}{ref\_tem} = ref\_tem
00079 
00080         \textcolor{comment}{# If it's not standard effective collision strengths, we don't want it}
00081         coll\_data\_temp=[]
00082         \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a50a9af3695633a64c66d082ed67d1bfb}{coll\_data}: 
00083             coll\_data\_temp.append(item)
00084         \textcolor{keywordflow}{for} data \textcolor{keywordflow}{in} coll\_data\_temp:
00085             pn.atomicData.setDataFile(data[\textcolor{stringliteral}{'file\_'}])
00086             atom = pn.Atom(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem}, self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec}, OmegaInterp=OmegaInterp, NLevels=NLevels)
00087             \textcolor{stringliteral}{"""}
00088 \textcolor{stringliteral}{            try:}
00089 \textcolor{stringliteral}{                if 'O\_UNIT' in atom.CollData.comments.keys():}
00090 \textcolor{stringliteral}{                    self.coll\_data.remove(data)}
00091 \textcolor{stringliteral}{            except:}
00092 \textcolor{stringliteral}{                pass}
00093 \textcolor{stringliteral}{            """}
00094         \textcolor{comment}{# For each data set, an atom is built. }
00095         del(atom)
00096         \textcolor{keywordflow}{for} data \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data} + self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a50a9af3695633a64c66d082ed67d1bfb}{coll\_data}:
00097             pn.atomicData.setDataFile(data[\textcolor{stringliteral}{'file\_'}])
00098             atom = pn.Atom(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem}, self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec}, OmegaInterp=OmegaInterp, NLevels=NLevels)
00099             data[\textcolor{stringliteral}{'atom'}] = atom
00100         \textcolor{keywordflow}{for} data \textcolor{keywordflow}{in} old\_data:
00101             \textcolor{keywordflow}{if} data \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00102                 pn.atomicData.setDataFile(data)
\hypertarget{plot_atomic_data_8py_source_l00103}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a334c448311ed9dc8cd700af504e06254}{00103}         self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a334c448311ed9dc8cd700af504e06254}{atom\_rom} = string.lower(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem} + \textcolor{stringliteral}{'\_'} + \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(int(self.
      \hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec})))
\hypertarget{plot_atomic_data_8py_source_l00104}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a9f92ae121756c0e3d3624f11e3d2ae17}{00104}         self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a9f92ae121756c0e3d3624f11e3d2ae17}{n\_tem\_points} = n\_tem\_points
00105 
\hypertarget{plot_atomic_data_8py_source_l00106}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a668572cfe9a684e7195535d60d343938}{00106}         self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a668572cfe9a684e7195535d60d343938}{atom\_n\_max} = 0
00107         \textcolor{keywordflow}{for} at \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}:
00108             \textcolor{keywordflow}{if} at[\textcolor{stringliteral}{'atom'}].atomFileType != \textcolor{stringliteral}{'chianti'}:
00109                 \textcolor{keywordflow}{if} at[\textcolor{stringliteral}{'atom'}].atomNLevels > self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a668572cfe9a684e7195535d60d343938}{atom\_n\_max}:
00110                     self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a668572cfe9a684e7195535d60d343938}{atom\_n\_max} = at[\textcolor{stringliteral}{'atom'}].atomNLevels
\hypertarget{plot_atomic_data_8py_source_l00111}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa15b01aa8da5eac903d797c2a1af3461}{00111}         self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa15b01aa8da5eac903d797c2a1af3461}{coll\_n\_max} = 0
00112         \textcolor{keywordflow}{for} at \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a50a9af3695633a64c66d082ed67d1bfb}{coll\_data}:
00113             \textcolor{keywordflow}{if} at[\textcolor{stringliteral}{'atom'}].collFileType != \textcolor{stringliteral}{'chianti'}:
00114                 \textcolor{keywordflow}{if} at[\textcolor{stringliteral}{'atom'}].collNLevels > self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa15b01aa8da5eac903d797c2a1af3461}{coll\_n\_max}:
00115                     self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa15b01aa8da5eac903d797c2a1af3461}{coll\_n\_max} = at[\textcolor{stringliteral}{'atom'}].collNLevels
00116                                     
\hypertarget{plot_atomic_data_8py_source_l00117}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a389e18b521d2052577494c8611cb5c80}{00117}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a389e18b521d2052577494c8611cb5c80}{plotA}(self, save=False, figsize=(18, 12), fignum=\textcolor{keywordtype}{None}, NLevels=\textcolor{keywordtype}{None}):
00118         \textcolor{stringliteral}{"""}
00119 \textcolor{stringliteral}{        Plot the log of the A values of each data set }
00120 \textcolor{stringliteral}{        }
00121 \textcolor{stringliteral}{        Parameters:}
00122 \textcolor{stringliteral}{            - save     if True, saves the plot in a file}
00123 \textcolor{stringliteral}{            - figsize  figure size (default: [18, 12])}
00124 \textcolor{stringliteral}{            - fignum    figure Number}
00125 \textcolor{stringliteral}{}
00126 \textcolor{stringliteral}{        """}
00127         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00128             atom\_n\_max = self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a668572cfe9a684e7195535d60d343938}{atom\_n\_max}
00129         \textcolor{keywordflow}{else}:
00130             atom\_n\_max = NLevels
00131         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]:
00132             pn.log\_.error(\textcolor{stringliteral}{'Matplotlib not installed!'}, calling=self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling})
00133         plt.figure(fignum, figsize=figsize)
00134         plt.clf()
00135         ax = plt.subplot(111, axisbg=\textcolor{stringliteral}{'Ivory'})
00136         x = np.arange(atom\_n\_max * (atom\_n\_max - 1) / 2.)
00137         ticks = x
00138         \textcolor{comment}{# Inventory of markers. Chosen to be distinguished even when overlapped}
00139         mark = [\textcolor{stringliteral}{'<'}, (5, 1), \textcolor{stringliteral}{'>'}, \textcolor{stringliteral}{'o'}, \textcolor{stringliteral}{'|'}]
00140         i\_marker = 0
00141         \textcolor{comment}{# Background colors to distinguish lower levels }
00142         bg\_color\_sequence = [\textcolor{stringliteral}{'g'}, \textcolor{stringliteral}{'}\textcolor{stringliteral}{r', '}b', 'y', 'm', 'c']
00143         \textcolor{comment}{# The following command replicates the string to allocate a sufficient number of colors}
00144         bg\_color = bg\_color\_sequence * (int(atom\_n\_max - 2) / len(bg\_color\_sequence) + 1)
00145         tick\_label = []
00146         
00147         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(atom\_n\_max - 1):
00148             \textcolor{comment}{# x0, x1 are start and end points of each level}
00149             x0 = i * (atom\_n\_max - 1) - i * (i - 1) / 2 - 0.5
00150             width = atom\_n\_max - i - 1
00151             x1 = x0 + width
00152             plt.axvspan(x0, x1, facecolor=bg\_color[i], alpha=0.05)
00153             \textcolor{comment}{# The x axis must stretch the maximum range (although some data set might have a lower n\_level)}
00154             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i + 1, atom\_n\_max):
00155                 tick\_label.append(\textcolor{stringliteral}{'('} + str(j + 1) + \textcolor{stringliteral}{', '} + str(i + 1) + \textcolor{stringliteral}{')'})
00156 
00157 
00158         \textcolor{keywordflow}{for} data \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}:
00159             n\_levels = data[\textcolor{stringliteral}{'atom'}].atomNLevels
00160             Ay = []
00161             A = data[\textcolor{stringliteral}{'atom'}].getA()
00162             color = data[\textcolor{stringliteral}{'color'}]
00163             \textcolor{keywordflow}{try}:
00164                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(n\_levels - 1):
00165                     \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i + 1, n\_levels):
00166                         \textcolor{keywordflow}{if} A[j, i] > 0:
00167                             Ay.append(np.log10(A[j, i]))
00168                         \textcolor{keywordflow}{else}:
00169                             Ay.append(np.NaN)
00170                 plt.scatter(x, Ay, marker=mark[i\_marker], s=300., c=color, alpha=0.35, linewidths=1, label=\textcolor{stringliteral}{
      '%s'} % (data[\textcolor{stringliteral}{'ID'}]))
00171                 ax.set\_xticks(ticks)
00172             \textcolor{keywordflow}{except}:
00173                 pn.log\_.warn(\textcolor{stringliteral}{'Problem in plotting A'}, calling=self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling} + \textcolor{stringliteral}{'.plotA'})
00174             i\_marker += 1
00175         ax.set\_xticklabels(tick\_label)
00176 
00177         \textcolor{comment}{# Plot features}
00178         plt.xlabel(\textcolor{stringliteral}{'Transition'})
00179         plt.ylabel(\textcolor{stringliteral}{'Log A(j, i)'})
00180         plt.title(\textcolor{stringliteral}{'Transition probabilities for [%s %s]'} % (self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem}, 
      \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(int(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec}))))
00181         plt.legend(loc=\textcolor{stringliteral}{'lower right'}, markerscale=1., scatterpoints=1, borderpad=1, labelspacing=1)
00182         plt.show()      
00183         \textcolor{keywordflow}{if} save:
00184             plt.figure(figsize=[18, 12])
00185             plt.savefig(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a334c448311ed9dc8cd700af504e06254}{atom\_rom} + \textcolor{stringliteral}{'\_'} + data[\textcolor{stringliteral}{'ID'}] + \textcolor{stringliteral}{"-"} + self.ref\_data + \textcolor{stringliteral}{"\_A.pdf"})
00186 
00187 
00188 
\hypertarget{plot_atomic_data_8py_source_l00189}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a0b245c7f8b97681b15beadcef38a0021}{00189}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a0b245c7f8b97681b15beadcef38a0021}{plotAllA}(self, save=False, figsize=(18, 12), fignum=\textcolor{keywordtype}{None}, NLevels=\textcolor{keywordtype}{None}):
00190         \textcolor{stringliteral}{"""}
00191 \textcolor{stringliteral}{        Plot the log of the A values of each data set }
00192 \textcolor{stringliteral}{        }
00193 \textcolor{stringliteral}{        Parameters:}
00194 \textcolor{stringliteral}{            - save     if True, saves the plot in a file}
00195 \textcolor{stringliteral}{            - figsize  figure size (default: [18, 12])}
00196 \textcolor{stringliteral}{            - fignum    figure Number}
00197 \textcolor{stringliteral}{}
00198 \textcolor{stringliteral}{        """}
00199         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00200             atom\_n\_max = self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a668572cfe9a684e7195535d60d343938}{atom\_n\_max}
00201         \textcolor{keywordflow}{else}:
00202             atom\_n\_max = NLevels
00203         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]:
00204             pn.log\_.error(\textcolor{stringliteral}{'Matplotlib not installed!'}, calling=self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling})
00205         fig = plt.figure(fignum, figsize=figsize)
00206         plt.clf()
00207         max\_y\_ticks = 6
00208         ticks = np.arange(len(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data})+1)[1:] 
00209         
00210         A = np.zeros([len(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}), atom\_n\_max, atom\_n\_max])
00211         color=[]
00212         \textcolor{keywordflow}{for} i, data \textcolor{keywordflow}{in} enumerate(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}):
00213             A\_tmp = data[\textcolor{stringliteral}{'atom'}].getA()
00214             \textcolor{keywordflow}{if} A\_tmp.shape[0] > atom\_n\_max:
00215                 A[i, :] = A\_tmp[0:atom\_n\_max, 0:atom\_n\_max]
00216             \textcolor{keywordflow}{else}:
00217                 A[i, 0:A\_tmp.shape[0], 0:A\_tmp.shape[1]] = A\_tmp
00218             color.append(data[\textcolor{stringliteral}{'color'}])
00219         
00220         A[np.where((A<=0))] = np.NaN
00221         lgA = np.log10(A)
00222         
00223         x = ticks
00224         color = np.array(color)
00225         \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(2, atom\_n\_max+1):
00226             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, j):
00227                 y = lgA[:, j-1, i-1]
00228                 ax = plt.subplot(atom\_n\_max - 1, atom\_n\_max - 1, (atom\_n\_max-1)*(j-2) + i,
00229                                  axisbg=\textcolor{stringliteral}{'#FFFFE0'})
00230                 ax.set\_xticks(x)
00231                 plt.xlim((min(x)-0.5, max(x)+0.5))
00232                 ax.yaxis.set\_major\_locator(MaxNLocator(max\_y\_ticks-1))
00233                 \textcolor{keywordflow}{try}:
00234                     plt.scatter(x, y, c=color, label=\textcolor{stringliteral}{'\_nolegend\_'}, s=40)
00235                     lbl = \textcolor{stringliteral}{'(\{0\} -> \{1\})'}.format(j,i)
00236                     ax.text(0.95, 0.95, lbl, fontsize=10, color=\textcolor{stringliteral}{"#660066"}, transform=ax.transAxes, ha=\textcolor{stringliteral}{"
      right"}, va=\textcolor{stringliteral}{"top"})                                    
00237                 \textcolor{keywordflow}{except}:
00238                     pn.log\_.warn(\textcolor{stringliteral}{'Problem with plotting a subplot \{\} \{\}'}.format(i,j), calling=self.
      \hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling})
00239                 \textcolor{keywordflow}{if} (j==atom\_n\_max) & (i==1):  
00240                     plt.xlabel(\textcolor{stringliteral}{'Reference #'}, fontsize=8)
00241                     plt.ylabel(\textcolor{stringliteral}{'Log(A$\_\{ji\}$)'}, fontsize=8)
00242         plt.subplots\_adjust(left=0.15, right=0.95, top=0.95, bottom=0.12)
00243         plt.gca().get\_yaxis().get\_major\_formatter().set\_useOffset(\textcolor{keyword}{False})
00244         ax.set\_xticks(x)
00245         
00246         fig.text(.5, .05, \textcolor{stringliteral}{"i (lower level)"}, fontsize=12, ha=\textcolor{stringliteral}{'center'}, color=\textcolor{stringliteral}{"#660066"}, va=\textcolor{stringliteral}{'top'})
00247         fig.text(.05, .5, \textcolor{stringliteral}{"j (upper level)"}, ha=\textcolor{stringliteral}{'left'}, va=\textcolor{stringliteral}{'center'}, fontsize=12, color=\textcolor{stringliteral}{"#660066"}, rotation
      =90)
00248         title = \textcolor{stringliteral}{"Available transition probabilities for \{0\} \{1\}"}.format(self.
      \hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem}, \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(int(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec})))
00249         fig.text(.5, .95, title, color=\textcolor{stringliteral}{"#191970"}, fontsize=14, ha=\textcolor{stringliteral}{'center'})
00250         \textcolor{keywordflow}{for} i, data \textcolor{keywordflow}{in} enumerate(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}):
00251             x\_txt = .95
00252             y\_txt = .85 - .04*i 
00253             fig.text(x\_txt, y\_txt, \textcolor{stringliteral}{"Ref. %d: %s"} %(i+1, data[\textcolor{stringliteral}{'ID'}]), color=color[i], ha = \textcolor{stringliteral}{'right'}) 
00254 
00255         plt.tight\_layout(pad=0.1)
00256         \textcolor{keywordflow}{if} save:
00257             plt.savefig(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a334c448311ed9dc8cd700af504e06254}{atom\_rom} + \textcolor{stringliteral}{"\_all\_As.pdf"})
00258     
00259         plt.show()      
00260         
00261 
\hypertarget{plot_atomic_data_8py_source_l00262}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a9fc5e1df4de9471e26b20018ce89eb9d}{00262}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a9fc5e1df4de9471e26b20018ce89eb9d}{plotRelA}(self, ref\_data=None, save=False, figsize=None, fignum=None, NLevels=None, fig=None
      ):
00263         \textcolor{stringliteral}{"""}
00264 \textcolor{stringliteral}{        Plot the relative difference of the A of each data set with respect to the reference one}
00265 \textcolor{stringliteral}{}
00266 \textcolor{stringliteral}{        Parameters:}
00267 \textcolor{stringliteral}{            - ref\_data       reference data set for comparing transition probabilities (default=first data
       ID)}
00268 \textcolor{stringliteral}{            - save           if True, save the plot in a file (default: False)}
00269 \textcolor{stringliteral}{            - figsize        figure size (default: [18, 12])}
00270 \textcolor{stringliteral}{            - fignum         figure number}
00271 \textcolor{stringliteral}{}
00272 \textcolor{stringliteral}{        """}
00273         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00274             atom\_n\_max = self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a668572cfe9a684e7195535d60d343938}{atom\_n\_max}
00275         \textcolor{keywordflow}{else}:
00276             atom\_n\_max = NLevels
00277         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]:
00278             pn.log\_.error(\textcolor{stringliteral}{'Matplotlib not installed!'}, calling=self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling})
00279         \textcolor{comment}{# Commented out because it produced an extra, empty frame - VL 30 Jul 2015}
00280         \textcolor{comment}{#if fig is None:}
00281         \textcolor{comment}{#    fig = plt.figure(fignum, figsize=figsize)}
00282         \textcolor{comment}{#plt.clf()}
00283         ticks = range(atom\_n\_max + 1)[1:]
00284 
00285         \textcolor{comment}{# The As of the reference data set are stored}
00286         \textcolor{keywordflow}{if} ref\_data \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00287             ref\_data = self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}[0][\textcolor{stringliteral}{'ID'}]
00288         \textcolor{keywordflow}{for} data \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}:
00289             \textcolor{keywordflow}{if} (data[\textcolor{stringliteral}{'ID'}] \textcolor{keywordflow}{is} ref\_data):
00290                 ref\_A = data[\textcolor{stringliteral}{'atom'}].getA()
00291                 \textcolor{comment}{# Only non-zero values are taken into account to prevent dividing by zero}
00292                 nonzero\_ref\_A\_indexes = np.nonzero(ref\_A)
00293 
00294         \textcolor{keywordflow}{for} data \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aee33ad460a38cb4293a5bd89cec12294}{atom\_data}:
00295             \textcolor{keywordflow}{if} (data[\textcolor{stringliteral}{'ID'}] \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} ref\_data):
00296                 A = data[\textcolor{stringliteral}{'atom'}].getA()
00297                 \textcolor{keywordflow}{try}:
00298                     \textcolor{comment}{# The data to be compared might have fewer levels than the reference one. Only the ones
       in common are considered.}
00299                     tmp\_indexes = np.asarray(nonzero\_ref\_A\_indexes) 
00300                     up\_indexes = tmp\_indexes[0][tmp\_indexes[0] < data[\textcolor{stringliteral}{'atom'}].atomNLevels]
00301                     lo\_indexes = tmp\_indexes[1][tmp\_indexes[0] < data[\textcolor{stringliteral}{'atom'}].atomNLevels]
00302                     \textcolor{comment}{# Indexes for which the reference data set is not zero}
00303                     ref\_indexes = (up\_indexes, lo\_indexes)
00304                     \textcolor{comment}{# Ratio of A/A\_ref for non-zero A\_ref values}
00305                     A\_ratio = A[ref\_indexes] / ref\_A[ref\_indexes]
00306                     nonzero\_A\_ratio\_indexes = np.nonzero(A\_ratio)
00307                     rel\_A = np.log10(A\_ratio[nonzero\_A\_ratio\_indexes])
00308                     \textcolor{comment}{# Plotting starts}
00309                     \textcolor{comment}{#fig = plt.figure()}
00310                     \textcolor{keywordflow}{if} fig \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00311                         fig = plt.figure(fignum, figsize=figsize)
00312                     plt.clf()
00313                     ax = plt.subplot(111, axisbg=\textcolor{stringliteral}{'#FFFFE0'})
00314                     fig.subplots\_adjust(top=0.9)
00315                     \textcolor{comment}{# Physical levels = array levels + 1}
00316                     x = np.asarray(lo\_indexes) + 1
00317                     y = np.asarray(up\_indexes) + 1
00318                     \textcolor{comment}{# Size is proportional to difference between As}
00319                     \textcolor{comment}{# Numerical value of size adjusted empirically, no particular meaning }
00320                     size = np.multiply(10000., np.abs(rel\_A))
00321                     \textcolor{comment}{# A different color is assigned to data points depending on whether they are smaller or
       larger}
00322                     \textcolor{comment}{# than the reference data.}
00323                     \textcolor{comment}{# The ratio is not compared to exactly one to include only truly different values  }
00324                     index\_grt = np.where(rel\_A > 0.0000)
00325                     color\_grt = np.array([\textcolor{stringliteral}{'#FF8C00'}]).repeat(x[index\_grt].size)
00326                     index\_sml = np.where(rel\_A <= 0.0)
00327                     color\_sml = np.array([\textcolor{stringliteral}{'#FF1480'}]).repeat(x[index\_sml].size)
00328                     \textcolor{comment}{# The range is adjusted to include only values for which there is a difference}
00329                     xmin = np.max([np.min(x[index\_sml]), np.min(x[index\_grt])])
00330                     xmax = np.min([np.max(x[index\_sml]), np.max(x[index\_sml])])
00331                     ax.set\_xticks(ticks)
00332                     ax.set\_xlim((xmin - 0.25, xmax + 0.25)[:])
00333                     \textcolor{comment}{# The x-axis is plotted on the top to mimic the data array in the fits file}
00334                     \textcolor{keywordflow}{for} tick \textcolor{keywordflow}{in} ax.xaxis.get\_major\_ticks():
00335                         tick.label1On = \textcolor{keyword}{False}
00336                         tick.label2On = \textcolor{keyword}{True}
00337                     ymin = np.min([np.min(y[index\_sml]), np.min(y[index\_grt])])
00338                     ymax = np.max([np.max(y[index\_sml]), np.max(y[index\_sml])])
00339                     ax.set\_yticks(ticks)
00340                     \textcolor{comment}{# The y axis increases downward to mimic the data array in the fits file}
00341                     ax.set\_ylim((ymin - 0.25, ymax + 0.25)[::-1])
00342                     \textcolor{comment}{# Fake points, just to generate the labels (I don't know how to generate a reasonable
       label}
00343                     \textcolor{comment}{# for data points with markers of different size)}
00344                     plt.scatter(x[index\_grt][0], y[index\_grt][0], marker=\textcolor{stringliteral}{'o'}, s=.0002, c=color\_grt[0],
00345                                 label=\textcolor{stringliteral}{'Positive (max = %.2f)'} % (np.max(rel\_A)))
00346                     plt.scatter(x[index\_grt][0], y[index\_grt][0], marker=\textcolor{stringliteral}{'o'}, s=.0002, c=color\_sml[0],
00347                                 label=\textcolor{stringliteral}{'Negative (min = %.2f)'} % (np.min(rel\_A)))
00348                     \textcolor{comment}{# True data; size reflects divergence from reference data, color whether positive or
       negative}
00349                     plt.scatter(x[index\_grt], y[index\_grt], marker=\textcolor{stringliteral}{'o'}, s=size[index\_grt], c=np.asarray(
      color\_grt), alpha=1.0)
00350                     plt.scatter(x[index\_sml], y[index\_sml], marker=\textcolor{stringliteral}{'o'}, s=size[index\_sml], c=np.asarray(
      color\_sml), alpha=1.0)
00351                     \textcolor{comment}{# X-axis label }
00352                     ax.text(.5, 1.05, \textcolor{stringliteral}{'$i$ (lower level)'}, transform=ax.transAxes, ha=\textcolor{stringliteral}{'center'}, va=\textcolor{stringliteral}{'bottom'}
      )
00353                     \textcolor{comment}{#plt.xlabel('$i$ (lower level)')}
00354                     \textcolor{comment}{# Y-axis label}
00355                     plt.ylabel(\textcolor{stringliteral}{'$j$ (upper level)'})
00356                     \textcolor{comment}{# Legend}
00357                     plt.legend(loc=\textcolor{stringliteral}{'upper right'}, markerscale=1000., scatterpoints=1, borderpad=1,
00358                                labelspacing=1, prop=dict(size=12), title=\textcolor{stringliteral}{u'Log (%s / %s)'} % (data[\textcolor{stringliteral}{'ID'}], 
      ref\_data))
00359                     \textcolor{comment}{# Plot title}
00360                     ax.text(.5, -.10, \textcolor{stringliteral}{"Relative difference between $A$s data for [%s %s]"} 
00361                                 % (self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem}, \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(int(self.
      \hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec}))),
00362                                 transform=ax.transAxes, ha=\textcolor{stringliteral}{'center'}, va=\textcolor{stringliteral}{'bottom'}, color=\textcolor{stringliteral}{'#191970'}, size=12)
00363                 \textcolor{keywordflow}{except}:
00364                     pn.log\_.warn(\textcolor{stringliteral}{'Problem in plotting relA'}, calling=\textcolor{stringliteral}{'DatasetPlot'})
00365 
00366                 \textcolor{keywordflow}{if} save:
00367                     plt.savefig(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a334c448311ed9dc8cd700af504e06254}{atom\_rom} + \textcolor{stringliteral}{'\_'} + data[\textcolor{stringliteral}{'ID'}] + \textcolor{stringliteral}{"-"} + ref\_data + \textcolor{stringliteral}{"\_relA.pdf"})
00368     
00369                 plt.show()      
00370 
00371 
00372     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a674c04e8512a9f5724c2af0df4e0a8fe}{plotOmega}(self, save=False, figsize=(18, 12), fignum=1, scan\_orders=\textcolor{keywordtype}{None}, NLevels=\textcolor{keywordtype}{None},
\hypertarget{plot_atomic_data_8py_source_l00373}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a674c04e8512a9f5724c2af0df4e0a8fe}{00373}                   fig=\textcolor{keywordtype}{None}):
00374         \textcolor{stringliteral}{"""}
00375 \textcolor{stringliteral}{        Plot the tabulated collision strengths of each data set and the fit that is performed by PyNeb}
00376 \textcolor{stringliteral}{        }
00377 \textcolor{stringliteral}{        Parameters:}
00378 \textcolor{stringliteral}{            - save     Boolean. Determine if the plot is automatically saved in a file (default: False)}
00379 \textcolor{stringliteral}{            - figsize  List. figure size in inches (default: [18, 12])}
00380 \textcolor{stringliteral}{            - fignum   Figure Number}
00381 \textcolor{stringliteral}{            - scan\_orders = None or (min\_order, max\_order) or (min\_order, -1) to go until the max.
       DEPRECATED!!!}
00382 \textcolor{stringliteral}{}
00383 \textcolor{stringliteral}{        """}
00384         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00385             coll\_n\_max = self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa15b01aa8da5eac903d797c2a1af3461}{coll\_n\_max}
00386         \textcolor{keywordflow}{else}:
00387             coll\_n\_max = NLevels
00388         \textcolor{comment}{# Plotting range somewhat larger than actual data range (less tight) }
00389         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]:
00390             pn.log\_.error(\textcolor{stringliteral}{'Matplotlib not installed!'}, calling=self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling})
00391         \textcolor{keywordflow}{if} fig \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00392             fig = plt.figure(fignum, figsize=figsize)
00393         plt.autoscale(tight=\textcolor{keyword}{False})
00394         \textcolor{comment}{# I need two }
00395         first = \textcolor{keyword}{True}
00396         first\_done = \textcolor{keyword}{False}
00397         plt.clf()
00398         
00399         legend\_text = []
00400         legend\_lines = []
00401 \textcolor{comment}{#        style\_dic = ['-', '--', '-.', ':'] * 10}
00402         \textcolor{keywordflow}{for} data \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a50a9af3695633a64c66d082ed67d1bfb}{coll\_data}:
00403             \textcolor{comment}{# tem\_points = tabulated temperature points (different for each data set)}
00404             tem\_points = self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a44a19b283355d6c3ad1903e70009cfee}{tem\_in\_K}(data[\textcolor{stringliteral}{'atom'}].tem\_units, data[\textcolor{stringliteral}{'atom'}].getTemArray())
00405             tem\_min = min(tem\_points)
00406             tem\_max = max(tem\_points)
00407             \textcolor{comment}{# tem\_funct = array of temperature values for which the fit is evaluated}
00408             tem\_funct = np.linspace(tem\_min, tem\_max, self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a9f92ae121756c0e3d3624f11e3d2ae17}{n\_tem\_points})
00409             x\_dots = np.log10(tem\_points)
00410             x\_lines = np.log10(tem\_funct)
00411             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'COEFF'} \textcolor{keywordflow}{in} data[\textcolor{stringliteral}{'atom'}].CollData.comments.keys():
00412                 coeff = float(data[\textcolor{stringliteral}{'atom'}].CollData.comments[\textcolor{stringliteral}{'COEFF'}])
00413             \textcolor{keywordflow}{else}:
00414                 coeff = 1.0
00415             \textcolor{comment}{# Loops over all levels}
00416             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, coll\_n\_max+1):
00417                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i + 1, coll\_n\_max+1):                
00418                         \textcolor{comment}{# N levels require an N-1 x N-1 array of plots}
00419                         \textcolor{comment}{# The subplots are arranged in rows and columns according to the upper and lower
       levels}
00420  
00421                         ax = plt.subplot(coll\_n\_max-1, coll\_n\_max-1, 
00422                                          (coll\_n\_max-1) * (j - 2) + i,
00423                                          axisbg=\textcolor{stringliteral}{'#FFFFE0'})
00424                         \textcolor{keywordflow}{if} (i <= data[\textcolor{stringliteral}{'atom'}].collNLevels) \textcolor{keywordflow}{and} (j <= data[\textcolor{stringliteral}{'atom'}].collNLevels):
00425                             y\_dots = data[\textcolor{stringliteral}{'atom'}].getOmega(tem\_points, j, i)
00426                             \textcolor{keywordflow}{try}:
00427                                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'O\_UNIT'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} data[\textcolor{stringliteral}{'atom'}].CollData.comments:
00428                                     y\_dots = coeff * data[\textcolor{stringliteral}{'atom'}].getOmegaArray(j, i)
00429                                     \textcolor{keywordflow}{if} y\_dots.sum() > 0.0:
00430                                         ax.plot(x\_dots, y\_dots, color=data[\textcolor{stringliteral}{'color'}],
00431                                                 marker=\textcolor{stringliteral}{'*'}, linestyle=\textcolor{stringliteral}{'None'}, label=\textcolor{stringliteral}{'\_nolegend\_'}, 
      markersize=10)
00432                                     
00433                                 y\_dots = data[\textcolor{stringliteral}{'atom'}].getOmega(tem\_points, j, i)
00434                                 \textcolor{keywordflow}{if} y\_dots.sum() > 0.0:
00435                                     ax.plot(x\_dots, y\_dots, color=data[\textcolor{stringliteral}{'color'}],
00436                                             marker=\textcolor{stringliteral}{'o'}, linestyle=\textcolor{stringliteral}{'None'}, label=\textcolor{stringliteral}{'\_nolegend\_'})
00437                                 y\_lines = data[\textcolor{stringliteral}{'atom'}].getOmega(tem\_funct, j, i)
00438                                 \textcolor{keywordflow}{if} y\_lines.sum() > 0.:
00439                                     ax.plot(x\_lines, y\_lines,
00440                                             color=data[\textcolor{stringliteral}{'color'}], label=\textcolor{stringliteral}{'\_nolegend\_'})
00441                             \textcolor{keywordflow}{except}:
00442                                 pn.log\_.warn(\textcolor{stringliteral}{'Problem with plotting a data set'}, calling=self.
      \hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a393a133b607541c57d5ebc5a34687e3f}{calling})
00443 \textcolor{comment}{# Draws vertical lines at selected temperature values (only once for each subplot, hence "first") }
00444                         \textcolor{keywordflow}{if} (first \textcolor{keywordflow}{and} (data[\textcolor{stringliteral}{'atom'}].collNLevels == coll\_n\_max)):
00445                             \textcolor{keywordflow}{for} tem \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa260990b7c3556dc48741f6ae9516894}{ref\_tem}:
00446                                 plt.axvline(tem, c=\textcolor{stringliteral}{'blue'}, alpha=0.4, ls=\textcolor{stringliteral}{':'})
00447                             lbl = \textcolor{stringliteral}{"$\(\backslash\)Omega$"} + \textcolor{stringliteral}{"("} + str(j) + \textcolor{stringliteral}{","} + str(i) + \textcolor{stringliteral}{")"}
00448                             ax.text(0.95, 0.95, lbl, transform=ax.transAxes, ha=\textcolor{stringliteral}{"right"}, va=\textcolor{stringliteral}{"top"})   
00449                             first\_done = \textcolor{keyword}{True}                                 
00450                         \textcolor{comment}{# Maximum number of ticks to avoid overcrowding}
00451                         ax.xaxis.set\_major\_locator(MaxNLocator(4))
00452                         ax.yaxis.set\_major\_locator(MaxNLocator(3))
00453             \textcolor{comment}{# The line type and identifier of each data set are stored for the legend}
00454             legend\_lines.append(mpl.lines.Line2D(tem\_funct, tem\_funct, color=data[\textcolor{stringliteral}{'color'}], linestyle=\textcolor{stringliteral}{'-'}))
00455             legend\_text.append(data[\textcolor{stringliteral}{'ID'}])
00456             \textcolor{keywordflow}{if} first\_done:
00457                 first = \textcolor{keyword}{False}
00458         \textcolor{comment}{# The label of the reference temperature values are only plotted above the last plot}
00459         \textcolor{keywordflow}{for} tem \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_aa260990b7c3556dc48741f6ae9516894}{ref\_tem}:
00460             ax.text(tem, ax.get\_ylim()[1], \textcolor{stringliteral}{' %0.0f K'} % (10 ** tem), ha=\textcolor{stringliteral}{"left"}, va=\textcolor{stringliteral}{"bottom"}, 
00461                     rotation=65, fontsize=12, color=\textcolor{stringliteral}{'#FF0000'}, alpha=0.35)
00462         \textcolor{comment}{# Axis labels, title and legend    }
00463         fig.text(.5, .05, \textcolor{stringliteral}{"Log($T\_e/K$)"}, fontsize=16, ha=\textcolor{stringliteral}{'center'}, va=\textcolor{stringliteral}{'top'})
00464         fig.text(.05, .5, \textcolor{stringliteral}{"$\(\backslash\)Omega$"}, va=\textcolor{stringliteral}{'center'}, fontsize=20, rotation=90)
00465         fig.text(.5, .95, \textcolor{stringliteral}{"[%s %s] collision strengths"} % (self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_ae936c57b93cc86a5cf28f8838164940a}{elem}, 
      \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(int(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_acaaca83a6e12e99ebc1da72af5f8c60a}{spec}))), 
00466                  color=\textcolor{stringliteral}{"#191970"}, fontsize=16, ha=\textcolor{stringliteral}{'center'})
00467 \textcolor{comment}{#        plt.legend(legend\_lines, legend\_text, loc='upper right', borderpad=1, }
00468 \textcolor{comment}{#                   labelspacing=1, bbox\_to\_anchor=(1, 1 * coll\_n\_max))}
00469         plt.legend(legend\_lines, legend\_text, loc=\textcolor{stringliteral}{'upper right'}, borderpad=1, 
00470                    labelspacing=1, bbox\_to\_anchor=(1, coll\_n\_max - 1))
00471         \textcolor{comment}{#plt.tight\_layout()}
00472         \textcolor{keywordflow}{if} save:
00473             plt.savefig(self.\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a334c448311ed9dc8cd700af504e06254}{atom\_rom} + \textcolor{stringliteral}{"\_CS.pdf"})
00474         
00475         plt.show()
00476 
00477 
\hypertarget{plot_atomic_data_8py_source_l00478}{}\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a44a19b283355d6c3ad1903e70009cfee}{00478}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1plot_1_1plot_atomic_data_1_1_data_plot_a44a19b283355d6c3ad1903e70009cfee}{tem\_in\_K}(self, tem\_units, tem):
00479         \textcolor{stringliteral}{"""}
00480 \textcolor{stringliteral}{        Convert the temperature from the unit of the fits file into K}
00481 \textcolor{stringliteral}{}
00482 \textcolor{stringliteral}{        Parameters:}
00483 \textcolor{stringliteral}{            - tem\_units     'log(K)' or 'K/1000'}
00484 \textcolor{stringliteral}{            - tem           temperature}
00485 \textcolor{stringliteral}{        """}
00486         
00487         \textcolor{keywordflow}{if} (tem\_units == \textcolor{stringliteral}{"log(K)"}):
00488             \textcolor{keywordflow}{return} np.power(10., tem)
00489         \textcolor{keywordflow}{elif} (tem\_units == \textcolor{stringliteral}{"K/10000"}):
00490             \textcolor{keywordflow}{return} np.multiply(tem, 1.e4)
00491         \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
00492             \textcolor{keywordflow}{return} tem
00493                 
00494     
\end{DoxyCode}
