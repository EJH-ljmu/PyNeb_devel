\hypertarget{manage__atomic__data_8py_source}{}\section{manage\+\_\+atomic\+\_\+data.\+py}
\label{manage__atomic__data_8py_source}\index{pyneb/utils/manage\+\_\+atomic\+\_\+data.\+py@{pyneb/utils/manage\+\_\+atomic\+\_\+data.\+py}}

\begin{DoxyCode}
\hypertarget{manage__atomic__data_8py_source_l00001}{}\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data}{00001} \textcolor{keyword}{import} os
00002 \textcolor{keyword}{import} pyneb \textcolor{keyword}{as} pn
00003 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np
00004 \textcolor{keyword}{import} re
00005 \textcolor{keyword}{from} misc \textcolor{keyword}{import} execution\_path, parseAtom, roman\_to\_int, multi\_split, int\_to\_roman, strExtract
00006 \textcolor{keyword}{from} init \textcolor{keyword}{import} ELEM\_LIST, SPEC\_LIST
00007 \textcolor{keyword}{from} physics \textcolor{keyword}{import} \_predefinedDataFileDict
00008 
\hypertarget{manage__atomic__data_8py_source_l00009}{}\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{00009} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{atom2chianti}(atom):
00010     elem = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[0]
00011     spec = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[1])
00012     \textcolor{keywordflow}{return} \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(elem.lower(), spec)
00013 
\hypertarget{manage__atomic__data_8py_source_l00014}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data}{00014} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data}{\_ManageAtomicData}(object):
00015     
\hypertarget{manage__atomic__data_8py_source_l00016}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a5cadf1550d771a79538a0a6a58a4cd59}{00016}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a5cadf1550d771a79538a0a6a58a4cd59}{\_\_init\_\_}(self):
\hypertarget{manage__atomic__data_8py_source_l00017}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a1d8277ab92e8bac3e52ade094ba63773}{00017}         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a1d8277ab92e8bac3e52ade094ba63773}{log\_} = pn.log\_
\hypertarget{manage__atomic__data_8py_source_l00018}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{00018}         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling} = \textcolor{stringliteral}{'\_ManageAtomicData'}
\hypertarget{manage__atomic__data_8py_source_l00019}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ad9b54bc077170e477f23059e2256b30f}{00019}         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ad9b54bc077170e477f23059e2256b30f}{\_predefinedDataFileDict} = \_predefinedDataFileDict
00020         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a196510345a35dc1749684b5619ce64d5}{setDataFileDict}()
00021         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9c22482034e5d9154e315649c079b8fd}{addDataFilePath}()
00022         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9c22482034e5d9154e315649c079b8fd}{addDataFilePath}(\textcolor{stringliteral}{'../atomic\_data\_fits/'}, inPyNeb=\textcolor{keyword}{True})
00023         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9c22482034e5d9154e315649c079b8fd}{addDataFilePath}(\textcolor{stringliteral}{'../atomic\_data/'}, inPyNeb=\textcolor{keyword}{True})
00024         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9c22482034e5d9154e315649c079b8fd}{addDataFilePath}(\textcolor{stringliteral}{'./'})
\hypertarget{manage__atomic__data_8py_source_l00025}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a01eaf095b647e87d3dbf9094104f680c}{00025}         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a01eaf095b647e87d3dbf9094104f680c}{\_RecombData} = \{\}
00026         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a76dc32f396e494e06327a6c8464d005e}{\_initChianti}()
00027 
\hypertarget{manage__atomic__data_8py_source_l00028}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_abd71c1d8b069ee1cd57d2125b4799a4c}{00028}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_abd71c1d8b069ee1cd57d2125b4799a4c}{includeFitsPath}(self):
00029         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9c22482034e5d9154e315649c079b8fd}{addDataFilePath}(\textcolor{stringliteral}{'../atomic\_data\_fits/old\_fits/'}, inPyNeb=\textcolor{keyword}{True})
00030 
\hypertarget{manage__atomic__data_8py_source_l00031}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9cade6c2f74e46262270c8464c9811d7}{00031}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9cade6c2f74e46262270c8464c9811d7}{removeFitsPath}(self):
00032         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a058a05e4bc4bb113b7ec44510a1a40f8}{removeDataFilePath}(\textcolor{stringliteral}{'../atomic\_data\_fits/old\_fits/'})
00033         
\hypertarget{manage__atomic__data_8py_source_l00034}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a95c5df20a27033c4c32831d85a1c2876}{00034}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a95c5df20a27033c4c32831d85a1c2876}{getPredefinedDataFileDict}(self, data\_dict=None):
00035         \textcolor{stringliteral}{"""}
00036 \textcolor{stringliteral}{        Retrieve all predefined dictionaries of atomic data (or a specified one if data\_dict is specified)}
00037 \textcolor{stringliteral}{        }
00038 \textcolor{stringliteral}{        Parameters:}
00039 \textcolor{stringliteral}{           - data\_dict    name of the dictionary (default: None)}
00040 \textcolor{stringliteral}{}
00041 \textcolor{stringliteral}{        """}
00042 \textcolor{comment}{#        Retrieve a predefined dictionary of atomic data (either the default one [data\_dict unspecified]}
00043 \textcolor{comment}{#        or another one [identified by data\_dict])}
00044         \textcolor{keywordflow}{if} data\_dict \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00045             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ad9b54bc077170e477f23059e2256b30f}{\_predefinedDataFileDict}
00046         \textcolor{keywordflow}{elif} data\_dict \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ad9b54bc077170e477f23059e2256b30f}{\_predefinedDataFileDict}:
00047             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ad9b54bc077170e477f23059e2256b30f}{\_predefinedDataFileDict}[data\_dict]
00048         \textcolor{keywordflow}{else}:
00049             self.log\_.error(\textcolor{stringliteral}{'unknown DataFile dictionary \{0\}'}.format(data\_dict), calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00050             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00051 
00052 
\hypertarget{manage__atomic__data_8py_source_l00053}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab315b359b5eb8173c34ebc1d8d0739f4}{00053}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab315b359b5eb8173c34ebc1d8d0739f4}{getAllPredefinedDict}(self):
00054         \textcolor{stringliteral}{"""}
00055 \textcolor{stringliteral}{        Return the labels of the available predefined dictionaries of atomic data}
00056 \textcolor{stringliteral}{}
00057 \textcolor{stringliteral}{        """}
00058         \textcolor{keywordflow}{return} pn.atomicData.getPredefinedDataFileDict().keys()
00059 
00060     
\hypertarget{manage__atomic__data_8py_source_l00061}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_aac9ab940753d6e6fcd6479e0a5b94f99}{00061}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_aac9ab940753d6e6fcd6479e0a5b94f99}{resetDataFileDict}(self):
00062         \textcolor{stringliteral}{"""}
00063 \textcolor{stringliteral}{        Reset the DataFileDict to the default value. This value is in defaultDict}
00064 \textcolor{stringliteral}{}
00065 \textcolor{stringliteral}{        """}
00066         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a196510345a35dc1749684b5619ce64d5}{setDataFileDict}(self.defaultDict)
00067 
00068 
\hypertarget{manage__atomic__data_8py_source_l00069}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a196510345a35dc1749684b5619ce64d5}{00069}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a196510345a35dc1749684b5619ce64d5}{setDataFileDict}(self, data\_dict=None):
00070         \textcolor{stringliteral}{"""}
00071 \textcolor{stringliteral}{        Use a dictionary for the atomic data (either predefined [string] or custom [dictionary]).}
00072 \textcolor{stringliteral}{        }
00073 \textcolor{stringliteral}{        Parameters:}
00074 \textcolor{stringliteral}{           - data\_dict    name of the dictionary }
00075 \textcolor{stringliteral}{}
00076 \textcolor{stringliteral}{        """}
00077         \textcolor{keywordflow}{if} data\_dict \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{manage__atomic__data_8py_source_l00078}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{00078}             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict} = \{\}
00079             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00080         \textcolor{keywordflow}{if} type(data\_dict) == type(\{\}):
00081             \textcolor{keywordflow}{for} atom \textcolor{keywordflow}{in} data\_dict:
00082                 \textcolor{keywordflow}{for} data\_type \textcolor{keywordflow}{in} data\_dict[atom]:
00083                     self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a76ee45cb9b8a5ead8cd716ebc0facf92}{setDataFile}(data\_dict[atom][data\_type], atom, data\_type)
\hypertarget{manage__atomic__data_8py_source_l00084}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a42d17444c105bd5238ae202a722ecb47}{00084}             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a42d17444c105bd5238ae202a722ecb47}{predefined} = \textcolor{keywordtype}{None}
00085         \textcolor{keywordflow}{elif} data\_dict \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a95c5df20a27033c4c32831d85a1c2876}{getPredefinedDataFileDict}():
00086             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a196510345a35dc1749684b5619ce64d5}{setDataFileDict}()
00087             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a196510345a35dc1749684b5619ce64d5}{setDataFileDict}(self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a95c5df20a27033c4c32831d85a1c2876}{getPredefinedDataFileDict}(
      data\_dict))
00088             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a42d17444c105bd5238ae202a722ecb47}{predefined} = data\_dict
00089             self.log\_.message(\textcolor{stringliteral}{'DataFileDict set to \{0\}.'}.format(data\_dict), calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00090         \textcolor{keywordflow}{else}:
00091             self.log\_.error(\textcolor{stringliteral}{'\{0\} is not a valid DataFileDict.'}.format(data\_dict), calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00092  
00093             
\hypertarget{manage__atomic__data_8py_source_l00094}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9c22482034e5d9154e315649c079b8fd}{00094}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a9c22482034e5d9154e315649c079b8fd}{addDataFilePath}(self, fits\_dir=None, inPyNeb=False):
00095         \textcolor{stringliteral}{"""}
00096 \textcolor{stringliteral}{        Add a directory to the list of directories where atomic data files are searched for.}
00097 \textcolor{stringliteral}{        }
00098 \textcolor{stringliteral}{        Parameters:}
00099 \textcolor{stringliteral}{           - fits\_dir    directory}
00100 \textcolor{stringliteral}{           - inPyNeb     Boolean.}
00101 \textcolor{stringliteral}{}
00102 \textcolor{stringliteral}{        """}
00103         \textcolor{keywordflow}{if} fits\_dir \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{manage__atomic__data_8py_source_l00104}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a92da10ed6b2395c54f88300c05a71ae9}{00104}             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a92da10ed6b2395c54f88300c05a71ae9}{\_DataFilePaths} = []
00105         \textcolor{keywordflow}{else}:
00106             \textcolor{keywordflow}{try}:
00107                 \textcolor{keywordflow}{if} inPyNeb:
00108                     self.\_DataFilePaths.append(\hyperlink{namespacepyneb_1_1utils_1_1misc_a0e9572755930aabb03c6b0e5d66b8356}{execution\_path}(fits\_dir))
00109                 \textcolor{keywordflow}{else}:
00110                     self.\_DataFilePaths.append(os.path.abspath(fits\_dir))
00111             \textcolor{keywordflow}{except}:
00112                 self.log\_.warn(\textcolor{stringliteral}{'\{0\} could not be added to the path list'}, calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00113  
00114  
\hypertarget{manage__atomic__data_8py_source_l00115}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a058a05e4bc4bb113b7ec44510a1a40f8}{00115}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a058a05e4bc4bb113b7ec44510a1a40f8}{removeDataFilePath}(self, fits\_dir=None):
00116         \textcolor{stringliteral}{"""}
00117 \textcolor{stringliteral}{        Remove a directory from the list of directories where atomic data files are searched for.}
00118 \textcolor{stringliteral}{}
00119 \textcolor{stringliteral}{        Parameters:}
00120 \textcolor{stringliteral}{           - fits\_dir    name of the directory to be removed}
00121 \textcolor{stringliteral}{}
00122 \textcolor{stringliteral}{        """}
00123         \textcolor{keywordflow}{if} fits\_dir \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00124             \textcolor{keywordflow}{pass}
00125         \textcolor{keywordflow}{else}:
00126             \textcolor{keywordflow}{try}:
00127                 self.\_DataFilePaths.remove(os.path.abspath(fits\_dir))
00128             \textcolor{keywordflow}{except}:
00129                 \textcolor{keywordflow}{pass}
00130             \textcolor{keywordflow}{try}:
00131                 self.\_DataFilePaths.remove(\hyperlink{namespacepyneb_1_1utils_1_1misc_a0e9572755930aabb03c6b0e5d66b8356}{execution\_path}(fits\_dir))
00132             \textcolor{keywordflow}{except}:
00133                 \textcolor{keywordflow}{pass}
00134  
00135                 
\hypertarget{manage__atomic__data_8py_source_l00136}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ada200fb69531c28d492bf326337e53c7}{00136}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ada200fb69531c28d492bf326337e53c7}{getAllDataFilePaths}(self):
00137         \textcolor{stringliteral}{"""}
00138 \textcolor{stringliteral}{        Return the list of directories where atomic data files are searched for.}
00139 \textcolor{stringliteral}{}
00140 \textcolor{stringliteral}{        """}
00141         \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a92da10ed6b2395c54f88300c05a71ae9}{\_DataFilePaths}
00142  
00143             
\hypertarget{manage__atomic__data_8py_source_l00144}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_acd017c8296821230170a520927be8c66}{00144}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_acd017c8296821230170a520927be8c66}{getDirForFile}(self, data\_file):
00145         \textcolor{stringliteral}{"""}
00146 \textcolor{stringliteral}{        Return the first directory from getDataFilePaths() where a file is found.}
00147 \textcolor{stringliteral}{        If nothing is found, return None.}
00148 \textcolor{stringliteral}{}
00149 \textcolor{stringliteral}{        Parameters:}
00150 \textcolor{stringliteral}{           - data\_file    name of the file}
00151 \textcolor{stringliteral}{}
00152 \textcolor{stringliteral}{        """}
00153         
00154         \textcolor{keywordflow}{for} dir \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a92da10ed6b2395c54f88300c05a71ae9}{\_DataFilePaths}:
00155             \textcolor{keywordflow}{if} data\_file \textcolor{keywordflow}{in} os.listdir(dir):
00156                 \textcolor{keywordflow}{return} dir
00157         \textcolor{keywordflow}{if} data\_file.split(\textcolor{stringliteral}{'.'})[-1] == \textcolor{stringliteral}{'chianti'}:
00158             strs = data\_file.split(\textcolor{stringliteral}{'\_'})
00159             elem = strs[0].capitalize()
00160             spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a97329c3ce57bd870421672b90e3e6541}{roman\_to\_int}(strs[1])
00161             atom = elem + str(spec)
00162             strs = re.split(\textcolor{stringliteral}{r'[\_.]+'},data\_file)
00163             data\_type = strs[2]
00164             \textcolor{keywordflow}{if} (data\_type == \textcolor{stringliteral}{'atom'}) \textcolor{keywordflow}{and} (\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{atom2chianti}(atom) \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'atom'}]):
00165                 return(\textcolor{stringliteral}{'\{\}/\{\}/\{\}'}.format(self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{Chianti\_path}, elem.lower(), 
      \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{atom2chianti}(atom)))
00166             \textcolor{keywordflow}{if} (data\_type == \textcolor{stringliteral}{'coll'}) \textcolor{keywordflow}{and} (\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{atom2chianti}(atom) \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'coll'}]):
00167                 return(\textcolor{stringliteral}{'\{\}/\{\}/\{\}'}.format(self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{Chianti\_path}, elem.lower(), 
      \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{atom2chianti}(atom)))
00168         \textcolor{keywordflow}{else}:
00169             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00170  
00171     
\hypertarget{manage__atomic__data_8py_source_l00172}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ae6058f81e349162d18cc2baca19b328e}{00172}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ae6058f81e349162d18cc2baca19b328e}{printDirForAllFiles}(self):
00173         \textcolor{stringliteral}{"""}
00174 \textcolor{stringliteral}{        Print the directories where all the files defined in the dictionary of }
00175 \textcolor{stringliteral}{            atomic data files are located.}
00176 \textcolor{stringliteral}{}
00177 \textcolor{stringliteral}{        """}
00178         \textcolor{keywordflow}{for} atom \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}:
00179             atom\_file = self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, \textcolor{stringliteral}{'atom'}, warn=\textcolor{keyword}{False})
00180             \textcolor{keywordflow}{if} atom\_file \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00181                 print(\textcolor{stringliteral}{'\{0\} atom from \{1\} in \{2\}'}.format(atom, atom\_file , self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_acd017c8296821230170a520927be8c66}{getDirForFile}(atom\_file)))
00182             coll\_file = self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, \textcolor{stringliteral}{'coll'}, warn=\textcolor{keyword}{False})
00183             \textcolor{keywordflow}{if} coll\_file \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00184                 print(\textcolor{stringliteral}{'\{0\} coll from \{1\} in \{2\}'}.format(atom, coll\_file , self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_acd017c8296821230170a520927be8c66}{getDirForFile}(coll\_file)))
00185             rec\_file = self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, \textcolor{stringliteral}{'rec'}, warn=\textcolor{keyword}{False})
00186             \textcolor{keywordflow}{if} rec\_file \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00187                 print(\textcolor{stringliteral}{'\{0\} rec from \{1\} in \{2\}'}.format(atom, rec\_file , self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_acd017c8296821230170a520927be8c66}{getDirForFile}(rec\_file)))
00188  
00189  
\hypertarget{manage__atomic__data_8py_source_l00190}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ac828c51afd39972cc4fb0f2b48617857}{00190}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ac828c51afd39972cc4fb0f2b48617857}{getAllAvailableFiles}(self, atom=None, data\_type=None):
00191         \textcolor{stringliteral}{"""}
00192 \textcolor{stringliteral}{        Scan every directory in the list of paths, printing all the *atom*.fits, *atom*.dat,}
00193 \textcolor{stringliteral}{            *coll*.fits and *rec*.fits files}
00194 \textcolor{stringliteral}{            }
00195 \textcolor{stringliteral}{        Parameters:}
00196 \textcolor{stringliteral}{           - atom        atom name}
00197 \textcolor{stringliteral}{           - data\_type   either 'rec', 'atom', 'coll' or 'trc'}
00198 \textcolor{stringliteral}{}
00199 \textcolor{stringliteral}{        """}
00200         file\_list = []
00201         \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00202             data\_types = [\textcolor{stringliteral}{'atom'}, \textcolor{stringliteral}{'coll'}, \textcolor{stringliteral}{'rec'}, \textcolor{stringliteral}{'trc'}]
00203         \textcolor{keywordflow}{else}:
00204             data\_types = [data\_type]
00205         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00206             elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)
00207             elem = elem.lower()
00208             spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_aec4e973d4cb9299f749ef190ea636a06}{int\_to\_roman}(int(spec)).lower()
00209             atom\_str = \textcolor{stringliteral}{'\{0\}\_\{1\}\_'}.format(elem, spec)
00210             \textcolor{keywordflow}{if} \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{atom2chianti}(atom) \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'atom'}]:
00211                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'atom'} \textcolor{keywordflow}{in} data\_types:
00212                     file\_list.append(\textcolor{stringliteral}{'\{0\}\_\{1\}\_atom.chianti'}.format(elem, spec))
00213             \textcolor{keywordflow}{if} \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a9c992b2ae01f2e369be5d539172f78a0}{atom2chianti}(atom) \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'coll'}]:
00214                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'coll'} \textcolor{keywordflow}{in} data\_types:
00215                     file\_list.append(\textcolor{stringliteral}{'\{0\}\_\{1\}\_coll.chianti'}.format(elem, spec))
00216         \textcolor{keywordflow}{else}:
00217             atom\_str = \textcolor{stringliteral}{'.'}
00218             \textcolor{keywordflow}{for} atom \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'atom'}]:
00219                 elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)
00220                 elem = elem.lower()
00221                 spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_aec4e973d4cb9299f749ef190ea636a06}{int\_to\_roman}(int(spec)).lower()
00222                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'atom'} \textcolor{keywordflow}{in} data\_types:
00223                     file\_list.append(\textcolor{stringliteral}{'\{0\}\_\{1\}\_atom.chianti'}.format(elem, spec))
00224             \textcolor{keywordflow}{for} atom \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'coll'}]:
00225                 elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)
00226                 elem = elem.lower()
00227                 spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_aec4e973d4cb9299f749ef190ea636a06}{int\_to\_roman}(int(spec)).lower()
00228                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'coll'} \textcolor{keywordflow}{in} data\_types:
00229                     file\_list.append(\textcolor{stringliteral}{'\{0\}\_\{1\}\_coll.chianti'}.format(elem, spec))
00230         \textcolor{keywordflow}{for} dir \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a92da10ed6b2395c54f88300c05a71ae9}{\_DataFilePaths}:
00231             files = os.listdir(dir)
00232             \textcolor{keywordflow}{for} file \textcolor{keywordflow}{in} files:
00233                 \textcolor{keywordflow}{if} ((\textcolor{stringliteral}{'.fits'} \textcolor{keywordflow}{in} file) \textcolor{keywordflow}{or} (\textcolor{stringliteral}{'.dat'} \textcolor{keywordflow}{in} file) ) \textcolor{keywordflow}{and} (atom\_str \textcolor{keywordflow}{in} file):
00234                     \textcolor{keywordflow}{for} dt \textcolor{keywordflow}{in} data\_types:
00235                         \textcolor{keywordflow}{if} dt \textcolor{keywordflow}{in} file:
00236                             file\_list.append(file)
00237                             
00238         file\_list.sort()
00239         \textcolor{keywordflow}{return} file\_list
00240     
00241     
\hypertarget{manage__atomic__data_8py_source_l00242}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a5de7925aac194c157f7fbd243ee25c17}{00242}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a5de7925aac194c157f7fbd243ee25c17}{getAllPossibleAtoms}(self):
00243         \textcolor{stringliteral}{"""}
00244 \textcolor{stringliteral}{        Return the list of all the possible collisional and recombination }
00245 \textcolor{stringliteral}{        atoms that can be built with the available datafiles (not all of }
00246 \textcolor{stringliteral}{        them necessarily included in the current atomic file dictionary) }
00247 \textcolor{stringliteral}{                    }
00248 \textcolor{stringliteral}{        Parameters:}
00249 \textcolor{stringliteral}{           - atom        atom name}
00250 \textcolor{stringliteral}{           - data\_type   either 'rec', 'atom' or 'coll'}
00251 \textcolor{stringliteral}{}
00252 \textcolor{stringliteral}{        """}
00253         atom\_dict = \{\textcolor{stringliteral}{'atom'}:[], \textcolor{stringliteral}{'coll'}: [], \textcolor{stringliteral}{'rec'}: []\}
00254         \textcolor{keywordflow}{for} path \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a92da10ed6b2395c54f88300c05a71ae9}{\_DataFilePaths}:
00255             files = os.listdir(path)
00256             \textcolor{keywordflow}{for} elem \textcolor{keywordflow}{in} ELEM\_LIST:
00257                 \textcolor{keywordflow}{for} spec \textcolor{keywordflow}{in} SPEC\_LIST:
00258                     atom = elem + spec
00259                     atom\_str = \textcolor{stringliteral}{'\{0\}\_\{1\}\_'}.format(elem.lower(), \hyperlink{namespacepyneb_1_1utils_1_1misc_aec4e973d4cb9299f749ef190ea636a06}{int\_to\_roman}(int(spec)).lower())
00260                     \textcolor{keywordflow}{for} entry \textcolor{keywordflow}{in} files:
00261                         \textcolor{keywordflow}{if} ((\textcolor{stringliteral}{'.fits'} \textcolor{keywordflow}{in} entry) \textcolor{keywordflow}{or} (\textcolor{stringliteral}{'.dat'} \textcolor{keywordflow}{in} entry) ) \textcolor{keywordflow}{and} (atom\_str \textcolor{keywordflow}{in} entry):
00262                             \textcolor{keywordflow}{if} (\textcolor{stringliteral}{'atom'} \textcolor{keywordflow}{in} entry):
00263                                 atom\_dict[\textcolor{stringliteral}{'atom'}].append(atom)
00264                             \textcolor{keywordflow}{elif} (\textcolor{stringliteral}{'coll'} \textcolor{keywordflow}{in} entry):
00265                                 atom\_dict[\textcolor{stringliteral}{'coll'}].append(atom)
00266                             \textcolor{keywordflow}{elif} (\textcolor{stringliteral}{'rec'} \textcolor{keywordflow}{in} entry):
00267                                 atom\_dict[\textcolor{stringliteral}{'rec'}].append(atom)
00268                             \textcolor{keywordflow}{else}:
00269                                 \textcolor{keywordflow}{pass}
00270         coll\_atom\_list = list(set(atom\_dict[\textcolor{stringliteral}{'atom'}]) & set(atom\_dict[\textcolor{stringliteral}{'coll'}]))
00271         rec\_atom\_list = list(set(atom\_dict[\textcolor{stringliteral}{'rec'}]))
00272         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Data for the following collisional atoms exist:'}, coll\_atom\_list
00273         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Data for the following recombination atoms exist:'}, rec\_atom\_list
00274         \textcolor{keywordflow}{return} [coll\_atom\_list, rec\_atom\_list] 
00275         
00276     
\hypertarget{manage__atomic__data_8py_source_l00277}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a6e4f6d5890cfb5e3371b46c319c67f53}{00277}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a6e4f6d5890cfb5e3371b46c319c67f53}{getAllAtoms}(self, coll=True, rec=False):
00278         \textcolor{stringliteral}{"""}
00279 \textcolor{stringliteral}{        Return a list of all the atoms (e.g. 'O3') included in the adopted dictionary }
00280 \textcolor{stringliteral}{        and for which dataFiles are available (a subset of all the ions returned by}
00281 \textcolor{stringliteral}{        the getAllPossibleIons() command)}
00282 \textcolor{stringliteral}{}
00283 \textcolor{stringliteral}{        Parameters:}
00284 \textcolor{stringliteral}{            - coll     if True (default) includes the Atom objects}
00285 \textcolor{stringliteral}{            - rec     if True (not the default) includes the RecAtoms}
00286 \textcolor{stringliteral}{}
00287 \textcolor{stringliteral}{        """}
00288         to\_return = []
00289         \textcolor{keywordflow}{for} atom \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}:
00290             \textcolor{keywordflow}{if} coll \textcolor{keywordflow}{and} (\textcolor{stringliteral}{'atom'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}[atom]):
00291                 to\_return.append(atom)
00292             \textcolor{keywordflow}{if} rec \textcolor{keywordflow}{and} (\textcolor{stringliteral}{'rec'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}[atom]):
00293                 to\_return.append(atom)
00294         \textcolor{keywordflow}{return} to\_return
00295             
00296 
\hypertarget{manage__atomic__data_8py_source_l00297}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{00297}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(self, atom=None, data\_type=None, warn=True):
00298         \textcolor{stringliteral}{"""}
00299 \textcolor{stringliteral}{        Return the name of the atomic data file associated to an atom and a type of data, }
00300 \textcolor{stringliteral}{        which is one of ('atom', 'coll', 'rec').}
00301 \textcolor{stringliteral}{            }
00302 \textcolor{stringliteral}{        Parameters:}
00303 \textcolor{stringliteral}{            - atom        selected atom}
00304 \textcolor{stringliteral}{            - data\_type   type of atomic data ('atom', 'coll', 'rec', 'trc')}
00305 \textcolor{stringliteral}{            - warn        warn if no associated data file is found}
00306 \textcolor{stringliteral}{        }
00307 \textcolor{stringliteral}{        """}
00308         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00309             \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00310                 \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}
00311             \textcolor{keywordflow}{else}:
00312                 DFD = self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}
00313                 to\_return = \{\}
00314                 \textcolor{keywordflow}{for} at \textcolor{keywordflow}{in} DFD:
00315                     \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{in} DFD[at]:
00316                         to\_return[at] = DFD[at][data\_type]
00317                 \textcolor{keywordflow}{return} to\_return
00318         \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00319             return(self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, \textcolor{stringliteral}{'atom'}, warn=warn),
00320                    self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, \textcolor{stringliteral}{'coll'}, warn=warn),
00321                    self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, \textcolor{stringliteral}{'rec'}, warn=warn),
00322                    self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, \textcolor{stringliteral}{'trc'}, warn=warn))
00323         \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} (\textcolor{stringliteral}{'atom'}, \textcolor{stringliteral}{'coll'}, \textcolor{stringliteral}{'rec'}, \textcolor{stringliteral}{'trc'}):
00324             \textcolor{keywordflow}{if} warn:
00325                 self.log\_.warn(\textcolor{stringliteral}{'\{0\} type unknown'}.format(data\_type), calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00326             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00327         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}:
00328             \textcolor{keywordflow}{if} warn:
00329                 self.log\_.warn(\textcolor{stringliteral}{'data for \{0\} not available'}.format(atom), calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00330             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00331         \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}[atom]:
00332             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}[atom][data\_type]
00333         \textcolor{keywordflow}{else}:
00334             \textcolor{keywordflow}{if} warn:
00335                 self.log\_.warn(\textcolor{stringliteral}{'\{0\} data not available for \{1\}'}.format(data\_type, atom), calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00336             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00337 
00338         
\hypertarget{manage__atomic__data_8py_source_l00339}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ac8f4b782b3aee9491aa3542fd933bd52}{00339}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ac8f4b782b3aee9491aa3542fd933bd52}{getDataFullPath}(self, atom, data\_type=None, warn=True):
00340         \textcolor{stringliteral}{"""}
00341 \textcolor{stringliteral}{        Return the full path of the atomic data file associated to an atom and a type of data, }
00342 \textcolor{stringliteral}{        which is one of ('atom', 'coll', 'rec').}
00343 \textcolor{stringliteral}{        }
00344 \textcolor{stringliteral}{        Parameters:}
00345 \textcolor{stringliteral}{            - atom        selected atom}
00346 \textcolor{stringliteral}{            - data\_type   type of atomic data ('atom', 'coll', 'rec', 'trc')}
00347 \textcolor{stringliteral}{            - warn        warn if no associated data file is found}
00348 \textcolor{stringliteral}{        }
00349 \textcolor{stringliteral}{        """}
00350         data\_file = self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a289b3ad01e359e3550b2384362c36990}{getDataFile}(atom, data\_type=data\_type, warn=warn)
00351         data\_path = self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_acd017c8296821230170a520927be8c66}{getDirForFile}(data\_file)
00352         \textcolor{keywordflow}{if} data\_file \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00353             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00354         \textcolor{keywordflow}{else}:
00355             \textcolor{keywordflow}{return} \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(data\_path, data\_file)
00356 
00357 
\hypertarget{manage__atomic__data_8py_source_l00358}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_af9b8c445d7b585983c8b5221aad5402f}{00358}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_af9b8c445d7b585983c8b5221aad5402f}{scanDirForDataFiles}(self, fits\_dir):
00359         \textcolor{stringliteral}{"""}
00360 \textcolor{stringliteral}{        Scan a directory and associate any file named x\_i\_type\_ref.fits to the atom Xi (i in roman), }
00361 \textcolor{stringliteral}{        type being one of ('atom', 'coll', 'rec').}
00362 \textcolor{stringliteral}{        The directory must have been registered before using addDataFilePath(fits\_dir)}
00363 \textcolor{stringliteral}{}
00364 \textcolor{stringliteral}{        Parameters:}
00365 \textcolor{stringliteral}{            - fits\_dir        directory name}
00366 \textcolor{stringliteral}{}
00367 \textcolor{stringliteral}{        """}
00368         \textcolor{keywordflow}{for} file\_ \textcolor{keywordflow}{in} os.listdir(fits\_dir):
00369             names = \hyperlink{namespacepyneb_1_1utils_1_1misc_a4fc4f061f0c41f29de52ec765f894faf}{multi\_split}(file\_, [\textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{'.'}])
00370             elem = names[0].title()            
00371             \textcolor{keywordflow}{if} elem \textcolor{keywordflow}{in} ELEM\_LIST:
00372                 spec = str(\hyperlink{namespacepyneb_1_1utils_1_1misc_a97329c3ce57bd870421672b90e3e6541}{roman\_to\_int}(names[1]))
00373                 \textcolor{keywordflow}{if} spec \textcolor{keywordflow}{in} SPEC\_LIST:
00374                     atom = elem + spec
00375                     \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}:
00376                         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}[atom] = \{\}
00377                     \textcolor{keywordflow}{if} names[2] \textcolor{keywordflow}{in} (\textcolor{stringliteral}{'atom'}, \textcolor{stringliteral}{'coll'}, \textcolor{stringliteral}{'rec'}, \textcolor{stringliteral}{'trc'}):
00378                         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a76ee45cb9b8a5ead8cd716ebc0facf92}{setDataFile}(atom, names[2], file\_)
00379  
\hypertarget{manage__atomic__data_8py_source_l00380}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a76ee45cb9b8a5ead8cd716ebc0facf92}{00380}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a76ee45cb9b8a5ead8cd716ebc0facf92}{setDataFile}(self, data\_file=None, atom=None, data\_type=None):
00381         \textcolor{stringliteral}{"""}
00382 \textcolor{stringliteral}{        Associate an atomic data file to an atom and a type of data, which is one of }
00383 \textcolor{stringliteral}{            ('atom', 'coll', 'rec').}
00384 \textcolor{stringliteral}{}
00385 \textcolor{stringliteral}{        Usage:}
00386 \textcolor{stringliteral}{            pn.atomicData.setDataFile('cl\_iii\_atom\_M83-KS86.fits')}
00387 \textcolor{stringliteral}{            pn.atomicData.setDataFile('TEST.fits', 'O3', 'atom') # but the previous way }
00388 \textcolor{stringliteral}{                to name the files is preferred}
00389 \textcolor{stringliteral}{            pn.atomicData.setDataFile('o\_iii\_atom.chianti')}
00390 \textcolor{stringliteral}{}
00391 \textcolor{stringliteral}{        Parameters:}
00392 \textcolor{stringliteral}{            - data\_file    atomic data file. }
00393 \textcolor{stringliteral}{            - [atom]         selected atom}
00394 \textcolor{stringliteral}{            - [data\_type]    'atom', 'coll', 'rec'}
00395 \textcolor{stringliteral}{            If atom and data\_type not set, file format is assumed to be e.g. o\_iii\_coll\_REF.fits}
00396 \textcolor{stringliteral}{}
00397 \textcolor{stringliteral}{        """}          
00398         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00399             strs = data\_file.split(\textcolor{stringliteral}{'\_'})
00400             elem = strs[0].capitalize()
00401             spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a97329c3ce57bd870421672b90e3e6541}{roman\_to\_int}(strs[1])
00402             atom = elem + str(spec)
00403         \textcolor{keywordflow}{else}:
00404             elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)
00405         \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00406             strs = re.split(\textcolor{stringliteral}{r'[\_.]+'},data\_file)
00407             data\_type = strs[2]
00408         \textcolor{keywordflow}{if} data\_type \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} (\textcolor{stringliteral}{'atom'}, \textcolor{stringliteral}{'coll'}, \textcolor{stringliteral}{'rec'}, \textcolor{stringliteral}{'trc'}):
00409             self.log\_.error(\textcolor{stringliteral}{'\{0\} is not a valid type'}.format(data\_type))
00410             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00411         \textcolor{keywordflow}{if} elem \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} ELEM\_LIST:
00412             self.log\_.error(\textcolor{stringliteral}{'\{0\} is not a valid element'}.format(elem))
00413             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00414         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}:
00415             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}[atom] = \{\}
00416         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_acd017c8296821230170a520927be8c66}{getDirForFile}(data\_file) \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00417             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a25a8e0770b6d8a375cfc9092d600684d}{\_DataFileDict}[atom][data\_type] = data\_file
00418             \textcolor{comment}{# as something changed, predefined is not valid anymore}
00419             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a42d17444c105bd5238ae202a722ecb47}{predefined} = \textcolor{keywordtype}{None}
00420             \textcolor{keywordflow}{if} data\_type == \textcolor{stringliteral}{'rec'}:
00421                 \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a01eaf095b647e87d3dbf9094104f680c}{\_RecombData}:
00422                     del self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a01eaf095b647e87d3dbf9094104f680c}{\_RecombData}[atom]
00423             self.log\_.message(\textcolor{stringliteral}{'Adding \{0\} \{1\} data for \{2\}'}.format(data\_file, data\_type, atom), calling=
      self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00424         \textcolor{keywordflow}{else}:
00425             self.log\_.error(\textcolor{stringliteral}{'Unknown file \{0\} or corresponding File path not included in list. Run
       addDataFilePath first'}.format(data\_file),
00426                            calling=self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00427         \textcolor{keywordflow}{if} (atom == \textcolor{stringliteral}{'H1'}) \textcolor{keywordflow}{and} (\textcolor{stringliteral}{'H1'} \textcolor{keywordflow}{in} pn.atomicData.\_RecombData):
00428             del pn.atomicData.\_RecombData[\textcolor{stringliteral}{'H1'}]
00429 
00430 
\hypertarget{manage__atomic__data_8py_source_l00431}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a17f7d0a39484aa363bd2814ffbee2855}{00431}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a17f7d0a39484aa363bd2814ffbee2855}{printAllSources}(self, at\_set=None, predef=None):
00432         \textcolor{stringliteral}{"""}
00433 \textcolor{stringliteral}{        Print bibliographic sources of the adopted data sets of a list of atoms.}
00434 \textcolor{stringliteral}{        }
00435 \textcolor{stringliteral}{        Usage:}
00436 \textcolor{stringliteral}{        pn.atomicData.printAllSources(['O3', 'Ar4', 'S2'])}
00437 \textcolor{stringliteral}{        pn.atomicData.printAllSources([O, S])}
00438 \textcolor{stringliteral}{        pn.atomicData.printAllSources()}
00439 \textcolor{stringliteral}{}
00440 \textcolor{stringliteral}{        Parameters: }
00441 \textcolor{stringliteral}{            - at\_set   a list or tuple containing the atoms. If not set, }
00442 \textcolor{stringliteral}{                       print bibliographic sources for all the atoms in PyNeb's default dictionary}
00443 \textcolor{stringliteral}{                       }
00444 \textcolor{stringliteral}{        """}        
00445         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling} = \textcolor{stringliteral}{'printAllSources'}
00446         \textcolor{keywordflow}{if} (type(at\_set) == list) \textcolor{keywordflow}{or} (type(at\_set) == tuple):
00447             at\_dict = \{\}
00448             \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} at\_set:
00449                 atom = pn.utils.misc.parseAtom(item)[0]
00450                 spec = pn.utils.misc.parseAtom(item)[1]
00451                 \textcolor{keywordflow}{if} spec \textcolor{keywordflow}{is} \textcolor{stringliteral}{''}:
00452                     \textcolor{keywordflow}{for} ispec \textcolor{keywordflow}{in} SPEC\_LIST:
00453                         \textcolor{keywordflow}{try}:
00454                             at\_dict[atom+ispec] = pn.Atom(atom, ispec)
00455                         \textcolor{keywordflow}{except}:
00456                             \textcolor{keywordflow}{pass}
00457                 \textcolor{keywordflow}{else}:
00458                     at\_dict[item] = pn.Atom(atom, spec)
00459         \textcolor{keywordflow}{elif} at\_set \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00460             pn.log\_.error(\textcolor{stringliteral}{'The argument at\_set must be a list or a tuple'}, calling=self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00461             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00462         \textcolor{keywordflow}{elif} (at\_set \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (predef \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}):
00463             at\_dict = pn.getAtomDict()
00464         \textcolor{keywordflow}{elif} predef \textcolor{keywordflow}{in} pn.atomicData.getAllPredefinedDict():
00465             current = pn.atomicData.predefined
00466             pn.atomicData.setDataFileDict(predef)
00467             at\_dict = pn.getAtomDict()
00468             pn.atomicData.setDataFileDict(current)
00469         \textcolor{keywordflow}{else}: 
00470             pn.log\_.error(\textcolor{stringliteral}{'The argument predef must be the label of a predefined dictionary'}, 
00471                           calling=self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_ab10b91ca784741ce7af163d010802434}{calling})
00472         
00473         \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} sorted(at\_dict):                                                              
00474             at\_dict[item].printSources()
00475     
\hypertarget{manage__atomic__data_8py_source_l00476}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a76dc32f396e494e06327a6c8464d005e}{00476}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a76dc32f396e494e06327a6c8464d005e}{\_initChianti}(self):
\hypertarget{manage__atomic__data_8py_source_l00477}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{00477}         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS} = \{\textcolor{stringliteral}{'atom'}:[], \textcolor{stringliteral}{'coll'}:[]\}
\hypertarget{manage__atomic__data_8py_source_l00478}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{00478}         self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{Chianti\_path} = \textcolor{keywordtype}{None}
00479         
00480         \textcolor{keywordflow}{if} pn.config.INSTALLED[\textcolor{stringliteral}{'Chianti'}]:
00481     
00482             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{Chianti\_path} = os.environ[\textcolor{stringliteral}{'XUVTOP'}]
00483             masterlist = \textcolor{stringliteral}{'\{0\}/masterlist/masterlist.ions'}.format(self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{Chianti\_path})
00484             \textcolor{keywordflow}{try}:
00485                 with open(masterlist) \textcolor{keyword}{as} master:
00486                     \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} master.readlines():
00487                         atom = line.split()[0]
00488                         elem = atom.split(\textcolor{stringliteral}{'\_'})[0]
00489                         coll\_file = \textcolor{stringliteral}{'\{0\}/\{1\}/\{2\}/\{2\}.splups'}.format(self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{Chianti\_path}, elem, atom)
00490                         atom\_file = \textcolor{stringliteral}{'\{0\}/\{1\}/\{2\}/\{2\}.wgfa'}.format(self.
      \hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a898e51085e3461333ea9df3a3fce3599}{Chianti\_path}, elem, atom)
00491                         \textcolor{keywordflow}{if} os.path.exists(coll\_file): 
00492                             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'coll'}].append(atom)
00493                         \textcolor{keywordflow}{if} os.path.exists(atom\_file):
00494                             self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a06491f5f808df3d4e58b35e09db74a18}{ChiantiIONS}[\textcolor{stringliteral}{'atom'}].append(atom)
00495             \textcolor{keywordflow}{except}:
00496                 pn.log\_.warn(\textcolor{stringliteral}{'File not found \{\}, no Chianti data available'}.format(masterlist), 
00497                              calling=\textcolor{stringliteral}{'\_initChianti'})
00498         
\hypertarget{manage__atomic__data_8py_source_l00499}{}\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a780a8f85e8acf64b44b2bce4b4292386}{00499}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a780a8f85e8acf64b44b2bce4b4292386}{printPoem}(self, yr=0):
00500         \textcolor{stringliteral}{"""}
00501 \textcolor{stringliteral}{        Print one of Wiese et al. spectroscopic poems}
00502 \textcolor{stringliteral}{        }
00503 \textcolor{stringliteral}{        Parameters:}
00504 \textcolor{stringliteral}{            - yr     publication year. If no valid year is given, random print}
00505 \textcolor{stringliteral}{ }
00506 \textcolor{stringliteral}{        """}
00507         \textcolor{keywordflow}{if} (yr == 96):
00508             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"********************************************"}
00509             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
00510             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"We have used a near limitless data source,"}
00511             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"It is the Opacity Project, of course."}
00512             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"Its results are certainly fine"}
00513             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"For most any LS-coupled line."}        
00514             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
00515             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"            (Wiese, Fuhr & Deters 1996)"}
00516             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
00517             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"********************************************"}
00518         \textcolor{keywordflow}{elif} (yr == 66):
00519             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"********************************************"}
00520             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
00521             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"If there is no other data source"}
00522             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"Use the Coulomb approximation, of course."}    
00523             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"The results should be certainly fine"}
00524             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"For any moderately or highly excited line."}
00525             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
00526             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"            (Wiese, Smith & Glennon 1966)"} 
00527             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
00528             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"********************************************"}
00529         \textcolor{keywordflow}{else}:
00530             rnd = np.random.rand()
00531             \textcolor{keywordflow}{if} (rnd < 0.5):
00532                 self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a780a8f85e8acf64b44b2bce4b4292386}{printPoem}(yr=66)
00533             \textcolor{keywordflow}{else}:
00534                 self.\hyperlink{classpyneb_1_1utils_1_1manage__atomic__data_1_1___manage_atomic_data_a780a8f85e8acf64b44b2bce4b4292386}{printPoem}(yr=96)
00535 
00536 
\hypertarget{manage__atomic__data_8py_source_l00537}{}\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a211c531a869b2e0789e557b2a15a892c}{00537} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a211c531a869b2e0789e557b2a15a892c}{extract\_flt}(str\_):
00538     \textcolor{stringliteral}{"""}
00539 \textcolor{stringliteral}{    Return the first float in str\_, removing the no digit (and no dot) leading part of it.}
00540 \textcolor{stringliteral}{    Ex:}
00541 \textcolor{stringliteral}{    extract\_flt('123.00?') -> 123.00}
00542 \textcolor{stringliteral}{    """}
00543     res = \textcolor{stringliteral}{''}
00544     \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} str\_:
00545         \textcolor{keywordflow}{if} l.isdigit() \textcolor{keywordflow}{or} l == \textcolor{stringliteral}{'.'}:
00546             res += l
00547         \textcolor{keywordflow}{else}:
00548             \textcolor{keywordflow}{break}
00549     \textcolor{keywordflow}{if} res == \textcolor{stringliteral}{''}:
00550         \textcolor{keywordflow}{return} np.nan
00551     \textcolor{keywordflow}{else}:
00552         \textcolor{keywordflow}{return} float(res)
00553 
00554 
\hypertarget{manage__atomic__data_8py_source_l00555}{}\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ab843a6f51ebb888e83a849835e49a885}{00555} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ab843a6f51ebb888e83a849835e49a885}{readNIST}(NISTfile):
00556     \textcolor{stringliteral}{"""}
00557 \textcolor{stringliteral}{    The NIST levels file must be obtained from this page:}
00558 \textcolor{stringliteral}{        http://physics.nist.gov/PhysRefData/ASD/levels\_form.html}
00559 \textcolor{stringliteral}{    with the following options:}
00560 \textcolor{stringliteral}{        Level Units: cm-1}
00561 \textcolor{stringliteral}{        Format output: ASCII}
00562 \textcolor{stringliteral}{        Display output: in its entirely}
00563 \textcolor{stringliteral}{        Energy ordered}
00564 \textcolor{stringliteral}{        Level Information: Principal configuration, Principal term, Level, J}
00565 \textcolor{stringliteral}{        Bibliographic references}
00566 \textcolor{stringliteral}{    """}
00567     data = np.genfromtxt(NISTfile, comments = \textcolor{stringliteral}{'-'}, 
00568                     delimiter = \textcolor{stringliteral}{'|'}, names = \textcolor{stringliteral}{'conf, term, J, energy, ref'}, 
00569                     dtype=(\textcolor{stringliteral}{'a23'}, \textcolor{stringliteral}{'a9'}, \textcolor{stringliteral}{'a4'}, \textcolor{stringliteral}{'float'}, \textcolor{stringliteral}{'a10'}), autostrip=\textcolor{keyword}{True},
00570                     converters = \{\textcolor{stringliteral}{'energy'}:extract\_flt\})
00571     data = data[data[\textcolor{stringliteral}{'J'}] != \textcolor{stringliteral}{''}]
00572     previous\_ref = \textcolor{stringliteral}{''}
00573     previous\_conf = \textcolor{stringliteral}{''}
00574     previous\_term = \textcolor{stringliteral}{''}
00575     \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data:
00576         \textcolor{keywordflow}{if} d[\textcolor{stringliteral}{'conf'}] == \textcolor{stringliteral}{''}:
00577             d[\textcolor{stringliteral}{'conf'}] = previous\_conf
00578         \textcolor{keywordflow}{else}:
00579             previous\_conf = d[\textcolor{stringliteral}{'conf'}]
00580         \textcolor{keywordflow}{if} d[\textcolor{stringliteral}{'term'}] == \textcolor{stringliteral}{''}:
00581             d[\textcolor{stringliteral}{'term'}] = previous\_term
00582         \textcolor{keywordflow}{else}:
00583             previous\_term = d[\textcolor{stringliteral}{'term'}]
00584         \textcolor{keywordflow}{if} d[\textcolor{stringliteral}{'ref'}] == \textcolor{stringliteral}{''}:
00585             d[\textcolor{stringliteral}{'ref'}] = previous\_ref
00586         \textcolor{keywordflow}{else}:
00587             previous\_ref = d[\textcolor{stringliteral}{'ref'}]
00588         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'?'} \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'J'}]:
00589             d[\textcolor{stringliteral}{'J'}] = d[\textcolor{stringliteral}{'J'}].split(\textcolor{stringliteral}{'?'})[0]
00590         \textcolor{keywordflow}{if} d[\textcolor{stringliteral}{'J'}] == \textcolor{stringliteral}{''}:
00591             d[\textcolor{stringliteral}{'J'}] = 0.
00592         \textcolor{keywordflow}{elif} \textcolor{stringliteral}{'/'} \textcolor{keywordflow}{in} d[\textcolor{stringliteral}{'J'}]:
00593             d[\textcolor{stringliteral}{'J'}] = \textcolor{stringliteral}{'\{0:.1f\}'}.format(float(d[\textcolor{stringliteral}{'J'}].split(\textcolor{stringliteral}{'/'})[0]) / float(d[\textcolor{stringliteral}{'J'}].split(\textcolor{stringliteral}{'/'})[1]))
00594         \textcolor{keywordflow}{else}:
00595             d[\textcolor{stringliteral}{'J'}] = \textcolor{stringliteral}{'\{0:.1f\}'}.format(float(d[\textcolor{stringliteral}{'J'}]))
00596            
00597     data = data[data[\textcolor{stringliteral}{'energy'}].argsort()]
00598     data = data.astype([(\textcolor{stringliteral}{'conf'}, \textcolor{stringliteral}{'a23'}), (\textcolor{stringliteral}{'term'}, \textcolor{stringliteral}{'a9'}), (\textcolor{stringliteral}{'J'}, \textcolor{stringliteral}{'float'}), (\textcolor{stringliteral}{'energy'}, \textcolor{stringliteral}{'float'}), (\textcolor{stringliteral}{'ref'}, \textcolor{stringliteral}{'a10'}
      )])
00599     \textcolor{keywordflow}{return} data
00600 
00601 
\hypertarget{manage__atomic__data_8py_source_l00602}{}\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{00602} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(atom, Nmax = None):
00603     \textcolor{stringliteral}{"""}
00604 \textcolor{stringliteral}{    Return a numpy.array containing the NIST data related to the levels for the given atom}
00605 \textcolor{stringliteral}{    The keys of the recarry are: conf, term, J, energy, ref}
00606 \textcolor{stringliteral}{    Example:}
00607 \textcolor{stringliteral}{        data = getLevelsNIST('O3')}
00608 \textcolor{stringliteral}{        energies = data['energy']}
00609 \textcolor{stringliteral}{        }
00610 \textcolor{stringliteral}{    """}
00611     elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)
00612     elem = elem.lower()
00613     spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_aec4e973d4cb9299f749ef190ea636a06}{int\_to\_roman}(int(spec)).lower()
00614     atom\_str = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(elem, spec)
00615     level\_file = \textcolor{stringliteral}{'\{0\}\_levels.dat'}.format(atom\_str)
00616     file\_ = \hyperlink{namespacepyneb_1_1utils_1_1misc_a0e9572755930aabb03c6b0e5d66b8356}{execution\_path}(\textcolor{stringliteral}{'../atomic\_data/levels/\{0\}'}.format(level\_file))
00617     \textcolor{keywordflow}{if} os.path.isfile(file\_):
00618         data = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ab843a6f51ebb888e83a849835e49a885}{readNIST}(file\_)
00619         pn.log\_.message(\textcolor{stringliteral}{'Reading energies and stat weights from \{0\}'}.format(level\_file), calling=\textcolor{stringliteral}{'
      getLevelsNIST'})
00620         \textcolor{keywordflow}{if} Nmax \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00621             \textcolor{keywordflow}{if} Nmax < len(data):
00622                 data = data[0:Nmax]
00623         \textcolor{keywordflow}{return} data
00624     \textcolor{keywordflow}{else}:
00625         \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00626     
00627     
\hypertarget{manage__atomic__data_8py_source_l00628}{}\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a3e35c0ac9cfe657a18cb4a1a797edf32}{00628} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a3e35c0ac9cfe657a18cb4a1a797edf32}{\_atom\_fits2ascii}(filename):
00629     \textcolor{stringliteral}{"""}
00630 \textcolor{stringliteral}{    Transform a *atom*.fits file into an *atom*.dat file.}
00631 \textcolor{stringliteral}{    }
00632 \textcolor{stringliteral}{    """}
00633     strs = filename.split(\textcolor{stringliteral}{'/'})[-1].split(\textcolor{stringliteral}{'\_'})
00634     elem = strs[0].capitalize()
00635     spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a97329c3ce57bd870421672b90e3e6541}{roman\_to\_int}(strs[1])
00636 \textcolor{comment}{#    type = strs[2]}
00637     pn.atomicData.setDataFile(filename.split(\textcolor{stringliteral}{'/'})[-1])
00638     atom = pn.Atom(elem, spec)
00639     atom.printSources()
00640     print(\textcolor{stringliteral}{''})
00641     fileout = raw\_input(\textcolor{stringliteral}{'Enter the name of the output file (between \{0[0]\}\_\{0[1]\}\_\{0[2]\}\_ and .dat:'}.format
      (strs))
00642     
00643     fout = open(\textcolor{stringliteral}{'\{0[0]\}\_\{0[1]\}\_\{0[2]\}\_\{1\}.dat'}.format(strs,fileout), \textcolor{stringliteral}{'w'})
00644     fout.write(\textcolor{stringliteral}{'Aij\(\backslash\)n'})
00645 \textcolor{comment}{#    str\_ = ''}
00646 \textcolor{comment}{#    for i in np.arange(atom.NLevels):}
00647 \textcolor{comment}{#        str\_ += '1/s '}
00648 \textcolor{comment}{#    str\_ += '\(\backslash\)n'}
00649     str\_ = \textcolor{stringliteral}{'1/s '} * atom.NLevels + \textcolor{stringliteral}{'\(\backslash\)n'}
00650     fout.write(str\_)
00651     \textcolor{keywordflow}{for} a1 \textcolor{keywordflow}{in} atom.getA():
00652         str\_ = \textcolor{stringliteral}{''}
00653         \textcolor{keywordflow}{for} a2 \textcolor{keywordflow}{in} a1:
00654             str\_ += \textcolor{stringliteral}{'\{0:10.7e\}'}.format(a2)
00655             str\_ += \textcolor{stringliteral}{' '}
00656         str\_ += \textcolor{stringliteral}{'\(\backslash\)n'}
00657         fout.write(str\_)
00658     \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} atom.AtomData.AtomHeader.iteritems():
00659         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} item[0] \textcolor{keywordflow}{or} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} item[0] \textcolor{keywordflow}{or} \textcolor{stringliteral}{'GSCONFIG'} \textcolor{keywordflow}{in} item[0]:
00660             fout.write(\textcolor{stringliteral}{'*** '} + item[0] + \textcolor{stringliteral}{' '} + str(item[1]) + \textcolor{stringliteral}{'\(\backslash\)n'})
00661         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'NOTE'} \textcolor{keywordflow}{in} item[0]:
00662             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'Energy'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} item[1]:
00663                 N\_Note = item[0].split(\textcolor{stringliteral}{'NOTE'})[1]
00664                 str\_N\_Note = str(N\_Note.split(\textcolor{stringliteral}{'\_'})[0])
00665                 fout.write(\textcolor{stringliteral}{'*** SOURCE'} + str\_N\_Note + \textcolor{stringliteral}{' '} + atom.AtomData.AtomHeader.get(\textcolor{stringliteral}{'SOURCE'}+
      str\_N\_Note)  + \textcolor{stringliteral}{'\(\backslash\)n'})
00666                 fout.write(\textcolor{stringliteral}{'*** '} + item[0] + \textcolor{stringliteral}{' '} + str(item[1]) + \textcolor{stringliteral}{'\(\backslash\)n'})
00667     
00668     fout.close()
00669     
\hypertarget{manage__atomic__data_8py_source_l00670}{}\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a1d70a5d8b876f114e058506cd9998de4}{00670} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_a1d70a5d8b876f114e058506cd9998de4}{\_coll\_fits2ascii}(filename, overwrite=None):
00671     \textcolor{stringliteral}{"""}
00672 \textcolor{stringliteral}{    Transform a *coll*.fits file into an *coll*.dat file.}
00673 \textcolor{stringliteral}{    }
00674 \textcolor{stringliteral}{    """}
00675     strs = filename.split(\textcolor{stringliteral}{'/'})[-1].split(\textcolor{stringliteral}{'\_'})
00676     elem = strs[0].capitalize()
00677     spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a97329c3ce57bd870421672b90e3e6541}{roman\_to\_int}(strs[1])
00678     pn.atomicData.setDataFile(filename.split(\textcolor{stringliteral}{'/'})[-1])
00679     atom = pn.Atom(elem, spec)
00680     \textcolor{comment}{#atom.printSources()}
00681     fileout = \textcolor{stringliteral}{'\{\}.dat'}.format(filename.split(\textcolor{stringliteral}{'.'})[0])
00682     
00683     \textcolor{keywordflow}{if} overwrite \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keyword}{True}:
00684         \textcolor{keywordflow}{if} os.path.exists(fileout):
00685             erase = raw\_input(\textcolor{stringliteral}{'\{\} exists, overwrite?'}.format(fileout))
00686             \textcolor{keywordflow}{if} erase != \textcolor{stringliteral}{'y'}:
00687                 \textcolor{keywordflow}{return}
00688     fout = open(fileout, \textcolor{stringliteral}{'w'})
00689     fout.write(\textcolor{stringliteral}{'*** \{0\}\{1\} collision strengths data\(\backslash\)n'}.format(elem, strs[1].upper()))
00690     str\_ = \textcolor{stringliteral}{'0 0'}
00691     \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} atom.getTemArray():
00692         str\_ += \textcolor{stringliteral}{' \{0:9.3e\}'}.format(t)
00693     str\_ += \textcolor{stringliteral}{'\(\backslash\)n'}
00694     fout.write(str\_)
00695     \textcolor{keywordflow}{for} omega \textcolor{keywordflow}{in} atom.getOmegaArray():
00696         j = \hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(omega, \textcolor{stringliteral}{'Omega('}, \textcolor{stringliteral}{'->'})
00697         i = \hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(omega, \textcolor{stringliteral}{'->'}, \textcolor{stringliteral}{')'})
00698         omegs = \hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(omega, \textcolor{stringliteral}{'['}, \textcolor{stringliteral}{']'})
00699         str\_ = \textcolor{stringliteral}{'\{0\} \{1\}'}.format(i,j)
00700         \textcolor{keywordflow}{for} omeg \textcolor{keywordflow}{in} omegs.split():
00701             str\_ += \textcolor{stringliteral}{' \{0:9.3e\}'}.format(float(omeg))
00702         str\_ += \textcolor{stringliteral}{'\(\backslash\)n'}
00703         fout.write(str\_)
00704         
00705     \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} atom.CollData.CollHeader.iteritems():
00706         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} item[0] \textcolor{keywordflow}{or} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} item[0] \textcolor{keywordflow}{or} \textcolor{stringliteral}{'GSCONFIG'} \textcolor{keywordflow}{in} item[0]:
00707             fout.write(\textcolor{stringliteral}{'*** '} + item[0] + \textcolor{stringliteral}{' '} + str(item[1]) + \textcolor{stringliteral}{'\(\backslash\)n'})
00708         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'TUNIT1'} == item[0]:
00709             fout.write(\textcolor{stringliteral}{'*** T\_UNIT '} + str(item[1]) + \textcolor{stringliteral}{'\(\backslash\)n'}) 
00710         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} item[0]:
00711             N\_Source = item[0].split(\textcolor{stringliteral}{'SOURCE'})[1]
00712             str\_N\_Source = str(N\_Source.split(\textcolor{stringliteral}{'\_'})[0])
00713             fout.write(\textcolor{stringliteral}{'*** '} + item[0] + \textcolor{stringliteral}{' '} + str(item[1]) + \textcolor{stringliteral}{'\(\backslash\)n'})
00714             \textcolor{keywordflow}{try}:
00715                 fout.write(\textcolor{stringliteral}{'*** NOTE'} + str\_N\_Source + \textcolor{stringliteral}{' '} + atom.CollData.CollHeader.get(\textcolor{stringliteral}{'NOTE'}+
      str\_N\_Source)  + \textcolor{stringliteral}{'\(\backslash\)n'})
00716             \textcolor{keywordflow}{except}:
00717                 fout.write(\textcolor{stringliteral}{'*** NOTE'} + str\_N\_Source + \textcolor{stringliteral}{' collision strengths \(\backslash\)n'})
00718     print(\textcolor{stringliteral}{'\{\} done'}.format(fileout))
00719     fout.close()
00720     
00721     
00722     
\end{DoxyCode}
