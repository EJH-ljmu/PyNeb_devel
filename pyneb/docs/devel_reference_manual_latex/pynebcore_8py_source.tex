\hypertarget{pynebcore_8py_source}{}\section{pynebcore.\+py}
\label{pynebcore_8py_source}\index{pyneb/core/pynebcore.\+py@{pyneb/core/pynebcore.\+py}}

\begin{DoxyCode}
\hypertarget{pynebcore_8py_source_l00001}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore}{00001} \textcolor{stringliteral}{"""@module pynebcore}
00002 \textcolor{stringliteral}{Main PyNeb module}
00003 \textcolor{stringliteral}{Tools to manage atoms, emission lines and observational data.}
00004 \textcolor{stringliteral}{}
00005 \textcolor{stringliteral}{@class Atom           atom object}
00006 \textcolor{stringliteral}{@class EmissionLine   emission line object}
00007 \textcolor{stringliteral}{@class Observation    observation object}
00008 \textcolor{stringliteral}{}
00009 \textcolor{stringliteral}{"""}
00010 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np
00011 \textcolor{keyword}{import} warnings
00012 \textcolor{keyword}{import} os
00013 \textcolor{keyword}{import} pyneb \textcolor{keyword}{as} pn
00014 \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils_1_1misc}{pyneb.utils.misc} \textcolor{keyword}{import} int\_to\_roman, strExtract, parseAtom, quiet\_divide, \_returnNone
00015 \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils}{pyneb.utils} \textcolor{keyword}{import} chebyshev
00016 \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils_1_1init}{pyneb.utils.init} \textcolor{keyword}{import} LINE\_LABEL\_LIST, BLEND\_LIST, SPEC\_LIST, label2levelDict
00017 \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils_1_1physics}{pyneb.utils.physics} \textcolor{keyword}{import} sym2name, gsDict, gsLevelDict, gsFromAtom, vactoair
00018 \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data}{pyneb.utils.manage\_atomic\_data} \textcolor{keyword}{import} getLevelsNIST
00019 \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils_1_1pn__chianti}{pyneb.utils.pn\_chianti} \textcolor{keyword}{import} \_AtomChianti, \_CollChianti
00020 \textcolor{keyword}{from} fractions \textcolor{keyword}{import} Fraction
00021 \textcolor{keywordflow}{if} pn.config.INSTALLED[\textcolor{stringliteral}{'scipy'}]:
00022     \textcolor{keyword}{from} scipy \textcolor{keyword}{import} interpolate
00023     \textcolor{keyword}{from} scipy.special \textcolor{keyword}{import} gamma
00024 \textcolor{keywordflow}{if} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]: 
00025     \textcolor{keyword}{import} matplotlib.pyplot \textcolor{keyword}{as} plt
00026     \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} cm
00027     \textcolor{keyword}{from} matplotlib.collections \textcolor{keyword}{import} LineCollection
00028     \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} colors
00029 \textcolor{keywordflow}{if} pn.config.INSTALLED[\textcolor{stringliteral}{'mp'}]:
00030     \textcolor{keyword}{from} multiprocessing \textcolor{keyword}{import} Queue, Process
00031     \textcolor{keyword}{from} \hyperlink{namespacepyneb_1_1utils_1_1multiprocs}{pyneb.utils.multiprocs} \textcolor{keyword}{import} getTemDen\_helper
00032 \textcolor{keywordflow}{if} pn.config.INSTALLED[\textcolor{stringliteral}{'pyfits'}]:
00033     \textcolor{keyword}{import} pyfits
00034 \textcolor{keywordflow}{elif} pn.config.INSTALLED[\textcolor{stringliteral}{'pyfits from astropy'}]:
00035     \textcolor{keyword}{import} astropy.io.fits \textcolor{keyword}{as} pyfits
00036 
00037 \textcolor{comment}{# Change the profiler to 'cpu', 'mem' or None to profile the execution of Atom.}
\hypertarget{pynebcore_8py_source_l00038}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_ab9e20b2acbbf8eec3da84081929fae24}{00038} profiler = \textcolor{keywordtype}{None}
00039 \textcolor{keywordflow}{if} profiler == \textcolor{stringliteral}{'mem'}:
00040     \textcolor{keywordflow}{try}:
00041         \textcolor{keyword}{from} memory\_profiler \textcolor{keyword}{import} profile
00042     \textcolor{keywordflow}{except}:
\hypertarget{pynebcore_8py_source_l00043}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aae0baf03bd810ce431563cc0c64c3996}{00043}         \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aae0baf03bd810ce431563cc0c64c3996}{profile}(f):
00044             \textcolor{keywordflow}{return} f
00045 \textcolor{keywordflow}{elif} profiler \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00046     \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aae0baf03bd810ce431563cc0c64c3996}{profile}(f):
00047         \textcolor{keywordflow}{return} f
00048 
\hypertarget{pynebcore_8py_source_l00049}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none}{00049} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none}{\_AtomDataNone}(object):
00050     
\hypertarget{pynebcore_8py_source_l00051}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_af3a42f81acbecee70f5e28ee47f90a7f}{00051}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_af3a42f81acbecee70f5e28ee47f90a7f}{\_\_init\_\_}(self):
00052 
\hypertarget{pynebcore_8py_source_l00053}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a0b4acd0c49278c6b3ac0fa460ad33bb9}{00053}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a0b4acd0c49278c6b3ac0fa460ad33bb9}{atomFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00054}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_aa255a7f490aa5d1cf7cfee7c5eb388ae}{00054}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_aa255a7f490aa5d1cf7cfee7c5eb388ae}{atomPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00055}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_af853b15fb8cb15c2781dedc2cac7f3a3}{00055}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_af853b15fb8cb15c2781dedc2cac7f3a3}{atomFitsFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00056}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ad9df42301b90127f83be1381a302f57b}{00056}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ad9df42301b90127f83be1381a302f57b}{atomFitsPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00057}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a6a6e8b052741d46963b85c0cdcb9fd79}{00057}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a6a6e8b052741d46963b85c0cdcb9fd79}{wave\_Ang} = np.nan
\hypertarget{pynebcore_8py_source_l00058}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a45c07931f008fd0cfc0349222b14cd8c}{00058}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a45c07931f008fd0cfc0349222b14cd8c}{getStatWeight} = \_returnNone
\hypertarget{pynebcore_8py_source_l00059}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ace59c545d211f79753ebdc9414eb1824}{00059}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ace59c545d211f79753ebdc9414eb1824}{getEnergy} = \_returnNone
\hypertarget{pynebcore_8py_source_l00060}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a44aa15dc5314c07627944e86581631b1}{00060}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a44aa15dc5314c07627944e86581631b1}{getA} = \_returnNone
\hypertarget{pynebcore_8py_source_l00061}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a3bc65b4742319ce5123d6fd3ca977c63}{00061}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a3bc65b4742319ce5123d6fd3ca977c63}{atomNLevels} = 0
\hypertarget{pynebcore_8py_source_l00062}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a784a8906a9fd1b408b567989207aca84}{00062}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a784a8906a9fd1b408b567989207aca84}{NLevels} = 0
00063 
\hypertarget{pynebcore_8py_source_l00064}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none}{00064} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none}{\_CollDataNone}(object):
00065     
\hypertarget{pynebcore_8py_source_l00066}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_aef4857135bf4c5ac4ee281c3872a7ae1}{00066}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_aef4857135bf4c5ac4ee281c3872a7ae1}{\_\_init\_\_}(self):
\hypertarget{pynebcore_8py_source_l00067}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a9945656d527d539b02443f1e12175952}{00067}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a9945656d527d539b02443f1e12175952}{getOmegaArray} = \_returnNone
\hypertarget{pynebcore_8py_source_l00068}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a75bd94e0404dbdad86ce0cd849331b6d}{00068}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a75bd94e0404dbdad86ce0cd849331b6d}{getTemArray} = \_returnNone
\hypertarget{pynebcore_8py_source_l00069}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a921566608d3f514d075992b0c6870952}{00069}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a921566608d3f514d075992b0c6870952}{collFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00070}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a3e39b0e757b0987e39ad0257a981ff13}{00070}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a3e39b0e757b0987e39ad0257a981ff13}{collPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00071}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_acb2dc662b7ca086e2d3322b79993fc60}{00071}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_acb2dc662b7ca086e2d3322b79993fc60}{collFitsFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00072}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_ad3bac87fe373ebf85361cc6c86b25c97}{00072}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_ad3bac87fe373ebf85361cc6c86b25c97}{collFitsPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00073}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_aa6cfd6d6afa856ba4c102acc9180df42}{00073}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_aa6cfd6d6afa856ba4c102acc9180df42}{collNLevels} = 0
\hypertarget{pynebcore_8py_source_l00074}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_afc8b4905545401491edcb56c8f0b556e}{00074}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_afc8b4905545401491edcb56c8f0b556e}{tem\_units} = \hyperlink{namespacepyneb_1_1utils_1_1misc_adca84ea86408b88ee4f54583e19d4a18}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00075}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a194d717f8c873199de6a3e0cb7d7a96b}{00075}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a194d717f8c873199de6a3e0cb7d7a96b}{NLevels} = 0
00076 
\hypertarget{pynebcore_8py_source_l00077}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits}{00077} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits}{\_AtomDataFits}(object):
00078     
\hypertarget{pynebcore_8py_source_l00079}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a626724a08fd24ba2ea2b44307ec6b294}{00079}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a626724a08fd24ba2ea2b44307ec6b294}{\_\_init\_\_}(self, elem=None, spec=None, atom=None):
\hypertarget{pynebcore_8py_source_l00080}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8919598e2830080299dcfe70249d4a15}{00080}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8919598e2830080299dcfe70249d4a15}{log\_} = pn.log\_
00081         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00082}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{00082}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} = atom
\hypertarget{pynebcore_8py_source_l00083}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{00083}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00084}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{00084}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[1])
00085         \textcolor{keywordflow}{else}:
00086             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem} = elem
00087             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec} = int(spec)
00088             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec})
\hypertarget{pynebcore_8py_source_l00089}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ac3d861a23f94412d8ae28aeb15a98170}{00089}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ac3d861a23f94412d8ae28aeb15a98170}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem}]
\hypertarget{pynebcore_8py_source_l00090}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{00090}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}
00091                 
00092         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a5011cd6c231d6fdbedb29d91615a3d4d}{\_loadFit}()
\hypertarget{pynebcore_8py_source_l00093}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a84351f8e5bae7c23f1318fe9464db1ca}{00093}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a84351f8e5bae7c23f1318fe9464db1ca}{\_A} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{getA}() \textcolor{comment}{# index = quantum number - 1}
\hypertarget{pynebcore_8py_source_l00094}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{00094}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{\_Energy} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ade643ddf8307c8068ad52b9500d894ce}{getEnergy}() \textcolor{comment}{#Angstrom^-1}
\hypertarget{pynebcore_8py_source_l00095}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8bee4fc914c9542b85e4750eb63b7aa0}{00095}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8bee4fc914c9542b85e4750eb63b7aa0}{\_StatWeight} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ad0edb5ef48a2f1acdb0d02890aeeb4b6}{getStatWeight}()
00096         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28df203664408392ddb6bb301e46f6a4}{initWaves}()
00097         
00098         
\hypertarget{pynebcore_8py_source_l00099}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a5011cd6c231d6fdbedb29d91615a3d4d}{00099}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a5011cd6c231d6fdbedb29d91615a3d4d}{\_loadFit}(self):
00100         \textcolor{stringliteral}{"""}
00101 \textcolor{stringliteral}{        Load fits file of atomic data.}
00102 \textcolor{stringliteral}{        The fits files names are defined in the pn.atomicData Object}
00103 \textcolor{stringliteral}{}
00104 \textcolor{stringliteral}{        """}                 
\hypertarget{pynebcore_8py_source_l00105}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{00105}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile} = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}, data\_type=\textcolor{stringliteral}{'atom'})
\hypertarget{pynebcore_8py_source_l00106}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{00106}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile}
00107         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00108             self.log\_.error(\textcolor{stringliteral}{'No atom data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00109             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00110         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} \textcolor{keywordflow}{in} pn.config.DataFiles:
00111             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} pn.config.DataFiles[self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}]:
00112                 pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile})
00113         \textcolor{keywordflow}{else}:
00114             pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}]
00115             
\hypertarget{pynebcore_8py_source_l00116}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{00116}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{atomPath} = pn.atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile})
\hypertarget{pynebcore_8py_source_l00117}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a6606b085964dbd4011085454b30efe41}{00117}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a6606b085964dbd4011085454b30efe41}{atomFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{atomPath}
00118         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{atomPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile})
00119         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00120             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00121         atomFits = pyfits.open(file\_to\_open, ignore\_missing\_end=\textcolor{keyword}{True})
00122         self.log\_.message(\textcolor{stringliteral}{'Reading atom data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00123         
00124         AtomExt = atomFits[1]
00125 
00126 
00127         \textcolor{comment}{#Read headers}
\hypertarget{pynebcore_8py_source_l00128}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{00128}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader} = AtomExt.header
00129 
\hypertarget{pynebcore_8py_source_l00130}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae8ab3604ecbf05c1f668717fc13e9dc2}{00130}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae8ab3604ecbf05c1f668717fc13e9dc2}{gs} = \textcolor{stringliteral}{'unknown'}
00131         \textcolor{keywordflow}{try}:
00132             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae8ab3604ecbf05c1f668717fc13e9dc2}{gs} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'GSCONFIG'}]
00133         \textcolor{keywordflow}{except}:
00134             \textcolor{keywordflow}{pass}
00135         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}:
00136             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec}:
00137                 pn.log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.
      format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'SPECTRUM'}],
00138                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00139         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}:
00140             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem}]:
00141                 pn.log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}.
       Check the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'ATOM'}],
00142                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00143                 
00144         \textcolor{comment}{#Read data}
\hypertarget{pynebcore_8py_source_l00145}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a778ab4d0dcd50a9d2f5aa54da07b51cc}{00145}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a778ab4d0dcd50a9d2f5aa54da07b51cc}{\_AtomData} = AtomExt.data
00146 
00147         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l00148}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{00148}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'N\_LEVELS'}]
00149         \textcolor{keywordflow}{except}:
00150             pn.log\_.error(\textcolor{stringliteral}{'N\_LEVELS is not set in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}))
00151             
00152         self.log\_.message(\textcolor{stringliteral}{'NLevels of atomic data: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}),
00153                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00154         
\hypertarget{pynebcore_8py_source_l00155}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{00155}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}
00156         
00157         atomFits.close()
00158 
00159 
\hypertarget{pynebcore_8py_source_l00160}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28df203664408392ddb6bb301e46f6a4}{00160}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28df203664408392ddb6bb301e46f6a4}{initWaves}(self):
00161         \textcolor{stringliteral}{"""}
00162 \textcolor{stringliteral}{        Initialization of wave\_Ang }
00163 \textcolor{stringliteral}{        }
00164 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l00165}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{00165}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{wave\_Ang} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}))
00166         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}):
00167             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
00168                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{wave\_Ang}[i, j] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{wave\_Ang}[j, i] = 1. / abs(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{\_Energy}[j])
00169 
00170         
\hypertarget{pynebcore_8py_source_l00171}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae83c63a7bd651275de23e5f17ddcf999}{00171}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae83c63a7bd651275de23e5f17ddcf999}{\_test\_lev}(self, level):
00172         \textcolor{stringliteral}{"""}
00173 \textcolor{stringliteral}{        Test whether selected level is legal}
00174 \textcolor{stringliteral}{}
00175 \textcolor{stringliteral}{        Parameters:}
00176 \textcolor{stringliteral}{            - level        selected atom level}
00177 \textcolor{stringliteral}{}
00178 \textcolor{stringliteral}{        """}       
00179         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}:
00180             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}),
00181                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00182         
\hypertarget{pynebcore_8py_source_l00183}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a798f0a704adc5f8de86ea22cbd40fb81}{00183}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a798f0a704adc5f8de86ea22cbd40fb81}{getSources}(self):
00184         \textcolor{stringliteral}{"""}
00185 \textcolor{stringliteral}{        Return bibliographic sources for atomic data, as listed in the headers of the fits files}
00186 \textcolor{stringliteral}{        """}
00187         sources = [] 
00188         header = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}
00189         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(header.items())):
00190             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} header.items()[i][0]:
00191                 number = header.items()[i][0].lstrip(\textcolor{stringliteral}{'SOURCE'})
00192                 \textcolor{keywordflow}{try}:
00193                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} + \textcolor{stringliteral}{': '} + header.get(\textcolor{stringliteral}{'NOTE'} + str(number)) + \textcolor{stringliteral}{':'}, 
      header.get(\textcolor{stringliteral}{'SOURCE'} + str(number)))
00194                 \textcolor{keywordflow}{except}:
00195                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} + \textcolor{stringliteral}{': '} + \textcolor{stringliteral}{'Atomic data:'}, header.get(\textcolor{stringliteral}{'SOURCE'} + str(number)
      ))
00196         \textcolor{keywordflow}{return} sources
00197     
00198     
\hypertarget{pynebcore_8py_source_l00199}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a7307e0d4863dc562369df1b7e6d5ac1b}{00199}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a7307e0d4863dc562369df1b7e6d5ac1b}{printSources}(self):
00200         
00201         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a798f0a704adc5f8de86ea22cbd40fb81}{getSources}():
00202             \textcolor{keywordflow}{print} source    
00203 
00204     
\hypertarget{pynebcore_8py_source_l00205}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{00205}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{getA}(self, lev\_i= -1, lev\_j= -1):
00206         \textcolor{stringliteral}{"""}
00207 \textcolor{stringliteral}{        Return the transition probability data. }
00208 \textcolor{stringliteral}{        If no arguments are given, the whole array of A is returned.}
00209 \textcolor{stringliteral}{        A specific A value can be obtained by giving either the upper and lower levels.}
00210 \textcolor{stringliteral}{            }
00211 \textcolor{stringliteral}{        Usage:}
00212 \textcolor{stringliteral}{            A\_O3 = O3.getA()          # The whole A array is stored in A\_O3}
00213 \textcolor{stringliteral}{            O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed}
00214 \textcolor{stringliteral}{            O3.getA(2, 4)      # Returns 0}
00215 \textcolor{stringliteral}{}
00216 \textcolor{stringliteral}{        Parameters:}
00217 \textcolor{stringliteral}{            - lev\_i  upper level of transition (default= -1, returns complete array)}
00218 \textcolor{stringliteral}{            - lev\_j  lower level of transition (default= -1, returns complete array)}
00219 \textcolor{stringliteral}{            }
00220 \textcolor{stringliteral}{        """}
00221         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae83c63a7bd651275de23e5f17ddcf999}{\_test\_lev}(lev\_i)
00222         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae83c63a7bd651275de23e5f17ddcf999}{\_test\_lev}(lev\_j)
00223         \textcolor{keywordflow}{if} (lev\_i == -1):
00224             \textcolor{keywordflow}{if} (lev\_j == -1):
00225                 \textcolor{comment}{# Line below commented out because introduces bug if Nlevels(atom) > Nlevels(coll)}
00226                 \textcolor{comment}{#resultArray = np.zeros([self.NLevels, self.NLevels])}
00227                 resultArray = np.zeros([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}])
00228                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels} - 1):
00229                     lev\_i = i + 1
00230                     j = i + 1
00231                     \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}):
00232                         lev\_j = j + 1
00233                         resultArray[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{getA}(lev\_j, lev\_i)
00234                         j += 1
00235                 \textcolor{keywordflow}{return} resultArray
00236 
00237             \textcolor{keywordflow}{return} (self.\_AtomData.field(\textcolor{stringliteral}{'A(*->\{0\})'}.format(lev\_j)))
00238         \textcolor{keywordflow}{else}:
00239             \textcolor{keywordflow}{return} (self.\_AtomData.field(\textcolor{stringliteral}{'A(*->\{0\})'}.format(lev\_j))[lev\_i - 1])
00240 
00241 
\hypertarget{pynebcore_8py_source_l00242}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ad0edb5ef48a2f1acdb0d02890aeeb4b6}{00242}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ad0edb5ef48a2f1acdb0d02890aeeb4b6}{getStatWeight}(self, level= -1):
00243         \textcolor{stringliteral}{"""}
00244 \textcolor{stringliteral}{        Returns the array of statistical weights of the ion (if no arguments are given) }
00245 \textcolor{stringliteral}{            or the statistical weight of level i (if i is given as an argument, }
00246 \textcolor{stringliteral}{            with the optional keyword level).}
00247 \textcolor{stringliteral}{            }
00248 \textcolor{stringliteral}{        Usage:}
00249 \textcolor{stringliteral}{            O3.getStatWeight()}
00250 \textcolor{stringliteral}{            O3.getStatWeight(level=4)}
00251 \textcolor{stringliteral}{            O3.getStatWeight(4)}
00252 \textcolor{stringliteral}{                      }
00253 \textcolor{stringliteral}{        Parameters:}
00254 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00255 \textcolor{stringliteral}{            }
00256 \textcolor{stringliteral}{        """}
00257         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae83c63a7bd651275de23e5f17ddcf999}{\_test\_lev}(level)
00258         \textcolor{keywordflow}{if} (level == -1):
00259             \textcolor{keywordflow}{return} ((self.\_AtomData.field(\textcolor{stringliteral}{'Stat\_Weight'})) * 1.0)
00260         \textcolor{keywordflow}{elif} (level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}  \textcolor{keywordflow}{or} level < 1):
00261             self.log\_.warn(\textcolor{stringliteral}{'level \{0\} outside the [1-\{1\}] range: aborting'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels})
00262                                , calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00263 \textcolor{comment}{#                level = level % self.NLevels }
00264         \textcolor{keywordflow}{else}:
00265             \textcolor{keywordflow}{return} ((self.\_AtomData.field(\textcolor{stringliteral}{'Stat\_Weight'})[level - 1]) * 1.0)
00266     
00267 
\hypertarget{pynebcore_8py_source_l00268}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ade643ddf8307c8068ad52b9500d894ce}{00268}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ade643ddf8307c8068ad52b9500d894ce}{getEnergy}(self, level= -1, unit='1/Ang'):
00269         \textcolor{stringliteral}{"""}
00270 \textcolor{stringliteral}{        Return energy level of selected level (or array of energy levels, if level not given) }
00271 \textcolor{stringliteral}{            in Angstrom^-1 (default) or another unit}
00272 \textcolor{stringliteral}{        }
00273 \textcolor{stringliteral}{        Usage:}
00274 \textcolor{stringliteral}{            O3.getEnergy(4, unit='eV')}
00275 \textcolor{stringliteral}{        Parameters:}
00276 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00277 \textcolor{stringliteral}{            - unit   [str] one of '1/Ang' (default), 'eV', or 'Ryd'    }
00278 \textcolor{stringliteral}{            }
00279 \textcolor{stringliteral}{        """}
00280         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae83c63a7bd651275de23e5f17ddcf999}{\_test\_lev}(level)
00281         unit\_dict = \{\textcolor{stringliteral}{'1/Ang'}: 1.,
00282                      \textcolor{stringliteral}{'Ryd'}: pn.CST.RYD\_ANG,
00283                      \textcolor{stringliteral}{'eV'}: pn.CST.RYD\_ANG * pn.CST.RYD\_EV,
00284                      \textcolor{stringliteral}{'erg'}: pn.CST.HPLANCK * pn.CST.CLIGHT * 1e8\}
00285         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} unit\_dict:
00286             self.log\_.warn(\textcolor{stringliteral}{'Unit \{0\} unknown, using 1/Ang'}.format(unit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling} + \textcolor{stringliteral}{'.getEnergy'})
00287             unit = \textcolor{stringliteral}{'1/Ang'}
00288         \textcolor{keywordflow}{if} (level == -1):
00289             \textcolor{keywordflow}{return} self.\_AtomData.field(\textcolor{stringliteral}{'Energy'}) * unit\_dict[unit]
00290         \textcolor{keywordflow}{elif} (level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}  \textcolor{keywordflow}{or} level < 1):
00291             self.log\_.warn(\textcolor{stringliteral}{'level \{0\} outside the [1-\{1\}] range: aborting'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels})
00292                                , calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00293 \textcolor{comment}{#                level = level % self.NLevels }
00294         \textcolor{keywordflow}{else}:
00295             \textcolor{keywordflow}{return} self.\_AtomData.field(\textcolor{stringliteral}{'Energy'})[level - 1] * unit\_dict[unit]
00296 
00297 
\hypertarget{pynebcore_8py_source_l00298}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii}{00298} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii}{\_AtomDataAscii}(object):
00299     
\hypertarget{pynebcore_8py_source_l00300}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a18839ec771a0105ab111f8c6411c70e1}{00300}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a18839ec771a0105ab111f8c6411c70e1}{\_\_init\_\_}(self, elem=None, spec=None, atom=None):
\hypertarget{pynebcore_8py_source_l00301}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aaddba4bcc59a7a5e69c08b2545939737}{00301}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aaddba4bcc59a7a5e69c08b2545939737}{log\_} = pn.log\_
00302         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00303}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{00303}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom} = atom
\hypertarget{pynebcore_8py_source_l00304}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{00304}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00305}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{00305}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[1])
00306         \textcolor{keywordflow}{else}:
00307             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem} = elem
00308             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec} = int(spec)
00309             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec})
\hypertarget{pynebcore_8py_source_l00310}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ab03fcf558862acb02a57ccd5accf155d}{00310}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ab03fcf558862acb02a57ccd5accf155d}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}]
\hypertarget{pynebcore_8py_source_l00311}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{00311}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}
00312                 
00313         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac0d0c0c95f762944ec7e0ee660415416}{\_loadAscii}()
00314         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a583ecd4bdf83ecdecb7f5d7516aaa101}{initWaves}()
00315         
\hypertarget{pynebcore_8py_source_l00316}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac0d0c0c95f762944ec7e0ee660415416}{00316}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac0d0c0c95f762944ec7e0ee660415416}{\_loadAscii}(self):
00317         
\hypertarget{pynebcore_8py_source_l00318}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{00318}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile} = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, data\_type=\textcolor{stringliteral}{'atom'})
00319         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00320             self.log\_.error(\textcolor{stringliteral}{'No atom data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00321             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00322         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom} \textcolor{keywordflow}{in} pn.config.DataFiles:
00323             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}]:
00324                 pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile})
00325         \textcolor{keywordflow}{else}:
00326             pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}]
00327             
\hypertarget{pynebcore_8py_source_l00328}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae16a1eb022aac82bfee45f425a21ed90}{00328}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae16a1eb022aac82bfee45f425a21ed90}{atomPath} = pn.atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile})
00329         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae16a1eb022aac82bfee45f425a21ed90}{atomPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile})
00330         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00331             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00332             
00333         self.log\_.message(\textcolor{stringliteral}{'Reading atom data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00334 
00335     
\hypertarget{pynebcore_8py_source_l00336}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{00336}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{E\_in\_vacuum} = \textcolor{keyword}{False}
00337         \textcolor{comment}{# Read data from ascii file}
00338         \textcolor{comment}{#}
00339         \textcolor{comment}{# Read energies and stat weights }
00340         f = open(file\_to\_open)
00341         data = f.readlines()
00342         f.close()
00343         \textcolor{keywordflow}{if} data[0].strip() == \textcolor{stringliteral}{'Aij'}:
00344             \textcolor{comment}{# This means that we are dealing with new format (no more energies nor stats weights}
00345             \textcolor{comment}{# so NIST data are needed}
00346             need\_NIST = \textcolor{keyword}{True}
00347             at\_data = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}][2::], dtype=\textcolor{stringliteral}{'float'})
00348             comments\_tab = [d \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]==\textcolor{stringliteral}{'***'}]
\hypertarget{pynebcore_8py_source_l00349}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{00349}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments} = \{\}
00350             \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} comments\_tab:
00351                 key = com.split()[1]
00352                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[key] = com.split(key)[1].strip()
00353             A = at\_data.copy()
00354             \textcolor{keywordflow}{if} A.shape[0] != A.shape[1]:
00355                 pn.log\_.error(\textcolor{stringliteral}{'Atomic data must be a NxN matrix'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling}) 
00356             NLevels = A.shape[0]
00357         \textcolor{keywordflow}{else}:
00358             \textcolor{comment}{# This is the old format}
00359             need\_NIST = \textcolor{keyword}{False}
00360             units = data[1].split()[0]
00361             at\_data = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}][2::], dtype=\textcolor{stringliteral}{'float'})
00362             comments\_tab = [d \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]==\textcolor{stringliteral}{'***'}]
00363             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments} = \{\}
00364             \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} comments\_tab:
00365                 key = com.split()[1]
00366                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[key] = com.split(key)[1].strip()
00367             
00368             \textcolor{comment}{# Read Es}
00369             energy = at\_data[:,0]
00370             NLevels = len(energy)
00371             \textcolor{keywordflow}{if} units == \textcolor{stringliteral}{'eV'}: 
00372                 energy /= pn.CST.RYD\_EV * pn.CST.RYD\_ANG
00373             \textcolor{keywordflow}{elif} units == \textcolor{stringliteral}{'Rydberg'}:
00374                 energy /= pn.CST.RYD\_ANG
00375             \textcolor{keywordflow}{elif} units == \textcolor{stringliteral}{'cm-1'}:
00376                 energy /= 1e8
00377             \textcolor{comment}{# Read statistical weights}
00378             stat\_weight = at\_data[:,1]
00379             
00380             \textcolor{comment}{# Read As}
00381             A = np.zeros([NLevels, NLevels])
00382             A[:,:] = at\_data[:,2:]
00383 
00384         
\hypertarget{pynebcore_8py_source_l00385}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{00385}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST} = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, NLevels)
00386         
00387         web = \textcolor{stringliteral}{'Ref. \{0\} of NIST 2014 (try this:
       http://physics.nist.gov/cgi-bin/ASBib1/get\_ASBib\_ref.cgi?db=el&db\_id=\{0\}&comment\_code=&element=\{1\}&spectr\_charge=\{2\}&'}
00388         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00389             energy = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST}[\textcolor{stringliteral}{'energy'}] / 1e8
00390             stat\_weight = 1 + 2 * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST}[\textcolor{stringliteral}{'J'}]
00391             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'VACUUM'}] = \textcolor{stringliteral}{'1'}
00392             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'NOTE'}] = \textcolor{stringliteral}{'Energy levels'}
00393             source = \textcolor{stringliteral}{'\(\backslash\)n    '}
00394             \textcolor{keywordflow}{for} ref \textcolor{keywordflow}{in} np.unique(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST}[\textcolor{stringliteral}{'ref'}]):
00395                 source = source + web.format(ref[1:], self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec}) + \textcolor{stringliteral}{')\(\backslash\)n  + '} 
00396             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'SOURCE'}] = source[0:-5]
00397         \textcolor{keywordflow}{elif} need\_NIST:
00398             pn.log\_.error(\textcolor{stringliteral}{'NIST data are needed for this format of atomic data'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling}) 
00399         
\hypertarget{pynebcore_8py_source_l00400}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{00400}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy} = energy
\hypertarget{pynebcore_8py_source_l00401}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{00401}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{\_StatWeight} = stat\_weight
\hypertarget{pynebcore_8py_source_l00402}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{00402}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A} = A
\hypertarget{pynebcore_8py_source_l00403}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a58e3b3de028fdda9d52cade8e378fe2d}{00403}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a58e3b3de028fdda9d52cade8e378fe2d}{atomNLevels} = NLevels
\hypertarget{pynebcore_8py_source_l00404}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{00404}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a58e3b3de028fdda9d52cade8e378fe2d}{atomNLevels}
00405         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'GSCONFIG'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
\hypertarget{pynebcore_8py_source_l00406}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aed6d711337dfb385d65306e7f3c4d06d}{00406}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aed6d711337dfb385d65306e7f3c4d06d}{gs} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'GSCONFIG'}]
00407         \textcolor{keywordflow}{else}:
00408             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aed6d711337dfb385d65306e7f3c4d06d}{gs} = \textcolor{stringliteral}{'unknown'}
00409         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00410             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec}:
00411                 pn.log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.
      format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'SPECTRUM'}],
00412                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00413         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00414             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}]:
00415                 pn.log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}.
       Check the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'ATOM'}],
00416                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00417         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'VACUUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00418             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'VACUUM'}] == \textcolor{stringliteral}{'1'}:
00419                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{E\_in\_vacuum} = \textcolor{keyword}{True}
00420     
\hypertarget{pynebcore_8py_source_l00421}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a583ecd4bdf83ecdecb7f5d7516aaa101}{00421}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a583ecd4bdf83ecdecb7f5d7516aaa101}{initWaves}(self):
00422         \textcolor{stringliteral}{"""}
00423 \textcolor{stringliteral}{        Initialization of wave\_Ang}
00424 \textcolor{stringliteral}{        }
00425 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l00426}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{00426}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{wave\_Ang} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}))
00427         
00428         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}):
00429             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
00430                 wave = 1. / abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy}[j])
00431                 \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{E\_in\_vacuum}:
00432                     wave = \hyperlink{namespacepyneb_1_1utils_1_1physics_aafb02f69e32ab62fa89420481f9a65f4}{vactoair}(wave)
00433                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{wave\_Ang}[i, j] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{wave\_Ang}[j, i] = wave
00434         
\hypertarget{pynebcore_8py_source_l00435}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a2b36467278900c759761366fe5b69c37}{00435}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a2b36467278900c759761366fe5b69c37}{\_test\_lev}(self, level):
00436         \textcolor{stringliteral}{"""}
00437 \textcolor{stringliteral}{        Test whether selected level is legal}
00438 \textcolor{stringliteral}{}
00439 \textcolor{stringliteral}{        Parameters:}
00440 \textcolor{stringliteral}{            - level        selected atom level}
00441 \textcolor{stringliteral}{}
00442 \textcolor{stringliteral}{        """}       
00443         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}:
00444             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}),
00445                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00446 
00447     
\hypertarget{pynebcore_8py_source_l00448}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aac811b213b17e3c37999ba75d0aa64f3}{00448}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aac811b213b17e3c37999ba75d0aa64f3}{getSources}(self):
00449         \textcolor{stringliteral}{"""}
00450 \textcolor{stringliteral}{        Return bibliographic sources for atomic data, as listed in the headers of the fits files}
00451 \textcolor{stringliteral}{        }
00452 \textcolor{stringliteral}{        """}
00453         sources = []
00454         sources\_str = \{\}
00455         notes = \{\}
00456         \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00457             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} com:
00458                 number = com.split(\textcolor{stringliteral}{'SOURCE'})[1]
00459                 sources\_str[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[com]
00460             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'NOTE'} \textcolor{keywordflow}{in} com:
00461                 number = com.split(\textcolor{stringliteral}{'NOTE'})[1]
00462                 notes[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[com]
00463         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} sources\_str:
00464             \textcolor{keywordflow}{try}:
00465                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}: \{2\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, notes[key], sources\_str[key])) 
00466             \textcolor{keywordflow}{except}:
00467                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, sources[key]))
00468         \textcolor{keywordflow}{return} sources
00469 
\hypertarget{pynebcore_8py_source_l00470}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a3fdbfe99be5b68bed58b5f1500448242}{00470}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a3fdbfe99be5b68bed58b5f1500448242}{printSources}(self):
00471         
00472         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aac811b213b17e3c37999ba75d0aa64f3}{getSources}():
00473             \textcolor{keywordflow}{print} source    
00474     
\hypertarget{pynebcore_8py_source_l00475}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a858e1ecef317c56f7f9e771ed0b5aca9}{00475}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a858e1ecef317c56f7f9e771ed0b5aca9}{getA}(self, lev\_i= -1, lev\_j= -1):
00476         \textcolor{stringliteral}{"""}
00477 \textcolor{stringliteral}{        Return the transition probability data. }
00478 \textcolor{stringliteral}{        If no arguments are given, the whole array of A is returned.}
00479 \textcolor{stringliteral}{        A specific A value can be obtained by giving either the upper and lower levels.}
00480 \textcolor{stringliteral}{            }
00481 \textcolor{stringliteral}{        Usage:}
00482 \textcolor{stringliteral}{            A\_O3 = O3.getA()          # The whole A array is stored in A\_O3}
00483 \textcolor{stringliteral}{            O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed}
00484 \textcolor{stringliteral}{            O3.getA(2, 4)      # Returns 0}
00485 \textcolor{stringliteral}{}
00486 \textcolor{stringliteral}{        Parameters:}
00487 \textcolor{stringliteral}{            - lev\_i  upper level of transition (default= -1, returns complete array)}
00488 \textcolor{stringliteral}{            - lev\_j  lower level of transition (default= -1, returns complete array)}
00489 \textcolor{stringliteral}{            }
00490 \textcolor{stringliteral}{        """}
00491         
00492         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a2b36467278900c759761366fe5b69c37}{\_test\_lev}(lev\_i)
00493         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a2b36467278900c759761366fe5b69c37}{\_test\_lev}(lev\_j)
00494         \textcolor{keywordflow}{if} (lev\_i == -1):
00495             \textcolor{keywordflow}{if} (lev\_j == -1):
00496                 \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A}
00497             \textcolor{keywordflow}{else}:
00498                 \textcolor{keywordflow}{return} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A}[lev\_i - 1])
00499         \textcolor{keywordflow}{else}:
00500             \textcolor{keywordflow}{return} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A}[lev\_i - 1, lev\_j - 1])       
00501     
\hypertarget{pynebcore_8py_source_l00502}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a0b913fd7ff9b235a699c735b33c96e85}{00502}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a0b913fd7ff9b235a699c735b33c96e85}{getStatWeight}(self, level= -1):
00503         \textcolor{stringliteral}{"""}
00504 \textcolor{stringliteral}{        Returns the array of statistical weights of the ion (if no arguments are given) }
00505 \textcolor{stringliteral}{            or the statistical weight of level i (if i is given as an argument, }
00506 \textcolor{stringliteral}{            with the optional keyword level).}
00507 \textcolor{stringliteral}{            }
00508 \textcolor{stringliteral}{        Usage:}
00509 \textcolor{stringliteral}{            O3.getStatWeight()}
00510 \textcolor{stringliteral}{            O3.getStatWeight(level=4)}
00511 \textcolor{stringliteral}{            O3.getStatWeight(4)}
00512 \textcolor{stringliteral}{                      }
00513 \textcolor{stringliteral}{        Parameters:}
00514 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00515 \textcolor{stringliteral}{            }
00516 \textcolor{stringliteral}{        """}
00517         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a2b36467278900c759761366fe5b69c37}{\_test\_lev}(level)
00518         
00519         \textcolor{keywordflow}{if} level == -1:
00520             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{\_StatWeight}
00521         \textcolor{keywordflow}{else}:
00522             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{\_StatWeight}[level-1]
00523         
00524     
\hypertarget{pynebcore_8py_source_l00525}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af747dc13a858a4eacc6107aedad89bd0}{00525}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af747dc13a858a4eacc6107aedad89bd0}{getEnergy}(self, level= -1, unit='1/Ang'):
00526         \textcolor{stringliteral}{"""}
00527 \textcolor{stringliteral}{        Return energy level of selected level (or array of energy levels, if level not given) }
00528 \textcolor{stringliteral}{            in Angstrom^-1 (default) or another unit}
00529 \textcolor{stringliteral}{        }
00530 \textcolor{stringliteral}{        Usage:}
00531 \textcolor{stringliteral}{            O3.getEnergy(4, unit='eV')}
00532 \textcolor{stringliteral}{        Parameters:}
00533 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00534 \textcolor{stringliteral}{            - unit   [str] one of '1/Ang' (default), 'eV', or 'Ryd'    }
00535 \textcolor{stringliteral}{            }
00536 \textcolor{stringliteral}{        """}
00537         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a2b36467278900c759761366fe5b69c37}{\_test\_lev}(level)
00538 
00539         unit\_dict = \{\textcolor{stringliteral}{'1/Ang'}: 1.,
00540                      \textcolor{stringliteral}{'Ryd'}: pn.CST.RYD\_ANG,
00541                      \textcolor{stringliteral}{'eV'}: pn.CST.RYD\_ANG * pn.CST.RYD\_EV,
00542                      \textcolor{stringliteral}{'cm-1'}: 1e8,
00543                      \textcolor{stringliteral}{'erg'}: pn.CST.HPLANCK * pn.CST.CLIGHT * 1e8\}
00544         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} unit\_dict:
00545             self.log\_.warn(\textcolor{stringliteral}{'Unit \{0\} unknown, using 1/Ang'}.format(unit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling} + \textcolor{stringliteral}{'.getEnergy'})
00546             unit = \textcolor{stringliteral}{'1/Ang'}        
00547         
00548         \textcolor{keywordflow}{if} level == -1:
00549             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy} * unit\_dict[unit]
00550         \textcolor{keywordflow}{else}:
00551             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy}[level-1] * unit\_dict[unit]
00552         
00553         
\hypertarget{pynebcore_8py_source_l00554}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits}{00554} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits}{\_CollDataFits}(object):
00555     
\hypertarget{pynebcore_8py_source_l00556}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34dd1c347e0328a9f282d418e14cf653}{00556}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34dd1c347e0328a9f282d418e14cf653}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, OmegaInterp='Cheb', noExtrapol = False, 
      NLevelsMax=None):
\hypertarget{pynebcore_8py_source_l00557}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a42f3e78e841a8714f2602866843d77da}{00557}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a42f3e78e841a8714f2602866843d77da}{log\_} = pn.log\_
00558         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00559}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{00559}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} = atom
\hypertarget{pynebcore_8py_source_l00560}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{00560}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00561}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{00561}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[1])
00562         \textcolor{keywordflow}{else}:
00563             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem} = elem
00564             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec} = int(spec)
00565             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec})
\hypertarget{pynebcore_8py_source_l00566}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a40d926369df2d46e0799a66e4c9d9a73}{00566}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a40d926369df2d46e0799a66e4c9d9a73}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem}]
\hypertarget{pynebcore_8py_source_l00567}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{00567}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{noExtrapol} = noExtrapol
\hypertarget{pynebcore_8py_source_l00568}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{00568}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}
00569                 
00570         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad04efe1233834714042db34b1ba4508b}{\_loadFit}()
00571         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ab8bb7b193ca2b9ccf6adf11453347226}{initOmegas}(OmegaInterp=OmegaInterp)
\hypertarget{pynebcore_8py_source_l00572}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{00572}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TUNIT1'}]
00573         \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
00574             \textcolor{keyword}{def }transfo\_tem(x):
00575                 y = np.log10(x)
00576                 \textcolor{keywordflow}{if} np.ndim(y) == 0:
00577                     y = np.array(y)
00578                 \textcolor{keywordflow}{return} y
00579         \textcolor{keywordflow}{elif} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
00580                 \textcolor{keyword}{def }transfo\_tem(x):
00581                     y = x / 1e4
00582                     \textcolor{keywordflow}{if} np.ndim(y) == 0:
00583                         y = np.array(y)
00584                     \textcolor{keywordflow}{return} y
00585         \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
00586             \textcolor{keyword}{def }transfo\_tem(x):
00587                 y = x
00588                 \textcolor{keywordflow}{return} x
\hypertarget{pynebcore_8py_source_l00589}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afa9318fd2557709e968682f47cefa379}{00589}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afa9318fd2557709e968682f47cefa379}{\_transfo\_tem} = transfo\_tem
00590         
00591         
\hypertarget{pynebcore_8py_source_l00592}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad04efe1233834714042db34b1ba4508b}{00592}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad04efe1233834714042db34b1ba4508b}{\_loadFit}(self):
00593         \textcolor{stringliteral}{"""}
00594 \textcolor{stringliteral}{        Load fits file of atomic data.}
00595 \textcolor{stringliteral}{        The fits files names are defined in the pn.atomicData Object}
00596 \textcolor{stringliteral}{}
00597 \textcolor{stringliteral}{        """}                 
\hypertarget{pynebcore_8py_source_l00598}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{00598}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}, data\_type=\textcolor{stringliteral}{'coll'})
\hypertarget{pynebcore_8py_source_l00599}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{00599}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} 
00600         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00601             self.log\_.error(\textcolor{stringliteral}{'No coll data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00602             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00603         
00604         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} \textcolor{keywordflow}{in} pn.config.DataFiles:
00605             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}]:
00606                 pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile})
00607         \textcolor{keywordflow}{else}:
00608             pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}]
00609             
\hypertarget{pynebcore_8py_source_l00610}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{00610}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{collPath} = pn.atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile})
\hypertarget{pynebcore_8py_source_l00611}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6a16fc5f5206b988d99be1511d158ada}{00611}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6a16fc5f5206b988d99be1511d158ada}{collFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{collPath} 
00612         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{collPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile})
00613         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00614             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})        
00615         collFits = pyfits.open(file\_to\_open, ignore\_missing\_end=\textcolor{keyword}{True})
00616         self.log\_.message(\textcolor{stringliteral}{'Reading coll data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00617         
00618         CollExt = collFits[1]
00619 
00620         \textcolor{comment}{#Read headers}
\hypertarget{pynebcore_8py_source_l00621}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{00621}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader} = CollExt.header
\hypertarget{pynebcore_8py_source_l00622}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a5526868efdb550fee08608f77262b106}{00622}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a5526868efdb550fee08608f77262b106}{CollExtNames} = CollExt.columns.names
00623 
00624         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}:
00625             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec}:
00626                 pn.log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.
      format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'SPECTRUM'}],
00627                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00628         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}:
00629             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem}]:
00630                 pn.log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}.
       Check the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'ATOM'}],
00631                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00632                 
00633         \textcolor{comment}{#Read data}
\hypertarget{pynebcore_8py_source_l00634}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34f70aba84a783d1a5a8633f797f7bb1}{00634}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34f70aba84a783d1a5a8633f797f7bb1}{\_CollData} = CollExt.data
00635 
00636         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l00637}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{00637}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'N\_LEVELS'}]
00638         \textcolor{keywordflow}{except}:
00639             pn.log\_.error(\textcolor{stringliteral}{'N\_LEVELS is not set in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}))
00640             
00641         self.log\_.message(\textcolor{stringliteral}{'NLevels of collisional data: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}),
00642                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00643         collFits.close()
00644 
00645 
\hypertarget{pynebcore_8py_source_l00646}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ab8bb7b193ca2b9ccf6adf11453347226}{00646}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ab8bb7b193ca2b9ccf6adf11453347226}{initOmegas}(self, OmegaInterp='Cheb'):
00647         \textcolor{stringliteral}{"""}
00648 \textcolor{stringliteral}{        Initialization of the Chebishev orders and coefficients. This method is called by \_\_init\_\_ and when
       }
00649 \textcolor{stringliteral}{        OmegaInterp is changed.}
00650 \textcolor{stringliteral}{}
00651 \textcolor{stringliteral}{        Parameter:}
00652 \textcolor{stringliteral}{            - OmegaInterp   one of ('Cheb', 'Linear')}
00653 \textcolor{stringliteral}{        }
00654 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l00655}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{00655}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{OmegaInterp} = OmegaInterp
\hypertarget{pynebcore_8py_source_l00656}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{00656}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac2e555f92570ed4df42926d0c415ac4c}{getChebOrder}()
\hypertarget{pynebcore_8py_source_l00657}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_af8eaa90b2ddbf77c0a78b648e9f66971}{00657}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_af8eaa90b2ddbf77c0a78b648e9f66971}{ChebCoeffs} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afe4a86564a0306ca1a72cfccc1a66360}{\_getChebCoeffArray}()
00658 
00659 
\hypertarget{pynebcore_8py_source_l00660}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{00660}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{\_test\_lev}(self, level):
00661         \textcolor{stringliteral}{"""}
00662 \textcolor{stringliteral}{        Test whether selected level is legal}
00663 \textcolor{stringliteral}{}
00664 \textcolor{stringliteral}{        Parameters:}
00665 \textcolor{stringliteral}{            - level        selected atom level}
00666 \textcolor{stringliteral}{}
00667 \textcolor{stringliteral}{        """}       
00668         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}:
00669             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\} (maximum: \{1\})'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}),
00670                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00671         
00672         
\hypertarget{pynebcore_8py_source_l00673}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a13ff2c1aef93336f152a248e534bd104}{00673}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a13ff2c1aef93336f152a248e534bd104}{getSources}(self):
00674         \textcolor{stringliteral}{"""}
00675 \textcolor{stringliteral}{        Return bibliographic sources for atomic data, as listed in the headers of the fits files.}
00676 \textcolor{stringliteral}{}
00677 \textcolor{stringliteral}{        """}
00678         sources = []
00679         header = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}
00680         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(header.items())):
00681             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} header.items()[i][0]:
00682                 number = header.items()[i][0].lstrip(\textcolor{stringliteral}{'SOURCE'})
00683                 \textcolor{keywordflow}{try}:
00684                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} + \textcolor{stringliteral}{': '} + header.get(\textcolor{stringliteral}{'NOTE'} + str(number)) + \textcolor{stringliteral}{':'}, 
      header.get(\textcolor{stringliteral}{'SOURCE'} + str(number)))
00685                 \textcolor{keywordflow}{except}:
00686                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} + \textcolor{stringliteral}{': '} + \textcolor{stringliteral}{'Collision strengths:'}, header.get(\textcolor{stringliteral}{'SOURCE'} + str
      (number)))
00687         \textcolor{keywordflow}{return} sources
00688     
\hypertarget{pynebcore_8py_source_l00689}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a4894e804fd2ea5cf1947de2535d2243f}{00689}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a4894e804fd2ea5cf1947de2535d2243f}{printSources}(self):
00690         
00691         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a13ff2c1aef93336f152a248e534bd104}{getSources}():
00692             \textcolor{keywordflow}{print} source    
00693     
\hypertarget{pynebcore_8py_source_l00694}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac2e555f92570ed4df42926d0c415ac4c}{00694}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac2e555f92570ed4df42926d0c415ac4c}{getChebOrder}(self, lev\_i= -1, lev\_j= -1):
00695         \textcolor{stringliteral}{"""}
00696 \textcolor{stringliteral}{        Return order of Chebyshev polynomial fitting the collision strengths of selected transition.}
00697 \textcolor{stringliteral}{        If transition not specified, return result for all transitions.}
00698 \textcolor{stringliteral}{        }
00699 \textcolor{stringliteral}{        Usage:}
00700 \textcolor{stringliteral}{            O3.getChebOrder(4, 2)}
00701 \textcolor{stringliteral}{        }
00702 \textcolor{stringliteral}{        Parameters:}
00703 \textcolor{stringliteral}{            - lev\_i  upper level (default= -1, returns complete array)}
00704 \textcolor{stringliteral}{            - lev\_j  lower level (default= -1, returns complete array)}
00705 \textcolor{stringliteral}{}
00706 \textcolor{stringliteral}{        """}
00707         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{\_test\_lev}(lev\_i)
00708         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{\_test\_lev}(lev\_j)
00709         \textcolor{keywordflow}{if} (lev\_i == -1):
00710             \textcolor{keywordflow}{if} (lev\_j == -1):
00711                 ChebOrder = np.zeros([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}])
00712                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} - 1):
00713                     lev\_i = i + 1
00714                     j = i + 1
00715                     \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}):
00716                         lev\_j = j + 1
00717                         fieldName = \textcolor{stringliteral}{'Omega(\{0\}->\{1\})'}.format(lev\_j, lev\_i)
00718                         index = self.CollExtNames.index(fieldName)
00719                         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{OmegaInterp} == \textcolor{stringliteral}{'Linear'}:
00720                             ChebOrder[j][i] = -1
00721                         \textcolor{keywordflow}{else}:
00722                             ChebOrder[j][i] = int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TUNIT\{0\}'}.format(index + 1)])
00723                         j += 1
00724         \textcolor{keywordflow}{else}:   
00725             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{OmegaInterp} == \textcolor{stringliteral}{'Linear'}:
00726                 ChebOrder = -1
00727             \textcolor{keywordflow}{else}:
00728                 fieldName = \textcolor{stringliteral}{'Omega(\{0\}->\{1\})'}.format(lev\_i, lev\_j)
00729                 index = self.CollExtNames.index(fieldName)
00730                 ChebOrder = int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TUNIT\{0\}'}.format(index + 1)])
00731         \textcolor{keywordflow}{return} ChebOrder
00732 
00733 
\hypertarget{pynebcore_8py_source_l00734}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afe4a86564a0306ca1a72cfccc1a66360}{00734}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afe4a86564a0306ca1a72cfccc1a66360}{\_getChebCoeffArray}(self):
00735         \textcolor{stringliteral}{"""}
00736 \textcolor{stringliteral}{        Return coefficients of Chebyshev fit of all transitions in a given atom}
00737 \textcolor{stringliteral}{            (3D array of Chebyshev fits; the first two dimensions are atomic levels,}
00738 \textcolor{stringliteral}{            the third is the array of coefficients of the Chebyshev polynomial}
00739 \textcolor{stringliteral}{            for the corresponding transition.}
00740 \textcolor{stringliteral}{}
00741 \textcolor{stringliteral}{        """}
00742 
00743         \textcolor{keyword}{def }\_chebyshevFit(temArray, omegaDict):
00744             \textcolor{stringliteral}{"""}
00745 \textcolor{stringliteral}{            Return coefficients of Chebyshev fit of a given transition}
00746 \textcolor{stringliteral}{            }
00747 \textcolor{stringliteral}{            Parameters:}
00748 \textcolor{stringliteral}{                - temArray    array of temperature points in collisional strengths data}
00749 \textcolor{stringliteral}{                - omegaDict   order of Chebyshev fit + array of collisional strengths }
00750 \textcolor{stringliteral}{                                of a given transition}
00751 \textcolor{stringliteral}{}
00752 \textcolor{stringliteral}{            """}
00753             warnings.filterwarnings(\textcolor{stringliteral}{'ignore'}, \textcolor{stringliteral}{"The fit may be poorly conditioned"})
00754 
00755             \textcolor{comment}{# -1 because (IRAF's order) = (polynomial degree + 1)}
00756             order = omegaDict[\textcolor{stringliteral}{'order'}] - 1
00757             data = omegaDict[\textcolor{stringliteral}{'data'}]
00758             coeffs = chebyshev.chebfit(temArray, data, order)
00759             \textcolor{keywordflow}{return} coeffs
00760         
00761         \textcolor{keywordflow}{if} np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}) == -1:
00762             \textcolor{keywordflow}{return} -1
00763         \textcolor{keywordflow}{else}:
00764             ChebCoeffArray = np.zeros([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, np.max(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder})])
00765             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} - 1):
00766                 lev\_i = i + 1
00767                 j = i + 1
00768                 \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}):
00769                     lev\_j = j + 1
00770                     \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1] == -1:
00771                         ChebCoeffArray[i, j, 0: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1]] = -1
00772                     \textcolor{keywordflow}{else}:
00773                         myOmega = \{\textcolor{stringliteral}{'order'}: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1],
00774                                    \textcolor{stringliteral}{'data'}: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{getOmegaArray}(lev\_j, lev\_i)\}
00775                         \textcolor{keywordflow}{if} myOmega[\textcolor{stringliteral}{'order'}] != 0.0:
00776                             ChebCoeffArray[i, j, 0: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1]] = \(\backslash\)
00777                                 np.array(\_chebyshevFit(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}(), myOmega))
00778                     j += 1
00779             \textcolor{keywordflow}{return} ChebCoeffArray
00780 
00781 
00782 
\hypertarget{pynebcore_8py_source_l00783}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{00783}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{getOmegaArray}(self, lev\_i= -1, lev\_j= -1):
00784         \textcolor{stringliteral}{"""}
00785 \textcolor{stringliteral}{        Return array of original tabulated collision strengths for a given transition, }
00786 \textcolor{stringliteral}{            as a function of temperature.}
00787 \textcolor{stringliteral}{        }
00788 \textcolor{stringliteral}{        Usage:}
00789 \textcolor{stringliteral}{            O3.getOmegaArray()}
00790 \textcolor{stringliteral}{        }
00791 \textcolor{stringliteral}{        Parameters:}
00792 \textcolor{stringliteral}{            - lev\_j  lower level (default= -1, returns complete array)}
00793 \textcolor{stringliteral}{            - lev\_i  upper level (default= -1, returns complete array)}
00794 \textcolor{stringliteral}{}
00795 \textcolor{stringliteral}{        """}
00796         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{\_test\_lev}(lev\_i)
00797         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{\_test\_lev}(lev\_j)
00798         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
00799             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00800             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}            
00801         \textcolor{keywordflow}{elif} lev\_i == -1 \textcolor{keywordflow}{or} lev\_j == -1:
00802             result = []
00803             \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.\_CollData.names:
00804                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'Omega'} \textcolor{keywordflow}{in} name:
00805                     result.append(name + \textcolor{stringliteral}{": "} + str(self.\_CollData.field(name)))
00806             \textcolor{keywordflow}{return} result
00807         \textcolor{keywordflow}{else}:
00808             \textcolor{keywordflow}{return} (self.\_CollData.field(\textcolor{stringliteral}{'Omega(\{0\}->\{1\})'}.format(lev\_i, lev\_j)))
00809 
00810 
\hypertarget{pynebcore_8py_source_l00811}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a07beca7cf9ee37f231754f0458fb8c2f}{00811}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a07beca7cf9ee37f231754f0458fb8c2f}{getOmega}(self, tem, lev\_i= -1, lev\_j= -1):
00812         \textcolor{stringliteral}{"""}
00813 \textcolor{stringliteral}{        Return interpolated value of the collision strength value at the given temperature }
00814 \textcolor{stringliteral}{            for the complete array or a specified transition.}
00815 \textcolor{stringliteral}{}
00816 \textcolor{stringliteral}{        Usage:}
00817 \textcolor{stringliteral}{            O3.getOmega(15000.)}
00818 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4])}
00819 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)}
00820 \textcolor{stringliteral}{        }
00821 \textcolor{stringliteral}{        Parameters:}
00822 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
00823 \textcolor{stringliteral}{            - lev\_i  upper level}
00824 \textcolor{stringliteral}{            - lev\_j  lower level}
00825 \textcolor{stringliteral}{}
00826 \textcolor{stringliteral}{        """}
00827         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{\_test\_lev}(lev\_i)
00828         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a7bc932cc0743068d924a2ac51af0b4d4}{\_test\_lev}(lev\_j)
00829         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
00830             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given: \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00831             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}            
00832         tem\_in\_file\_units = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afa9318fd2557709e968682f47cefa379}{\_transfo\_tem}(tem)
00833         TemArray = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}()
00834         \textcolor{keywordflow}{if} (lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1):
00835             tem = np.asarray(tem)
00836             res\_shape = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}]
00837             \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
00838                 res\_shape.append(sh)
00839             Omega = np.zeros(res\_shape)
00840     
00841             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} - 1):
00842                 j = i + 1
00843                 \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}):
00844                     Omega[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a07beca7cf9ee37f231754f0458fb8c2f}{getOmega}(tem, j + 1, i + 1)
00845                     j += 1
00846         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_i - 1, lev\_j - 1] != -1:
00847             fit = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_af8eaa90b2ddbf77c0a78b648e9f66971}{ChebCoeffs}[lev\_j - 1, lev\_i - 1, 0: self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_i - 1, lev\_j - 1]]
00848             tem\_eval = tem\_in\_file\_units
00849             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{noExtrapol} \textcolor{keywordflow}{or} pn.config.get\_noExtrapol():
00850                 leftExtrapol = np.NAN
00851                 rightExtrapol = np.NAN
00852             \textcolor{keywordflow}{else}:
00853                 leftExtrapol = TemArray[0]
00854                 rightExtrapol = TemArray[-1]
00855             
00856             \textcolor{keywordflow}{if} np.ndim(tem\_eval) > 0:
00857                 left = (tem\_eval < TemArray[0])
00858                 tem\_eval[left] = leftExtrapol
00859                 right = (tem\_eval > TemArray[-1])
00860                 tem\_eval[right] = rightExtrapol
00861             \textcolor{keywordflow}{else}:
00862                 \textcolor{keywordflow}{if} tem\_eval < TemArray[0]:
00863                     tem\_eval = leftExtrapol
00864                 \textcolor{keywordflow}{elif} tem\_eval > TemArray[-1]:
00865                     tem\_eval = rightExtrapol
00866             Omega = chebyshev.chebval(tem\_eval, fit)
00867         \textcolor{keywordflow}{else}:
00868             OmegaArray = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{getOmegaArray}(lev\_i, lev\_j)
00869             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{noExtrapol} \textcolor{keywordflow}{or} pn.config.get\_noExtrapol():
00870                 leftExtrapol = np.NAN
00871                 rightExtrapol = np.NAN
00872             \textcolor{keywordflow}{else}:
00873                 leftExtrapol = OmegaArray[0]
00874                 rightExtrapol = OmegaArray[-1]
00875             Omega = np.interp(tem\_in\_file\_units, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}(), OmegaArray,
00876                               left=leftExtrapol, right=rightExtrapol)
00877         \textcolor{keywordflow}{return} np.squeeze(Omega)
00878 
00879 
\hypertarget{pynebcore_8py_source_l00880}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{00880}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}(self, keep\_unit=True):
00881         \textcolor{stringliteral}{"""}
00882 \textcolor{stringliteral}{        Return array of tabulated original temperature points (as in fits file) }
00883 \textcolor{stringliteral}{            of collision strengths.}
00884 \textcolor{stringliteral}{        }
00885 \textcolor{stringliteral}{        Parameters:}
00886 \textcolor{stringliteral}{            - keep\_unit   return temperature in file units (default) or change it to Kelvin (False)}
00887 \textcolor{stringliteral}{}
00888 \textcolor{stringliteral}{}
00889 \textcolor{stringliteral}{        """}
00890         tem\_in\_file = self.\_CollData.field(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TTYPE1'}])
00891         \textcolor{keywordflow}{if} keep\_unit:
00892             \textcolor{keywordflow}{return} tem\_in\_file
00893         \textcolor{keywordflow}{else}:            
00894             \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
00895                 \textcolor{keywordflow}{return} pow(10., tem\_in\_file)
00896             \textcolor{keywordflow}{else}:
00897                 \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
00898                     \textcolor{keywordflow}{return} tem\_in\_file * 1.e4
00899                 \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
00900                     \textcolor{keywordflow}{return} tem\_in\_file
00901 
\hypertarget{pynebcore_8py_source_l00902}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii}{00902} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii}{\_CollDataAscii}(object):
00903 
00904     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad4514c646ad1e65d9d5e10c80d215041}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, OmegaInterp='Linear', noExtrapol = False, 
\hypertarget{pynebcore_8py_source_l00905}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad4514c646ad1e65d9d5e10c80d215041}{00905}                  NLevelsMax=\textcolor{keywordtype}{None}):
\hypertarget{pynebcore_8py_source_l00906}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a9277c108416ceb0bbdca484a4a246b5c}{00906}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a9277c108416ceb0bbdca484a4a246b5c}{log\_} = pn.log\_
00907         
00908         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00909}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{00909}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom} = atom
\hypertarget{pynebcore_8py_source_l00910}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{00910}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00911}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{00911}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)[1])
00912         \textcolor{keywordflow}{else}:
00913             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem} = elem
00914             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec} = int(spec)
00915             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec})
\hypertarget{pynebcore_8py_source_l00916}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a39c9697691d3e8e8d7f99c05e0baa4a9}{00916}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a39c9697691d3e8e8d7f99c05e0baa4a9}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem}]
\hypertarget{pynebcore_8py_source_l00917}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa4f6c8d0a2a8e4ac6503d67b4a51188d}{00917}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa4f6c8d0a2a8e4ac6503d67b4a51188d}{noExtrapol} = noExtrapol
\hypertarget{pynebcore_8py_source_l00918}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{00918}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}
00919         \textcolor{keywordflow}{if} OmegaInterp != \textcolor{stringliteral}{'Linear'}:
00920             self.log\_.error(\textcolor{stringliteral}{'Ascii files does not support other interpolation than Linear'}, 
00921                             calling = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00922         
00923         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2010732c9e4c8423831e82a3644aed60}{\_loadAscii}()
00924         \textcolor{comment}{#self.initOmegas(OmegaInterp=OmegaInterp)}
00925         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'T\_UNIT'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
\hypertarget{pynebcore_8py_source_l00926}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{00926}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'T\_UNIT'}]
00927         \textcolor{keywordflow}{else}:
00928             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} = \textcolor{stringliteral}{"K/10000"} \textcolor{comment}{# Default value}
00929         \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
00930             \textcolor{keyword}{def }transfo\_tem(x):
00931                 y = np.log10(x)
00932                 \textcolor{keywordflow}{if} np.ndim(y) == 0:
00933                     y = np.array(y)
00934                 \textcolor{keywordflow}{return} y
00935         \textcolor{keywordflow}{elif} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
00936                 \textcolor{keyword}{def }transfo\_tem(x):
00937                     y = x / 1e4
00938                     \textcolor{keywordflow}{if} np.ndim(y) == 0:
00939                         y = np.array(y)
00940                     \textcolor{keywordflow}{return} y
00941         \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
00942                 \textcolor{keyword}{def }transfo\_tem(x):
00943                     y = x
00944                     \textcolor{keywordflow}{return} x
\hypertarget{pynebcore_8py_source_l00945}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf268c621d916f4ea71bb5825e249200}{00945}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf268c621d916f4ea71bb5825e249200}{\_transfo\_tem} = transfo\_tem
00946 
\hypertarget{pynebcore_8py_source_l00947}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2010732c9e4c8423831e82a3644aed60}{00947}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2010732c9e4c8423831e82a3644aed60}{\_loadAscii}(self):
00948         
\hypertarget{pynebcore_8py_source_l00949}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{00949}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile} = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}, data\_type=\textcolor{stringliteral}{'coll'})
00950         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00951             self.log\_.error(\textcolor{stringliteral}{'No coll data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00952             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00953         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom} \textcolor{keywordflow}{in} pn.config.DataFiles:
00954             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}]:
00955                 pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile})
00956         \textcolor{keywordflow}{else}:
00957             pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}]
00958             
\hypertarget{pynebcore_8py_source_l00959}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa407510c78da8c376cd7d82a2ec87ba4}{00959}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa407510c78da8c376cd7d82a2ec87ba4}{collPath} = pn.atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile})
00960         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa407510c78da8c376cd7d82a2ec87ba4}{collPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile})
00961         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00962             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00963             
00964         self.log\_.message(\textcolor{stringliteral}{'Reading coll data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00965 
00966     
00967         \textcolor{comment}{# Read data from ascii file}
00968         \textcolor{comment}{#}
00969         \textcolor{comment}{# Read energies and stat weights }
00970         f = open(file\_to\_open)
00971         data = f.readlines()
00972         f.close()
00973     
00974         coll\_data = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}], dtype=\textcolor{stringliteral}{'float'})
00975         comments\_tab = [d \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]==\textcolor{stringliteral}{'***'}]
\hypertarget{pynebcore_8py_source_l00976}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{00976}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments} = \{\}
00977         \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} comments\_tab:
00978             key = com.split()[1]
00979             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[key] = com.split(key)[1].replace(\textcolor{stringliteral}{"'"}, \textcolor{stringliteral}{""}).replace(\textcolor{stringliteral}{'"'}, \textcolor{stringliteral}{''}).strip()
\hypertarget{pynebcore_8py_source_l00980}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{00980}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{\_lev\_is} = coll\_data[:,0]
\hypertarget{pynebcore_8py_source_l00981}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{00981}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{\_lev\_js} = coll\_data[:,1]
\hypertarget{pynebcore_8py_source_l00982}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{00982}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray} = coll\_data[0,2:]
00983         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'N\_LEVELS'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
\hypertarget{pynebcore_8py_source_l00984}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{00984}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} = int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'N\_LEVELS'}])
00985         \textcolor{keywordflow}{else}:
00986             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} = int(np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{\_lev\_js}))
\hypertarget{pynebcore_8py_source_l00987}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{00987}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}, len(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray})))
00988         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{\_lev\_is})):
00989             lev\_i = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{\_lev\_is}[i]
00990             lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{\_lev\_js}[i]
00991             \textcolor{keywordflow}{if} (lev\_i != 0) \textcolor{keywordflow}{and} (lev\_j != 0):
00992                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray}[lev\_i-1, lev\_j-1, :] = coll\_data[i,2:]
00993         
00994         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
00995             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec}:
00996                 pn.log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.
      format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'SPECTRUM'}],
00997                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00998         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
00999             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem}]:
01000                 pn.log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}.
       Check the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'ATOM'}],
01001                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})        
01002         
\hypertarget{pynebcore_8py_source_l01003}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a35b3c891312962903e5ee00cf992db48}{01003}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a35b3c891312962903e5ee00cf992db48}{getSources}(self):
01004         sources = []
01005         sources\_dic = \{\}
01006         notes = \{\}
01007         \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
01008             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} com:
01009                 number = com.split(\textcolor{stringliteral}{'SOURCE'})[1]
01010                 sources\_dic[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[com]
01011             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'NOTE'} \textcolor{keywordflow}{in} com:
01012                 number = com.split(\textcolor{stringliteral}{'NOTE'})[1]
01013                 notes[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[com]
01014         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} sources\_dic:
01015             \textcolor{keywordflow}{try}:
01016                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}: \{2\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}, notes[key], sources\_dic[key])) 
01017             \textcolor{keywordflow}{except}:
01018                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}, sources[key]))
01019         \textcolor{keywordflow}{return} sources
01020                 
\hypertarget{pynebcore_8py_source_l01021}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a05df67dc5de0c75eb3a7055af7044c31}{01021}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a05df67dc5de0c75eb3a7055af7044c31}{printSources}(self):
01022         
01023         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a35b3c891312962903e5ee00cf992db48}{getSources}():
01024             \textcolor{keywordflow}{print} source    
01025 
\hypertarget{pynebcore_8py_source_l01026}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a932859ccd799e220c26e9f9db0cdd0a6}{01026}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a932859ccd799e220c26e9f9db0cdd0a6}{\_test\_lev}(self, level):
01027         \textcolor{stringliteral}{"""}
01028 \textcolor{stringliteral}{        Test whether selected level is legal}
01029 \textcolor{stringliteral}{}
01030 \textcolor{stringliteral}{        Parameters:}
01031 \textcolor{stringliteral}{            - level        selected atom level}
01032 \textcolor{stringliteral}{}
01033 \textcolor{stringliteral}{        """}       
01034         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}:
01035             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\} (maximum: \{1\})'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}),
01036                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
01037 
01038     @profile
\hypertarget{pynebcore_8py_source_l01039}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ac78bf2ddca80543884f09c2924308351}{01039}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ac78bf2ddca80543884f09c2924308351}{getOmegaArray}(self, lev\_i= -1, lev\_j= -1):
01040         \textcolor{stringliteral}{"""}
01041 \textcolor{stringliteral}{        Return array of original tabulated collision strengths for a given transition, }
01042 \textcolor{stringliteral}{            as a function of temperature.}
01043 \textcolor{stringliteral}{        }
01044 \textcolor{stringliteral}{        Usage:}
01045 \textcolor{stringliteral}{            O3.getOmegaArray()}
01046 \textcolor{stringliteral}{        }
01047 \textcolor{stringliteral}{        Parameters:}
01048 \textcolor{stringliteral}{            - lev\_j  lower level (default= -1, returns complete array)}
01049 \textcolor{stringliteral}{            - lev\_i  upper level (default= -1, returns complete array)}
01050 \textcolor{stringliteral}{}
01051 \textcolor{stringliteral}{        """}
01052         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a932859ccd799e220c26e9f9db0cdd0a6}{\_test\_lev}(lev\_i)
01053         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a932859ccd799e220c26e9f9db0cdd0a6}{\_test\_lev}(lev\_j)
01054         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
01055             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
01056             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01057         \textcolor{keywordflow}{elif} lev\_i == -1 \textcolor{keywordflow}{or} lev\_j == -1:
01058             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray}
01059         \textcolor{keywordflow}{else}:
01060             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray}[lev\_j-1, lev\_i-1,:]
01061         
01062     @profile
\hypertarget{pynebcore_8py_source_l01063}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2f99c08a0f6a46d88b6e09b0a36495c2}{01063}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2f99c08a0f6a46d88b6e09b0a36495c2}{getOmega}(self, tem, lev\_i= -1, lev\_j= -1):
01064         \textcolor{stringliteral}{"""}
01065 \textcolor{stringliteral}{        Return interpolated value of the collision strength value at the given temperature }
01066 \textcolor{stringliteral}{            for the complete array or a specified transition.}
01067 \textcolor{stringliteral}{}
01068 \textcolor{stringliteral}{        Usage:}
01069 \textcolor{stringliteral}{            O3.getOmega(15000.)}
01070 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4])}
01071 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)}
01072 \textcolor{stringliteral}{        }
01073 \textcolor{stringliteral}{        Parameters:}
01074 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
01075 \textcolor{stringliteral}{            - lev\_i  upper level}
01076 \textcolor{stringliteral}{            - lev\_j  lower level}
01077 \textcolor{stringliteral}{}
01078 \textcolor{stringliteral}{        """}
01079         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a932859ccd799e220c26e9f9db0cdd0a6}{\_test\_lev}(lev\_i)
01080         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a932859ccd799e220c26e9f9db0cdd0a6}{\_test\_lev}(lev\_j)
01081         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
01082             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
01083             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}            
01084         tem\_in\_file\_units = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf268c621d916f4ea71bb5825e249200}{\_transfo\_tem}(tem)
01085         \textcolor{keywordflow}{if} (lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1):
01086             tem = np.asarray(tem)
01087             res\_shape = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}]
01088             \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01089                 res\_shape.append(sh)
01090             Omega = np.zeros(res\_shape)
01091     
01092             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} - 1):
01093                 j = i + 1
01094                 \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}):
01095                     Omega[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2f99c08a0f6a46d88b6e09b0a36495c2}{getOmega}(tem, j + 1, i + 1)
01096                     j += 1
01097         \textcolor{keywordflow}{else}:
01098             OmegaArray = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ac78bf2ddca80543884f09c2924308351}{getOmegaArray}(lev\_i, lev\_j)
01099             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa4f6c8d0a2a8e4ac6503d67b4a51188d}{noExtrapol} \textcolor{keywordflow}{or} pn.config.get\_noExtrapol():
01100                 leftExtrapol = np.NAN
01101                 rightExtrapol = np.NAN
01102             \textcolor{keywordflow}{else}:
01103                 leftExtrapol = OmegaArray[0]
01104                 rightExtrapol = OmegaArray[-1]
01105             Omega = np.interp(tem\_in\_file\_units, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf234dd4932c7f789eb8eaaf6a16cfc9}{getTemArray}(), OmegaArray,
01106                               left=leftExtrapol, right=rightExtrapol)
01107         
01108         \textcolor{keywordflow}{return} np.squeeze(Omega)
01109     
\hypertarget{pynebcore_8py_source_l01110}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf234dd4932c7f789eb8eaaf6a16cfc9}{01110}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf234dd4932c7f789eb8eaaf6a16cfc9}{getTemArray}(self, keep\_unit=True):
01111         \textcolor{stringliteral}{"""}
01112 \textcolor{stringliteral}{        Return array of tabulated original temperature points (as in fits file) }
01113 \textcolor{stringliteral}{            of collision strengths.}
01114 \textcolor{stringliteral}{        }
01115 \textcolor{stringliteral}{        Parameters:}
01116 \textcolor{stringliteral}{            - keep\_unit   return temperature in file units (default) or change it to Kelvin (False)}
01117 \textcolor{stringliteral}{}
01118 \textcolor{stringliteral}{}
01119 \textcolor{stringliteral}{        """}
01120         \textcolor{keywordflow}{if} keep\_unit:
01121             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray}
01122         \textcolor{keywordflow}{else}:            
01123             \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
01124                 \textcolor{keywordflow}{return} pow(10., self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray})
01125             \textcolor{keywordflow}{else}:
01126                 \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
01127                     \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray} * 1.e4
01128                 \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
01129                     \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray}
01130 
01131 
01132 
\hypertarget{pynebcore_8py_source_l01133}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom}{01133} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom}{Atom}(object):
01134     \textcolor{stringliteral}{"""}
01135 \textcolor{stringliteral}{    Define the atom object, fill it with data, explore the data, and }
01136 \textcolor{stringliteral}{    compute quantities such as level populations and line emissivities.}
01137 \textcolor{stringliteral}{}
01138 \textcolor{stringliteral}{    """}
01139     \textcolor{comment}{# This following Class variable will hold the (unique) references of every Atom instance created.}
01140     \textcolor{comment}{# This allows to list all the references used in a project.}
01141     
01142     
01143     @profile
\hypertarget{pynebcore_8py_source_l01144}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad92916e464a9e193eb3e49b84f253a35}{01144}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad92916e464a9e193eb3e49b84f253a35}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, OmegaInterp='Linear', noExtrapol = False):
01145         \textcolor{stringliteral}{"""}
01146 \textcolor{stringliteral}{        Atom constructor}
01147 \textcolor{stringliteral}{        }
01148 \textcolor{stringliteral}{        Parameters:}
01149 \textcolor{stringliteral}{            - elem          symbol of the selected element}
01150 \textcolor{stringliteral}{            - spec          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
01151 \textcolor{stringliteral}{            - atom          ion (e.g. 'O3').}
01152 \textcolor{stringliteral}{            - OmegaInterp   one of ('Cheb', 'Linear'). Default is Linear. "Cheb" works only for fits files.
       }
01153 \textcolor{stringliteral}{            - noExtrapol    if set to False (default), Omega will be extrapolated above and below}
01154 \textcolor{stringliteral}{                            the highest and lowest temperatures where it is defined. If set to True}
01155 \textcolor{stringliteral}{                            a NaN will be return.}
01156 \textcolor{stringliteral}{            }
01157 \textcolor{stringliteral}{        Usage:}
01158 \textcolor{stringliteral}{            O3 = pn.Atom('O',3)}
01159 \textcolor{stringliteral}{            N2 = pn.Atom(atom='N2')}
01160 \textcolor{stringliteral}{            S2 = pn.Atom(atom='S2', OmegaInterp='Linear')}
01161 \textcolor{stringliteral}{        """}        
\hypertarget{pynebcore_8py_source_l01162}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9e2e5b5402bb9cf14c1b08684bccbf6b}{01162}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9e2e5b5402bb9cf14c1b08684bccbf6b}{log\_} = pn.log\_
01163         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l01164}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{01164}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom} = str.capitalize(atom)
\hypertarget{pynebcore_8py_source_l01165}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{01165}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})[0]
\hypertarget{pynebcore_8py_source_l01166}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{01166}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})[1])
01167         \textcolor{keywordflow}{else}:
01168             \textcolor{keywordflow}{if} elem[0].isalpha():
01169                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} = str.capitalize(elem)
01170             \textcolor{keywordflow}{else}:
01171                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} = elem
01172             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec} = int(spec)
01173             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec})
\hypertarget{pynebcore_8py_source_l01174}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa8b43e1441b80824954f2f2fac4f2eba}{01174}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa8b43e1441b80824954f2f2fac4f2eba}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}]
\hypertarget{pynebcore_8py_source_l01175}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{01175}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}
01176         self.log\_.message(\textcolor{stringliteral}{'Making atom object for \{0\} \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01177 
01178         dataFile = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, data\_type=\textcolor{stringliteral}{'atom'})
01179         \textcolor{keywordflow}{if} dataFile \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l01180}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{01180}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} = \textcolor{keywordtype}{None}
01181         \textcolor{keywordflow}{else}:
01182             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} = dataFile.split(\textcolor{stringliteral}{'.'})[-1]
01183         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} == \textcolor{stringliteral}{'fits'}:
\hypertarget{pynebcore_8py_source_l01184}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{01184}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits}{\_AtomDataFits}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})
01185         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} == \textcolor{stringliteral}{'dat'}:
01186             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii}{\_AtomDataAscii}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})
01187         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} == \textcolor{stringliteral}{'chianti'}:
01188             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1utils_1_1pn__chianti_1_1___atom_chianti}{\_AtomChianti}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})
01189         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01190             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none}{\_AtomDataNone}()
01191         \textcolor{keywordflow}{else}:
01192             pn.log\_.error(\textcolor{stringliteral}{'Atom file extensions must be fits, dat or chianti'})
01193                     
\hypertarget{pynebcore_8py_source_l01194}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{01194}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{atomFile} = self.AtomData.atomFile
\hypertarget{pynebcore_8py_source_l01195}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8c2ddffd0cd3f7ce2a089e87746e909f}{01195}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8c2ddffd0cd3f7ce2a089e87746e909f}{atomPath} = self.AtomData.atomPath
\hypertarget{pynebcore_8py_source_l01196}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ada464bba6971f03f7fc1a51228b35f5d}{01196}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ada464bba6971f03f7fc1a51228b35f5d}{atomFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{atomFile} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01197}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8919c61156a1cbc2cfac6a6d9ee3b1f7}{01197}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8919c61156a1cbc2cfac6a6d9ee3b1f7}{atomFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8c2ddffd0cd3f7ce2a089e87746e909f}{atomPath} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01198}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{01198}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang} = self.AtomData.wave\_Ang
\hypertarget{pynebcore_8py_source_l01199}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{01199}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight} = self.AtomData.getStatWeight
\hypertarget{pynebcore_8py_source_l01200}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{01200}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy} = self.AtomData.getEnergy
\hypertarget{pynebcore_8py_source_l01201}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{01201}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{atomNLevels} = self.AtomData.NLevels
01202         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01203}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{01203}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs} = self.AtomData.gs
01204         \textcolor{keywordflow}{except}:
01205             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs} = \hyperlink{namespacepyneb_1_1utils_1_1physics_affea300d5f6d64b440b7363755a67cef}{gsFromAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})
01206         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01207}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5d9daf69b08c0f60714095f34d0bb0f5}{01207}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5d9daf69b08c0f60714095f34d0bb0f5}{AtomHeader} = self.AtomData.AtomHeader
01208         \textcolor{keywordflow}{except}:
01209             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5d9daf69b08c0f60714095f34d0bb0f5}{AtomHeader} = \textcolor{keywordtype}{None}
01210         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01211}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{01211}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} = self.AtomData.NIST
01212         \textcolor{keywordflow}{except}:
01213             \textcolor{keywordflow}{try}:
01214                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{atomNLevels})
01215             \textcolor{keywordflow}{except}:
01216                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} = \textcolor{keywordtype}{None}
01217 
\hypertarget{pynebcore_8py_source_l01218}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{01218}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList} = []
01219         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{atomNLevels}):
01220             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} np.arange(i):
01221                 self.lineList.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i][j])
01222         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList} = np.array(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList})
\hypertarget{pynebcore_8py_source_l01223}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4198e6d7ab28c6973dd0f567e285ac3b}{01223}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4198e6d7ab28c6973dd0f567e285ac3b}{energy\_Ryd} = \hyperlink{namespacepyneb_1_1utils_1_1misc_afa4163f24be7b1472200c24824c72ae1}{quiet\_divide}(pn.CST.RYD\_ANG, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang})
\hypertarget{pynebcore_8py_source_l01224}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a07f2923aa90cd65d395812bf5cfd5fe3}{01224}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a07f2923aa90cd65d395812bf5cfd5fe3}{energy\_eV} = pn.CST.RYD\_EV * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4198e6d7ab28c6973dd0f567e285ac3b}{energy\_Ryd}
01225 
01226         dataFile = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, data\_type=\textcolor{stringliteral}{'coll'})
01227         \textcolor{keywordflow}{if} dataFile \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l01228}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{01228}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} = \textcolor{keywordtype}{None}
01229         \textcolor{keywordflow}{else}:
01230             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} = dataFile.split(\textcolor{stringliteral}{'.'})[-1]
01231         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} == \textcolor{stringliteral}{'fits'}:
\hypertarget{pynebcore_8py_source_l01232}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{01232}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits}{\_CollDataFits}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, 
01233                                          OmegaInterp=OmegaInterp, noExtrapol = noExtrapol)
01234         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} == \textcolor{stringliteral}{'dat'}:
01235             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii}{\_CollDataAscii}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, 
01236                                           OmegaInterp=\textcolor{stringliteral}{'Linear'}, noExtrapol = noExtrapol)
01237         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} == \textcolor{stringliteral}{'chianti'}:
01238             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1utils_1_1pn__chianti_1_1___coll_chianti}{\_CollChianti}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})
01239         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01240             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none}{\_CollDataNone}()
01241         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01242}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acc4393c4ba0bba2e8d5b1cb49682d488}{01242}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acc4393c4ba0bba2e8d5b1cb49682d488}{CollHeader} = self.CollData.CollHeader
01243         \textcolor{keywordflow}{except}:
01244             \textcolor{keywordflow}{pass}
01245         \textcolor{keywordflow}{if} \textcolor{stringliteral}{"comments"} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.CollData.\_\_dict\_\_.keys():
01246             self.CollData.comments = []
\hypertarget{pynebcore_8py_source_l01247}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a82067d384b463179a274711b618f03b5}{01247}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a82067d384b463179a274711b618f03b5}{getOmegaArray} = self.CollData.getOmegaArray
\hypertarget{pynebcore_8py_source_l01248}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{01248}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{getTemArray} = self.CollData.getTemArray
\hypertarget{pynebcore_8py_source_l01249}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{01249}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{collFile} = self.CollData.collFile
\hypertarget{pynebcore_8py_source_l01250}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7afd231b8a40f04aff5d61b8cc20c387}{01250}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7afd231b8a40f04aff5d61b8cc20c387}{collPath} = self.CollData.collPath
\hypertarget{pynebcore_8py_source_l01251}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a60a9c79fb04bee36371a0123fb5ae842}{01251}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a60a9c79fb04bee36371a0123fb5ae842}{collFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{collFile} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01252}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a386b3ef5e37abd539dbe36eeadfbeca5}{01252}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a386b3ef5e37abd539dbe36eeadfbeca5}{collFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7afd231b8a40f04aff5d61b8cc20c387}{collPath} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01253}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{01253}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels} = self.CollData.NLevels
\hypertarget{pynebcore_8py_source_l01254}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a218d09913e06d074a86466946eb221f5}{01254}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a218d09913e06d074a86466946eb221f5}{tem\_units} = self.CollData.tem\_units
01255 
\hypertarget{pynebcore_8py_source_l01256}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{01256}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}() \textcolor{comment}{# index = quantum number - 1}
\hypertarget{pynebcore_8py_source_l01257}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{01257}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}() \textcolor{comment}{# Angstrom^-1}
\hypertarget{pynebcore_8py_source_l01258}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{01258}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{\_StatWeight} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}()
\hypertarget{pynebcore_8py_source_l01259}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a03277bf57e7056ec2199cc89f2a007aa}{01259}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a03277bf57e7056ec2199cc89f2a007aa}{EnergyNLevels} = len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy})
\hypertarget{pynebcore_8py_source_l01260}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{01260}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels} = np.min((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{atomNLevels}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a03277bf57e7056ec2199cc89f2a007aa}{EnergyNLevels}))
01261         
\hypertarget{pynebcore_8py_source_l01262}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{01262}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{getOmega}(self, tem, lev\_i= -1, lev\_j= -1, wave= -1):
01263         \textcolor{stringliteral}{"""}
01264 \textcolor{stringliteral}{        Return interpolated value of the collision strength value at the given temperature }
01265 \textcolor{stringliteral}{            for the complete array or a specified transition.}
01266 \textcolor{stringliteral}{        If kappa is not None (non-maxwellian distribution of e-velocities), the collision }
01267 \textcolor{stringliteral}{            strength is corrected as in Mendoza & Bautista, 2014 ApJ 785, 91.}
01268 \textcolor{stringliteral}{}
01269 \textcolor{stringliteral}{        Usage:}
01270 \textcolor{stringliteral}{            O3.getOmega(15000.)}
01271 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4])}
01272 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)}
01273 \textcolor{stringliteral}{        }
01274 \textcolor{stringliteral}{        Parameters:}
01275 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
01276 \textcolor{stringliteral}{            - lev\_i  upper level}
01277 \textcolor{stringliteral}{            - lev\_j  lower level}
01278 \textcolor{stringliteral}{}
01279 \textcolor{stringliteral}{        """}
01280         \textcolor{stringliteral}{"""}
01281 \textcolor{stringliteral}{        """}
01282         
01283         \textcolor{keywordflow}{if} wave != -1:
01284             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
01285         kappa = pn.config.kappa 
01286         \textcolor{keywordflow}{if} kappa \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01287             to\_return = self.CollData.getOmega(tem, lev\_i, lev\_j)
01288         \textcolor{keywordflow}{else}:
01289             \textcolor{keywordflow}{if} (lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1):
01290                 tem = np.asarray(tem)
01291                 res\_shape = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}]
01292                 \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01293                     res\_shape.append(sh)
01294                 Omega = np.zeros(res\_shape)
01295         
01296                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels} - 1):
01297                     j = i + 1
01298                     \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}):
01299                         Omega[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{getOmega}(tem, j + 1, i + 1)
01300                         j += 1
01301             \textcolor{keywordflow}{else}:
01302                 OmegaMB = self.CollData.getOmega(tem, lev\_i, lev\_j)
01303                 delta\_E = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_i, unit=\textcolor{stringliteral}{'eV'}) - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_j, unit=\textcolor{stringliteral}{'eV'})
01304                 correc = ((kappa - 3./2.)**(-0.5) / kappa * gamma(kappa+1) / gamma(kappa-0.5) * 
01305                           (1 + delta\_E/((kappa-1.5)*pn.CST.BOLTZMANN\_eVK*tem))**(-kappa)) * np.exp(delta\_E/
      pn.CST.BOLTZMANN\_eVK/tem)
01306     
01307                 Omega = correc * OmegaMB
01308                 pn.log\_.message(\textcolor{stringliteral}{'Correcting for Kappa=\{0\} by \{1\}'}.format(kappa, correc), self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01309 
01310             to\_return = np.squeeze(Omega)
01311         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'COEFF'} \textcolor{keywordflow}{in} self.CollData.comments:
01312             to\_return *= float(self.CollData.comments[\textcolor{stringliteral}{'COEFF'}])
01313         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'O\_UNIT'} \textcolor{keywordflow}{in} self.CollData.comments:
01314             \textcolor{keywordflow}{if} self.CollData.comments[\textcolor{stringliteral}{'O\_UNIT'}] == \textcolor{stringliteral}{'DEEX RATE COEFF'}:
01315                 to\_return /= pn.CST.KCOLLRATE / tem ** 0.5 / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i)
01316             \textcolor{keywordflow}{elif} self.CollData.comments[\textcolor{stringliteral}{'O\_UNIT'}] == \textcolor{stringliteral}{'RATE COEFF'}:
01317                 deltaE = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_i, unit=\textcolor{stringliteral}{'erg'}) - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_j, unit=\textcolor{stringliteral}{'erg'})
01318                 to\_return *= (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_j) / self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i) * np.exp(deltaE /(pn.CST.BOLTZMANN * tem))) \textcolor{comment}{#q21}
01319                 to\_return /= pn.CST.KCOLLRATE / tem ** 0.5 / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i)
01320             \textcolor{keywordflow}{elif} self.CollData.comments[\textcolor{stringliteral}{'O\_UNIT'}] == \textcolor{stringliteral}{'COOLING'}:
01321                 deltaE = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_i, unit=\textcolor{stringliteral}{'erg'}) - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_j, unit=\textcolor{stringliteral}{'erg'})
01322                 to\_return /= deltaE \textcolor{comment}{# Loss to q12                }
01323                 to\_return *= (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_j) / self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i) * np.exp(deltaE /(pn.CST.BOLTZMANN * tem))) \textcolor{comment}{#q21}
01324                 to\_return /= (pn.CST.KCOLLRATE / np.sqrt(tem) / self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i)) \textcolor{comment}{# Omega}
01325                 
01326         \textcolor{keywordflow}{return} to\_return
01327     
01328     @profile
\hypertarget{pynebcore_8py_source_l01329}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{01329}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{getCollRates}(self, tem, NLevels=None):
01330         \textcolor{stringliteral}{"""}
01331 \textcolor{stringliteral}{        Return (n\_levels x n\_levels) array of collision rates at given temperature. }
01332 \textcolor{stringliteral}{        }
01333 \textcolor{stringliteral}{        Usage:}
01334 \textcolor{stringliteral}{            O3.getCollRates(tem=10000)}
01335 \textcolor{stringliteral}{            O3.getCollRates([8e3, 1e4, 1.2e4])}
01336 \textcolor{stringliteral}{        }
01337 \textcolor{stringliteral}{        Parameters:}
01338 \textcolor{stringliteral}{            - tem     electronic temperature in K. May be an array.}
01339 \textcolor{stringliteral}{}
01340 \textcolor{stringliteral}{}
01341 \textcolor{stringliteral}{        """}
01342         tem = np.asarray(tem)
01343         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01344             NLevels = np.min((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a03277bf57e7056ec2199cc89f2a007aa}{EnergyNLevels}))
01345         res\_shape = [NLevels, NLevels]
01346         \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01347             res\_shape.append(sh)
01348         resultArray = np.zeros(res\_shape)
01349         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(NLevels - 1):
01350             lev\_i = i + 1
01351             j = i + 1
01352             energy\_i = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i]
01353             stat\_weight\_i = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{\_StatWeight}[i]
01354             \textcolor{keywordflow}{while} (j < NLevels):
01355                 lev\_j = j + 1 
01356                 energy\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]
01357                 stat\_weight\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{\_StatWeight}[j]
01358                 resultArray[j][i] = pn.CST.KCOLLRATE / tem ** 0.5 / stat\_weight\_j * self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{getOmega}(tem, lev\_j, lev\_i)
01359                 resultArray[i][j] = ((stat\_weight\_j) / (stat\_weight\_i) * 
01360                                       np.exp((energy\_i - energy\_j) / (pn.CST.BOLTZMANN\_ANGK * tem)) * 
01361                                       resultArray[j][i])
01362                 j += 1
01363         
01364         \textcolor{keywordflow}{return} np.squeeze(resultArray)
01365 
01366     
\hypertarget{pynebcore_8py_source_l01367}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{01367}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{\_Transition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
01368         \textcolor{stringliteral}{"""}
01369 \textcolor{stringliteral}{        Return an array with computed upper level, computed lower level, computed wavelength, }
01370 \textcolor{stringliteral}{            input wavelength}
01371 \textcolor{stringliteral}{        }
01372 \textcolor{stringliteral}{        Parameters:}
01373 \textcolor{stringliteral}{            - wave       wavelength either in Angstrom (a float or a label: e.g., 5007, '5007A') }
01374 \textcolor{stringliteral}{                            or in micron (a label: '51.5m')}
01375 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
01376 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
01377 \textcolor{stringliteral}{                            }
01378 \textcolor{stringliteral}{        """}
01379         \textcolor{keywordflow}{if} str(wave)[-1] == \textcolor{stringliteral}{'A'}:
01380             inputWave = float(wave[:-1])
01381             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave)
01382             maxError = maxErrorA
01383         \textcolor{keywordflow}{elif} str(wave)[-1] == \textcolor{stringliteral}{'m'}:
01384             inputWave = float(wave[:-1]) * 1e4
01385             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave)
01386             maxError = maxErrorm
01387         \textcolor{keywordflow}{else}:
01388             inputWave = wave
01389             label = \textcolor{stringliteral}{'\{0\}\_\{1\}A'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, int(wave))
01390             maxError = maxErrorA
01391             
01392         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{in} label2levelDict:
01393             result = [label2levelDict[label][0], label2levelDict[label][1], inputWave, inputWave]
01394             return(result)
01395         
01396         j, i = np.unravel\_index(np.argmin(abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang} - inputWave)), self.wave\_Ang.shape)
01397         bestWave = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j]
01398         error = np.abs(bestWave - inputWave) / inputWave
01399         result = [i + 1, j + 1, bestWave, inputWave]
01400         \textcolor{keywordflow}{if} error > maxError:
01401             self.log\_.warn(\textcolor{stringliteral}{'\_Transition: wavelengths differ by more than \{0:.2f\}%: input = \{1:.2f\}, output
       = \{2:.2f\}'}\(\backslash\)
01402                            .format(100 * maxError, inputWave, bestWave), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01403         return(result)
01404 
01405 
\hypertarget{pynebcore_8py_source_l01406}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{01406}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
01407         \textcolor{stringliteral}{"""}
01408 \textcolor{stringliteral}{        Return the indexes (upper level, lower level) of a transition for a given atom }
01409 \textcolor{stringliteral}{            from the wavelength.}
01410 \textcolor{stringliteral}{        }
01411 \textcolor{stringliteral}{        Usage:}
01412 \textcolor{stringliteral}{            O3.getTransition(4959)}
01413 \textcolor{stringliteral}{            }
01414 \textcolor{stringliteral}{        Parameters:}
01415 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
01416 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
01417 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
01418 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
01419 \textcolor{stringliteral}{                }
01420 \textcolor{stringliteral}{        """} 
01421         res = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{\_Transition}(wave, maxErrorA = maxErrorA, maxErrorm = maxErrorm)
01422         return(res[0], res[1])
01423         
01424 
\hypertarget{pynebcore_8py_source_l01425}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a2e6b21ca9b8f63a8da2167bdaf0912f3}{01425}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a2e6b21ca9b8f63a8da2167bdaf0912f3}{printTransition}(self, wave):
01426         \textcolor{stringliteral}{"""}
01427 \textcolor{stringliteral}{        Print info on transition associated to input wavelength.}
01428 \textcolor{stringliteral}{        }
01429 \textcolor{stringliteral}{        Usage:}
01430 \textcolor{stringliteral}{            O3.printTransition(4959)}
01431 \textcolor{stringliteral}{            }
01432 \textcolor{stringliteral}{        Parameters:}
01433 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
01434 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
01435 \textcolor{stringliteral}{                }
01436 \textcolor{stringliteral}{        """}
01437         closestTransition = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{\_Transition}(wave)
01438         relativeError = closestTransition[3] / closestTransition[2] - 1
01439         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Input wave: \{0:.1F\}'}.format(closestTransition[3])
01440         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Closest wave found: \{0:.1F\}'}.format(closestTransition[2])
01441         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Relative error: \{0:.0E\} '}.format(relativeError)
01442         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Transition: \{0[0]\} -> \{0[1]\}'}.format(closestTransition)
01443         \textcolor{keywordflow}{return}
01444     
\hypertarget{pynebcore_8py_source_l01445}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_af603fa94afcc5893bc55a72cafc3fdd5}{01445}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_af603fa94afcc5893bc55a72cafc3fdd5}{printSources}(self):
01446         
01447         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9d6390b03ff490938536167fe65d8a87}{getSources}():
01448             \textcolor{keywordflow}{print} source    
01449     
\hypertarget{pynebcore_8py_source_l01450}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9d6390b03ff490938536167fe65d8a87}{01450}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9d6390b03ff490938536167fe65d8a87}{getSources}(self):
01451         sources = []
01452         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData}:
01453             sources.extend(self.AtomData.getSources())
01454             sources.extend(self.CollData.getSources())
01455         \textcolor{keywordflow}{else}:
01456             sources.extend(self.AtomData.getSources())
01457         \textcolor{keywordflow}{return} sources
01458     
\hypertarget{pynebcore_8py_source_l01459}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{01459}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(self, level):
01460         \textcolor{stringliteral}{"""}
01461 \textcolor{stringliteral}{        Test whether selected level is legal}
01462 \textcolor{stringliteral}{}
01463 \textcolor{stringliteral}{        Parameters:}
01464 \textcolor{stringliteral}{            - level        selected atom level}
01465 \textcolor{stringliteral}{}
01466 \textcolor{stringliteral}{        """}       
01467         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}:
01468             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}),
01469                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01470 
\hypertarget{pynebcore_8py_source_l01471}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{01471}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(self, lev\_i= -1, lev\_j= -1, wave= -1):
01472         \textcolor{stringliteral}{"""}
01473 \textcolor{stringliteral}{        Return the transition probability data. }
01474 \textcolor{stringliteral}{        If no arguments are given, the whole array of A is returned.}
01475 \textcolor{stringliteral}{        A specific A value can be obtained by giving either the upper and lower levels or }
01476 \textcolor{stringliteral}{            the wavelength of the transition (keyword wave).}
01477 \textcolor{stringliteral}{            }
01478 \textcolor{stringliteral}{        Usage:}
01479 \textcolor{stringliteral}{            A\_O3 = O3.getA()          # The whole A array is stored in A\_O3}
01480 \textcolor{stringliteral}{            O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed}
01481 \textcolor{stringliteral}{            O3.getA(2, 4)      # Returns 0}
01482 \textcolor{stringliteral}{            O3.getA(wave=4959)      }
01483 \textcolor{stringliteral}{}
01484 \textcolor{stringliteral}{        Parameters:}
01485 \textcolor{stringliteral}{            - lev\_i  upper level of transition (default= -1, returns complete array)}
01486 \textcolor{stringliteral}{            - lev\_j  lower level of transition (default= -1, returns complete array)}
01487 \textcolor{stringliteral}{            - wave   wavelength of transition. Takes precedence on lev\_i and lev\_j. Ignored if not set.}
01488 \textcolor{stringliteral}{            }
01489 \textcolor{stringliteral}{        """}
01490         \textcolor{keywordflow}{if} wave != -1:
01491             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
01492         
01493         \textcolor{keywordflow}{return} self.AtomData.getA(lev\_i= lev\_i, lev\_j= lev\_j)
01494         
01495     @profile
\hypertarget{pynebcore_8py_source_l01496}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{01496}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(self, tem, den, product=True, NLevels=None):
01497         \textcolor{stringliteral}{"""}
01498 \textcolor{stringliteral}{        Return array of populations at given temperature and density.}
01499 \textcolor{stringliteral}{        The method returns a 1-, 2- or 3-D array containing the population of each level }
01500 \textcolor{stringliteral}{            for all temperatures and densities specified in the input vectors tem and den }
01501 \textcolor{stringliteral}{            (which can be n-element or 1-element vectors).}
01502 \textcolor{stringliteral}{        If either quantity (tem or den) is a 1-element vector -that is, a single value-, }
01503 \textcolor{stringliteral}{            the resulting population array is collapsed along that dimension; }
01504 \textcolor{stringliteral}{            as a result, the result population array can be a 1-D, 2-D or 3-D array }
01505 \textcolor{stringliteral}{            (the three cases corresponding to situations in which both tem and den are single values; }
01506 \textcolor{stringliteral}{            one of them is a single value and the other an n-element vector; or both are multielement }
01507 \textcolor{stringliteral}{            vectors, respectively). In the general case, the level index is the first }
01508 \textcolor{stringliteral}{            [WARNING! It is not in physical unit, i.e. ground level = 0; to be normalized], }
01509 \textcolor{stringliteral}{            followed by the temperature index (if it exists) and the density index. }
01510 \textcolor{stringliteral}{}
01511 \textcolor{stringliteral}{        Usage:}
01512 \textcolor{stringliteral}{            O3.getPopulations(1e4, 1e2)}
01513 \textcolor{stringliteral}{            tem=np.array([10000., 12000., 15000., 20000]) # An array of four temperatures}
01514 \textcolor{stringliteral}{            den=np.array([600., 800., 1000])      # An array of three densities}
01515 \textcolor{stringliteral}{            O3.getPopulations(tem, den)           # is a (6, 4, 3) array}
01516 \textcolor{stringliteral}{            O3.getPopulations(tem, den)[0,2,1]    # Returns the population of level 1 for T = 15000 }
01517 \textcolor{stringliteral}{                                                    and Ne = 800}
01518 \textcolor{stringliteral}{            tem = 20000                           # tem is no longer an array}
01519 \textcolor{stringliteral}{            O3.getPopulations(tem, den)[0,2,1]  # Crashes: one index too much}
01520 \textcolor{stringliteral}{            O3.getPopulations(tem, den)[0,1]    # Returns the population of level 1 for T = 20000 }
01521 \textcolor{stringliteral}{                                                    and Ne = 800 [see warning]}
01522 \textcolor{stringliteral}{            tem=np.array([10000., 15000., 20000]) # An array of three temperatures}
01523 \textcolor{stringliteral}{            O3.getPopulations(tem, den, product = False)# is a (6, 3) array, tem and den beeing }
01524 \textcolor{stringliteral}{                                                            taken 2 by 2.}
01525 \textcolor{stringliteral}{        }
01526 \textcolor{stringliteral}{        Parameters:}
01527 \textcolor{stringliteral}{            - tem       electronic temperature in K}
01528 \textcolor{stringliteral}{            - den       electronic density in cm^-3}
01529 \textcolor{stringliteral}{            - product   operate on all possible combinations of temperature and density }
01530 \textcolor{stringliteral}{                      (product = True, default case) or on those resulting from combining }
01531 \textcolor{stringliteral}{                      the i-th value of tem with the i-th value of den (product = False).}
01532 \textcolor{stringliteral}{                      If product = False, then tem and den must be the same size.}
01533 \textcolor{stringliteral}{}
01534 \textcolor{stringliteral}{        """}
01535         tem = np.asarray(tem)
01536         den = np.asarray(den)
01537         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01538             n\_level = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}
01539         \textcolor{keywordflow}{else}:
01540             n\_level = NLevels
01541         \textcolor{keywordflow}{if} product:
01542             n\_tem = tem.size
01543             n\_den = den.size
01544             tem\_ones = np.ones(n\_tem)
01545             den\_ones = np.ones(n\_den)
01546             \textcolor{comment}{# q is vector-indexed (q(0, 1) = rate between levels 1 and 2)}
01547             q = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{getCollRates}(tem, n\_level)
01548             Atem = np.outer(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[:n\_level, :n\_level], tem\_ones).reshape(n\_level, n\_level, n\_tem)
01549             pop\_result = np.zeros((n\_level, n\_tem, n\_den))
01550             sum\_q\_up = np.zeros((n\_level, n\_tem))
01551             sum\_q\_down = np.zeros((n\_level, n\_tem))
01552             sum\_A = np.squeeze(Atem.sum(axis=1))
\hypertarget{pynebcore_8py_source_l01553}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{01553}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity} = sum\_A / q.sum(axis=1)
01554             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, n\_level):
01555                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i + 1, n\_level):
01556                     sum\_q\_up[i] = sum\_q\_up[i] + q[i, j]
01557                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(0, i):
01558                     sum\_q\_down[i] = sum\_q\_down[i] + q[i, j]
01559             coeff\_matrix = ((np.outer(np.swapaxes(q, 0, 1), den) + 
01560                              np.outer(np.swapaxes(Atem, 0, 1), den\_ones)).reshape(n\_level, n\_level, n\_tem, 
      n\_den))
01561             coeff\_matrix[0, :] = 1.
01562             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, n\_level):
01563                 coeff\_matrix[i, i] = (-(np.outer((sum\_q\_up[i] + sum\_q\_down[i]), den) + 
01564                                         np.outer(sum\_A[i], den\_ones)).reshape(1, 1, n\_tem, n\_den))
01565             vect = np.zeros(n\_level)
01566             vect[0] = 1.
01567     
01568             \textcolor{keywordflow}{for} i\_tem \textcolor{keywordflow}{in} range(n\_tem):
01569                 \textcolor{keywordflow}{for} i\_den \textcolor{keywordflow}{in} range(n\_den):
01570                     \textcolor{keywordflow}{try}:
01571                         pop\_result[:, i\_tem, i\_den] = np.linalg.solve(np.squeeze(coeff\_matrix[:, :, i\_tem, 
      i\_den]), vect)
01572                     \textcolor{keywordflow}{except} np.linalg.LinAlgError:
01573                         pop\_result[:, i\_tem, i\_den] = np.nan
01574                     \textcolor{keywordflow}{except}:
01575                         self.log\_.error(\textcolor{stringliteral}{'Error solving population matrix'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01576             pop = np.squeeze(pop\_result)
01577         \textcolor{keywordflow}{else}:
01578             \textcolor{keywordflow}{if} tem.shape != den.shape:
01579                 self.log\_.error(\textcolor{stringliteral}{'tem and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01580                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01581             res\_shape1 = [n\_level]
01582             res\_shape\_rav1 = [n\_level, tem.size]
01583             res\_shape\_rav2 = [n\_level, n\_level, tem.size]
01584             \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01585                 res\_shape1.append(sh)
01586             tem\_rav = tem.ravel()
01587             den\_rav = den.ravel()
01588             q = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{getCollRates}(tem\_rav, n\_level)
01589             A = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[:n\_level, :n\_level]
01590             pop\_result = np.zeros(res\_shape\_rav1)
01591             coeff\_matrix = np.ones(res\_shape\_rav2)
01592             sum\_q\_up = np.zeros(res\_shape\_rav1)
01593             sum\_q\_down = np.zeros(res\_shape\_rav1)
01594             sum\_A = A.sum(axis=1)
01595             n\_tem = tem\_rav.size
01596             \textcolor{comment}{# Following line changed 29/11/2012. It made the code crash when atom\_nlevels diff coll\_nlevels}
01597             \textcolor{comment}{#Atem = np.outer(self.\_A, np.ones(n\_tem)).reshape(n\_level, n\_level, n\_tem)}
01598             Atem = np.outer(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[:n\_level, :n\_level], np.ones(n\_tem)).reshape(n\_level, n\_level, n\_tem)
01599             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity} = Atem.sum(axis=1) / q.sum(axis=1)
01600 
01601             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, n\_level):
01602                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i + 1, n\_level):
01603                     sum\_q\_up[i] = sum\_q\_up[i] + q[i, j]
01604                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(0, i):
01605                     sum\_q\_down[i] = sum\_q\_down[i] + q[i, j]
01606             \textcolor{keywordflow}{for} row \textcolor{keywordflow}{in} range(1, n\_level):
01607                 \textcolor{comment}{# upper right half            }
01608                 \textcolor{keywordflow}{for} col \textcolor{keywordflow}{in} range(row + 1, n\_level):
01609                     coeff\_matrix[row, col] = den\_rav * q[col, row] + A[col, row]
01610                 \textcolor{comment}{# lower left half}
01611                 \textcolor{keywordflow}{for} col \textcolor{keywordflow}{in} range(0, row):
01612                     coeff\_matrix[row, col] = den\_rav * q[col, row]
01613                 \textcolor{comment}{# diagonal}
01614                 coeff\_matrix[row, row] = -(den\_rav * (sum\_q\_up[row] + sum\_q\_down[row]) + sum\_A[row])
01615 
01616             vect = np.zeros(n\_level)
01617             vect[0] = 1.
01618             
01619             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(tem.size):
01620                 \textcolor{keywordflow}{try}:
01621                     pop\_result[:, i] = np.linalg.solve(np.squeeze(coeff\_matrix[:, :, i]), vect)
01622                 \textcolor{keywordflow}{except} np.linalg.LinAlgError:
01623                     pop\_result[:, i] = np.nan
01624                 \textcolor{keywordflow}{except}:
01625                     self.log\_.error(\textcolor{stringliteral}{'Error solving population matrix'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01626             
01627             pop = np.squeeze(pop\_result.reshape(res\_shape1))
01628             
01629         \textcolor{keywordflow}{return} pop
01630 
01631     
\hypertarget{pynebcore_8py_source_l01632}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6db2a3425e5a35f0bd04f05bcb25ee1}{01632}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6db2a3425e5a35f0bd04f05bcb25ee1}{getLowDensRatio}(self, lev\_i1=-1, lev\_i2=-1, wave1=-1, wave2=-1, to\_eval=None):
01633         
01634         \textcolor{stringliteral}{"""}
01635 \textcolor{stringliteral}{        Return the value of a diagostic ratio at the low density limit}
01636 \textcolor{stringliteral}{        S2.getLowDensRatio(lev\_i1 = 3, lev\_i2 = 2)}
01637 \textcolor{stringliteral}{        S2.getLowDensRatio(wave1 = 6716, wave2 = 6731)}
01638 \textcolor{stringliteral}{        S2.getLowDensRatio(to\_eval = 'L(6716)/L(6731)')}
01639 \textcolor{stringliteral}{        """}
01640         
01641         \textcolor{keywordflow}{if} wave1 != -1:
01642             lev\_i1, lev\_j1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave1)
01643         \textcolor{keywordflow}{if} wave2 != -1:
01644             lev\_i2, lev\_j2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave2)
01645             
01646         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
01647             L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0])
01648             \textcolor{keywordflow}{return} eval(to\_eval)
01649             
01650         \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i1) / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i2)
01651         
01652         
\hypertarget{pynebcore_8py_source_l01653}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ac2e1509a2acc642c00696f3787e95f95}{01653}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ac2e1509a2acc642c00696f3787e95f95}{getHighDensRatio}(self, lev\_i1=-1, lev\_i2=-1, lev\_j1=-1, lev\_j2=-1, wave1=-1, 
      wave2=-1, to\_eval=None):
01654         
01655         \textcolor{stringliteral}{"""}
01656 \textcolor{stringliteral}{        Return the value of a diagostic ratio at the high density limit}
01657 \textcolor{stringliteral}{        S2.getHighDensRatio(lev\_i1 = 3, lev\_i2 = 2)}
01658 \textcolor{stringliteral}{        S2.getHighDensRatio(wave1 = 6716, wave2 = 6731)}
01659 \textcolor{stringliteral}{        S2.getHighDensRatio(to\_eval = 'L(6716)/L(6731)')}
01660 \textcolor{stringliteral}{        """}
01661         
01662         \textcolor{keywordflow}{if} wave1 != -1:
01663             lev\_i1, lev\_j1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave1)
01664         \textcolor{keywordflow}{if} wave2 != -1:
01665             lev\_i2, lev\_j2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave2)
01666             
01667         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
01668             L = \textcolor{keyword}{lambda} wave: (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0]) * 
01669                               self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0], self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1]))
01670             \textcolor{keywordflow}{return} eval(to\_eval)
01671             
01672         \textcolor{keywordflow}{return} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i1) / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i2) *
01673                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(lev\_i1, lev\_j1) / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(lev\_i2, lev\_j2))
01674            
01675     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a30ea60641df87c5eaf8af392d31da920}{getDensityRange}(self, lev\_i1=-1, lev\_i2=-1, lev\_j1=-1, lev\_j2=-1, wave1=-1, 
      wave2=-1, 
\hypertarget{pynebcore_8py_source_l01676}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a30ea60641df87c5eaf8af392d31da920}{01676}                         to\_eval=\textcolor{keywordtype}{None}, tol=0.1, tem=1e4):
01677         \textcolor{stringliteral}{"""}
01678 \textcolor{stringliteral}{        Return the range of density where a given line ratio is between 10% and 90% of the low and high
       density limits}
01679 \textcolor{stringliteral}{        """}
01680         LowLim = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6db2a3425e5a35f0bd04f05bcb25ee1}{getLowDensRatio}(lev\_i1, lev\_i2, wave1, wave2, to\_eval)
01681         HighLim = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ac2e1509a2acc642c00696f3787e95f95}{getHighDensRatio}(lev\_i1, lev\_i2, lev\_j1, lev\_j2, wave1, wave2, 
      to\_eval)
01682         
01683         delta = abs(LowLim - HighLim)
01684         minRatio = min((LowLim, HighLim)) + tol * delta
01685         maxRatio = max((LowLim, HighLim)) - tol * delta
01686         dens1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(minRatio, tem=tem, lev\_i1= lev\_i1, lev\_j1= lev\_j1, lev\_i2= lev\_i2, 
      lev\_j2= lev\_j2,
01687                   wave1= wave1, wave2= wave2, to\_eval=to\_eval)
01688         dens2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(maxRatio, tem=tem, lev\_i1= lev\_i1, lev\_j1= lev\_j1, lev\_i2= lev\_i2, 
      lev\_j2= lev\_j2,
01689                   wave1= wave1, wave2= wave2, to\_eval=to\_eval)
01690         return(np.sort((dens1, dens2)))
01691                
01692     @profile
\hypertarget{pynebcore_8py_source_l01693}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aae95b1cb36defadad24cf94459203eb3}{01693}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aae95b1cb36defadad24cf94459203eb3}{getCritDensity}(self, tem, level= -1):
01694         \textcolor{stringliteral}{"""}
01695 \textcolor{stringliteral}{        Return the critical density of selected level at given temperature. }
01696 \textcolor{stringliteral}{        If no transition is selected, return complete array.}
01697 \textcolor{stringliteral}{        }
01698 \textcolor{stringliteral}{        Usage:}
01699 \textcolor{stringliteral}{            O3.getCritDensity(12000)}
01700 \textcolor{stringliteral}{            O3.getCritDensity(12000, 4)}
01701 \textcolor{stringliteral}{        }
01702 \textcolor{stringliteral}{        Parameters:}
01703 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
01704 \textcolor{stringliteral}{            - level  selected atomic level (default= -1)}
01705 \textcolor{stringliteral}{}
01706 \textcolor{stringliteral}{        """}
01707         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(level)
01708         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den=100.) \textcolor{comment}{# Any density would do}
01709         \textcolor{keywordflow}{if} level != -1:
01710             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity}[level - 1]
01711         \textcolor{keywordflow}{else}:
01712             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity}
01713         
01714         
01715     @profile
\hypertarget{pynebcore_8py_source_l01716}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{01716}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(self, tem, den, lev\_i= -1, lev\_j= -1, wave= -1, product=True):
01717         \textcolor{stringliteral}{"""}
01718 \textcolor{stringliteral}{        Return the line emissivity of selected transition or complete array of emissivities}
01719 \textcolor{stringliteral}{        The transition is selected by the argument wave (if given); }
01720 \textcolor{stringliteral}{        if wave is not supplied, it is selected by the upper and lower levels (lev\_i and lev\_j); }
01721 \textcolor{stringliteral}{        if neither is given, the whole array is computed}
01722 \textcolor{stringliteral}{        }
01723 \textcolor{stringliteral}{        Usage:      }
01724 \textcolor{stringliteral}{            O3.getEmissivity(12000, 100, 4, 2)         # (4, 2) transition}
01725 \textcolor{stringliteral}{            O3.getEmissivity(10000, 10000, wave=5007)  # (4, 2) transition}
01726 \textcolor{stringliteral}{            O3.getEmissivity(12000, 100)               # all transitions}
01727 \textcolor{stringliteral}{            O3.getEmissivity([10000, 12000], [100, 500], 4, 2)}
01728 \textcolor{stringliteral}{            O3.getEmissivity([10000, 12000], [100, 500])}
01729 \textcolor{stringliteral}{            }
01730 \textcolor{stringliteral}{        Parameters:}
01731 \textcolor{stringliteral}{            - tem      electronic temperature in K. May be an array.}
01732 \textcolor{stringliteral}{            - den      electronic density in cm^-3. May be an array.}
01733 \textcolor{stringliteral}{            - lev\_i    upper level (default= -1)}
01734 \textcolor{stringliteral}{            - lev\_j    lower level (default= -1)}
01735 \textcolor{stringliteral}{            - wave     wavelength of transition. Takes precedence on lev\_i and lev\_j if set, }
01736 \textcolor{stringliteral}{                        ignored otherwise. It can also be a blend label.}
01737 \textcolor{stringliteral}{            - product  Boolean. If True (default), all the combination of (tem, den) are used. }
01738 \textcolor{stringliteral}{                         If False, tem and den must have the same size and are joined.}
01739 \textcolor{stringliteral}{}
01740 \textcolor{stringliteral}{        """}
01741         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave) \textcolor{keywordflow}{in} BLEND\_LIST:
01742             L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, wave=wave, product=product)
01743             I = \textcolor{keyword}{lambda} lev\_i, lev\_j: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, lev\_i=lev\_i, lev\_j=lev\_j, 
      product=product)
01744             \textcolor{keywordflow}{try}:
01745                 res = eval(BLEND\_LIST[\textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave)])
01746             \textcolor{keywordflow}{except}:
01747                 pn.log\_.warn(\textcolor{stringliteral}{'\{0\} is not understood'}.format(wave), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'getEmissivity'})
01748                 res = \textcolor{keywordtype}{None}
01749             \textcolor{keywordflow}{return} res
01750         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_i)
01751         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_j)
01752         tem = np.asarray(tem)
01753         den = np.asarray(den)
01754         \textcolor{keywordflow}{if} wave != -1:
01755             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
01756         NLevels = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}
01757         \textcolor{keywordflow}{if} lev\_i > NLevels \textcolor{keywordflow}{or} lev\_j > NLevels:
01758             pn.log\_.error(\textcolor{stringliteral}{'The number of levels \{\} does not allow getting this emissivity. Consider
       changing the atomic data'}.format(NLevels),
01759                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling}) 
01760         \textcolor{keywordflow}{if} product:
01761             n\_tem = tem.size
01762             n\_den = den.size
01763             tem\_ones = np.ones(n\_tem)
01764             populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den, product=\textcolor{keyword}{True})
01765             \textcolor{keywordflow}{if} ((lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1)):
01766                 resultArray = np.zeros((NLevels, NLevels, n\_tem, n\_den))
01767                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(NLevels):
01768                     lev\_i = i + 1
01769                     j = i - 1 
01770                     \textcolor{keywordflow}{while} (j >= 0):
01771                         lev\_j = j + 1
01772                         deltaE = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]) * pn.CST.HPLANCK * 
      pn.CST.CLIGHT * 1.e8 
01773                         resultArray[i][j] = (deltaE * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[i, j] * populations[i].reshape(1, 1, n\_tem,
       n\_den) / 
01774                                              np.outer(tem\_ones, den).reshape(1, 1, n\_tem, n\_den))
01775                         j -= 1
01776                 \textcolor{keywordflow}{return} np.squeeze(resultArray)
01777             \textcolor{keywordflow}{else}:
01778                 \textcolor{keywordflow}{if} (lev\_i <= lev\_j):
01779                     \textcolor{keywordflow}{return} 0.
01780                 \textcolor{keywordflow}{else}:
01781                     i = lev\_i - 1
01782                     j = lev\_j - 1
01783                     deltaE = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]) * pn.CST.HPLANCK * 
      pn.CST.CLIGHT * 1.e8 
01784                     \textcolor{keywordflow}{return} np.squeeze((populations[i] * deltaE * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[i, j]).reshape(1, 1, n\_tem, 
      n\_den) / 
01785                                       np.outer(tem\_ones, den).reshape(1, 1, n\_tem, n\_den))
01786         \textcolor{keywordflow}{else}:
01787             \textcolor{keywordflow}{if} tem.shape != den.shape:
01788                 self.log\_.error(\textcolor{stringliteral}{'tem and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01789                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01790             populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den, product=\textcolor{keyword}{False})
01791             \textcolor{keywordflow}{if} (lev\_i <= lev\_j):
01792                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01793             \textcolor{keywordflow}{else}:
01794                 i = lev\_i - 1
01795                 j = lev\_j - 1
01796                 deltaE = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]) * pn.CST.HPLANCK * pn.CST.CLIGHT
       * 1.e8 
01797                 \textcolor{keywordflow}{return} populations[i] * deltaE * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[i, j] / den
01798 
01799         
01800     @profile
01801     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, 
      lev\_j2= -1,
01802                   wave1= -1, wave2= -1, maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x=
       -1,
\hypertarget{pynebcore_8py_source_l01803}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{01803}                   to\_eval=\textcolor{keywordtype}{None}, nCut=30, maxIter=20):
01804 
01805         \textcolor{comment}{##}
01806         \textcolor{comment}{# @todo manage blends}
01807         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_i1)
01808         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_j1)
01809         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_i2)
01810         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_j2)
01811         tem = np.asarray(tem)
01812         den = np.asarray(den)
01813         \textcolor{keywordflow}{if} np.asarray(int\_ratio).size != 1:
01814             shape = np.asarray(int\_ratio).shape
01815             size = np.asarray(int\_ratio).size
01816             result = np.zeros(size) 
01817             \textcolor{keywordflow}{if} np.asarray(tem).size != 1:
01818                 \textcolor{keywordflow}{if} np.asarray(tem).shape != shape:
01819                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01820                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01821                 tem\_ravel = np.asarray(tem).ravel()
01822                 den\_ravel = np.zeros(size) + den
01823             \textcolor{keywordflow}{elif} np.asarray(den).size != 1:
01824                 \textcolor{keywordflow}{if} np.asarray(den).shape != shape:
01825                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01826                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01827                 den\_ravel = np.asarray(den).ravel()
01828                 tem\_ravel = np.zeros(size) + tem
01829             \textcolor{keywordflow}{else}:
01830                 den\_ravel = np.zeros(size) + den
01831                 tem\_ravel = np.zeros(size) + tem
01832             int\_ratio\_ravel = np.asarray(int\_ratio).ravel()
01833             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(size):
01834                 result[i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(int\_ratio\_ravel[i], tem=tem\_ravel[i], den=
      den\_ravel[i],
01835                                            lev\_i1=lev\_i1, lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
01836                                            wave1=wave1, wave2=wave2, maxError=maxError, method=method,
01837                                            log=log, start\_x=start\_x, end\_x=end\_x,
01838                                            to\_eval=to\_eval)
01839             \textcolor{keywordflow}{return} result.reshape(shape)
01840             
01841         \textcolor{keywordflow}{if} wave1 != -1:
01842             lev\_i1, lev\_j1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave1)
01843         \textcolor{keywordflow}{if} wave2 != -1:
01844             lev\_i2, lev\_j2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave2)
01845 
01846         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01847             to\_eval = \textcolor{stringliteral}{'I('} + str(lev\_i1) + \textcolor{stringliteral}{','} + str(lev\_j1) + \textcolor{stringliteral}{')/I('} + str(lev\_i2) + \textcolor{stringliteral}{','} + str(lev\_j2) + \textcolor{stringliteral}{'
      )'}
01848 
01849 
01850         \textcolor{keywordflow}{if} tem == -1:
01851             \textcolor{keywordflow}{if} start\_x == -1:
01852                 start\_x = min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{getTemArray}(keep\_unit=\textcolor{keyword}{False}))
01853                 \textcolor{keywordflow}{if} log:
01854                     start\_x = np.log10(start\_x)
01855             \textcolor{keywordflow}{if} end\_x == -1:
01856                 end\_x = max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{getTemArray}(keep\_unit=\textcolor{keyword}{False}))
01857                 \textcolor{keywordflow}{if} log:
01858                     end\_x = np.log10(end\_x)
01859             
01860             @profile
01861             \textcolor{keyword}{def }\_func(x):
01862                 \textcolor{stringliteral}{"""}
01863 \textcolor{stringliteral}{                The function for which a root is looked for.}
01864 \textcolor{stringliteral}{                It must return an array if x is an array, if an nsect-like method is used.}
01865 \textcolor{stringliteral}{                The returned value is already normalized to the intensity ratio.}
01866 \textcolor{stringliteral}{}
01867 \textcolor{stringliteral}{                """}
01868                 \textcolor{keywordflow}{if} log:
01869                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(10.**x, den)
01870                 \textcolor{keywordflow}{else}:
01871                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(x, den)
01872                 I = \textcolor{keyword}{lambda} lev\_i, lev\_j: (populations[lev\_i - 1] * 
01873                                           (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[lev\_i - 1, lev\_j - 1] * 
01874                                            (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_i - 1] - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_j - 1])))
01875                 L = \textcolor{keyword}{lambda} wave: (populations[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] * 
01876                                   (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1] * 
01877                                    (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] - 
01878                                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1])))
01879                 result = eval(to\_eval)
01880                 \textcolor{keywordflow}{return} \hyperlink{namespacepyneb_1_1utils_1_1misc_afa4163f24be7b1472200c24824c72ae1}{quiet\_divide}((result - int\_ratio), int\_ratio)
01881             
01882         \textcolor{keywordflow}{elif} den == -1:
01883             \textcolor{keywordflow}{if} start\_x == -1:
01884                 start\_x = 1.e0
01885                 \textcolor{keywordflow}{if} log: start\_x = np.log10(start\_x)
01886             \textcolor{keywordflow}{if} end\_x == -1:
01887                 end\_x = 1e8
01888                 \textcolor{keywordflow}{if} log: end\_x = np.log10(end\_x)
01889 
01890             @profile
01891             \textcolor{keyword}{def }\_func(x):
01892                 \textcolor{stringliteral}{"""}
01893 \textcolor{stringliteral}{                The function for which a root is looked for.}
01894 \textcolor{stringliteral}{                It must return an array if x is an array, if an nsect-like method is used.}
01895 \textcolor{stringliteral}{                The returned value is already normalized to the intensity ratio.}
01896 \textcolor{stringliteral}{                }
01897 \textcolor{stringliteral}{                """}
01898                 \textcolor{keywordflow}{if} log:
01899                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, pow(10., x))
01900                 \textcolor{keywordflow}{else}:
01901                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, x)
01902                 I = \textcolor{keyword}{lambda} lev\_i, lev\_j: (populations[lev\_i - 1] * 
01903                                           (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[lev\_i - 1, lev\_j - 1] * 
01904                                            (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_i - 1] - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_j - 1])))
01905                 L = \textcolor{keyword}{lambda} wave: (populations[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] * 
01906                                   (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1] * 
01907                                    (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] - 
01908                                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1])))
01909                 result = eval(to\_eval)
01910                 \textcolor{keywordflow}{return} \hyperlink{namespacepyneb_1_1utils_1_1misc_afa4163f24be7b1472200c24824c72ae1}{quiet\_divide}((result - int\_ratio), int\_ratio)
01911         \textcolor{comment}{# improve exception handling (we must include cases where both tem, den = -1) }
01912         \textcolor{keywordflow}{else}:
01913             self.log\_.error(\textcolor{stringliteral}{'ERROR in getTemDen: temperature and density cannot be simultaneously given'},
01914                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01915 
01916         \textcolor{keywordflow}{if} method == \textcolor{stringliteral}{'nsect\_recur'}:
01917             \textcolor{stringliteral}{"""}
01918 \textcolor{stringliteral}{            Recursive n-section method for finding a root}
01919 \textcolor{stringliteral}{            It works by looking for the minumum of abs(f) using the fact that f(array) }
01920 \textcolor{stringliteral}{                returns an array}
01921 \textcolor{stringliteral}{}
01922 \textcolor{stringliteral}{            """}
01923             @profile
01924             \textcolor{keyword}{def }nsect\_recur(f, x1, x2, nCut, maxIter, \_iter=0):
01925                 \textcolor{keywordflow}{if} \_iter > maxIter:
01926                     \textcolor{keywordflow}{return} np.nan
01927                 x = np.linspace(x1, x2, nCut)
01928                 y = abs(\hyperlink{namespacepyneb_1_1utils_1_1_fortran_format_af94352584eced016c14d524330879115}{f}(x))
01929                 x\_min = np.argmin(y)
01930                 \textcolor{keywordflow}{if} y[x\_min] < maxError:
01931                     \textcolor{keywordflow}{return} x[x\_min]
01932                 \textcolor{keywordflow}{else}:
01933                     \textcolor{keywordflow}{if} x\_min == 0:
01934                         x\_min = 1
01935                     \textcolor{keywordflow}{if} x\_min == nCut - 1:
01936                         x\_min = nCut - 2
01937                     x1 = x[x\_min - 1]
01938                     x2 = x[x\_min + 1]
01939                     \_iter = \_iter + 1
01940                     \textcolor{keywordflow}{return} nsect\_recur(f, x1, x2, nCut=nCut, maxIter=maxIter, \_iter=\_iter)
01941 
01942             result = nsect\_recur(\_func, start\_x, end\_x, nCut, maxIter)
01943 
01944         \textcolor{keywordflow}{elif} method == \textcolor{stringliteral}{'nsect\_iter'}:
01945             \textcolor{stringliteral}{"""}
01946 \textcolor{stringliteral}{            Iterative n-section method for finding a root (analogous to the bisection method)}
01947 \textcolor{stringliteral}{            It works by looking for the minimum of abs(f) using the fact that f(array) returns an array}
01948 \textcolor{stringliteral}{}
01949 \textcolor{stringliteral}{            """}
01950             
01951             @profile
01952             \textcolor{keyword}{def }nsect\_iter(f, x1, x2, nCut, maxIter):
01953                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(maxIter):
01954                     x = np.linspace(x1, x2, nCut)
01955                     y = abs(\hyperlink{namespacepyneb_1_1utils_1_1_fortran_format_af94352584eced016c14d524330879115}{f}(x))
01956                     x\_min = np.argmin(y)
01957                     \textcolor{keywordflow}{if} y[x\_min] < maxError:
01958                         \textcolor{keywordflow}{return} x[x\_min]
01959                     \textcolor{keywordflow}{else}:
01960                         \textcolor{keywordflow}{if} x\_min == 0: x\_min = 1
01961                         \textcolor{keywordflow}{if} x\_min == nCut - 1: x\_min = nCut - 2
01962                         x1 = x[x\_min - 1]
01963                         x2 = x[x\_min + 1]
01964                 \textcolor{keywordflow}{return} np.nan
01965 
01966             result = nsect\_iter(\_func, start\_x, end\_x, nCut, maxIter)
01967             
01968         \textcolor{keywordflow}{else}:
01969             self.log\_.error(\textcolor{stringliteral}{'ERROR in getTemDen: no valid method given'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01970             result = \textcolor{keywordtype}{None}
01971 
01972         \textcolor{keywordflow}{if} (log \textcolor{keywordflow}{is} \textcolor{keyword}{True}) \textcolor{keywordflow}{and} (result \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
01973             \textcolor{keywordflow}{return} pow(10., result)
01974         \textcolor{keywordflow}{else}:
01975             \textcolor{keywordflow}{return} result
01976 
01977 
01978     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3a7c4f43d58a5988d04cbe23ed9593ba}{\_getTemDen\_MP}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, 
      lev\_j2= -1,
01979                   wave1= -1, wave2= -1, maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x=
       -1,
\hypertarget{pynebcore_8py_source_l01980}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3a7c4f43d58a5988d04cbe23ed9593ba}{01980}                   to\_eval=\textcolor{keywordtype}{None}, nCut=30, maxIter=20):
01981         
01982         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'mp'}]:
01983             pn.log\_.error(\textcolor{stringliteral}{'\_getTemDen\_MP cannot be used in absence of multiprocessing package'},
01984                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01985             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01986         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_i1)
01987         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_j1)
01988         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_i2)
01989         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_j2)
01990         tem = np.asarray(tem)
01991         den = np.asarray(den)
01992         \textcolor{keywordflow}{if} np.asarray(int\_ratio).size != 1:
01993             shape = np.asarray(int\_ratio).shape
01994             size = np.asarray(int\_ratio).size
01995             result = np.zeros(size) 
01996             \textcolor{keywordflow}{if} np.asarray(tem).size != 1:
01997                 \textcolor{keywordflow}{if} np.asarray(tem).shape != shape:
01998                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01999                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02000                 tem\_ravel = np.asarray(tem).ravel()
02001                 den\_ravel = np.zeros(size) + den
02002             \textcolor{keywordflow}{elif} np.asarray(den).size != 1:
02003                 \textcolor{keywordflow}{if} np.asarray(den).shape != shape:
02004                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02005                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02006                 den\_ravel = np.asarray(den).ravel()
02007                 tem\_ravel = np.zeros(size) + tem
02008             \textcolor{keywordflow}{else}:
02009                 den\_ravel = np.zeros(size) + den
02010                 tem\_ravel = np.zeros(size) + tem
02011             int\_ratio\_ravel = np.asarray(int\_ratio).ravel()
02012         \textcolor{keywordflow}{else}:
02013             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(int\_ratio=int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, 
      lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
02014                   wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, start\_x=start\_x,
02015                   end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02016         
02017         Nprocs = pn.config.Nprocs
02018         pn.log\_.message(\textcolor{stringliteral}{'number of CPUs = \{0\}'}.format(Nprocs), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02019         gTDWorkerQ = Queue()
02020         gTDDoneQ = Queue()
02021         pn.log\_.message(\textcolor{stringliteral}{'Queues initialized'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02022         jobid = 0
02023         \textcolor{keywordflow}{for} int\_rat1, tem1, den1 \textcolor{keywordflow}{in} zip(int\_ratio\_ravel, tem\_ravel, den\_ravel):
02024             gTDWorkerQ.put((jobid, int\_rat1, tem1, den1))
02025             jobid += 1
02026         pn.log\_.message(\textcolor{stringliteral}{'put done'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02027         \textcolor{comment}{#gTDWorkerQSize = gTDWorkerQ.qsize() # this crash on OSX}
02028         gTDWorkerQSize = size
02029         pn.log\_.message(\textcolor{stringliteral}{'Queue size \{0\}'}.format(gTDWorkerQSize), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02030 
02031         
02032         gTDProcesses = []
02033         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(Nprocs):
02034             p = Process(target=getTemDen\_helper, args=(gTDWorkerQ, gTDDoneQ, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, lev\_i1, lev\_j1, lev\_i2, lev\_j2,
02035                   wave1, wave2, maxError, method, log, start\_x, end\_x, to\_eval, nCut, maxIter))
02036             p.start()
02037             gTDProcesses.append(p)
02038         pn.log\_.message(\textcolor{stringliteral}{'processes started'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02039 
02040         \textcolor{comment}{#}
02041         result = []
02042         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(gTDWorkerQSize):
02043             result.append(gTDDoneQ.get())
02044         pn.log\_.message(\textcolor{stringliteral}{'Result obtained'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02045 
02046         \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} gTDProcesses:
02047             p.join(timeout=0.1)
02048         pn.log\_.message(\textcolor{stringliteral}{'Joined'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02049 
02050         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(Nprocs):
02051             gTDWorkerQ.put(\textcolor{stringliteral}{'STOP'})
02052         result.sort()
02053         to\_return = np.array(result)[:, 1]
02054         \textcolor{keywordflow}{return} to\_return.reshape(int\_ratio.shape)
02055 
02056     
02057     @profile
02058     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, lev\_j2= 
      -1,
02059                   wave1= -1, wave2= -1, maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x=
       -1,
\hypertarget{pynebcore_8py_source_l02060}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{02060}                   to\_eval=\textcolor{keywordtype}{None}, nCut=30, maxIter=20):
02061         \textcolor{stringliteral}{"""}
02062 \textcolor{stringliteral}{        Return either the temperature or the density given the other variable for a selected line ratio }
02063 \textcolor{stringliteral}{            of known intensity.}
02064 \textcolor{stringliteral}{        The line ratio can involve two or more than two lines. }
02065 \textcolor{stringliteral}{        In the first case (only two lines), it can be specified giving either two transitions }
02066 \textcolor{stringliteral}{            (four atomic levels, i.e. two for each transition), or two wavelengths.}
02067 \textcolor{stringliteral}{        In the general case (any number of lines), it can be specified as an algebraic expression }
02068 \textcolor{stringliteral}{            to be evaluated, involving either atomic levels or wavelengths.}
02069 \textcolor{stringliteral}{        An array of values, rather than a single value, can also be given, in which case the result }
02070 \textcolor{stringliteral}{            will also be an array.}
02071 \textcolor{stringliteral}{            }
02072 \textcolor{stringliteral}{        Usage: }
02073 \textcolor{stringliteral}{            O3.getTemDen(150., den=100., wave1=5007, wave2=4363, maxError=1.e-2)}
02074 \textcolor{stringliteral}{            O3.getTemDen(150., den=100., to\_eval = '(I(4,3) + I(4,2) + I(4,1)) / I(5,4)')}
02075 \textcolor{stringliteral}{            N2.getTemDen(150., den=100., to\_eval = '(L(6584) + L(6548)) / L(5755)')}
02076 \textcolor{stringliteral}{            O3.getTemDen([0.02, 0.04], den=[1.e4, 1.1e4], to\_eval="I(5, 4) / (I(4, 3) + I(4, 2))")}
02077 \textcolor{stringliteral}{}
02078 \textcolor{stringliteral}{        Parameters:}
02079 \textcolor{stringliteral}{            - int\_ratio    intensity ratio of the selected transition}
02080 \textcolor{stringliteral}{            - tem          electronic temperature}
02081 \textcolor{stringliteral}{            - den          electronic density}
02082 \textcolor{stringliteral}{            - lev\_i1       upper level of 1st transition}
02083 \textcolor{stringliteral}{            - lev\_j1       lower level of 1st transition}
02084 \textcolor{stringliteral}{            - lev\_i2       upper level of 2nd transition}
02085 \textcolor{stringliteral}{            - lev\_j2       lower level of 2nd transition}
02086 \textcolor{stringliteral}{            - wave1        wavelength of 1st transition}
02087 \textcolor{stringliteral}{            - wave2        wavelength of 2nd transition}
02088 \textcolor{stringliteral}{            - maxError     tolerance on difference between input and computed ratio }
02089 \textcolor{stringliteral}{            - method       numerical method for finding the root (nsect\_recur, nsect\_iter)}
02090 \textcolor{stringliteral}{            - log          switch of log (default = True). start\_x and end\_x are using this parameter.}
02091 \textcolor{stringliteral}{            - start\_x      lower end of the interval to explore. (default: lower end of collision }
02092 \textcolor{stringliteral}{                            strength temperature array for temperature, 1 if density)}
02093 \textcolor{stringliteral}{            - end\_x        higher end of the interval to explore. (default: higher end of collision }
02094 \textcolor{stringliteral}{                            strength temperature array for temperature, 1e8 if density)}
02095 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated, using either I (for transitions identified }
02096 \textcolor{stringliteral}{                            through atomic levels) or L (for transitions identified through wavelengths)}
02097 \textcolor{stringliteral}{            - nCut        number of sections in which each step is cut. 2 would be dichotomy.}
02098 \textcolor{stringliteral}{            - maxIter     maximum number of iterations}
02099 \textcolor{stringliteral}{}
02100 \textcolor{stringliteral}{        """}        
02101         \textcolor{keywordflow}{if} pn.config.\_use\_mp:
02102             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3a7c4f43d58a5988d04cbe23ed9593ba}{\_getTemDen\_MP}(int\_ratio=int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, 
      lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
02103                   wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, start\_x=start\_x,
02104                   end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02105         \textcolor{keywordflow}{else}:
02106             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(int\_ratio=int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, 
      lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
02107                   wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, start\_x=start\_x,
02108                   end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02109 
\hypertarget{pynebcore_8py_source_l02110}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a95230eab8816f670306adceffe6f6a48}{02110}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a95230eab8816f670306adceffe6f6a48}{getIonAbundance}(self, int\_ratio, tem, den, lev\_i= -1, lev\_j= -1, wave= -1, 
      to\_eval=None, Hbeta=100.):
02111         \textcolor{stringliteral}{"""}
02112 \textcolor{stringliteral}{        Compute the ionic abundance relative to H+ given the intensity of a line or sum of lines, }
02113 \textcolor{stringliteral}{        the temperature, and the density. }
02114 \textcolor{stringliteral}{        The line can be specified as a transition (i.e., giving the two atomic level involved), }
02115 \textcolor{stringliteral}{        as a wavelength, or as an algebraic expression. In the last case, a sum of lines }
02116 \textcolor{stringliteral}{        can also be supplied.}
02117 \textcolor{stringliteral}{}
02118 \textcolor{stringliteral}{        Usage:}
02119 \textcolor{stringliteral}{            O3.getIonAbundance(100, 1.5e4, 100., wave=5007)}
02120 \textcolor{stringliteral}{            O3.getIonAbundance(130, 1.5e4, 100., to\_eval='I(4,3) + I(4,2)')}
02121 \textcolor{stringliteral}{            O3.getIonAbundance(np.array([100, 150]), np.array([1.5e4, 1.2e4]), np.array([100., 120]), }
02122 \textcolor{stringliteral}{                wave=5007)}
02123 \textcolor{stringliteral}{            O2.getIonAbundance(int\_ratio=100, tem=1.5e4, den=100., to\_eval='L(3726)+L(3729)')}
02124 \textcolor{stringliteral}{}
02125 \textcolor{stringliteral}{            }
02126 \textcolor{stringliteral}{        Parameters:}
02127 \textcolor{stringliteral}{            - int\_ratio    relative line intensity (default normalization: Hbeta = 100). }
02128 \textcolor{stringliteral}{                            May be an array.}
02129 \textcolor{stringliteral}{            - tem          electronic temperature in K. May be an array.}
02130 \textcolor{stringliteral}{            - den          electronic density in cm^-3. May be an array.}
02131 \textcolor{stringliteral}{            - lev\_i        upper level of transition}
02132 \textcolor{stringliteral}{            - lev\_j        lower level of transition}
02133 \textcolor{stringliteral}{            - wave         wavelength of transition. Takes precedence on lev\_i and lev\_j if set, }
02134 \textcolor{stringliteral}{                            ignored otherwise }
02135 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated. Takes precedence on wave if set, }
02136 \textcolor{stringliteral}{                            ignored otherwise.}
02137 \textcolor{stringliteral}{            - Hbeta        line intensity normalization at Hbeta (default Hbeta = 100)}
02138 \textcolor{stringliteral}{        }
02139 \textcolor{stringliteral}{        """}
02140         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_i)
02141         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ade3de73e8bdb814d01d2d9af98eba87f}{\_test\_lev}(lev\_j)
02142         \textcolor{keywordflow}{if} np.ndim(tem) != np.ndim(den):
02143             self.log\_.error(\textcolor{stringliteral}{'ten and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02144             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02145         \textcolor{keywordflow}{if} ((np.squeeze(np.asarray(int\_ratio)).shape != np.squeeze(np.asarray(tem)).shape) | 
02146             (np.squeeze(np.asarray(den)).shape != np.squeeze(np.asarray(tem)).shape)):
02147             self.log\_.warn(\textcolor{stringliteral}{'int\_ratio, tem and den must does not have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02148         \textcolor{keywordflow}{if} (lev\_i == -1) & (lev\_j == -1) & (wave == -1) & (to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}):
02149             self.log\_.error(\textcolor{stringliteral}{'At least one of lev\_i, lev\_j, wave or to\_eval must be supplied'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02150             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02151         \textcolor{keywordflow}{if} to\_eval == \textcolor{keywordtype}{None}:
02152             \textcolor{keywordflow}{if} wave != -1:
02153                 lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)     
02154             to\_eval = \textcolor{stringliteral}{'I('} + str(lev\_i) + \textcolor{stringliteral}{','} + str(lev\_j) + \textcolor{stringliteral}{')'} 
02155         I = \textcolor{keyword}{lambda} lev\_i, lev\_j: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, lev\_i, lev\_j, product=\textcolor{keyword}{False})
02156         L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, wave=wave, product=\textcolor{keyword}{False})
02157         \textcolor{keywordflow}{try}:
02158             emis = eval(to\_eval)
02159         \textcolor{keywordflow}{except}:
02160             self.log\_.error(\textcolor{stringliteral}{'Unable to eval \{0\}'}.format(to\_eval), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02161             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02162         \textcolor{comment}{#int\_ratio is in units of Hb = Hbeta keyword}
02163         ionAbundance = ((int\_ratio / Hbeta) * (\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{getRecEmissivity}(tem, den, 4, 2, atom=\textcolor{stringliteral}{'H1'}, 
      product=\textcolor{keyword}{False}) / emis))
02164         \textcolor{keywordflow}{return} ionAbundance
02165     
02166 
\hypertarget{pynebcore_8py_source_l02167}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4be768ed1460bb448207b470551ef2ed}{02167}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4be768ed1460bb448207b470551ef2ed}{printIonic}(self, tem=None, den=None, printA=False, printPop=True, printCrit=True):
02168         \textcolor{stringliteral}{""" }
02169 \textcolor{stringliteral}{        Print miscellaneous information (wavelengths, level populations, emissivities, }
02170 \textcolor{stringliteral}{            critical densities) for given physical conditions.}
02171 \textcolor{stringliteral}{        If an electron temperature is given, level critical densities can be printed }
02172 \textcolor{stringliteral}{            (using printCrit=True)}
02173 \textcolor{stringliteral}{        If an electron density is also given, line emissivities (also for Hbeta) are printed and level }
02174 \textcolor{stringliteral}{            populations can be printed (using printPop=True)}
02175 \textcolor{stringliteral}{        }
02176 \textcolor{stringliteral}{        Usage:}
02177 \textcolor{stringliteral}{            O3.printIonic()}
02178 \textcolor{stringliteral}{            O3.printIonic(printA=True)}
02179 \textcolor{stringliteral}{            O3.printIonic(tem=10000., printCrit=True)}
02180 \textcolor{stringliteral}{            O3.printIonic(tem=10000., den=1e3, printA=True, printPop=True, printCrit=True)}
02181 \textcolor{stringliteral}{}
02182 \textcolor{stringliteral}{        Parameters:}
02183 \textcolor{stringliteral}{            - tem          temperature}
02184 \textcolor{stringliteral}{            - den          density}
02185 \textcolor{stringliteral}{            - printA       also print transition probabilities (default=False)}
02186 \textcolor{stringliteral}{            - printPop     also print level populations (needs tem and den)}
02187 \textcolor{stringliteral}{            - printCrit    also print critical densities (needs tem)}
02188 \textcolor{stringliteral}{}
02189 \textcolor{stringliteral}{        """}
02190         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'elem = %s'} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}
02191         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'spec = %i'} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}
02192         \textcolor{keywordflow}{if} tem \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
02193             \textcolor{keywordflow}{print} \textcolor{stringliteral}{'temperature = %6.1f K'} % tem
02194         \textcolor{keywordflow}{if} den \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
02195             \textcolor{keywordflow}{print} \textcolor{stringliteral}{'density = %6.1f cm-3'} % den
02196         \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
02197         \textcolor{keywordflow}{if} printPop \textcolor{keywordflow}{and} ((tem \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{or} (den \textcolor{keywordflow}{is} \textcolor{keywordtype}{None})):
02198             pn.log\_.warn(\textcolor{stringliteral}{'Cannot print populations as tem or den is missing'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02199             printPop = \textcolor{keyword}{False}
02200         \textcolor{keywordflow}{if} printCrit \textcolor{keywordflow}{and} (tem \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}):
02201             pn.log\_.warn(\textcolor{stringliteral}{'Cannot print critical densities as tem is missing'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02202             printCrit = \textcolor{keyword}{False}
02203         to\_print = \textcolor{stringliteral}{''}
02204         \textcolor{keywordflow}{if} printPop:
02205             to\_print += \textcolor{stringliteral}{'Level   Populations  '}
02206         \textcolor{keywordflow}{if} printCrit:
02207             to\_print += \textcolor{stringliteral}{'Critical densities'}
02208         \textcolor{keywordflow}{if} to\_print != \textcolor{stringliteral}{''}:
02209             print(to\_print)
02210         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}):
02211             lev\_i = i + 1
02212             to\_print = \textcolor{stringliteral}{'Level %1i:  '} % (lev\_i)
02213             \textcolor{keywordflow}{if} printPop:
02214                 pop = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den)
02215                 to\_print += \textcolor{stringliteral}{"%.3E  "} % (pop[i])
02216             \textcolor{keywordflow}{if} printCrit:
02217                 to\_print += \textcolor{stringliteral}{"%.3E"} % (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aae95b1cb36defadad24cf94459203eb3}{getCritDensity}(tem, lev\_i))
02218             \textcolor{keywordflow}{if} printPop \textcolor{keywordflow}{or} printCrit:
02219                 print(to\_print)
02220         \textcolor{keywordflow}{if} printPop \textcolor{keywordflow}{or} printCrit:
02221             print(\textcolor{stringliteral}{''})
02222              
02223         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}):
02224             \textcolor{keywordflow}{if} printA:
02225                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02226                     to\_print = \textcolor{stringliteral}{"\{0:.3E\}   "}.format(np.float(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(i + 1, j + 1)))
02227                     \textcolor{keywordflow}{print} to\_print,
02228                 \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
02229             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02230                 \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j] > 10000.:
02231                     to\_print = \textcolor{stringliteral}{"%10.2fm "} % (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j] / 1e4)
02232                 \textcolor{keywordflow}{else}:
02233                     to\_print = \textcolor{stringliteral}{"%10.2fA "} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j]
02234                 \textcolor{keywordflow}{print} to\_print,
02235             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
02236             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02237                 \textcolor{keywordflow}{print} \textcolor{stringliteral}{"    (%1i-->%1i) "} % (i + 1, j + 1),
02238             \textcolor{keywordflow}{print} \textcolor{stringliteral}{""}
02239             \textcolor{keywordflow}{if} (tem \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (den \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
02240                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02241                     \textcolor{keywordflow}{print} \textcolor{stringliteral}{"  %.3E "} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, lev\_i=i + 1, lev\_j=j + 1),
02242             \textcolor{keywordflow}{print} \textcolor{stringliteral}{"\(\backslash\)n"}
02243         \textcolor{keywordflow}{if} (tem \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (den \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
02244             \textcolor{keywordflow}{try}:
02245                 H1 = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{RecAtom}(\textcolor{stringliteral}{'H'}, 1)
02246                 \textcolor{keywordflow}{print} \textcolor{stringliteral}{"# H-beta volume emissivity:"}
02247                 \textcolor{keywordflow}{print} \textcolor{stringliteral}{"%.3E N(H+) * N(e-)  (erg/s)"} % H1.getEmissivity(tem, den, 4, 2)
02248             \textcolor{keywordflow}{except}:
02249                 \textcolor{keywordflow}{pass}
02250 
02251     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0b95239f3b76bbd0e42da220370ff866}{printTemDen}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, 
      lev\_j2= -1, wave1= -1, wave2= -1,
02252                     maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x= -1, to\_eval=\textcolor{keywordtype}{None},
\hypertarget{pynebcore_8py_source_l02253}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0b95239f3b76bbd0e42da220370ff866}{02253}                     nCut=30, maxIter=20):
02254         \textcolor{stringliteral}{""" }
02255 \textcolor{stringliteral}{        Print result of getTemDen function. See getTemDen for more details.}
02256 \textcolor{stringliteral}{        }
02257 \textcolor{stringliteral}{        Usage:}
02258 \textcolor{stringliteral}{            O3.printTemDen(100, tem=10000, wave1=5007, wave2=4363)}
02259 \textcolor{stringliteral}{        }
02260 \textcolor{stringliteral}{        Parameters:}
02261 \textcolor{stringliteral}{            - int\_ratio    intensity ratio of the selected transition}
02262 \textcolor{stringliteral}{            - tem          electronic temperature}
02263 \textcolor{stringliteral}{            - den          electronic density}
02264 \textcolor{stringliteral}{            - lev\_i1       upper level of 1st transition}
02265 \textcolor{stringliteral}{            - lev\_j1       lower level of 1st transition}
02266 \textcolor{stringliteral}{            - lev\_i2       upper level of 2nd transition}
02267 \textcolor{stringliteral}{            - lev\_j2       lower level of 2nd transition}
02268 \textcolor{stringliteral}{            - wave1        wavelength of 1st transition}
02269 \textcolor{stringliteral}{            - wave2        wavelength of 2nd transition}
02270 \textcolor{stringliteral}{            - maxError     tolerance on difference between input and computed ratio }
02271 \textcolor{stringliteral}{            - method       numerical method for finding the root (nsect\_recur, nsect\_iter)}
02272 \textcolor{stringliteral}{            - log          log switch (default = True)}
02273 \textcolor{stringliteral}{            - start\_x      lower end of the interval to explore (default: lower end of collision }
02274 \textcolor{stringliteral}{                            strength temperature array)}
02275 \textcolor{stringliteral}{            - end\_x        higher end of the interval to explore (default: higher end of collision }
02276 \textcolor{stringliteral}{                            strength temperature array)}
02277 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated, using either I (for transitions identified through }
02278 \textcolor{stringliteral}{                            atomic levels) or L (for transitions identified through wavelengths)}
02279 \textcolor{stringliteral}{            - nCut        number of sections in which each step is cut. 2 would be dichotomy.}
02280 \textcolor{stringliteral}{            - maxIter     maximum number of iterations}
02281 \textcolor{stringliteral}{}
02282 \textcolor{stringliteral}{        """}
02283         \textcolor{keywordflow}{if} tem == -1:
02284             option = \textcolor{stringliteral}{'temperature'}
02285             assume = den
02286             assume\_str = \textcolor{stringliteral}{'density'}
02287             assume\_unit = \textcolor{stringliteral}{'cm-3'}
02288             unit = \textcolor{stringliteral}{'K'}
02289         \textcolor{keywordflow}{if} den == -1:
02290             option = \textcolor{stringliteral}{'density'}
02291             assume = tem
02292             assume\_str = \textcolor{stringliteral}{'temperature'}
02293             assume\_unit = \textcolor{stringliteral}{'K'}
02294             unit = \textcolor{stringliteral}{'cm-3'}
02295 
02296         result = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, lev\_j1=lev\_j1, lev\_i2=
      lev\_i2, lev\_j2=lev\_j2,
02297                                 wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, 
      start\_x=start\_x,
02298                                 end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02299         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Ion = %s'} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} + \textcolor{stringliteral}{" "} + \hyperlink{namespacepyneb_1_1utils_1_1misc_aec4e973d4cb9299f749ef190ea636a06}{int\_to\_roman}(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec})
02300         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Option = %s'} % option
02301         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Assumed %s = %.0f %s'} % (assume\_str, assume, assume\_unit)
02302         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02303             \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Assumed I(%i)/I(%i) ratio = %.0f'} % (wave1, wave2, int\_ratio)
02304         \textcolor{keywordflow}{else}:
02305             \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Assumed %s = %.0f'} % (to\_eval, int\_ratio)
02306 \textcolor{comment}{#        print 'method = %s' % method}
02307 \textcolor{comment}{#        print 'maxError on ratio %f' % maxError}
02308         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Calculated %s = %.0f %s'} % (option, result, unit)
02309 
02310 
02311     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_adc2de658da17347204f430aff728650b}{plotEmiss}(self, tem\_min=1000, tem\_max=30000, ionic\_abund=1.0, den=1e3, style='-',
02312                   legend\_loc=4, temLog=\textcolor{keyword}{False}, plot\_total=\textcolor{keyword}{False}, plot\_only\_total=\textcolor{keyword}{False}, legend=\textcolor{keyword}{True},
\hypertarget{pynebcore_8py_source_l02313}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_adc2de658da17347204f430aff728650b}{02313}                   total\_color=\textcolor{stringliteral}{'black'}, total\_label=\textcolor{stringliteral}{'TOTAL'}, ax=\textcolor{keywordtype}{None}):
02314         \textcolor{stringliteral}{""" }
02315 \textcolor{stringliteral}{        Plot the emissivity as a function of temperature of all the lines of the selected atom.  }
02316 \textcolor{stringliteral}{}
02317 \textcolor{stringliteral}{        Usage: }
02318 \textcolor{stringliteral}{            O3.plotEmiss(tem\_min=10000, tem\_max=20000)}
02319 \textcolor{stringliteral}{        }
02320 \textcolor{stringliteral}{        Parameters:}
02321 \textcolor{stringliteral}{            - tem\_min         minimum value of the temperature range to span (default=1000)}
02322 \textcolor{stringliteral}{            - tem\_max         maximum value of the temperature range to span (default=30000)}
02323 \textcolor{stringliteral}{            - ionic\_abund     relative ionic abundance (default = 1.0)}
02324 \textcolor{stringliteral}{            - den             electron density}
02325 \textcolor{stringliteral}{            - style           line style of the plot (default: '-' [solid line])}
02326 \textcolor{stringliteral}{            - legend\_loc      localization of the legend (default: 4 = lower right; see plt.legend }
02327 \textcolor{stringliteral}{                                for more details)}
02328 \textcolor{stringliteral}{            - temLog          linear (False) or logarithmic temperature axis (default = False)}
02329 \textcolor{stringliteral}{            - plot\_total      flag to also plot total emissivity (default = False)}
02330 \textcolor{stringliteral}{            - plot\_only\_total flag to only plot total emissivity (default = False)}
02331 \textcolor{stringliteral}{            - legend          flag to place legend (default = True)}
02332 \textcolor{stringliteral}{            - total\_color     color of the total emissivity (default = 'black')}
02333 \textcolor{stringliteral}{            - total\_label     label of the total emissivity (default = 'TOTAL')}
02334 \textcolor{stringliteral}{            - ax              axis where to send the plot. If None, a new axis is done}
02335 \textcolor{stringliteral}{}
02336 \textcolor{stringliteral}{        """}
02337         \textcolor{keywordflow}{if} ax \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02338             f, ax = plt.subplots()
02339         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]: 
02340             pn.log\_.error(\textcolor{stringliteral}{'Matplotlib not available, no plot'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.plot'})
02341             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02342         tem = np.logspace(np.log10(tem\_min), np.log10(tem\_max), 1000)
02343         total\_emis = np.zeros\_like(tem)
02344         \textcolor{keywordflow}{for} wave \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList}:
02345             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
02346             \textcolor{keywordflow}{if} (lev\_i <= self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}) \textcolor{keywordflow}{and} (lev\_j <= self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}):
02347                 color = ((np.log10(wave) - np.log10(np.min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList}))) / 
02348                          (np.log10(np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList})) - np.log10(np.min(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList})))) ** 0.4
02349                 c = cm.jet(color, 1)
02350                 \textcolor{keywordflow}{if} temLog:
02351                     x\_to\_plot = np.log10(tem)
02352                 \textcolor{keywordflow}{else}:
02353                     x\_to\_plot = tem
02354                 y\_to\_plot = ionic\_abund * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, wave=wave)
02355                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} plot\_only\_total:
02356                     \textcolor{keywordflow}{if} (y\_to\_plot[0] > 0.):
02357                         ax.plot(x\_to\_plot, np.log10(y\_to\_plot),
02358                              label=\textcolor{stringliteral}{'\{0:.0f\}'}.format(wave), color=c, linestyle=style)
02359                 total\_emis += y\_to\_plot
02360         \textcolor{keywordflow}{if} plot\_total:
02361             ax.plot(x\_to\_plot, np.log10(total\_emis),
02362                      label=total\_label, color=total\_color, linewidth=3, linestyle=style)
02363         \textcolor{keywordflow}{if} legend:
02364             ax.legend(loc=legend\_loc)
02365         \textcolor{keywordflow}{if} temLog:
02366             ax.set\_xlabel(\textcolor{stringliteral}{'log(T[K])'})
02367         \textcolor{keywordflow}{else}:
02368             ax.set\_xlabel(\textcolor{stringliteral}{'T[K]'})
02369         ax.set\_ylabel(\textcolor{stringliteral}{'log [erg.cm3/s]'})
02370         ax.set\_title(\textcolor{stringliteral}{'Line emissivities'})
02371 
\hypertarget{pynebcore_8py_source_l02372}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad18adec8faaf694fbff55656efea719d}{02372}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad18adec8faaf694fbff55656efea719d}{plotGrotrian}(self, tem=1e4, den=1e2, thresh\_int=1e-3, unit='eV', detailed=False, 
      ax=None):
02373         \textcolor{stringliteral}{"""}
02374 \textcolor{stringliteral}{        Draw a Grotrian plot of the selected atom, labelling only lines above a}
02375 \textcolor{stringliteral}{        pecified intensity threshold (relative to the most intense line). }
02376 \textcolor{stringliteral}{        For ground state levels, the Russell-Saunders term symbol is also given.}
02377 \textcolor{stringliteral}{        }
02378 \textcolor{stringliteral}{        Usage:}
02379 \textcolor{stringliteral}{            O3.plotGrotrian()}
02380 \textcolor{stringliteral}{        }
02381 \textcolor{stringliteral}{        Parameters:}
02382 \textcolor{stringliteral}{            - tem          temperature at which the intensity threshold is to be computed }
02383 \textcolor{stringliteral}{            - den          density at which the intensity threshold is to be computed }
02384 \textcolor{stringliteral}{            - thresh\_int   intensity threshold (relative to the most intense line, default: 1.e-3)}
02385 \textcolor{stringliteral}{            - unit         one of 'eV' (default), '1/Ang' or 'Ryd'}
02386 \textcolor{stringliteral}{            - ax           axis where to plot the result}
02387 \textcolor{stringliteral}{}
02388 \textcolor{stringliteral}{        """}
02389         \textcolor{keywordflow}{if} ax \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02390             f, ax = plt.subplots()
02391         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'eV'}, \textcolor{stringliteral}{'Ryd'}, \textcolor{stringliteral}{'1/Ang'}]:
02392             pn.log\_.error(\textcolor{stringliteral}{'Unit \{0\} not available'}.format(unit))
02393             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02394         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'plt'}]: 
02395             pn.log\_.error(\textcolor{stringliteral}{'Matplotlib not available, no plot'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.plot'})
02396             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02397         color\_list = [\textcolor{stringliteral}{'b'}, \textcolor{stringliteral}{'}\textcolor{stringliteral}{r', '}y', 'c', 'm', 'g']
02398         energies = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(unit=unit)
02399          
02400         \textcolor{comment}{# VL 16 Jul 2013 - Detect level inversion, just for warning        }
02401         level\_multiplet = [0]
02402         multiplets = []
02403         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
02404             term = []; j = []; en = []
02405             \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST}:
02406                 term.append(item[1])
02407                 j.append(item[2])
02408                 en.append(item[3])
02409             sorted\_indx = np.argsort(en) 
02410             term = np.array(term)[sorted\_indx]
02411             j = np.array(j)[sorted\_indx]
02412             en = np.array(en)[sorted\_indx]
02413             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(1, len(en)):
02414                 \textcolor{keywordflow}{if} (term[i] == term[i-1]):
02415                     level\_multiplet.append(i)
02416                 \textcolor{keywordflow}{else}:
02417                     multiplets.append(level\_multiplet) 
02418                     level\_multiplet = [i]
02419             multiplets.append(level\_multiplet) \textcolor{comment}{# append last multiplet}
02420 \textcolor{comment}{# Mistakenly rounds off fractional J values. Corrected 26/12/2014            }
02421 \textcolor{comment}{#            levelLabels = ['$^\{\{\{0\}\}\}$\{1\}$\_\{\{\{2:.0f\}\}\}$'.format(l['term'][0],l['term'][1],l['J']) for l in
       self.NIST]}
02422             levelLabels = [\textcolor{stringliteral}{'$^\{\{\{0\}\}\}$\{1\}$\_\{\{\{2\}/\{3\}\}\}$'}.format(l[\textcolor{stringliteral}{'term'}][0], l[\textcolor{stringliteral}{'term'}][1], Fraction(l[\textcolor{stringliteral}{'J'}]
      ).numerator, Fraction(l[\textcolor{stringliteral}{'J'}]).denominator) \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST}]
02423         \textcolor{keywordflow}{else}:
02424             delta\_e\_max = 1.e-5  \textcolor{comment}{# Arbitrary limit to define hyperfine structure and identify multiplets }
02425             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(1, len(energies)):
02426                 \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}()[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}()[i - 1] < delta\_e\_max):
02427                     \textcolor{comment}{# if levels close, append level to multiplet}
02428                     level\_multiplet.append(i) 
02429                 \textcolor{keywordflow}{else}:
02430                     \textcolor{comment}{# if levels separated, add current multiplet to array and start a new multiplet}
02431                     multiplets.append(level\_multiplet) 
02432                     level\_multiplet = [i]
02433             multiplets.append(level\_multiplet) \textcolor{comment}{# append last multiplet}
02434             warn\_label = []
02435             levelLabels = gsLevelDict[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs}]
02436             \textcolor{keywordflow}{for} i\_multi \textcolor{keywordflow}{in} np.arange(len(multiplets)):
02437                 stat\_weights = []
02438                 \textcolor{comment}{# check each multiplet for inversion separately}
02439                 \textcolor{keywordflow}{for} i\_level \textcolor{keywordflow}{in} multiplets[i\_multi]:
02440                     latex\_sw = levelLabels[i\_level]
02441                     sw = eval(latex\_sw.split(\textcolor{stringliteral}{'$'})[-2].replace(\textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{''}).replace(\textcolor{stringliteral}{'\{'}, \textcolor{stringliteral}{''}).replace(\textcolor{stringliteral}{'\}'}, \textcolor{stringliteral}{'.'}) +
       \textcolor{stringliteral}{'*2.+1.'})
02442                     stat\_weights.append(sw)
02443                 \textcolor{keywordflow}{if} (stat\_weights != [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}()[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} multiplets[i\_multi]]):
02444                     warn\_label.append(i\_multi)
02445                     to\_print = \textcolor{stringliteral}{'\(\backslash\)nLevel inversion in multiplet \{0\} of \{1\}'}\(\backslash\)
02446                              \textcolor{stringliteral}{'\(\backslash\)nThe labels of levels \{2\} are displayed in the wrong order'} + \(\backslash\)
02447                              \textcolor{stringliteral}{'\(\backslash\)nAssumed statistical weights: \{3\}'} + \(\backslash\)
02448                              \textcolor{stringliteral}{'\(\backslash\)nStatistical weights of data: \{4\}\(\backslash\)n'}
02449                     pn.log\_.warn(to\_print.format(i\_multi + 1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, multiplets[i\_multi], 
02450                                                  stat\_weights, [self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}()[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} multiplets[i\_multi]]), 
02451                                  calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.plot'})
02452 
02453         \textcolor{comment}{# where level starts in the plot}
02454        
02455         x\_span = 0.75
02456         x\_0 = (1 - x\_span) / 4.    
02457         dx = 0.005
02458         max\_en = np.max(energies)
02459         blow = 0.02 * max\_en \textcolor{comment}{# blowup scale for multiplets}
02460         ax.set\_xlim((0, 1.))
02461         ax.set\_ylim((np.max(energies) * -0.05, max\_en * 1.05))
02462         ax.set\_title(\textcolor{stringliteral}{'[\{0\} \{1\}]'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, \hyperlink{namespacepyneb_1_1utils_1_1misc_aec4e973d4cb9299f749ef190ea636a06}{int\_to\_roman}(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec})))
02463 
02464         \textcolor{comment}{# Blow up of multiplets in the plot}
02465         i\_tot = 0
02466         \textcolor{keywordflow}{for} i\_multi \textcolor{keywordflow}{in} np.arange(len(multiplets)):
02467             shift = (1-len(multiplets[i\_multi])) / 2.
02468             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(len(multiplets[i\_multi])):
02469                 y = energies[multiplets[i\_multi][i]] + shift * blow
02470                 ax.plot([x\_0, 1.5 * x\_0, 1.6 * x\_0, x\_0 + x\_span], 
02471                          [y, y, energies[multiplets[i\_multi][i]], 
02472                           energies[multiplets[i\_multi][i]]], lw = 1.2, 
02473                          color = color\_list[np.mod(multiplets[i\_multi][i], len(color\_list))])
02474                 ax.text(x\_span + x\_0 + dx, y, \textcolor{stringliteral}{'\{0:7.4f\}'}.format(energies[multiplets[i\_multi][i]]), size=\textcolor{stringliteral}{'
      small'}, 
02475                          horizontalalignment=\textcolor{stringliteral}{'left'}, verticalalignment=\textcolor{stringliteral}{'center'})
02476                 \textcolor{keywordflow}{try}:
02477                     \textcolor{keywordflow}{if} (detailed \textcolor{keywordflow}{is} \textcolor{keyword}{False}):
02478                         ax.text(dx, y, levelLabels[i\_tot], size=\textcolor{stringliteral}{'medium'}, verticalalignment=\textcolor{stringliteral}{'center'})
02479                     \textcolor{keywordflow}{else}:
02480                         ax.text(dx, y, str(i\_tot+1) + \textcolor{stringliteral}{": "} + levelLabels[i\_tot] , size=\textcolor{stringliteral}{'medium'}, 
      verticalalignment=\textcolor{stringliteral}{'center'}, color = color\_list[np.mod(multiplets[i\_multi][i], len(color\_list))])
02481                     i\_tot += 1
02482                 \textcolor{keywordflow}{except}:
02483                     \textcolor{keywordflow}{pass}
02484                 shift += 1
02485         ax.text(1 - dx / 2., max(energies) * 0.5, \textcolor{stringliteral}{'E [\{0:s\}] '}.format(unit), horizontalalignment=\textcolor{stringliteral}{'right'}, 
      color=\textcolor{stringliteral}{'blue'})
02486         plt.xlabel(\textcolor{stringliteral}{'Ground-state configuration: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs}), color=\textcolor{stringliteral}{"#004400"})
02487                
02488         ax.xaxis.set\_ticks\_position(\textcolor{stringliteral}{"none"})
02489         ax.yaxis.set\_ticks\_position(\textcolor{stringliteral}{"none"})
02490         ax.xaxis.set\_ticklabels([])
02491         ax.yaxis.set\_ticklabels([])
02492         
02493         emis\_max = np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den))
02494         N\_lines = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(1e4, 1e3) > (emis\_max * thresh\_int)).sum() \textcolor{comment}{# number of
       lines plotted}
02495         x\_pad = 0.1 * (x\_span - 0.6 * x\_0)     
02496         \textcolor{keywordflow}{if} N\_lines > 1:
02497             delta\_x = (x\_span - 2 * x\_pad) / (N\_lines - 1)
02498             x = 1.6 * x\_0 + 0.5 * x\_pad
02499         \textcolor{keywordflow}{else}:
02500             delta\_x = 0
02501             x = (1.6 * x\_0 + x\_span) / 2.
02502         cc = colors.ColorConverter()
02503         \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels} - 1) + 2:
02504             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(j - 1) + 1:
02505                 emis = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, j, i)
02506                 \textcolor{keywordflow}{if} emis > (emis\_max * thresh\_int):
02507                     N\_seg = 1000. \textcolor{comment}{#number of segments to draw emission line, to make it look smooth}
02508                     xx = np.ones(N\_seg+1) * x  \textcolor{comment}{# x coord of segmente making up one line}
02509                     yy = np.linspace(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(i, unit=unit), self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(j, unit=unit), N\_seg+1)
02510                     scale = np.linspace(0, 1, N\_seg+1)
02511                     alpha =  np.tanh((2*scale-1)+1)  \textcolor{comment}{# to make alpha vary as a smooth step function}
02512                     points = np.array([xx, yy]).T.reshape(-1, 1, 2) 
02513                     segments = np.concatenate([points[:-1], points[1:]], axis=1) 
02514                     cmap1 = []
02515                     cmap2 = []
02516                     \textcolor{keywordflow}{for} seg \textcolor{keywordflow}{in} segments:
02517                             yy0 = seg.mean(0)[1] 
02518                             alpha0 = np.interp(yy0, yy, alpha)
02519                             rgb1 = cc.to\_rgb(color\_list[np.mod(j-1, len(color\_list))]) 
02520                             rgb2 = cc.to\_rgb(color\_list[np.mod(i-1, len(color\_list))]) 
02521                             cmap1.append([rgb1[0], rgb1[1], rgb1[2], alpha0]) 
02522                             cmap2.append([rgb2[0], rgb2[1], rgb2[2], 1-alpha0])
02523                     lc1 = LineCollection(segments, linewidths=3.5)
02524                     lc1.set\_color(cmap1) 
02525                     lc2 = LineCollection(segments, linewidths=3.5)
02526                     lc2.set\_color(cmap2) 
02527                     ax.add\_collection(lc1) 
02528                     ax.add\_collection(lc2) 
02529                     \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[j - 1, i - 1] > 1e4:
02530                         to\_print = \textcolor{stringliteral}{'\{0:.1f\}m'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[j - 1, i - 1] / 1e4) + \textcolor{stringliteral}{' '}
02531                     \textcolor{keywordflow}{else}:
02532                         to\_print = \textcolor{stringliteral}{'\{0:.1f\}A'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[j - 1, i - 1]) + \textcolor{stringliteral}{' '}
02533                     ax.text(x + 0.05 * delta\_x, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(j, unit=unit)-blow/2., to\_print, 
      size=\textcolor{stringliteral}{'small'}, rotation=90, verticalalignment=\textcolor{stringliteral}{'top'})
02534                     x = x + delta\_x
02535 
02536         \textcolor{comment}{# issue warning on plot if level inversion }
02537         \textcolor{keywordflow}{try}:
02538             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} warn\_label:
02539                 ax.text(0, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(multiplets[i][0]+1, unit=unit), \textcolor{stringliteral}{'Warning '}, ha=\textcolor{stringliteral}{'right'}, 
      color=\textcolor{stringliteral}{'red'})
02540         \textcolor{keywordflow}{except}:
02541             \textcolor{keywordflow}{pass}
02542 
02543     
\hypertarget{pynebcore_8py_source_l02544}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a30b539ebf4b4d3bc804bfdf0f8174d9f}{02544}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a30b539ebf4b4d3bc804bfdf0f8174d9f}{\_\_repr\_\_}(self):
02545         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Atom \{0\}\{1\} from \{2\} and \{3\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{atomFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{collFile})
02546 
02547 
\hypertarget{pynebcore_8py_source_l02548}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{02548} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{RecAtom}(object):
02549     
\hypertarget{pynebcore_8py_source_l02550}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abf13c53bf46bd7330bebd9397b4f8774}{02550}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abf13c53bf46bd7330bebd9397b4f8774}{\_\_init\_\_}(self, elem, spec, atom=None):
02551         \textcolor{stringliteral}{"""}
02552 \textcolor{stringliteral}{        RecAtom class. Used to manage recombination data and compute emissivities.}
02553 \textcolor{stringliteral}{        }
02554 \textcolor{stringliteral}{        Usage:}
02555 \textcolor{stringliteral}{            H1 = pn.RecAtom('H', 1)}
02556 \textcolor{stringliteral}{        }
02557 \textcolor{stringliteral}{        Parameters:}
02558 \textcolor{stringliteral}{            - elem          symbol of the selected element}
02559 \textcolor{stringliteral}{            - spec          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
02560 \textcolor{stringliteral}{         }
02561 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l02562}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad901cd583cbb6a4008bc41013e16d82f}{02562}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad901cd583cbb6a4008bc41013e16d82f}{log\_} = pn.log\_
02563         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l02564}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{02564}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} = str.capitalize(atom)
\hypertarget{pynebcore_8py_source_l02565}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{02565}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom})[0]
\hypertarget{pynebcore_8py_source_l02566}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{02566}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom})[1])
02567         \textcolor{keywordflow}{else}:
02568             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem} = str.capitalize(elem)
02569             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec} = int(spec)
02570             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec})
\hypertarget{pynebcore_8py_source_l02571}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abde95b732830df56b3d7713313f83060}{02571}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abde95b732830df56b3d7713313f83060}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}]
\hypertarget{pynebcore_8py_source_l02572}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{02572}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}
02573         self.log\_.message(\textcolor{stringliteral}{'Making rec-atom object for \{0\} \{1:d\}'}.format(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02574                 
02575         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a84628ce75ecdf667d179df96ee287fa3}{\_loadFit}()
02576         
02577         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'trc'} \textcolor{keywordflow}{in} pn.atomicData.getDataFile()[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}].keys():
02578             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a17f0f264893dcd582bcf4f9a1befd8bc}{\_loadTotRecombination}()
02579         
\hypertarget{pynebcore_8py_source_l02580}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad8b22dbde0d9861d94cf7aeacf0d93be}{02580}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad8b22dbde0d9861d94cf7aeacf0d93be}{E\_in\_vacuum} = \textcolor{keyword}{True}
\hypertarget{pynebcore_8py_source_l02581}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{02581}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST} = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom})
\hypertarget{pynebcore_8py_source_l02582}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{02582}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments} = \{\}
02583         web = \textcolor{stringliteral}{'Ref. \{0\} of NIST 2014 (try this:
       http://physics.nist.gov/cgi-bin/ASBib1/get\_ASBib\_ref.cgi?db=el&db\_id=\{0\}&comment\_code=&element=\{1\}&spectr\_charge=\{2\}&'}
02584         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l02585}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{02585}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels} = len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST})
\hypertarget{pynebcore_8py_source_l02586}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{02586}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST}[\textcolor{stringliteral}{'energy'}] / 1e8
02587             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments}[\textcolor{stringliteral}{'VACUUM'}] = \textcolor{stringliteral}{'1'}
02588             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments}[\textcolor{stringliteral}{'NOTE'}] = \textcolor{stringliteral}{'Energy levels'}
02589             source = \textcolor{stringliteral}{'\(\backslash\)n    '}
02590             \textcolor{keywordflow}{for} ref \textcolor{keywordflow}{in} np.unique(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST}[\textcolor{stringliteral}{'ref'}]):
02591                 source = source + web.format(ref[1:], self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec}) + \textcolor{stringliteral}{')\(\backslash\)n  + '} 
02592             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments}[\textcolor{stringliteral}{'SOURCE'}] = source[0:-5]
02593         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a20b990d9d745db7be03fdaac8390f919}{initWaves}()
02594 
02595 
\hypertarget{pynebcore_8py_source_l02596}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a271f5e8992df0412c6fdca611ac87a5d}{02596}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a271f5e8992df0412c6fdca611ac87a5d}{\_test\_lev}(self, level):
02597         \textcolor{stringliteral}{"""}
02598 \textcolor{stringliteral}{        Test whether selected level is legal}
02599 \textcolor{stringliteral}{}
02600 \textcolor{stringliteral}{        Parameters:}
02601 \textcolor{stringliteral}{            - level        selected atom level}
02602 \textcolor{stringliteral}{}
02603 \textcolor{stringliteral}{        """}       
02604         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}:
02605             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}),
02606                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02607 
\hypertarget{pynebcore_8py_source_l02608}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a20b990d9d745db7be03fdaac8390f919}{02608}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a20b990d9d745db7be03fdaac8390f919}{initWaves}(self):
02609         \textcolor{stringliteral}{"""}
02610 \textcolor{stringliteral}{        Initialization of wave\_Ang}
02611 \textcolor{stringliteral}{        }
02612 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l02613}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{02613}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}))
02614         
02615         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}):
02616             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02617                 wave = 1. / abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy}[j])
02618                 \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad8b22dbde0d9861d94cf7aeacf0d93be}{E\_in\_vacuum}:
02619                     wave = \hyperlink{namespacepyneb_1_1utils_1_1physics_aafb02f69e32ab62fa89420481f9a65f4}{vactoair}(wave)
02620                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[i, j] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[j, i] = wave
02621 
02622 
\hypertarget{pynebcore_8py_source_l02623}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a4c99566f33409cee77076ca8735568f0}{02623}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a4c99566f33409cee77076ca8735568f0}{getWave}(self, lev\_i=None, lev\_j=None):
02624         \textcolor{stringliteral}{"""}
02625 \textcolor{stringliteral}{        Return the wavelength of a transition given the levels}
02626 \textcolor{stringliteral}{        }
02627 \textcolor{stringliteral}{        Usage:}
02628 \textcolor{stringliteral}{            He2.getWave(4, 3) }
02629 \textcolor{stringliteral}{            }
02630 \textcolor{stringliteral}{        Parameters:}
02631 \textcolor{stringliteral}{            - lev\_i, lev\_j: upper and lower levels of the transition}
02632 \textcolor{stringliteral}{                }
02633 \textcolor{stringliteral}{        """} 
02634         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a271f5e8992df0412c6fdca611ac87a5d}{\_test\_lev}(lev\_i)
02635         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a271f5e8992df0412c6fdca611ac87a5d}{\_test\_lev}(lev\_j)
02636         return(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[lev\_i-1, lev\_j-1])
02637         
\hypertarget{pynebcore_8py_source_l02638}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a84628ce75ecdf667d179df96ee287fa3}{02638}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a84628ce75ecdf667d179df96ee287fa3}{\_loadFit}(self):
02639         \textcolor{stringliteral}{"""}
02640 \textcolor{stringliteral}{        Method to read the atomic data fits file and store the data}
02641 \textcolor{stringliteral}{        Called by \_\_init\_\_}
02642 \textcolor{stringliteral}{}
02643 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l02644}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{02644}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} = pn.atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'rec'})
02645         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02646             pn.log\_.error(\textcolor{stringliteral}{'No fits data for atom: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02647             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
\hypertarget{pynebcore_8py_source_l02648}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{02648}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath} = pn.atomicData.getDataFullPath(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'rec'})
02649         \textcolor{keywordflow}{try}:
02650             hdu = pyfits.open(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath})
02651         \textcolor{keywordflow}{except}:
02652             pn.log\_.error(\textcolor{stringliteral}{'\{0\} recombination file not read'}.format(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
\hypertarget{pynebcore_8py_source_l02653}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{02653}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData} = hdu[1].data
02654         hdu.close()
02655         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} \textcolor{keywordflow}{in} pn.config.DataFiles:
02656             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}]:
02657                 pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile})
02658         \textcolor{keywordflow}{else}:
02659             pn.config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}]
02660         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l02661}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{02661}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{temp} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[\textcolor{stringliteral}{'TEMP'}]
02662         \textcolor{keywordflow}{except}:
02663             pn.log\_.error(\textcolor{stringliteral}{'No TEMP field in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}))
02664         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l02665}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{02665}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{log\_dens} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[\textcolor{stringliteral}{'DENS'}]
02666         \textcolor{keywordflow}{except}:
02667             pn.log\_.error(\textcolor{stringliteral}{'No DENS field in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}))
\hypertarget{pynebcore_8py_source_l02668}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{02668}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels} = self.\_RecombData.names
02669         del self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels}[self.labels.index(\textcolor{stringliteral}{'TEMP'})]
02670         del self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels}[self.labels.index(\textcolor{stringliteral}{'DENS'})]
02671         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'\_'} \textcolor{keywordflow}{in} self.\_RecombData.names[0]:
\hypertarget{pynebcore_8py_source_l02672}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{02672}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} = \textcolor{stringliteral}{'transitions'}
02673         \textcolor{keywordflow}{else}:
02674             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} = \textcolor{stringliteral}{'wavelengths'}
02675         pn.log\_.message(\textcolor{stringliteral}{'\{0\} recombination data read from \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02676 
02677 
\hypertarget{pynebcore_8py_source_l02678}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a17f0f264893dcd582bcf4f9a1befd8bc}{02678}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a17f0f264893dcd582bcf4f9a1befd8bc}{\_loadTotRecombination}(self):
02679         \textcolor{stringliteral}{"""}
02680 \textcolor{stringliteral}{        Load the total recombination coefficient table. The case (A or B) is set by selecting the
       corresponding trc file.}
02681 \textcolor{stringliteral}{            }
02682 \textcolor{stringliteral}{        Parameters:}
02683 \textcolor{stringliteral}{            None}
02684 \textcolor{stringliteral}{                }
02685 \textcolor{stringliteral}{        """} 
\hypertarget{pynebcore_8py_source_l02686}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a3654e24299df680fe969486399e27880}{02686}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a3654e24299df680fe969486399e27880}{TotRecFile} = pn.atomicData.getDataFullPath(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'trc'})
02687         f = open(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a3654e24299df680fe969486399e27880}{TotRecFile})
02688         data = f.readlines()
02689         f.close()
02690         den\_points = [np.float(d) \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data[0].split()]
02691         tem\_points = [np.float(d) \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data[1].split()]
\hypertarget{pynebcore_8py_source_l02692}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad253222149ed56462daddaa2b9287cbb}{02692}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad253222149ed56462daddaa2b9287cbb}{alpha\_grid} = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}][2::], dtype=\textcolor{stringliteral}{'float'}
      )
\hypertarget{pynebcore_8py_source_l02693}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a6c6ed37093cbb2b2cf5a48df56357879}{02693}         self.lg\_den\_grid, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a6c6ed37093cbb2b2cf5a48df56357879}{lg\_tem\_grid} = np.meshgrid(np.log10(den\_points), np.log10(
      tem\_points))
02694 
02695         
\hypertarget{pynebcore_8py_source_l02696}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{02696}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{\_Transition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
02697         \textcolor{stringliteral}{"""}
02698 \textcolor{stringliteral}{        Return an array with computed upper level, computed lower level, computed wavelength, }
02699 \textcolor{stringliteral}{            input wavelength}
02700 \textcolor{stringliteral}{        }
02701 \textcolor{stringliteral}{        Parameters:}
02702 \textcolor{stringliteral}{            - wave       wavelength either in Angstrom (a float or a label: e.g., 5007, '5007A') }
02703 \textcolor{stringliteral}{                            or in micron (a label: '51.5m')}
02704 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
02705 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
02706 \textcolor{stringliteral}{                            }
02707 \textcolor{stringliteral}{        """}
02708         \textcolor{keywordflow}{if} str(wave)[-1] == \textcolor{stringliteral}{'A'}:
02709             inputWave = float(wave[:-1])
02710             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, wave)
02711             maxError = maxErrorA
02712         \textcolor{keywordflow}{elif} str(wave)[-1] == \textcolor{stringliteral}{'m'}:
02713             inputWave = float(wave[:-1]) * 1e4
02714             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, wave)
02715             maxError = maxErrorm
02716         \textcolor{keywordflow}{else}:
02717             inputWave = wave
02718             label = \textcolor{stringliteral}{'\{0\}\_\{1\}A'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, int(wave))
02719             maxError = maxErrorA
02720             
02721         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{in} label2levelDict:
02722             result = [label2levelDict[label][0], label2levelDict[label][1], inputWave, inputWave]
02723             return(result)
02724         
02725         j, i = np.unravel\_index(np.argmin(abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang} - inputWave)), self.wave\_Ang.shape)
02726         bestWave = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[i, j]
02727         error = np.abs(bestWave - inputWave) / inputWave
02728         result = [i + 1, j + 1, bestWave, inputWave]
02729         \textcolor{keywordflow}{if} error > maxError:
02730             self.log\_.warn(\textcolor{stringliteral}{'\_Transition: wavelengths differ by more than \{0:.2f\}%: input = \{1:.2f\}, output
       = \{2:.2f\}'}\(\backslash\)
02731                            .format(100 * maxError, inputWave, bestWave), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02732         return(result)
02733 
02734 
\hypertarget{pynebcore_8py_source_l02735}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ab7e0b11cdc85dade76528fe5de9886c0}{02735}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ab7e0b11cdc85dade76528fe5de9886c0}{getTotRecombination}(self, tem, den, method='linear'):
02736         \textcolor{stringliteral}{"""}
02737 \textcolor{stringliteral}{        Return the total recombination coefficient. The case (A or B) is set by selecting the corresponding
       trc file.}
02738 \textcolor{stringliteral}{        }
02739 \textcolor{stringliteral}{        Usage:}
02740 \textcolor{stringliteral}{            pn.atomicData.setDataFile('h\_i\_trc\_SH95-caseA.dat')}
02741 \textcolor{stringliteral}{            h1.getTotRecombination(tem=10000, den=5.e3)}
02742 \textcolor{stringliteral}{            }
02743 \textcolor{stringliteral}{        Parameters:}
02744 \textcolor{stringliteral}{            - tem, den  temperature and density}
02745 \textcolor{stringliteral}{            - method    interpolation method in the grid ('linear' = default, 'nearest', 'cubic')    }
02746 \textcolor{stringliteral}{                }
02747 \textcolor{stringliteral}{        """} 
02748         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling} = \textcolor{stringliteral}{'getTotRecombination'}
02749         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'trc'} \textcolor{keywordflow}{in} pn.atomicData.getDataFile()[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}].keys():
02750             \textcolor{keywordflow}{return} interpolate.griddata((self.lg\_den\_grid.ravel(), self.lg\_tem\_grid.ravel()), 
      self.alpha\_grid.ravel(), (np.log10(den), np.log10(tem)), method=method)
02751         \textcolor{keywordflow}{else}:
02752             self.log\_.warn(\textcolor{stringliteral}{'No recombination data available for \{0\} in the adopted dictionary (but data may
       exist: please query pn.atomicData.getAllAvailableFiles("<atom>") for trc files)'}.format(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02753             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02754         
02755         
\hypertarget{pynebcore_8py_source_l02756}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abc77497db8e5d888d8424e4a82d50c2e}{02756}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abc77497db8e5d888d8424e4a82d50c2e}{getTransition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
02757         \textcolor{stringliteral}{"""}
02758 \textcolor{stringliteral}{        Return the indexes (upper level, lower level) of a transition for a given atom }
02759 \textcolor{stringliteral}{            from the wavelength.}
02760 \textcolor{stringliteral}{        }
02761 \textcolor{stringliteral}{        Usage:}
02762 \textcolor{stringliteral}{            O3.getTransition(4959)}
02763 \textcolor{stringliteral}{            }
02764 \textcolor{stringliteral}{        Parameters:}
02765 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
02766 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
02767 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
02768 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
02769 \textcolor{stringliteral}{                }
02770 \textcolor{stringliteral}{        """} 
02771         res = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{\_Transition}(wave, maxErrorA = maxErrorA, maxErrorm = maxErrorm)
02772         return(res[0], res[1])
02773         
02774         
\hypertarget{pynebcore_8py_source_l02775}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_acdf8a7cf94fee8be8335e4651c318a30}{02775}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_acdf8a7cf94fee8be8335e4651c318a30}{printTransition}(self, wave):
02776         \textcolor{stringliteral}{"""}
02777 \textcolor{stringliteral}{        Print info on transition associated to input wavelength.}
02778 \textcolor{stringliteral}{        }
02779 \textcolor{stringliteral}{        Usage:}
02780 \textcolor{stringliteral}{            O3.printTransition(4959)}
02781 \textcolor{stringliteral}{            }
02782 \textcolor{stringliteral}{        Parameters:}
02783 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
02784 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
02785 \textcolor{stringliteral}{                }
02786 \textcolor{stringliteral}{        """}
02787         closestTransition = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{\_Transition}(wave)
02788         relativeError = closestTransition[3] / closestTransition[2] - 1
02789         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Input wave: \{0:.1F\}'}.format(closestTransition[3])
02790         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Closest wave found: \{0:.1F\}'}.format(closestTransition[2])
02791         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Relative error: \{0:.0E\} '}.format(relativeError)
02792         \textcolor{keywordflow}{print} \textcolor{stringliteral}{'Transition: \{0[0]\} -> \{0[1]\}'}.format(closestTransition)
02793         \textcolor{keywordflow}{return}
02794     
02795               
\hypertarget{pynebcore_8py_source_l02796}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0f7e0f80b7e0057d59d61676ff5a54c0}{02796}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0f7e0f80b7e0057d59d61676ff5a54c0}{printSources}(self):
02797         \textcolor{stringliteral}{"""}
02798 \textcolor{stringliteral}{        Print bibliographic sources for atomic data, as listed in the headers of the fits files.}
02799 \textcolor{stringliteral}{        }
02800 \textcolor{stringliteral}{        """}       
02801         header = pyfits.open(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath}, ignore\_missing\_end=\textcolor{keyword}{True})[1].header
02802         \textcolor{keywordflow}{for} record \textcolor{keywordflow}{in} header.items():
02803             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} record[0]:
02804                 number = record[0].lstrip(\textcolor{stringliteral}{'SOURCE'})
02805                 \textcolor{keywordflow}{try}:
02806                     \textcolor{keywordflow}{print} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} + \textcolor{stringliteral}{': '} + header.get(\textcolor{stringliteral}{'NOTE'} + str(number)) + \textcolor{stringliteral}{':'}, header.get(\textcolor{stringliteral}{'SOURCE
      '} + str(number))
02807                 \textcolor{keywordflow}{except}:
02808                     \textcolor{keywordflow}{print} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} + \textcolor{stringliteral}{': '} + \textcolor{stringliteral}{'Atomic data:'}, header.get(\textcolor{stringliteral}{'SOURCE'} + str(number))
02809 
02810 
\hypertarget{pynebcore_8py_source_l02811}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a664340029b0a067b459cae45e13d50c5}{02811}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a664340029b0a067b459cae45e13d50c5}{getEnergy}(self, level= -1, unit='1/Ang'):
02812         \textcolor{stringliteral}{"""}
02813 \textcolor{stringliteral}{        Return energy level of selected level (or array of energy levels, if level not given) }
02814 \textcolor{stringliteral}{            in Angstrom^-1 (default) or another unit}
02815 \textcolor{stringliteral}{        }
02816 \textcolor{stringliteral}{        Usage:}
02817 \textcolor{stringliteral}{            O3.getEnergy(4, unit='eV')}
02818 \textcolor{stringliteral}{        Parameters:}
02819 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
02820 \textcolor{stringliteral}{            - unit   [str] one of '1/Ang' (default), 'eV', or 'Ryd'    }
02821 \textcolor{stringliteral}{            }
02822 \textcolor{stringliteral}{        """}
02823         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a271f5e8992df0412c6fdca611ac87a5d}{\_test\_lev}(level)
02824 
02825         unit\_dict = \{\textcolor{stringliteral}{'1/Ang'}: 1.,
02826                      \textcolor{stringliteral}{'Ryd'}: pn.CST.RYD\_ANG,
02827                      \textcolor{stringliteral}{'eV'}: pn.CST.RYD\_ANG * pn.CST.RYD\_EV,
02828                      \textcolor{stringliteral}{'cm-1'}: 1e8\}
02829         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} unit\_dict:
02830             self.log\_.warn(\textcolor{stringliteral}{'Unit \{0\} unknown, using 1/Ang'}.format(unit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling} + \textcolor{stringliteral}{'.getEnergy'})
02831             unit = \textcolor{stringliteral}{'1/Ang'}        
02832         
02833         \textcolor{keywordflow}{if} level == -1:
02834             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy} * unit\_dict[unit]
02835         \textcolor{keywordflow}{else}:
02836             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy}[level-1] * unit\_dict[unit]
02837 
02838     
\hypertarget{pynebcore_8py_source_l02839}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_adcc9c72bd96e9064b01591d8b32112ea}{02839}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_adcc9c72bd96e9064b01591d8b32112ea}{\_checkLabel}(self, label):
02840         \textcolor{stringliteral}{"""}
02841 \textcolor{stringliteral}{        Return True if the label is compatible with the type of labels read form the data file}
02842 \textcolor{stringliteral}{        'transitions' labels are of the form "J\_I"}
02843 \textcolor{stringliteral}{        'wavelengths' labels are of the form "1234.5" (dot is mandatory)}
02844 \textcolor{stringliteral}{}
02845 \textcolor{stringliteral}{        """}
02846         \textcolor{keywordflow}{if} (\textcolor{stringliteral}{'\_'} \textcolor{keywordflow}{in} label) \textcolor{keywordflow}{and} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} == \textcolor{stringliteral}{'transitions'}):
02847             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
02848         \textcolor{keywordflow}{elif} (\textcolor{stringliteral}{'.'} \textcolor{keywordflow}{in} label) \textcolor{keywordflow}{and} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} == \textcolor{stringliteral}{'wavelengths'}):
02849             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
02850         \textcolor{keywordflow}{else}:
02851             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
02852    
02853             
\hypertarget{pynebcore_8py_source_l02854}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad235d43c967836595e501959f2c7c575}{02854}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad235d43c967836595e501959f2c7c575}{\_getLabelStr}(self, label):
02855         \textcolor{stringliteral}{"""}
02856 \textcolor{stringliteral}{        Returns a string containing the label. }
02857 \textcolor{stringliteral}{        If label is a float, it is transormed into a string .}
02858 \textcolor{stringliteral}{        If label is not in the self.labels list, None is returned}
02859 \textcolor{stringliteral}{}
02860 \textcolor{stringliteral}{        """}
02861         \textcolor{keywordflow}{if} np.isreal(label):
02862             label\_str = \textcolor{stringliteral}{'\{0:.1f\}'}.format(label)
02863         \textcolor{keywordflow}{else}:
02864             label\_str = str(label)
02865         \textcolor{keywordflow}{if} label\_str \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels}:
02866             pn.log\_.warn(\textcolor{stringliteral}{'Label \{0\} not in \{1\}.'}.format(label\_str, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02867             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02868         \textcolor{keywordflow}{else}:
02869             \textcolor{keywordflow}{return} label\_str
02870         
02871         
02872     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(self, tem, den, lev\_i=None, lev\_j=None, wave=None, label=None,
\hypertarget{pynebcore_8py_source_l02873}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{02873}                       method=\textcolor{stringliteral}{'linear'}, product=\textcolor{keyword}{True}):
02874         \textcolor{stringliteral}{"""}
02875 \textcolor{stringliteral}{        Return the emissivity of a recombination line. The arguments used to }
02876 \textcolor{stringliteral}{        define the line depend on whether the atom is an hydrogenoid or not. }
02877 \textcolor{stringliteral}{        In the first case, the transition can be specified either as a pair }
02878 \textcolor{stringliteral}{        of levels lev\_i, lev\_j or as a label. }
02879 \textcolor{stringliteral}{        In the second case, the transition can be specified either as a wavelength }
02880 \textcolor{stringliteral}{        or as a label.}
02881 \textcolor{stringliteral}{        In either case, enter <atom>.labels to display the valid labels.}
02882 \textcolor{stringliteral}{        }
02883 \textcolor{stringliteral}{        Usage:}
02884 \textcolor{stringliteral}{            H1 = pn.RecAtom('H', 1)}
02885 \textcolor{stringliteral}{            H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], lev\_i = 4, lev\_j = 2)}
02886 \textcolor{stringliteral}{            H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], label='4\_2', product=False)}
02887 \textcolor{stringliteral}{            tem = np.linspace(5000, 20000, 100)}
02888 \textcolor{stringliteral}{            den = np.logspace(2, 6, 100)}
02889 \textcolor{stringliteral}{            imHab = H1.getEmissivity(tem, den, label='3\_2') / H1.getEmissivity(tem, den, label='4\_2')}
02890 \textcolor{stringliteral}{}
02891 \textcolor{stringliteral}{            He1 = pn.RecAtom('He', 1)}
02892 \textcolor{stringliteral}{            He1.getEmissivity(1e4, 1e2, wave=4471.0)}
02893 \textcolor{stringliteral}{            He1.getEmissivity(1e4, 1e2, label='4471.0')}
02894 \textcolor{stringliteral}{            }
02895 \textcolor{stringliteral}{        Parameters:}
02896 \textcolor{stringliteral}{            - tem            temperature (K)}
02897 \textcolor{stringliteral}{            - den            density (cm-3)}
02898 \textcolor{stringliteral}{            - lev\_i, lev\_j   levels of the transition}
02899 \textcolor{stringliteral}{            - wave           wavelength of the transition}
02900 \textcolor{stringliteral}{            - label          label of the transition (e.g. "50\_3", "1234.5")}
02901 \textcolor{stringliteral}{            - method         interpolation method ('linear', 'nearest', 'cubic'), }
02902 \textcolor{stringliteral}{                             sent to scipy.interpolate.griddata    }
02903 \textcolor{stringliteral}{            - product        Boolean. If True (default), all the combination of (tem, den) are used. }
02904 \textcolor{stringliteral}{                             If False, tem and den must have the same size and are joined.}
02905 \textcolor{stringliteral}{        """}
02906         
02907         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} pn.config.INSTALLED[\textcolor{stringliteral}{'scipy'}]:
02908             pn.log\_.error(\textcolor{stringliteral}{'Scipy not installed, no RecAtom emissivities available'},
02909                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02910             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02911         tem = np.asarray(tem)
02912         den = np.asarray(den)
02913         \textcolor{keywordflow}{if} product:
02914             \textcolor{keywordflow}{if} tem.size == 1 \textcolor{keywordflow}{or} den.size == 1:
02915                 temg = tem
02916                 deng = den
02917             \textcolor{keywordflow}{else}:
02918                 temg, deng = np.meshgrid(tem, den)
02919         \textcolor{keywordflow}{else}:
02920             \textcolor{keywordflow}{if} tem.size != den.size:
02921                 pn.log\_.error(\textcolor{stringliteral}{'tem and den must have the same size'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02922                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02923             \textcolor{keywordflow}{else}:
02924                 temg = tem
02925                 deng = den
02926         \textcolor{keywordflow}{if} (lev\_i \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (lev\_j \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
02927             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(lev\_i, lev\_j)
02928         \textcolor{keywordflow}{if} wave \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
02929             label = \textcolor{stringliteral}{'\{0:.1f\}'}.format(wave)
02930         label\_str = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad235d43c967836595e501959f2c7c575}{\_getLabelStr}(label)
02931         \textcolor{keywordflow}{if} label\_str \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02932             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02933         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_adcc9c72bd96e9064b01591d8b32112ea}{\_checkLabel}(label\_str):
02934             pn.log\_.warn(\textcolor{stringliteral}{'Wrong label \{0\}'}.format(label\_str), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02935             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02936         enu = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[label\_str]
02937             
02938         logd = np.log10(deng)
02939         temp\_min = np.min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{temp})
02940         temp\_max = np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{temp})
02941         log\_dens\_min = np.min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{log\_dens})
02942         log\_dens\_max = np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{log\_dens})
02943         tt = (logd < log\_dens\_min)
02944         \textcolor{keywordflow}{if} np.ndim(logd) == 0: 
02945             \textcolor{keywordflow}{if} tt == \textcolor{keyword}{True}:
02946                 logd = log\_dens\_min
02947         \textcolor{keywordflow}{else}:
02948             logd[tt] = log\_dens\_min
02949         tt = (logd > log\_dens\_max)
02950         \textcolor{keywordflow}{if} np.ndim(logd) == 0:
02951             \textcolor{keywordflow}{if} tt == \textcolor{keyword}{True}:
02952                 logd = log\_dens\_max
02953         \textcolor{keywordflow}{else}:
02954             logd[tt] = log\_dens\_max
02955         res = interpolate.griddata((self.temp.ravel(), self.log\_dens.ravel()), enu.ravel(),
02956                                    (temg, logd), method=method)
02957         \textcolor{keywordflow}{return} res.T
02958 
02959 
02960     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a250ec6b99eedd84bdb8eae97cbd4beef}{getIonAbundance}(self, int\_ratio, tem, den, lev\_i= -1, lev\_j= -1, wave= -1, 
      label=None,
\hypertarget{pynebcore_8py_source_l02961}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a250ec6b99eedd84bdb8eae97cbd4beef}{02961}                         to\_eval=\textcolor{keywordtype}{None}, Hbeta=100.):
02962         \textcolor{stringliteral}{"""}
02963 \textcolor{stringliteral}{        Compute the ionic abundance relative to H+ given the temperature, the density and the }
02964 \textcolor{stringliteral}{            intensity of a line or sum of lines.}
02965 \textcolor{stringliteral}{        The arguments used to define the line depend on whether the atom is an hydrogenoid or not. }
02966 \textcolor{stringliteral}{        For hydrogenoids, the transition can be specified either as a pair of levels }
02967 \textcolor{stringliteral}{            lev\_i, lev\_j, as a label, or as an I-type expression as the argument of to\_eval }
02968 \textcolor{stringliteral}{            (e.g. to\_eval='I(50, 19)' for the 50->19 transition). Wavelengths or L-type expressions }
02969 \textcolor{stringliteral}{            will not work in this case. }
02970 \textcolor{stringliteral}{        For non-hydrogenoids, the transition can be specified either as an integer wavelength, }
02971 \textcolor{stringliteral}{            as a label, or as an A-type expression as the argument of to\_eval (e.g. to\_eval='A(4471)' }
02972 \textcolor{stringliteral}{            for the lambda=4471 transition). Note that all these alternatives imply that the wavelength}
02973 \textcolor{stringliteral}{            is known. Pairs of levels and I or L-type expressions would not work.}
02974 \textcolor{stringliteral}{}
02975 \textcolor{stringliteral}{        The preferred method are the label and the I-type expressions, as the remaining parameters }
02976 \textcolor{stringliteral}{            are inherently fragile.}
02977 \textcolor{stringliteral}{}
02978 \textcolor{stringliteral}{        Usage:}
02979 \textcolor{stringliteral}{            He2.getIonAbundance(130, 1.5e4, 100., lev\_i=5, lev\_j=4)}
02980 \textcolor{stringliteral}{            He2.getIonAbundance(130, 1.5e4, 100., label="5\_4")}
02981 \textcolor{stringliteral}{            He2.getIonAbundance(130, 1.5e4, 100., to\_eval='I(4,3) + I(4,2)')}
02982 \textcolor{stringliteral}{            He1.getIonAbundance(100, 1.5e4, 100., wave=5016)}
02983 \textcolor{stringliteral}{            He1.getIonAbundance(100, 1.5e4, 100., label="5016.0")}
02984 \textcolor{stringliteral}{            He1.getIonAbundance(100, 1.5e4, 100., to\_eval='A(5016)')}
02985 \textcolor{stringliteral}{            He1.getIonAbundance(np.array([100, 150]), np.array([1.5e4, 1.2e4]), np.array([100., 120]), }
02986 \textcolor{stringliteral}{                label="10830.0")}
02987 \textcolor{stringliteral}{            }
02988 \textcolor{stringliteral}{        Parameters:}
02989 \textcolor{stringliteral}{            - int\_ratio    relative line intensity (default normalization: Hbeta = 100). }
02990 \textcolor{stringliteral}{                            May be an array.}
02991 \textcolor{stringliteral}{            - tem          electronic temperature in K. May be an array.}
02992 \textcolor{stringliteral}{            - den          electronic density in cm^-3. May be an array.}
02993 \textcolor{stringliteral}{            - lev\_i        upper level of transition}
02994 \textcolor{stringliteral}{            - lev\_j        lower level of transition}
02995 \textcolor{stringliteral}{            - wave         wavelength of transition. Takes precedence on lev\_i and lev\_j if set, }
02996 \textcolor{stringliteral}{                            ignored otherwise }
02997 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated. Takes precedence on wave if set, }
02998 \textcolor{stringliteral}{                            ignored otherwise.}
02999 \textcolor{stringliteral}{            - Hbeta        line intensity normalization at Hbeta (default Hbeta = 100)}
03000 \textcolor{stringliteral}{}
03001 \textcolor{stringliteral}{        }
03002 \textcolor{stringliteral}{        """}
03003         \textcolor{keywordflow}{if} np.ndim(tem) != np.ndim(den):
03004             self.log\_.error(\textcolor{stringliteral}{'ten and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03005             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03006         \textcolor{keywordflow}{if} ((np.squeeze(np.asarray(int\_ratio)).shape != np.squeeze(np.asarray(tem)).shape) | 
03007             (np.squeeze(np.asarray(den)).shape != np.squeeze(np.asarray(tem)).shape)):
03008             self.log\_.warn(\textcolor{stringliteral}{'int\_ratio, tem and den must does not have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03009         \textcolor{keywordflow}{if} (lev\_i == -1) & (lev\_j == -1) & (wave == -1) & (to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}) & (label \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}):
03010             self.log\_.error(\textcolor{stringliteral}{'At least one of lev\_i, lev\_j, or wave, or to\_eval must be supplied'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03011             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03012         \textcolor{keywordflow}{if} to\_eval == \textcolor{keywordtype}{None}:
03013             \textcolor{keywordflow}{if} wave != -1:
03014                 to\_eval = \textcolor{stringliteral}{'L(\{0\})'}.format(wave)
03015             \textcolor{keywordflow}{elif} label \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03016                 to\_eval = \textcolor{stringliteral}{'A("\{0\}")'}.format(label)
03017             \textcolor{keywordflow}{else}:
03018                 to\_eval = \textcolor{stringliteral}{'I(\{0\}, \{1\})'}.format(lev\_i, lev\_j)
03019         I = \textcolor{keyword}{lambda} lev\_i, lev\_j: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(tem, den, lev\_i, lev\_j, product=\textcolor{keyword}{False})
03020         L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(tem, den, wave=wave, product=\textcolor{keyword}{False})
03021         A = \textcolor{keyword}{lambda} label: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(tem, den, label=label, product=\textcolor{keyword}{False})
03022         \textcolor{keywordflow}{try}:
03023             emis = eval(to\_eval)
03024         \textcolor{keywordflow}{except}:
03025             self.log\_.error(\textcolor{stringliteral}{'Unable to eval \{0\}'}.format(to\_eval), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03026             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03027         \textcolor{comment}{#int\_ratio is in units of Hb = Hbeta keyword}
03028         ionAbundance = ((int\_ratio / Hbeta) * (\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{getRecEmissivity}(tem, den, 4, 2, atom=\textcolor{stringliteral}{'H1'}, 
      product=\textcolor{keyword}{False}) / emis))
03029         \textcolor{keywordflow}{return} ionAbundance
03030     
03031     
\hypertarget{pynebcore_8py_source_l03032}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a7bed1e9b39a55269b74b2aeb455b819c}{03032}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a7bed1e9b39a55269b74b2aeb455b819c}{\_\_repr\_\_}(self):
03033         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Atom \{0\}\{1\} from \{2\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile})
03034         
03035 
\hypertarget{pynebcore_8py_source_l03036}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{03036} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{getRecEmissivity}(tem, den, lev\_i=None, lev\_j=None, atom='H1', method='linear', 
      wave=None, product=True):
03037     \textcolor{stringliteral}{"""}
03038 \textcolor{stringliteral}{    The function instantiates a RecAtom and store it into pn.atomicData.\_RecombData for a further use.}
03039 \textcolor{stringliteral}{    More possibilities are obtained using the RecAtom class.}
03040 \textcolor{stringliteral}{}
03041 \textcolor{stringliteral}{    Usage:}
03042 \textcolor{stringliteral}{        print getRecEmissivity(1e4, 1e3, 3, 2, atom='H1') / getRecEmissivity(1e4, 1e3, 4, 2, atom='H1')  }
03043 \textcolor{stringliteral}{            # return Ha/Hb }
03044 \textcolor{stringliteral}{}
03045 \textcolor{stringliteral}{    Parameters:}
03046 \textcolor{stringliteral}{        - tem           temperature in K}
03047 \textcolor{stringliteral}{        - den           density in cm-3}
03048 \textcolor{stringliteral}{        - lev\_i, lev\_j  levels (lev\_i>lev\_j, i\_min=1)}
03049 \textcolor{stringliteral}{        - atom          atom (e.g. 'H1', 'He1')}
03050 \textcolor{stringliteral}{        - method        interpolation method ('linear', 'nearest', 'cubic'), sent to
       scipy.interpolate.griddata}
03051 \textcolor{stringliteral}{        - wave          alternative way of identifying emision line.}
03052 \textcolor{stringliteral}{        }
03053 \textcolor{stringliteral}{    """}
03054     calling = \textcolor{stringliteral}{'getRecEmissivity'}
03055     
03056     \textcolor{keywordflow}{if} pn.config.INSTALLED[\textcolor{stringliteral}{'scipy'}]:
03057         elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)
03058     
03059         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} pn.atomicData.\_RecombData:
03060             pn.atomicData.\_RecombData[atom] = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{RecAtom}(elem, spec)
03061         \textcolor{keywordflow}{return} pn.atomicData.\_RecombData[atom].getEmissivity(tem=tem, den=den, lev\_i=lev\_i, lev\_j=lev\_j,
03062                                                              method=method, wave=wave, product=product)
03063     \textcolor{keywordflow}{else}:
03064         \textcolor{keywordflow}{if} (atom == \textcolor{stringliteral}{'H1'}) \textcolor{keywordflow}{and} (lev\_i == 4) \textcolor{keywordflow}{and} (lev\_j == 2):
03065             pn.log\_.warn(\textcolor{stringliteral}{'Scipy is missing, \{0\} returning Hbeta'}.format(calling), calling)
03066             \textcolor{keywordflow}{return} \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a027537ead17492a35c3e4e940cd95223}{getHbEmissivity}(tem)
03067         \textcolor{keywordflow}{else}:
03068             pn.log\_.error(\textcolor{stringliteral}{'Only Hbeta emissivity available, as scipy not installed'}, calling)
03069 
03070 
\hypertarget{pynebcore_8py_source_l03071}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a027537ead17492a35c3e4e940cd95223}{03071} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a027537ead17492a35c3e4e940cd95223}{getHbEmissivity}(tem= -1):
03072     \textcolor{stringliteral}{""" }
03073 \textcolor{stringliteral}{    Compute Hbeta emissivity in erg/s/(N(H+)*N(e-)) for a given temperature with the formula }
03074 \textcolor{stringliteral}{        by Aller (1984)}
03075 \textcolor{stringliteral}{}
03076 \textcolor{stringliteral}{    Usage:}
03077 \textcolor{stringliteral}{        getHbemissivity(tem=10000)}
03078 \textcolor{stringliteral}{}
03079 \textcolor{stringliteral}{    Parameters:}
03080 \textcolor{stringliteral}{        - tem     electronic temperature in K}
03081 \textcolor{stringliteral}{}
03082 \textcolor{stringliteral}{    """} 
03083     tem4 = np.asarray(tem) * 1.0e-4
03084     j\_hb = 1.387 / pow(tem4, 0.983) / pow(10., 0.0424 / tem4) * 1.e-25
03085 
03086     \textcolor{comment}{# Remove jhb for tem4 < 0 or tem4 > 1e2}
03087     ((tem4 < 0.) | (tem4 > 1e2)).choose(j\_hb, -1)
03088 
03089     \textcolor{keywordflow}{return} j\_hb
03090 
03091 
\hypertarget{pynebcore_8py_source_l03092}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a4e1b2e2f554c7c9c0b76419a45b2ee59}{03092} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a4e1b2e2f554c7c9c0b76419a45b2ee59}{getAtomDict}(atom\_list=None, elem\_list=None, spec\_list=None, **kwargs):
03093     \textcolor{stringliteral}{""" }
03094 \textcolor{stringliteral}{    Initializes all atoms, according to the atomic files available.}
03095 \textcolor{stringliteral}{    The elem objects are given conventional names elem+spec (e.g., O III is O3)}
03096 \textcolor{stringliteral}{}
03097 \textcolor{stringliteral}{    Usage:}
03098 \textcolor{stringliteral}{        all = pn.getAtomDict()}
03099 \textcolor{stringliteral}{        print all['S2'].name}
03100 \textcolor{stringliteral}{        some = pn.getAtomDict(elem\_list=['C', 'N', 'O'])}
03101 \textcolor{stringliteral}{        some = pn.getAtomDict(atom\_list=['O2', 'O3', 'Ar3'])}
03102 \textcolor{stringliteral}{    }
03103 \textcolor{stringliteral}{    Parameters:}
03104 \textcolor{stringliteral}{        - atom\_list     a list of the ions for which the elem is to be computed }
03105 \textcolor{stringliteral}{                        Takes precedence on elem\_list and spec\_list}
03106 \textcolor{stringliteral}{        - elem\_list     a list of all the elements for which the elem is to be computed (all by default)}
03107 \textcolor{stringliteral}{        - spec\_list     a list of the spectra for which the elem is to be computed (all by default)}
03108 \textcolor{stringliteral}{        \_ **kwargs      argumentas passed to Atom, e.g. OmegaInterp}
03109 \textcolor{stringliteral}{}
03110 \textcolor{stringliteral}{    """} 
03111     all\_atoms = \{\}
03112 
03113     \textcolor{keywordflow}{if} atom\_list \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:       
03114         \textcolor{keywordflow}{if} spec\_list \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03115             spec\_list = SPEC\_LIST
03116         \textcolor{keywordflow}{if} elem\_list \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03117             atom\_list = pn.atomicData.getAllAtoms()
03118         \textcolor{keywordflow}{else}:
03119             atom\_list = []
03120             \textcolor{keywordflow}{for} elem \textcolor{keywordflow}{in} elem\_list:
03121                 \textcolor{keywordflow}{for} spec \textcolor{keywordflow}{in} spec\_list:
03122                     atom\_list.append(elem + str(spec)) 
03123 
03124     \textcolor{keywordflow}{for} atom \textcolor{keywordflow}{in} atom\_list:
03125         elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(atom)        
03126         \textcolor{keywordflow}{try}:
03127             all\_atoms[atom] = pn.Atom(elem, spec, **kwargs)
03128             pn.log\_.message(\textcolor{stringliteral}{'Including '} + atom, calling=\textcolor{stringliteral}{'getAtomDict'})
03129         \textcolor{keywordflow}{except}:
03130             pn.log\_.message(atom + \textcolor{stringliteral}{' not found'}, calling=\textcolor{stringliteral}{'getAtomDict'})
03131     \textcolor{keywordflow}{return} all\_atoms
03132 
03133 
\hypertarget{pynebcore_8py_source_l03134}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{03134} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{getLineLabel}(elem, spec, wave, blend=False):
03135     \textcolor{stringliteral}{"""}
03136 \textcolor{stringliteral}{    Build a line label in the standard PyNeb format. Return atom\_label, wave\_label, and line\_label }
03137 \textcolor{stringliteral}{            (strings representing the atom and wave fragments of the line label and the }
03138 \textcolor{stringliteral}{                complete line label)}
03139 \textcolor{stringliteral}{    }
03140 \textcolor{stringliteral}{    Parameters:}
03141 \textcolor{stringliteral}{        - elem      symbol of the selected element}
03142 \textcolor{stringliteral}{        - spec      ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
03143 \textcolor{stringliteral}{        - wave      wavelength of the line}
03144 \textcolor{stringliteral}{        - blend     blend flag (default = False)}
03145 \textcolor{stringliteral}{}
03146 \textcolor{stringliteral}{    @see parseLineLabel}
03147 \textcolor{stringliteral}{    }
03148 \textcolor{stringliteral}{    """}    
03149     \textcolor{keywordflow}{if} isinstance(wave, str):
03150         wave\_label = wave
03151     \textcolor{keywordflow}{else}:
03152         wave4 = wave / 1.e4
03153         \textcolor{keywordflow}{if} wave < 10000.:
03154             wave\_label = \textcolor{stringliteral}{"\{0:.0f\}A"}.format(wave)
03155         \textcolor{keywordflow}{else}:
03156             wave\_label = \textcolor{stringliteral}{"\{0:.1f\}m"}.format(wave4)
03157     atom\_label = elem + str(spec)
03158     \textcolor{keywordflow}{if} blend:
03159         blend\_flag = \textcolor{stringliteral}{'+'}
03160     \textcolor{keywordflow}{else}:
03161         blend\_flag = \textcolor{stringliteral}{''}
03162     line\_label = atom\_label + \textcolor{stringliteral}{'\_'} + wave\_label + blend\_flag
03163 
03164     \textcolor{keywordflow}{return} atom\_label, wave\_label, line\_label
03165 
03166 
\hypertarget{pynebcore_8py_source_l03167}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a9fa8b0b7efdd4da21a816641bf17dcc7}{03167} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a9fa8b0b7efdd4da21a816641bf17dcc7}{parseLineLabel}(lineLabel):
03168     \textcolor{stringliteral}{"""}
03169 \textcolor{stringliteral}{    Parse the line label to extract the substrings referring to the atom (elem, spec and atom)}
03170 \textcolor{stringliteral}{    and the numerical value of the wave}
03171 \textcolor{stringliteral}{    }
03172 \textcolor{stringliteral}{    Parameters:}
03173 \textcolor{stringliteral}{        - label    line label in the standard PyNeb format}
03174 \textcolor{stringliteral}{    }
03175 \textcolor{stringliteral}{    Returns:}
03176 \textcolor{stringliteral}{        - elem, spec, atom\_label, wave, wave\_label, blend  strings containing the elem, spec, atom and }
03177 \textcolor{stringliteral}{                                                              wave; numerical value of the wave, }
03178 \textcolor{stringliteral}{                                                              in Angstrom; and blend flag }
03179 \textcolor{stringliteral}{    """}
03180     \textcolor{comment}{##}
03181     \textcolor{comment}{# @todo maybe rearrange the order so 1) it is compatible with getLineLabel, or 2) it lists all the
       strings first }
03182 
03183     \textcolor{comment}{# determine if the line is a blend or not}
03184     \textcolor{keywordflow}{if} lineLabel[-1] == \textcolor{stringliteral}{'+'}  \textcolor{keywordflow}{or} lineLabel[-2] == \textcolor{stringliteral}{'+'}:
03185         blend = \textcolor{keyword}{True}
03186     \textcolor{keywordflow}{else}:
03187         blend = \textcolor{keyword}{False}
03188     \textcolor{comment}{# extract information on the atom}
03189     elem\_spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel, \textcolor{stringliteral}{' '}, \textcolor{stringliteral}{'\_'})
03190     elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a8c069186002a3e73dd474958e35034d5}{parseAtom}(elem\_spec)
03191     atom\_label = elem + str(spec)
03192     \textcolor{keywordflow}{if} len(elem\_spec) > 0:
03193         \textcolor{keywordflow}{if} elem\_spec[-1] == \textcolor{stringliteral}{'}\textcolor{stringliteral}{r':}
03194 \textcolor{stringliteral}{            atom\_label += }\textcolor{stringliteral}{'}\textcolor{stringliteral}{r'}
03195 \textcolor{stringliteral}{    }\textcolor{comment}{# extract information on the wave}
03196     \textcolor{keywordflow}{if} blend:
03197         \textcolor{keywordflow}{try}:
03198             wave = float(\hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel[:-2], \textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{' '}))
03199         \textcolor{keywordflow}{except}:
03200             wave = 0.
03201     \textcolor{keywordflow}{else}:
03202         \textcolor{keywordflow}{try}:
03203             wave = float(\hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel[:-1], \textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{' '}))
03204         \textcolor{keywordflow}{except}:
03205             wave = 0.
03206     wave\_label = \hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel, \textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{' '})
03207     \textcolor{keywordflow}{if} lineLabel[-1] == \textcolor{stringliteral}{'m'}:
03208         wave = wave * 1.e4
03209     
03210     \textcolor{keywordflow}{return} elem, spec, atom\_label, wave, wave\_label, blend
03211 
03212     
\hypertarget{pynebcore_8py_source_l03213}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a3bc988a0c3e90099888bef4e59f882b1}{03213} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a3bc988a0c3e90099888bef4e59f882b1}{isValid}(line\_label):
03214     \textcolor{stringliteral}{"""}
03215 \textcolor{stringliteral}{    Return True if the line label correspond to a valid line from LINE\_LABEL\_LIST or BLEND\_LIST}
03216 \textcolor{stringliteral}{    }
03217 \textcolor{stringliteral}{    Usage:}
03218 \textcolor{stringliteral}{        isValid('O3\_5007A')}
03219 \textcolor{stringliteral}{}
03220 \textcolor{stringliteral}{    Parameters:}
03221 \textcolor{stringliteral}{        - line\_label    label to be tested}
03222 \textcolor{stringliteral}{}
03223 \textcolor{stringliteral}{    """}
03224     elem, spec, atom, wave, waveLabel, blend = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a9fa8b0b7efdd4da21a816641bf17dcc7}{parseLineLabel}(line\_label)
03225     \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{in} LINE\_LABEL\_LIST:
03226             \textcolor{keywordflow}{if} (waveLabel \textcolor{keywordflow}{in} LINE\_LABEL\_LIST[atom]) \textcolor{keywordflow}{or} (line\_label \textcolor{keywordflow}{in} BLEND\_LIST):
03227                 is\_valid = \textcolor{keyword}{True}
03228             \textcolor{keywordflow}{else}:
03229                 is\_valid = \textcolor{keyword}{False}
03230     \textcolor{keywordflow}{else}:
03231         is\_valid = \textcolor{keyword}{False}
03232     \textcolor{keywordflow}{return} is\_valid
03233 
03234 
\hypertarget{pynebcore_8py_source_l03235}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{03235} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{EmissionLine}(object):
03236     \textcolor{stringliteral}{"""}
03237 \textcolor{stringliteral}{    Define the emission line object, which is defined by the line parameters and the intensity }
03238 \textcolor{stringliteral}{        parameters.}
03239 \textcolor{stringliteral}{    The line parameters define the emitting ion, the wavelength or the transition, the label }
03240 \textcolor{stringliteral}{        in PyNeb format, and a flag defining whether the line is a blend or a single transition. }
03241 \textcolor{stringliteral}{    The intensity parameters describe the observed intensity, the observed uncertainty and }
03242 \textcolor{stringliteral}{        the corrected uncertainty}
03243 \textcolor{stringliteral}{        }
03244 \textcolor{stringliteral}{    Usage:}
03245 \textcolor{stringliteral}{        line = pn.EmissionLine('O', 3, 5007, obsIntens=[1.4, 1.3])}
03246 \textcolor{stringliteral}{        line = pn.EmissionLine(label = 'O3\_5007A', obsIntens=320, corrected = True)}
03247 \textcolor{stringliteral}{    }
03248 \textcolor{stringliteral}{    Parameters:}
03249 \textcolor{stringliteral}{        - elem        symbol of the selected element}
03250 \textcolor{stringliteral}{        - spec        ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
03251 \textcolor{stringliteral}{        - wave        wavelength of the line}
03252 \textcolor{stringliteral}{        - blend       blend flag (boolean)}
03253 \textcolor{stringliteral}{        - to\_eval     algebraic expression describing the emission line in terms of single transitions}
03254 \textcolor{stringliteral}{        - label       line label in the standard PyNeb format}
03255 \textcolor{stringliteral}{        - obsIntens   observed intensity}
03256 \textcolor{stringliteral}{        - obsError    uncertainty on the observed intensity}
03257 \textcolor{stringliteral}{    }
03258 \textcolor{stringliteral}{    """} 
03259     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4966db926181349d90594f0b6d170c45}{\_\_init\_\_}(self, elem=None, spec=None, wave=None, blend=False, to\_eval=None, label=None,
\hypertarget{pynebcore_8py_source_l03260}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4966db926181349d90594f0b6d170c45}{03260}                  obsIntens=\textcolor{keywordtype}{None}, obsError=\textcolor{keywordtype}{None}, corrected=\textcolor{keyword}{False}, \_unit=\textcolor{keywordtype}{None}):
03261         
\hypertarget{pynebcore_8py_source_l03262}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a85c9edd5e884b93ab84fd6507159e401}{03262}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a85c9edd5e884b93ab84fd6507159e401}{log\_} = pn.log\_ 
\hypertarget{pynebcore_8py_source_l03263}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{03263}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling} = \textcolor{stringliteral}{'EmissionLine'}
\hypertarget{pynebcore_8py_source_l03264}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{03264}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected} = corrected
03265         
03266         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l03267}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{03267}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{elem} = elem
\hypertarget{pynebcore_8py_source_l03268}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{03268}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{spec} = int(spec)
\hypertarget{pynebcore_8py_source_l03269}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{03269}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{elem} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{spec})
\hypertarget{pynebcore_8py_source_l03270}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{03270}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave} = wave
\hypertarget{pynebcore_8py_source_l03271}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{03271}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{blend} = blend
\hypertarget{pynebcore_8py_source_l03272}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{03272}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}, self.waveLabel, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label} = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{getLineLabel}(elem, spec, wave, 
      blend)
03273         \textcolor{keywordflow}{else}:
03274             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label} = label
03275             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{spec}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave}, self.waveLabel, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{blend} = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a9fa8b0b7efdd4da21a816641bf17dcc7}{parseLineLabel}(label)
03276             \textcolor{keywordflow}{if} wave \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03277                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave} = wave
03278 
03279         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom} \textcolor{keywordflow}{in} LINE\_LABEL\_LIST:
03280             \textcolor{keywordflow}{if} (self.waveLabel \textcolor{keywordflow}{in} LINE\_LABEL\_LIST[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}]) \textcolor{keywordflow}{or} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label} \textcolor{keywordflow}{in} BLEND\_LIST):
\hypertarget{pynebcore_8py_source_l03281}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{03281}                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{is\_valid} = \textcolor{keyword}{True}
03282                 \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03283                     \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{blend}:
\hypertarget{pynebcore_8py_source_l03284}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{03284}                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = BLEND\_LIST[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label}]
03285                     \textcolor{keywordflow}{else}: 
03286                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = \textcolor{stringliteral}{'L('} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave}) + \textcolor{stringliteral}{')'}
03287                 \textcolor{keywordflow}{else}:
03288                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = to\_eval
03289             \textcolor{keywordflow}{else}:
03290                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{is\_valid} = \textcolor{keyword}{False}
03291                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = \textcolor{keywordtype}{None}
03292                 self.log\_.warn(\textcolor{stringliteral}{'line \{0\} for atom \{1\} not valid'}.format(self.waveLabel, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling})
03293         \textcolor{keywordflow}{else}:
03294                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{is\_valid} = \textcolor{keyword}{False}
03295                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = \textcolor{keywordtype}{None}
03296                 self.log\_.warn(\textcolor{stringliteral}{'Atom \{0\} not valid'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling})
03297             
03298             
\hypertarget{pynebcore_8py_source_l03299}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{03299}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens} = np.asarray(obsIntens, dtype=float)
03300         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected}:
\hypertarget{pynebcore_8py_source_l03301}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{03301}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.asarray(obsIntens, dtype=float)
03302         \textcolor{keywordflow}{else}:
03303             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.zeros\_like(obsIntens)
03304             
03305         \textcolor{comment}{# the following is not public, as we still have to think about it. }
03306         \textcolor{comment}{# Don't une it...}
\hypertarget{pynebcore_8py_source_l03307}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a87753879f7fa6ac6a40e05bc0e5c3c72}{03307}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a87753879f7fa6ac6a40e05bc0e5c3c72}{\_obsIntens\_n} = np.zeros\_like(obsIntens)
\hypertarget{pynebcore_8py_source_l03308}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_aa1f44ce8f6be439b590589c08da84fc2}{03308}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_aa1f44ce8f6be439b590589c08da84fc2}{\_corrIntens\_n} = np.zeros\_like(obsIntens)
\hypertarget{pynebcore_8py_source_l03309}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1828e90dccac2948129b7052c54eedf5}{03309}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1828e90dccac2948129b7052c54eedf5}{\_unit} = \_unit
03310 
03311         \textcolor{keywordflow}{if} obsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l03312}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{03312}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.zeros\_like(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens})
03313         \textcolor{keywordflow}{else}:
03314             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.asarray(obsError, dtype=float)
03315 
03316         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected}:
\hypertarget{pynebcore_8py_source_l03317}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{03317}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.asarray(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}, dtype=float)
03318         \textcolor{keywordflow}{else}:
03319             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.zeros\_like(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError})
03320     \textcolor{comment}{##            }
03321     \textcolor{comment}{# @var elem}
03322     \textcolor{comment}{# Symbol of the element}
03323 
03324     
\hypertarget{pynebcore_8py_source_l03325}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a7e915a1443ed01912b44052900b2e581}{03325}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a7e915a1443ed01912b44052900b2e581}{correctIntens}(self, RC, normWave=None):
03326         \textcolor{stringliteral}{"""}
03327 \textcolor{stringliteral}{        Correct from extinction. The corrIntens and corrError values of the line }
03328 \textcolor{stringliteral}{        are updated according to the RedCorr object}
03329 \textcolor{stringliteral}{}
03330 \textcolor{stringliteral}{}
03331 \textcolor{stringliteral}{        Parameters:}
03332 \textcolor{stringliteral}{            - RC        an instantiation of the pn.RedCorr class }
03333 \textcolor{stringliteral}{            - normWave  a wavelength for the normalisation of the correction, e.g. 4861.  }
03334 \textcolor{stringliteral}{}
03335 \textcolor{stringliteral}{        """}
03336         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(RC, pn.RedCorr):
03337             pn.log\_.error(\textcolor{stringliteral}{'Trying to correct with something that is not a RedCor object'},
03338                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling})
03339             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03340         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave} > 0.0:
03341             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens} * RC.getCorr(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave}, normWave)     
03342         \textcolor{keywordflow}{else}:
03343             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens}
03344         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}
03345         
03346         
\hypertarget{pynebcore_8py_source_l03347}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1669e4e38ca70d04d3a1395bd6bf237e}{03347}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1669e4e38ca70d04d3a1395bd6bf237e}{addObs}(self, newObsIntens, newObsError=None):
03348         \textcolor{stringliteral}{"""}
03349 \textcolor{stringliteral}{        Add observed values to an existing line. }
03350 \textcolor{stringliteral}{        }
03351 \textcolor{stringliteral}{        Parameters:}
03352 \textcolor{stringliteral}{            - newObsIntens    observed intensity of the line}
03353 \textcolor{stringliteral}{            - newObsError     error on the observed intensity (optional)}
03354 \textcolor{stringliteral}{            }
03355 \textcolor{stringliteral}{        """}
03356         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens}, newObsIntens)
03357         \textcolor{keywordflow}{if} newObsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03358             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}, np.zeros\_like(newObsIntens))
03359         \textcolor{keywordflow}{else}:
03360             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}, newObsError)
03361         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected}:
03362             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens}, newObsIntens)
03363             \textcolor{keywordflow}{if} newObsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03364                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError}, np.zeros\_like(newObsIntens))
03365             \textcolor{keywordflow}{else}:
03366                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError}, newObsError) 
03367         \textcolor{keywordflow}{else}:
03368             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens}, np.zeros\_like(newObsIntens))
03369             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError}, np.zeros\_like(newObsIntens))
03370     
03371     
\hypertarget{pynebcore_8py_source_l03372}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ad562f9a16ec0a02822e34e98b9329e0e}{03372}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ad562f9a16ec0a02822e34e98b9329e0e}{printLine}(self):
03373         \textcolor{stringliteral}{"""}
03374 \textcolor{stringliteral}{        Provide information on the line: atom, label, to\_eval, as well as the intensities and errors}
03375 \textcolor{stringliteral}{        }
03376 \textcolor{stringliteral}{        Usage:}
03377 \textcolor{stringliteral}{            line.printLine()}
03378 \textcolor{stringliteral}{            }
03379 \textcolor{stringliteral}{        """}
03380         print(\textcolor{stringliteral}{"""Line \{0.atom\} \{0.label\} evaluated as \{0.to\_eval\}}
03381 \textcolor{stringliteral}{Observed intensity: \{0.obsIntens\}}
03382 \textcolor{stringliteral}{Observed error: \{0.obsError\}}
03383 \textcolor{stringliteral}{Corrected intensity: \{0.corrIntens\}}
03384 \textcolor{stringliteral}{Corrected error: \{0.corrError\}"""}.format(self))
03385      
03386      
\hypertarget{pynebcore_8py_source_l03387}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ab3e51046d3969f5a72dec03bdba238c2}{03387}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ab3e51046d3969f5a72dec03bdba238c2}{\_\_repr\_\_}(self):
03388         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Line \{0.atom\} \{0.label\}'}.format(self)
03389 
03390 
\hypertarget{pynebcore_8py_source_l03391}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation}{03391} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation}{Observation}(object):
03392     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a4f72b542ac93dd5376e05c7c44015409}{\_\_init\_\_}(self, obsFile=None, fileFormat='lines\_in\_cols', delimiter=None, err\_default=0.10,
\hypertarget{pynebcore_8py_source_l03393}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a4f72b542ac93dd5376e05c7c44015409}{03393}                  corrected=\textcolor{keyword}{False}, errIsRelative=\textcolor{keyword}{True}):
03394         \textcolor{stringliteral}{"""}
03395 \textcolor{stringliteral}{        Define the observation object, which is a collection of observated intensities of one or more}
03396 \textcolor{stringliteral}{        emission lines for one or more objects, with the corresponding errors.}
03397 \textcolor{stringliteral}{        The observed intensities are read from a file or filled in by the addLine method.}
03398 \textcolor{stringliteral}{        Includes an extinction correction object (pyneb.RedCorr) as Observation.extinction.}
03399 \textcolor{stringliteral}{        }
03400 \textcolor{stringliteral}{        Parameters:}
03401 \textcolor{stringliteral}{            - obsFile       name of the file containing the observations. May be a file object or a file
       name }
03402 \textcolor{stringliteral}{            - fileFormat    lines\_in\_cols or lines\_in\_row depending on how the wavelengths are ordered }
03403 \textcolor{stringliteral}{                                (default: lines\_in\_cols)}
03404 \textcolor{stringliteral}{            - delimiter     character separating entries }
03405 \textcolor{stringliteral}{            - err\_default   default uncertainty assumed on intensities. Will overwrite the error from the
       file.}
03406 \textcolor{stringliteral}{            - corrected     Boolean. True if the observed intensities are already corrected from extinction}
03407 \textcolor{stringliteral}{                                (default: False)}
03408 \textcolor{stringliteral}{            - errIsRelative Boolean. True if the errors are relative to the intensities, False if they}
03409 \textcolor{stringliteral}{                                are in the same unit as the intensity (default: True)}
03410 \textcolor{stringliteral}{}
03411 \textcolor{stringliteral}{        Example:}
03412 \textcolor{stringliteral}{            Read a file containing corrected intensities:}
03413 \textcolor{stringliteral}{                obs = pn.Observation('obs.dat', corrected = True)}
03414 \textcolor{stringliteral}{            to obtain a dictionary with the observed  corrected intensities:}
03415 \textcolor{stringliteral}{                i\_cor = \{label: obs.getLine(label = label).corrIntens for label in obs.lineLabels\}}
03416 \textcolor{stringliteral}{        }
03417 \textcolor{stringliteral}{        """}        
\hypertarget{pynebcore_8py_source_l03418}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a882b7909bc881e0c212dd5085305f4d4}{03418}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a882b7909bc881e0c212dd5085305f4d4}{log\_} = pn.log\_ 
\hypertarget{pynebcore_8py_source_l03419}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{03419}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling} = \textcolor{stringliteral}{'Observation'}
\hypertarget{pynebcore_8py_source_l03420}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{03420}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines} = []
\hypertarget{pynebcore_8py_source_l03421}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{03421}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = []
\hypertarget{pynebcore_8py_source_l03422}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_acdd6227c32bd92ec4a15b83110bcb570}{03422}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_acdd6227c32bd92ec4a15b83110bcb570}{extinction} = pn.RedCorr()
\hypertarget{pynebcore_8py_source_l03423}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{03423}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{corrected} = corrected
03424         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{corrected}:
03425             self.extinction.law = \textcolor{stringliteral}{'No correction'}
03426         \textcolor{keywordflow}{if} obsFile \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03427             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa33f35ce2f56f5b8a5666601b24a1107}{readData}(obsFile=obsFile, fileFormat=fileFormat, delimiter=delimiter,
03428                           err\_default=err\_default, corrected=corrected, errIsRelative=errIsRelative)
03429     \textcolor{comment}{##            }
03430     \textcolor{comment}{# @var log\_}
03431     \textcolor{comment}{# myloggin object}
03432     \textcolor{comment}{# @var extinction}
03433     \textcolor{comment}{# RedCor object}
03434 
03435 
\hypertarget{pynebcore_8py_source_l03436}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a5f4b01dbeb8d50963fb7fa21b94bfc17}{03436}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a5f4b01dbeb8d50963fb7fa21b94bfc17}{addLine}(self, line):
03437         \textcolor{stringliteral}{"""}
03438 \textcolor{stringliteral}{        Add a line to an existing observation}
03439 \textcolor{stringliteral}{}
03440 \textcolor{stringliteral}{        Parameters:}
03441 \textcolor{stringliteral}{            - line    the selected emission line (an instance of EmissionLine)}
03442 \textcolor{stringliteral}{            }
03443 \textcolor{stringliteral}{        """}
03444         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(line, pn.EmissionLine):            
03445             self.log\_.error(\textcolor{stringliteral}{'Trying to add an inappropriate record to observations'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03446             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03447         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{corrected}:
03448             line.corrected = \textcolor{keyword}{True}
03449             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}(line)
03450         self.lines.append(line)
03451 
\hypertarget{pynebcore_8py_source_l03452}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a106a6b30219b5d9778713936c2a3064d}{03452}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a106a6b30219b5d9778713936c2a3064d}{fillObs}(self, lineLabel, default=np.nan):
03453         \textcolor{stringliteral}{"""}
03454 \textcolor{stringliteral}{        Create a fake observation of a given line, filled with a given value.}
03455 \textcolor{stringliteral}{        Parameters:}
03456 \textcolor{stringliteral}{            - lineLabel: the label of the new line. If the label corresponds to an already }
03457 \textcolor{stringliteral}{                defined observation, nothing is done and a warning is issued.}
03458 \textcolor{stringliteral}{            - default: the value of the fake observations. Default is np.nan}
03459 \textcolor{stringliteral}{        """}
03460 
03461         \textcolor{keywordflow}{if} lineLabel \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6b3017332420d65de89c2d47ff51955e}{lineLabels}:
03462             newLine = pn.EmissionLine(label=lineLabel, obsIntens=default*np.ones(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aef2877f7f50f5c70cee1f0da97b34081}{n\_obs}))
03463             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a5f4b01dbeb8d50963fb7fa21b94bfc17}{addLine}(newLine)
03464         \textcolor{keywordflow}{else}:
03465             pn.log\_.warn(\textcolor{stringliteral}{'Line \{0\} already in obs'}.format(lineLabel), calling = self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03466 
\hypertarget{pynebcore_8py_source_l03467}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a301e67ff50a467e97cd929039607a5d0}{03467}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a301e67ff50a467e97cd929039607a5d0}{addObs}(self, name, newObsIntens, newObsError=None):
03468         \textcolor{stringliteral}{"""}
03469 \textcolor{stringliteral}{        Add an observation (i.e. a list of intensities corresponding to a new object) to the existing set.}
03470 \textcolor{stringliteral}{}
03471 \textcolor{stringliteral}{        Parameters:}
03472 \textcolor{stringliteral}{            - name            name of the new observation/object}
03473 \textcolor{stringliteral}{            - newObsIntens    value(s) of the line intensities. Length must match Observation.n\_lines}
03474 \textcolor{stringliteral}{                }
03475 \textcolor{stringliteral}{        """}
03476         \textcolor{keywordflow}{if} np.ndim(newObsIntens) == 0:
03477             newObsIntens = [newObsIntens]
03478         \textcolor{keywordflow}{if} len(newObsIntens) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac61184d33006ae92f2a3ed42adc149be}{n\_lines}:
03479             self.log\_.error(\textcolor{stringliteral}{'Length of observations to be added does not match n\_lines = \{0\}'}.format(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac61184d33006ae92f2a3ed42adc149be}{n\_lines}),
03480                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03481             \textcolor{keywordflow}{return}
03482         \textcolor{keywordflow}{if} name \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03483             self.log\_.error(\textcolor{stringliteral}{'Name \{0\} already exists'}.format(name))
03484             \textcolor{keywordflow}{return}
03485         \textcolor{keywordflow}{for} i, line \textcolor{keywordflow}{in} enumerate(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}):
03486             \textcolor{keywordflow}{if} newObsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03487                 line.addObs(newObsIntens[i])
03488             \textcolor{keywordflow}{else}:
03489                 line.addObs(newObsIntens[i], newObsError[i])
03490         self.names.append(name)
03491 
03492     @property
\hypertarget{pynebcore_8py_source_l03493}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6b3017332420d65de89c2d47ff51955e}{03493}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6b3017332420d65de89c2d47ff51955e}{lineLabels}(self):
03494         \textcolor{stringliteral}{"""}
03495 \textcolor{stringliteral}{        Property}
03496 \textcolor{stringliteral}{        Array of labels of the lines }
03497 \textcolor{stringliteral}{        }
03498 \textcolor{stringliteral}{        """}
03499         \textcolor{keywordflow}{return} np.asarray([line.label \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}])   
03500 
03501     @property
\hypertarget{pynebcore_8py_source_l03502}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac61184d33006ae92f2a3ed42adc149be}{03502}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac61184d33006ae92f2a3ed42adc149be}{n\_lines}(self):
03503         \textcolor{stringliteral}{"""}
03504 \textcolor{stringliteral}{        Property}
03505 \textcolor{stringliteral}{        Number of lines}
03506 \textcolor{stringliteral}{        }
03507 \textcolor{stringliteral}{        """}
03508         \textcolor{keywordflow}{return} len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines})
03509 
03510     @property
\hypertarget{pynebcore_8py_source_l03511}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7484ce35d15e5fcda49bab55c3501982}{03511}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7484ce35d15e5fcda49bab55c3501982}{n\_valid\_lines}(self):
03512         \textcolor{stringliteral}{"""}
03513 \textcolor{stringliteral}{        Property}
03514 \textcolor{stringliteral}{        Number of valid lines (i.e., lines with labels recognized by PyNeb)}
03515 \textcolor{stringliteral}{        }
03516 \textcolor{stringliteral}{        """}
03517         \textcolor{keywordflow}{return} len([line \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines} \textcolor{keywordflow}{if} line.is\_valid])
03518 
03519     @property
\hypertarget{pynebcore_8py_source_l03520}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aef2877f7f50f5c70cee1f0da97b34081}{03520}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aef2877f7f50f5c70cee1f0da97b34081}{n\_obs}(self):
03521         \textcolor{stringliteral}{"""}
03522 \textcolor{stringliteral}{        Property}
03523 \textcolor{stringliteral}{        Number of observations. If the number of observations varies from one line to the other,}
03524 \textcolor{stringliteral}{            returns the number of observations for each line as an array.}
03525 \textcolor{stringliteral}{            }
03526 \textcolor{stringliteral}{        """}
03527         n\_obs = np.asarray([l.obsIntens.size \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}])
03528         \textcolor{keywordflow}{for} n \textcolor{keywordflow}{in} n\_obs:
03529             \textcolor{keywordflow}{if} n != n\_obs[0]:
03530                 \textcolor{keywordflow}{return} n\_obs
03531                 
03532         \textcolor{keywordflow}{return} n\_obs[0]
03533     
03534     
03535     @property
\hypertarget{pynebcore_8py_source_l03536}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ab9a38256db6dda5f5c3a9d1a7cd06d8f}{03536}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ab9a38256db6dda5f5c3a9d1a7cd06d8f}{n\_obs\_origin}(self):
03537         \textcolor{stringliteral}{"""}
03538 \textcolor{stringliteral}{        Property}
03539 \textcolor{stringliteral}{        Number of observations which are not from MonteCarlo (i.e. without -MC- in the name)}
03540 \textcolor{stringliteral}{        """}
03541         \textcolor{keywordflow}{return} len([n \textcolor{keywordflow}{for} n \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} \textcolor{keywordflow}{if} \textcolor{stringliteral}{'-MC-'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} n])
03542 
\hypertarget{pynebcore_8py_source_l03543}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{03543}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(self, elem=None, spec=None, wave=None, label=None, blend=False, i=None, j=None):
03544         \textcolor{stringliteral}{"""}
03545 \textcolor{stringliteral}{        Return the lines corresponding to elem-spec-wave or to the label.}
03546 \textcolor{stringliteral}{        }
03547 \textcolor{stringliteral}{        """}
03548         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03549             label = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{getLineLabel}(elem, spec, wave, blend)[2]
03550         lines = [line \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines} \textcolor{keywordflow}{if} line.label == label.strip()]
03551         n\_lines = len(lines)
03552         \textcolor{keywordflow}{if} n\_lines == 0:
03553             self.log\_.warn(\textcolor{stringliteral}{'No line for \{0\} from \{1\}\{2\} at wavelength \{3\} (blend=\{4\})'}.format(label, elem, 
      spec, wave, blend),
03554                            calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03555             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03556         \textcolor{keywordflow}{elif} n\_lines == 1:
03557             \textcolor{keywordflow}{return} lines[0]
03558         \textcolor{keywordflow}{else}:
03559             \textcolor{keywordflow}{return} np.asarray(lines)
03560  
03561 
\hypertarget{pynebcore_8py_source_l03562}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2b18c06854c5492b53b7e91311bf1cff}{03562}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2b18c06854c5492b53b7e91311bf1cff}{getSortedLines}(self, crit='atom'):
03563         \textcolor{stringliteral}{"""}
03564 \textcolor{stringliteral}{        Return a list of lines sorted by atoms or wavelengths.}
03565 \textcolor{stringliteral}{        }
03566 \textcolor{stringliteral}{        Parameters:}
03567 \textcolor{stringliteral}{            - crit   criterion to sort the line list ('atom' [default] or 'wave')}
03568 \textcolor{stringliteral}{}
03569 \textcolor{stringliteral}{        """}
03570         \textcolor{keywordflow}{if} crit == \textcolor{stringliteral}{'atom'}:
03571             \textcolor{keywordflow}{return} sorted(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}, key=\textcolor{keyword}{lambda} line: line.atom + str(line.wave))
03572         \textcolor{keywordflow}{elif} crit == \textcolor{stringliteral}{'wave'}:
03573             \textcolor{keywordflow}{return} sorted(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}, key=\textcolor{keyword}{lambda} line: line.wave)
03574         \textcolor{keywordflow}{else}:
03575             self.log\_.error(\textcolor{stringliteral}{'crit = \{0\} is not valid'}.format(crit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling} + \textcolor{stringliteral}{'.getSortedLines'})
03576 
03577     
\hypertarget{pynebcore_8py_source_l03578}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_abe65e91f7abc06d2c525d6c1a3d05627}{03578}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_abe65e91f7abc06d2c525d6c1a3d05627}{getUniqueAtoms}(self):
03579         \textcolor{stringliteral}{"""}
03580 \textcolor{stringliteral}{        Return a numpy.ndarray of the atoms of the observed lines. If an atom emits }
03581 \textcolor{stringliteral}{        more than one line, it is returned only once (numpy.unique is applied }
03582 \textcolor{stringliteral}{        to the list before returning).}
03583 \textcolor{stringliteral}{}
03584 \textcolor{stringliteral}{        """}
03585         \textcolor{keywordflow}{return} np.unique([l.atom \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}])
03586 
03587     
03588     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa33f35ce2f56f5b8a5666601b24a1107}{readData}(self, obsFile, fileFormat='lines\_in\_cols', delimiter=None, err\_default=0.10, 
      corrected=False,
\hypertarget{pynebcore_8py_source_l03589}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa33f35ce2f56f5b8a5666601b24a1107}{03589}                  errIsRelative=\textcolor{keyword}{True}):
03590         \textcolor{stringliteral}{"""}
03591 \textcolor{stringliteral}{        Read observational data from an ascii file. The lines can be listed either in columns or in rows}
03592 \textcolor{stringliteral}{        and the observed objects vary in the other direction. The uncertainty on the line intensities}
03593 \textcolor{stringliteral}{        can be read from the file, or a constant relative value can be assumed.}
03594 \textcolor{stringliteral}{        The lines must be identified by a label in PyNeb's format ion\_wave (e.g., 'O3\_5007'); the list of
       ions and}
03595 \textcolor{stringliteral}{        corresponding wavelengths can also be found in pn.LINE\_LABEL\_LIST.}
03596 \textcolor{stringliteral}{        The following optional fields may also be included (without quotes): 'NAME' (object's name, in one
       string), }
03597 \textcolor{stringliteral}{        'E(B-V)', 'cHbeta', and 'e' (observational error).}
03598 \textcolor{stringliteral}{        }
03599 \textcolor{stringliteral}{ }
03600 \textcolor{stringliteral}{        Parameters:}
03601 \textcolor{stringliteral}{            - obsFile        file containing the observations. May be a file object or a string }
03602 \textcolor{stringliteral}{            - fileFormat     emission lines vary across columns ('lines\_in\_cols', default) or }
03603 \textcolor{stringliteral}{                                across rows ('lines\_in\_rows'), or across rows with errors in columns }
03604 \textcolor{stringliteral}{                                ('lines\_in\_rows\_err\_cols')m in which case the column label must start with 
      "err"}
03605 \textcolor{stringliteral}{            - delimiter      field delimiter (default: None)  }
03606 \textcolor{stringliteral}{            - err\_default    default uncertainty on the line intensities}
03607 \textcolor{stringliteral}{            - corrected      Boolean. True if the observed intensities are already corrected from
       extinction}
03608 \textcolor{stringliteral}{                                 (default: False)}
03609 \textcolor{stringliteral}{            - errIsRelative  Boolean. True if the errors are relative to the intensities, False if they}
03610 \textcolor{stringliteral}{                                 are in the same unit as the intensity (default: False)}
03611 \textcolor{stringliteral}{}
03612 \textcolor{stringliteral}{        """}    
03613         format\_list = [\textcolor{stringliteral}{'lines\_in\_cols'}, \textcolor{stringliteral}{'lines\_in\_cols2'}, \textcolor{stringliteral}{'lines\_in\_rows'}, \textcolor{stringliteral}{'lines\_in\_rows\_err\_cols'}]
03614         \textcolor{keywordflow}{if} fileFormat \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} format\_list:
03615             self.log\_.error(\textcolor{stringliteral}{'unknown format \{0\}'}.format(fileFormat), calling=\textcolor{stringliteral}{'Observation.readData'})
03616 
03617         \textcolor{keywordflow}{if} type(obsFile) \textcolor{keywordflow}{is} file:
03618             f = obsFile
03619             closeAfterUse = \textcolor{keyword}{False}
03620         \textcolor{keywordflow}{else}:
03621             f = open(obsFile, \textcolor{stringliteral}{'}\textcolor{stringliteral}{r')}
03622 \textcolor{stringliteral}{            closeAfterUse = }\textcolor{keyword}{True}
03623             
03624         \textcolor{keywordflow}{if} fileFormat == \textcolor{stringliteral}{'lines\_in\_cols'}:
03625             hdr = f.readline()
03626             labels = hdr.split(delimiter)
03627             labels = [l.strip() \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} labels]
03628             data = f.readlines()
03629             \textcolor{keywordflow}{if} closeAfterUse:
03630                 f.close()
03631             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = [dd.split(delimiter)[0].strip() \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data]
03632             data\_tab = np.asarray([[dd.split(delimiter)[i] \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(len(labels))]
      )
03633             
03634             \textcolor{keywordflow}{for} i, label \textcolor{keywordflow}{in} enumerate(labels):
03635                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'NAME'}:
03636                     \textcolor{keywordflow}{pass}
03637                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'cHbeta'}:
03638                     self.extinction.cHbeta = data\_tab[i].astype(np.float32)
03639                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03640                     self.extinction.E\_BV = data\_tab[i].astype(np.float32)         
03641                 \textcolor{keywordflow}{elif} label[-1] != \textcolor{stringliteral}{'e'}:
03642                     intens = data\_tab[i].astype(np.float32)
03643                     \textcolor{keywordflow}{try}:
03644                         i\_error = labels.index(label + \textcolor{stringliteral}{'e'})
03645                         error = data\_tab[i\_error].astype(np.float32)
03646                         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03647                             error = \hyperlink{namespacepyneb_1_1utils_1_1misc_afa4163f24be7b1472200c24824c72ae1}{quiet\_divide}(error, intens)
03648                     \textcolor{keywordflow}{except}:
03649                         self.log\_.message(\textcolor{stringliteral}{'No error found for line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03650                         error = data\_tab[1].astype(np.float32) * 0. + err\_default
03651                     \textcolor{keywordflow}{try}:
03652                         line2add = pn.EmissionLine(label=label, obsIntens=intens, obsError=error)
03653                     \textcolor{keywordflow}{except}:
03654                         self.log\_.warn(\textcolor{stringliteral}{'Unknown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03655                     \textcolor{keywordflow}{try}:
03656                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a5f4b01dbeb8d50963fb7fa21b94bfc17}{addLine}(line2add)
03657                         self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03658                     \textcolor{keywordflow}{except}:
03659                         self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03660                         
03661         \textcolor{keywordflow}{elif} fileFormat == \textcolor{stringliteral}{'lines\_in\_cols2'}:
03662             \textcolor{keywordflow}{if} closeAfterUse:
03663                 f.close()
03664             data\_tab = np.genfromtxt(obsFile, dtype=\textcolor{keywordtype}{None}, delimiter=delimiter, names=\textcolor{keyword}{True}, deletechars=\textcolor{stringliteral}{''})
03665             \textcolor{keywordflow}{for} label \textcolor{keywordflow}{in} data\_tab.dtype.names:
03666                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'cHbeta'}:
03667                     self.extinction.cHbeta = data\_tab[label]
03668                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03669                     self.extinction.E\_BV = data\_tab[label]
03670                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'NAME'}:
03671                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = list(data\_tab[label])
03672                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'NAME2'}:
03673                     \textcolor{keywordflow}{try}:
03674                         names2 = list(data\_tab[label])
03675                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = [n1 + \textcolor{stringliteral}{'\_'} + n2 \textcolor{keywordflow}{for} n1, n2 \textcolor{keywordflow}{in} zip(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}, names2)]
03676                     \textcolor{keywordflow}{except}:
03677                         \textcolor{keywordflow}{pass}
03678                 \textcolor{keywordflow}{elif} label[-1] != \textcolor{stringliteral}{'e'}:
03679                     \textcolor{keywordflow}{if} data\_tab[label].dtype.type != np.string\_:
03680                         intens = data\_tab[label]
03681                         \textcolor{keywordflow}{try}:
03682                             error = data\_tab[label + \textcolor{stringliteral}{'e'}]
03683                             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03684                                 error = error / intens
03685                         \textcolor{keywordflow}{except}:
03686                             self.log\_.message(\textcolor{stringliteral}{'No error found for line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03687                             error = np.ones\_like(data\_tab[label]) * err\_default
03688                         \textcolor{keywordflow}{try}:
03689                             line2add = pn.EmissionLine(label=label, obsIntens=intens, obsError=error)
03690                         \textcolor{keywordflow}{except}:
03691                             self.log\_.warn(\textcolor{stringliteral}{'unkown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03692                             \textcolor{keywordflow}{print} label, intens, error 
03693                         \textcolor{keywordflow}{try}:
03694                             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a5f4b01dbeb8d50963fb7fa21b94bfc17}{addLine}(line2add)
03695                             self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03696                         \textcolor{keywordflow}{except}:
03697                             self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03698                             \textcolor{keywordflow}{print} label, intens, error
03699                     \textcolor{keywordflow}{else}:
03700                         self.log\_.warn(\textcolor{stringliteral}{'Skipped \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03701             
03702         \textcolor{keywordflow}{elif} fileFormat == \textcolor{stringliteral}{'lines\_in\_rows'}:
03703             hdr = f.readline()
03704             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = hdr.split(delimiter)[1:]
03705             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} =  [l.strip() \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}]
03706             data = f.readlines()
03707             \textcolor{keywordflow}{if} closeAfterUse:
03708                 f.close()
03709 
03710             labels = [dd.split(delimiter)[0].strip() \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} len(dd.strip()) > 0]
03711             data\_tab = np.asarray([[dd.split(delimiter)[i + 1] \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} len(dd.strip()) > 0] \textcolor{keywordflow}{for} i
       \textcolor{keywordflow}{in} np.arange(len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}))])
03712             data\_tab = data\_tab.astype(np.float32)
03713             \textcolor{keywordflow}{for} i, label \textcolor{keywordflow}{in} enumerate(labels):
03714                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'cHbeta'}:
03715                     self.extinction.cHbeta = data\_tab[:, i]
03716                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03717                     self.extinction.E\_BV = data\_tab[:, i]
03718                 \textcolor{keywordflow}{elif} label[-1] != \textcolor{stringliteral}{'e'}:
03719                     intens = data\_tab[:, i]
03720                     \textcolor{keywordflow}{try}:
03721                         i\_error = labels.index(label + \textcolor{stringliteral}{'e'})
03722                         error = data\_tab[:, i\_error]
03723                         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03724                             error = error / intens
03725                     \textcolor{keywordflow}{except}:
03726                         self.log\_.message(\textcolor{stringliteral}{'No error found for line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03727                         error = np.ones\_like(data\_tab[:, 1]) * err\_default
03728                     \textcolor{keywordflow}{try}:
03729                         line2add = pn.EmissionLine(label=label, obsIntens=intens, obsError=error)
03730                     \textcolor{keywordflow}{except}:
03731                         self.log\_.warn(\textcolor{stringliteral}{'unkown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03732                         \textcolor{keywordflow}{print} label, intens, error 
03733                     \textcolor{keywordflow}{try}:
03734                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a5f4b01dbeb8d50963fb7fa21b94bfc17}{addLine}(line2add)
03735                         self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03736                     \textcolor{keywordflow}{except}:
03737                         self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03738                         \textcolor{keywordflow}{print} label, intens, error
03739                         
03740         \textcolor{keywordflow}{elif} fileFormat == \textcolor{stringliteral}{'lines\_in\_rows\_err\_cols'}:
03741             
03742             \textcolor{keywordflow}{if} closeAfterUse:
03743                 f.close()
03744                 
03745             data\_tab = np.genfromtxt(obsFile, dtype=\textcolor{keywordtype}{None}, delimiter=delimiter, names=\textcolor{keyword}{True})
03746             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = [name \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} data\_tab.dtype.names[1::] \textcolor{keywordflow}{if} name[0:3] != \textcolor{stringliteral}{'err'}]
03747             error\_names = [name \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} data\_tab.dtype.names \textcolor{keywordflow}{if} name[0:3] == \textcolor{stringliteral}{'err'}]
03748             \textcolor{keywordflow}{if} len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}) != len(error\_names):
03749                 pn.log\_.error(\textcolor{stringliteral}{'Number of columns for intensities <> number of columns for errors'},
03750                               calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03751                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03752             \textcolor{comment}{#names\_locations = [name in self.names for name in data\_tab.dtype.names]}
03753             \textcolor{comment}{#errors\_locations = [name[0:3] == 'err' for name in data\_tab.dtype.names]}
03754             \textcolor{keywordflow}{for} i, label \textcolor{keywordflow}{in} enumerate(data\_tab[\textcolor{stringliteral}{'LINE'}]):
03755                 label = label.strip()
03756                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'cHbeta'}:
03757                     self.extinction.cHbeta = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}])
03758                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03759                     self.extinction.E\_BV = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}])
03760                 \textcolor{keywordflow}{else}:
03761                     intens = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}])
03762                     error = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} error\_names])
03763                     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03764                         error = error / intens
03765                     \textcolor{keywordflow}{try}:
03766                         line2add = pn.EmissionLine(label=label, obsIntens=intens, obsError=error)
03767                     \textcolor{keywordflow}{except}:
03768                         self.log\_.warn(\textcolor{stringliteral}{'unkown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03769                         \textcolor{keywordflow}{print} label, intens, error 
03770                     \textcolor{keywordflow}{try}:
03771                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a5f4b01dbeb8d50963fb7fa21b94bfc17}{addLine}(line2add)
03772                         self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03773                     \textcolor{keywordflow}{except}:
03774                         self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03775                         \textcolor{keywordflow}{print} label, intens, error
03776         
03777             
03778         \textcolor{keywordflow}{if} corrected:
03779             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}()
03780             
03781             
\hypertarget{pynebcore_8py_source_l03782}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac380b22660411926b90f935f5123494b}{03782}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac380b22660411926b90f935f5123494b}{getIntens}(self, returnObs=False, obsName=None):
03783         \textcolor{stringliteral}{"""}
03784 \textcolor{stringliteral}{        Return the line intensities in form of a dictionary with line labels as keys.}
03785 \textcolor{stringliteral}{        }
03786 \textcolor{stringliteral}{        Parameters:}
03787 \textcolor{stringliteral}{            - returnObs  Boolean. If False (default), prints the corrected values. }
03788 \textcolor{stringliteral}{                            If True, prints the observed value. }
03789 \textcolor{stringliteral}{            - obsName    name of an observation. If not set or None, all the observations are printed}
03790 \textcolor{stringliteral}{}
03791 \textcolor{stringliteral}{        """}
03792         \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03793             \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03794                 obsIndex = self.names.index(obsName)
03795             \textcolor{keywordflow}{else}:
03796                 self.log\_.error(\textcolor{stringliteral}{'Name \{\} is not an Observation name'}.format(obsName))
03797                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03798         \textcolor{keywordflow}{else}:
03799             obsIndex = np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aef2877f7f50f5c70cee1f0da97b34081}{n\_obs})
03800         to\_return = \{\}
03801         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03802             \textcolor{keywordflow}{if} returnObs:
03803                 to\_return[line.label] = line.obsIntens[obsIndex]
03804             \textcolor{keywordflow}{else}:
03805                 to\_return[line.label] = line.corrIntens[obsIndex]
03806         \textcolor{keywordflow}{return} to\_return
03807     
03808     
\hypertarget{pynebcore_8py_source_l03809}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a96cf2360b9b568a675d2c8177d47b3d2}{03809}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a96cf2360b9b568a675d2c8177d47b3d2}{getError}(self, returnObs=False, obsName=None):
03810         \textcolor{stringliteral}{"""}
03811 \textcolor{stringliteral}{        Return the line intensity error in form of a dictionary with line labels as keys.}
03812 \textcolor{stringliteral}{        }
03813 \textcolor{stringliteral}{        Parameters:}
03814 \textcolor{stringliteral}{            - returnObs  if False (default), prints the corrected values. }
03815 \textcolor{stringliteral}{                            If True, prints the observed value. }
03816 \textcolor{stringliteral}{            - obsName    name of an observation. If not set or None, all the observations are printed}
03817 \textcolor{stringliteral}{            }
03818 \textcolor{stringliteral}{        """}
03819         \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03820             \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03821                 obsIndex = self.names.index(obsName)
03822             \textcolor{keywordflow}{else}:
03823                 self.log\_.error(\textcolor{stringliteral}{'Name \{\} is not an Observation name'}.format(obsName))
03824                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03825         \textcolor{keywordflow}{else}:
03826             obsIndex = np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aef2877f7f50f5c70cee1f0da97b34081}{n\_obs})
03827         to\_return = \{\}
03828         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03829             \textcolor{keywordflow}{if} returnObs:
03830                 to\_return[line.label] = line.obsError[obsIndex]
03831             \textcolor{keywordflow}{else}:
03832                 to\_return[line.label] = line.corrError[obsIndex]
03833         \textcolor{keywordflow}{return} to\_return
03834     
03835     
\hypertarget{pynebcore_8py_source_l03836}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa3d4a178539eaf7fe431ef1dbd347430}{03836}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa3d4a178539eaf7fe431ef1dbd347430}{printIntens}(self, returnObs=False, obsName=None):
03837         \textcolor{stringliteral}{"""}
03838 \textcolor{stringliteral}{        Print the line intensities.}
03839 \textcolor{stringliteral}{        }
03840 \textcolor{stringliteral}{        Parameters:}
03841 \textcolor{stringliteral}{            - returnObs   if False (default), prints the corrected values. }
03842 \textcolor{stringliteral}{                            If True, prints the observed value. }
03843 \textcolor{stringliteral}{            - obsName     name of an observation. Is unset or None, all the observations are printed}
03844 \textcolor{stringliteral}{}
03845 \textcolor{stringliteral}{        """}    
03846         \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03847             \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03848                 obsIndex = self.names.index(obsName)
03849             \textcolor{keywordflow}{else}:
03850                 self.log\_.error(\textcolor{stringliteral}{'Name \{\} is not an Observation name'}.format(obsName))
03851                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03852         \textcolor{keywordflow}{else}:
03853             obsIndex = np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aef2877f7f50f5c70cee1f0da97b34081}{n\_obs})
03854         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03855             \textcolor{keywordflow}{if} returnObs:
03856                 print(line.label, line.obsIntens[obsIndex])
03857             \textcolor{keywordflow}{else}:
03858                 print(line.label, line.corrIntens[obsIndex])
03859     
03860             
\hypertarget{pynebcore_8py_source_l03861}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ab01150e82809bd712a1b1f09d250db94}{03861}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ab01150e82809bd712a1b1f09d250db94}{def\_EBV}(self, label1="H1\_6563A", label2="H1\_4861A", r\_theo=2.85):
03862         \textcolor{stringliteral}{"""}
03863 \textcolor{stringliteral}{        Define the extinction parameter using the ratio of 2 lines.}
03864 \textcolor{stringliteral}{        Calls extinction.setCorr to set the EBV and cHbeta according to the parameters.}
03865 \textcolor{stringliteral}{        Once this is done, one may call correctData to compute the EmissionLine.corrIntens}
03866 \textcolor{stringliteral}{        }
03867 \textcolor{stringliteral}{        Parameters:}
03868 \textcolor{stringliteral}{            - label1 and label2 [EmissionLine.label] observed line whose intensities are used}
03869 \textcolor{stringliteral}{            - r\_theo [float] theoretical line ratio}
03870 \textcolor{stringliteral}{}
03871 \textcolor{stringliteral}{        """}
03872         line1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(label=label1)
03873         line2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(label=label2)
03874         \textcolor{keywordflow}{if} line1 \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03875             pn.log\_.error(\textcolor{stringliteral}{'\{0\} is not a valid label or is not observed'}.format(line1), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03876             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03877         \textcolor{keywordflow}{if} line2 \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03878             pn.log\_.error(\textcolor{stringliteral}{'\{0\} is not a valid label or is not observed'}.format(line2), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03879             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03880 
03881         obs\_over\_theo = (line1.obsIntens / line2.obsIntens) / r\_theo 
03882         self.extinction.setCorr(obs\_over\_theo, line1.wave, line2.wave)
03883         
03884  
\hypertarget{pynebcore_8py_source_l03885}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a04ce20073b375a6dd7d4282933adbd93}{03885}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a04ce20073b375a6dd7d4282933adbd93}{\_\_normalize}(self, label='H1\_4861A'):
03886         \textcolor{stringliteral}{"""}
03887 \textcolor{stringliteral}{        Normalize the line intensities to a reference line (Hbeta by default).}
03888 \textcolor{stringliteral}{        Not yet implemented}
03889 \textcolor{stringliteral}{        }
03890 \textcolor{stringliteral}{        """}
03891         \textcolor{keywordflow}{if} \textcolor{stringliteral}{"="} \textcolor{keywordflow}{in} label:
03892             line\_label, factor = label.split(\textcolor{stringliteral}{'='})
03893             factor = np.float(factor)
03894         \textcolor{keywordflow}{else}:
03895             line\_label = label
03896             factor = 1.
03897         line\_norm = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(label=line\_label) 
03898         \textcolor{keywordflow}{if} line\_norm \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03899             pn.log\_.warn(\textcolor{stringliteral}{'No normalization possible as \{0\} not found'}.format(line\_label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03900             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03901         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03902             line.\_obsIntens\_n = line.obsIntens / (line\_norm.obsIntens * factor)
03903             line.\_unit = line\_label.strip()
03904     
03905     
\hypertarget{pynebcore_8py_source_l03906}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{03906}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}(self, line=None, normWave=None):
03907         \textcolor{stringliteral}{"""}
03908 \textcolor{stringliteral}{        Correct the line intensities with the correction computed with the RedCorr class (extinction.py)}
03909 \textcolor{stringliteral}{        The result is stored in line.corrIntens (corrected intensity in absolute units).}
03910 \textcolor{stringliteral}{}
03911 \textcolor{stringliteral}{        """}
03912         \textcolor{keywordflow}{if} line \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03913             line = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}
03914         \textcolor{keywordflow}{if} np.ndim(line) != 0:
03915             \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} line:
03916                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}(l, normWave=normWave)
03917         \textcolor{keywordflow}{else}:
03918             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(line, pn.EmissionLine):
03919                 pn.log\_.error(\textcolor{stringliteral}{'Trying to correct something that is not a line'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03920                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}  
03921             line.correctIntens(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_acdd6227c32bd92ec4a15b83110bcb570}{extinction}, normWave=normWave)
03922 
03923             \textcolor{stringliteral}{"""            }
03924 \textcolor{stringliteral}{            # the following is commented for now, we'll see latter how to implement normalized intensities.}
03925 \textcolor{stringliteral}{            if line.\_unit is not None:}
03926 \textcolor{stringliteral}{                try:}
03927 \textcolor{stringliteral}{                    line\_norm = self.getLine(label=line.\_unit)}
03928 \textcolor{stringliteral}{                    line.\_corrIntens\_n = line.obsIntens\_n * self.extinction.getCorr(line.wave,
       line\_norm.wave)}
03929 \textcolor{stringliteral}{                except:}
03930 \textcolor{stringliteral}{                    pn.log\_.warn('No normalized correction for \{0\}'.format(line), calling='
      Observation.correctData')}
03931 \textcolor{stringliteral}{                    line.\_corrIntens\_n = None}
03932 \textcolor{stringliteral}{            """}
03933             
\hypertarget{pynebcore_8py_source_l03934}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa0f98ae4395e7dfa586bcd71d32e43f1}{03934}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa0f98ae4395e7dfa586bcd71d32e43f1}{setAllErrors}(self, err\_default):
03935         \textcolor{stringliteral}{"""}
03936 \textcolor{stringliteral}{        Set the relative uncertainty of all emission lines to a common constant value}
03937 \textcolor{stringliteral}{        }
03938 \textcolor{stringliteral}{        Parameters:}
03939 \textcolor{stringliteral}{            - err\_default     default value of the relative uncertainty}
03940 \textcolor{stringliteral}{        }
03941 \textcolor{stringliteral}{        """}
03942         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03943             line.obs\_err = np.ones\_like(line.obs\_err) * err\_default
03944 
03945     
03946     
\hypertarget{pynebcore_8py_source_l03947}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a8005a1ad8167e96e117d4b81d6e919ff}{03947}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a8005a1ad8167e96e117d4b81d6e919ff}{addMonteCarloObs}(self, N=0, i\_obs=None):
03948         \textcolor{stringliteral}{"""}
03949 \textcolor{stringliteral}{        Adding MonteCarlo random-gauss values of fake observations to an obs object.}
03950 \textcolor{stringliteral}{        The names of the fake observations will be OriginalName-MC-n, n ranging from 0 to N-1}
03951 \textcolor{stringliteral}{        }
03952 \textcolor{stringliteral}{        Parameters:}
03953 \textcolor{stringliteral}{        N: number of new observations to be added for each original observation.}
03954 \textcolor{stringliteral}{        i\_obs: used in case only a given observations needs to be treated}
03955 \textcolor{stringliteral}{        """}
03956         n\_lines = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac61184d33006ae92f2a3ed42adc149be}{n\_lines}
03957         n\_obs = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aef2877f7f50f5c70cee1f0da97b34081}{n\_obs}
03958         \textcolor{keywordflow}{if} i\_obs \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03959             pn.log\_.message(\textcolor{stringliteral}{'Entering'}, calling=\textcolor{stringliteral}{'addMonteCarloObs'})
03960             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} xrange(n\_obs):
03961                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a8005a1ad8167e96e117d4b81d6e919ff}{addMonteCarloObs}(i\_obs=i, N=N)
03962             pn.log\_.message(\textcolor{stringliteral}{'Leaving'}, calling=\textcolor{stringliteral}{'addMonteCarloObs'})
03963         \textcolor{keywordflow}{else}:
03964             intens = np.array([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac380b22660411926b90f935f5123494b}{getIntens}()[label] \textcolor{keywordflow}{for} label \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6b3017332420d65de89c2d47ff51955e}{lineLabels}])[:,i\_obs] \textcolor{comment}{# n\_lines}
03965             error = np.array([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a96cf2360b9b568a675d2c8177d47b3d2}{getError}()[label] \textcolor{keywordflow}{for} label \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6b3017332420d65de89c2d47ff51955e}{lineLabels}])[:,i\_obs]
03966             all\_new\_obs = np.random.standard\_normal((N, n\_lines))
03967             
03968             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} xrange(N):
03969                 new\_obs = intens * (all\_new\_obs[i,:] * error + 1)
03970                 new\_obs[new\_obs < 0.] = 0.
03971                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a301e67ff50a467e97cd929039607a5d0}{addObs}(\textcolor{stringliteral}{'\{0\}-MC-\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}[i\_obs], i), new\_obs, error)
03972     
\end{DoxyCode}
