\hypertarget{pynebcore_8py}{\section{pynebcore.\-py}
\label{pynebcore_8py}\index{pyneb/core/pynebcore.\-py@{pyneb/core/pynebcore.\-py}}
}

\begin{DoxyCode}
\hypertarget{pynebcore_8py_source_l00001}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore}{00001} \textcolor{stringliteral}{"""@module pynebcore}
00002 \textcolor{stringliteral}{Main PyNeb module}
00003 \textcolor{stringliteral}{Tools to manage atoms, emission lines and observational data.}
00004 \textcolor{stringliteral}{}
00005 \textcolor{stringliteral}{@class Atom           atom object}
00006 \textcolor{stringliteral}{@class EmissionLine   emission line object}
00007 \textcolor{stringliteral}{@class Observation    observation object}
00008 \textcolor{stringliteral}{}
00009 \textcolor{stringliteral}{"""}
00010 \textcolor{keyword}{from} \_\_future\_\_ \textcolor{keyword}{import} print\_function
00011 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np
00012 \textcolor{keyword}{import} warnings
00013 \textcolor{keyword}{import} os
00014 
00015 \textcolor{keyword}{from} pyneb \textcolor{keyword}{import} config, log\_, atomicData
00016 \textcolor{keyword}{from} ..utils.misc \textcolor{keyword}{import} int\_to\_roman, strExtract, parseAtom, quiet\_divide, \_returnNone, solve
00017 \textcolor{keyword}{from} ..utils \textcolor{keyword}{import} chebyshev
00018 \textcolor{keyword}{from} ..utils.init \textcolor{keyword}{import} LINE\_LABEL\_LIST, BLEND\_LIST, SPEC\_LIST, label2levelDict
00019 \textcolor{keyword}{from} ..utils.physics \textcolor{keyword}{import} sym2name, gsDict, gsLevelDict, gsFromAtom, vactoair, CST
00020 \textcolor{keyword}{from} ..utils.manage\_atomic\_data \textcolor{keyword}{import} getLevelsNIST
00021 \textcolor{keyword}{from} ..utils.pn\_chianti \textcolor{keyword}{import} \_AtomChianti, \_CollChianti
00022 \textcolor{keyword}{from} ..extinction.red\_corr \textcolor{keyword}{import} RedCorr
00023 \textcolor{keyword}{from} fractions \textcolor{keyword}{import} Fraction
00024 \textcolor{keywordflow}{if} config.INSTALLED[\textcolor{stringliteral}{'scipy'}]:
00025     \textcolor{keyword}{from} scipy \textcolor{keyword}{import} interpolate
00026     \textcolor{keyword}{from} scipy.special \textcolor{keyword}{import} gamma
00027 \textcolor{keywordflow}{if} config.INSTALLED[\textcolor{stringliteral}{'plt'}]: 
00028     \textcolor{keyword}{import} matplotlib.pyplot \textcolor{keyword}{as} plt
00029     \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} cm
00030     \textcolor{keyword}{from} matplotlib.collections \textcolor{keyword}{import} LineCollection
00031     \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} colors
00032 \textcolor{keywordflow}{if} config.INSTALLED[\textcolor{stringliteral}{'mp'}]:
00033     \textcolor{keyword}{from} multiprocessing \textcolor{keyword}{import} Queue, Process
00034     \textcolor{keyword}{from} ..utils.multiprocs \textcolor{keyword}{import} getTemDen\_helper
00035 \textcolor{keywordflow}{if} config.INSTALLED[\textcolor{stringliteral}{'pyfits'}]:
00036     \textcolor{keyword}{import} pyfits
00037 \textcolor{keywordflow}{elif} config.INSTALLED[\textcolor{stringliteral}{'pyfits from astropy'}]:
00038     \textcolor{keyword}{import} astropy.io.fits \textcolor{keyword}{as} pyfits
00039 \textcolor{keywordflow}{if} config.INSTALLED[\textcolor{stringliteral}{'h5py'}]:
00040     \textcolor{keyword}{import} h5py
00041 
00042 
00043 \textcolor{comment}{# Change the profiler to 'cpu', 'mem' or None to profile the execution of Atom.}
\hypertarget{pynebcore_8py_source_l00044}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_ab9e20b2acbbf8eec3da84081929fae24}{00044} profiler = \textcolor{keywordtype}{None}
00045 \textcolor{comment}{#profiler = 'cpu'}
00046 \textcolor{keywordflow}{if} profiler == \textcolor{stringliteral}{'mem'}:
00047     \textcolor{keywordflow}{try}:
00048         \textcolor{keyword}{from} memory\_profiler \textcolor{keyword}{import} profile
00049     \textcolor{keywordflow}{except}:
\hypertarget{pynebcore_8py_source_l00050}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_ac77de41f85dcf82405ec588c382fe456}{00050}         \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_ac77de41f85dcf82405ec588c382fe456}{profile}(f):
00051             \textcolor{keywordflow}{return} f
00052 \textcolor{keywordflow}{elif} profiler \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00053     \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_ac77de41f85dcf82405ec588c382fe456}{profile}(f):
00054         \textcolor{keywordflow}{return} f
00055 
\hypertarget{pynebcore_8py_source_l00056}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none}{00056} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none}{\_AtomDataNone}(object):
00057     
\hypertarget{pynebcore_8py_source_l00058}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a07f02d091d31fdfdc4e58b6357be5bb7}{00058}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a07f02d091d31fdfdc4e58b6357be5bb7}{\_\_init\_\_}(self):
00059 
\hypertarget{pynebcore_8py_source_l00060}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a0b4acd0c49278c6b3ac0fa460ad33bb9}{00060}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a0b4acd0c49278c6b3ac0fa460ad33bb9}{atomFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00061}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_aa255a7f490aa5d1cf7cfee7c5eb388ae}{00061}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_aa255a7f490aa5d1cf7cfee7c5eb388ae}{atomPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00062}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_af853b15fb8cb15c2781dedc2cac7f3a3}{00062}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_af853b15fb8cb15c2781dedc2cac7f3a3}{atomFitsFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00063}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ad9df42301b90127f83be1381a302f57b}{00063}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ad9df42301b90127f83be1381a302f57b}{atomFitsPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00064}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a6a6e8b052741d46963b85c0cdcb9fd79}{00064}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a6a6e8b052741d46963b85c0cdcb9fd79}{wave\_Ang} = np.nan
\hypertarget{pynebcore_8py_source_l00065}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a45c07931f008fd0cfc0349222b14cd8c}{00065}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a45c07931f008fd0cfc0349222b14cd8c}{getStatWeight} = \_returnNone
\hypertarget{pynebcore_8py_source_l00066}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ace59c545d211f79753ebdc9414eb1824}{00066}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_ace59c545d211f79753ebdc9414eb1824}{getEnergy} = \_returnNone
\hypertarget{pynebcore_8py_source_l00067}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a44aa15dc5314c07627944e86581631b1}{00067}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a44aa15dc5314c07627944e86581631b1}{getA} = \_returnNone
\hypertarget{pynebcore_8py_source_l00068}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a3bc65b4742319ce5123d6fd3ca977c63}{00068}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a3bc65b4742319ce5123d6fd3ca977c63}{atomNLevels} = 0
\hypertarget{pynebcore_8py_source_l00069}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a784a8906a9fd1b408b567989207aca84}{00069}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none_a784a8906a9fd1b408b567989207aca84}{NLevels} = 0
00070 
\hypertarget{pynebcore_8py_source_l00071}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none}{00071} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none}{\_CollDataNone}(object):
00072     
\hypertarget{pynebcore_8py_source_l00073}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a251bc227ca525ce64f620c6b86b43ca1}{00073}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a251bc227ca525ce64f620c6b86b43ca1}{\_\_init\_\_}(self):
\hypertarget{pynebcore_8py_source_l00074}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a9945656d527d539b02443f1e12175952}{00074}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a9945656d527d539b02443f1e12175952}{getOmegaArray} = \_returnNone
\hypertarget{pynebcore_8py_source_l00075}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a75bd94e0404dbdad86ce0cd849331b6d}{00075}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a75bd94e0404dbdad86ce0cd849331b6d}{getTemArray} = \_returnNone
\hypertarget{pynebcore_8py_source_l00076}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a921566608d3f514d075992b0c6870952}{00076}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a921566608d3f514d075992b0c6870952}{collFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00077}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a3e39b0e757b0987e39ad0257a981ff13}{00077}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a3e39b0e757b0987e39ad0257a981ff13}{collPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00078}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_acb2dc662b7ca086e2d3322b79993fc60}{00078}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_acb2dc662b7ca086e2d3322b79993fc60}{collFitsFile} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00079}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_ad3bac87fe373ebf85361cc6c86b25c97}{00079}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_ad3bac87fe373ebf85361cc6c86b25c97}{collFitsPath} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00080}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_aa6cfd6d6afa856ba4c102acc9180df42}{00080}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_aa6cfd6d6afa856ba4c102acc9180df42}{collNLevels} = 0
\hypertarget{pynebcore_8py_source_l00081}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_afc8b4905545401491edcb56c8f0b556e}{00081}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_afc8b4905545401491edcb56c8f0b556e}{tem\_units} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7adb0042ec7ea039b5a94fd243a596f1}{\_returnNone}()
\hypertarget{pynebcore_8py_source_l00082}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a194d717f8c873199de6a3e0cb7d7a96b}{00082}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none_a194d717f8c873199de6a3e0cb7d7a96b}{NLevels} = 0
00083 
\hypertarget{pynebcore_8py_source_l00084}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits}{00084} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits}{\_AtomDataFits}(object):
00085     
\hypertarget{pynebcore_8py_source_l00086}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a626724a08fd24ba2ea2b44307ec6b294}{00086}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a626724a08fd24ba2ea2b44307ec6b294}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, NLevels=None):
\hypertarget{pynebcore_8py_source_l00087}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8919598e2830080299dcfe70249d4a15}{00087}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8919598e2830080299dcfe70249d4a15}{log\_} = log\_
00088         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00089}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{00089}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} = atom
\hypertarget{pynebcore_8py_source_l00090}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{00090}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00091}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{00091}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[1])
00092         \textcolor{keywordflow}{else}:
00093             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem} = elem
00094             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec} = int(spec)
00095             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec})
\hypertarget{pynebcore_8py_source_l00096}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ac3d861a23f94412d8ae28aeb15a98170}{00096}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ac3d861a23f94412d8ae28aeb15a98170}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem}]
\hypertarget{pynebcore_8py_source_l00097}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{00097}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}
\hypertarget{pynebcore_8py_source_l00098}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{00098}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels} = NLevels
00099         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a1e92973091aaefa8b9985d3ca864dbd7}{\_loadFit}()
\hypertarget{pynebcore_8py_source_l00100}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a84351f8e5bae7c23f1318fe9464db1ca}{00100}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a84351f8e5bae7c23f1318fe9464db1ca}{\_A} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{getA}() \textcolor{comment}{# index = quantum number - 1}
\hypertarget{pynebcore_8py_source_l00101}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{00101}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{\_Energy} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ade643ddf8307c8068ad52b9500d894ce}{getEnergy}() \textcolor{comment}{#Angstrom^-1}
\hypertarget{pynebcore_8py_source_l00102}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8bee4fc914c9542b85e4750eb63b7aa0}{00102}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8bee4fc914c9542b85e4750eb63b7aa0}{\_StatWeight} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ad0edb5ef48a2f1acdb0d02890aeeb4b6}{getStatWeight}()
00103         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_aa30b080423ef6f6e3c342b602a17f8a1}{initWaves}()
00104         
00105         
\hypertarget{pynebcore_8py_source_l00106}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a1e92973091aaefa8b9985d3ca864dbd7}{00106}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a1e92973091aaefa8b9985d3ca864dbd7}{\_loadFit}(self):
00107         \textcolor{stringliteral}{"""}
00108 \textcolor{stringliteral}{        Load fits file of atomic data.}
00109 \textcolor{stringliteral}{        The fits files names are defined in the atomicData Object}
00110 \textcolor{stringliteral}{}
00111 \textcolor{stringliteral}{        """}                 
\hypertarget{pynebcore_8py_source_l00112}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{00112}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile} = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}, data\_type=\textcolor{stringliteral}{'atom'})
\hypertarget{pynebcore_8py_source_l00113}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{00113}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile}
00114         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00115             self.log\_.error(\textcolor{stringliteral}{'No atom data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00116             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00117         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} \textcolor{keywordflow}{in} config.DataFiles:
00118             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}]:
00119                 config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile})
00120         \textcolor{keywordflow}{else}:
00121             config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}]
00122             
\hypertarget{pynebcore_8py_source_l00123}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{00123}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{atomPath} = atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile})
\hypertarget{pynebcore_8py_source_l00124}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a6606b085964dbd4011085454b30efe41}{00124}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a6606b085964dbd4011085454b30efe41}{atomFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{atomPath}
00125         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2a9232b1a5ad60259d33d934e2cf5bf3}{atomPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile})
00126         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00127             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00128         atomFits = pyfits.open(file\_to\_open, ignore\_missing\_end=\textcolor{keyword}{True})
00129         self.log\_.message(\textcolor{stringliteral}{'Reading atom data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_add12b2ae3c11a68438ebf4bcf79fd6d0}{atomFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00130         
00131         AtomExt = atomFits[1]
00132 
00133 
00134         \textcolor{comment}{#Read headers}
\hypertarget{pynebcore_8py_source_l00135}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{00135}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader} = AtomExt.header
00136 
\hypertarget{pynebcore_8py_source_l00137}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae8ab3604ecbf05c1f668717fc13e9dc2}{00137}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae8ab3604ecbf05c1f668717fc13e9dc2}{gs} = \textcolor{stringliteral}{'unknown'}
00138         \textcolor{keywordflow}{try}:
00139             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ae8ab3604ecbf05c1f668717fc13e9dc2}{gs} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'GSCONFIG'}]
00140         \textcolor{keywordflow}{except}:
00141             \textcolor{keywordflow}{pass}
00142         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}:
00143             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec}:
00144                 log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.format(
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'SPECTRUM'}],
00145                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a28f8a716cd11ea24726de792fdfb5573}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00146         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}:
00147             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem}]:
00148                 log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}. Check
       the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'ATOM'}],
00149                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4724ac766d9c28d48fdcf43f50bd8478}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00150                 
00151         \textcolor{comment}{#Read data}
\hypertarget{pynebcore_8py_source_l00152}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a778ab4d0dcd50a9d2f5aa54da07b51cc}{00152}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a778ab4d0dcd50a9d2f5aa54da07b51cc}{\_AtomData} = AtomExt.data
00153 
00154         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l00155}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{00155}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}[\textcolor{stringliteral}{'N\_LEVELS'}]
00156         \textcolor{keywordflow}{except}:
00157             log\_.error(\textcolor{stringliteral}{'N\_LEVELS is not set in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a2523c95ccdad4f27adb19799da3c70b5}{atomFitsFile}))
00158             
00159         self.log\_.message(\textcolor{stringliteral}{'NLevels of atomic data: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}),
00160                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00161         
00162         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}
00163         
00164         atomFits.close()
00165 
00166 
\hypertarget{pynebcore_8py_source_l00167}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_aa30b080423ef6f6e3c342b602a17f8a1}{00167}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_aa30b080423ef6f6e3c342b602a17f8a1}{initWaves}(self):
00168         \textcolor{stringliteral}{"""}
00169 \textcolor{stringliteral}{        Initialization of wave\_Ang }
00170 \textcolor{stringliteral}{        }
00171 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l00172}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{00172}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{wave\_Ang} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}))
00173         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}):
00174             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
00175                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{wave\_Ang}[i, j] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a904df923201dd16936845199622afc76}{wave\_Ang}[j, i] = 1. / abs(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a465451be78113fc2ee30cf3ddabceadf}{\_Energy}[j])
00176 
00177         
\hypertarget{pynebcore_8py_source_l00178}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8e68300d05a33ee0bd949cbc5820e34c}{00178}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8e68300d05a33ee0bd949cbc5820e34c}{\_test\_lev}(self, level):
00179         \textcolor{stringliteral}{"""}
00180 \textcolor{stringliteral}{        Test whether selected level is legal}
00181 \textcolor{stringliteral}{}
00182 \textcolor{stringliteral}{        Parameters:}
00183 \textcolor{stringliteral}{            - level        selected atom level}
00184 \textcolor{stringliteral}{}
00185 \textcolor{stringliteral}{        """}       
00186         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}:
00187             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}),
00188                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00189         
\hypertarget{pynebcore_8py_source_l00190}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a371215f15e583f3d8446744ab5d6c0d8}{00190}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a371215f15e583f3d8446744ab5d6c0d8}{getSources}(self):
00191         \textcolor{stringliteral}{"""}
00192 \textcolor{stringliteral}{        Return bibliographic sources for atomic data, as listed in the headers of the fits files}
00193 \textcolor{stringliteral}{        """}
00194         sources = [] 
00195         header = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a660b5b881aa31dd7dcb6fecfe0735f70}{AtomHeader}
00196         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(header.items())):
00197             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} header.items()[i][0]:
00198                 number = header.items()[i][0].lstrip(\textcolor{stringliteral}{'SOURCE'})
00199                 \textcolor{keywordflow}{try}:
00200                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} + \textcolor{stringliteral}{': '} + header.get(\textcolor{stringliteral}{'NOTE'} + str(number)) + \textcolor{stringliteral}{':'}, 
      header.get(\textcolor{stringliteral}{'SOURCE'} + str(number)))
00201                 \textcolor{keywordflow}{except}:
00202                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a489ba89fa2e99786afc077e82acace4c}{atom} + \textcolor{stringliteral}{': '} + \textcolor{stringliteral}{'Atomic data:'}, header.get(\textcolor{stringliteral}{'SOURCE'} + str(number)
      ))
00203         \textcolor{keywordflow}{return} sources
00204     
00205     
\hypertarget{pynebcore_8py_source_l00206}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a1915aa59aa8cb2b5a3f9a7b381009f17}{00206}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a1915aa59aa8cb2b5a3f9a7b381009f17}{printSources}(self):
00207         
00208         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a371215f15e583f3d8446744ab5d6c0d8}{getSources}():
00209             print(source)    
00210 
00211     
\hypertarget{pynebcore_8py_source_l00212}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{00212}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{getA}(self, lev\_i= -1, lev\_j= -1):
00213         \textcolor{stringliteral}{"""}
00214 \textcolor{stringliteral}{        Return the transition probability data. }
00215 \textcolor{stringliteral}{        If no arguments are given, the whole array of A is returned.}
00216 \textcolor{stringliteral}{        A specific A value can be obtained by giving either the upper and lower levels.}
00217 \textcolor{stringliteral}{            }
00218 \textcolor{stringliteral}{        Usage:}
00219 \textcolor{stringliteral}{            A\_O3 = O3.getA()          # The whole A array is stored in A\_O3}
00220 \textcolor{stringliteral}{            O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed}
00221 \textcolor{stringliteral}{            O3.getA(2, 4)      # Returns 0}
00222 \textcolor{stringliteral}{}
00223 \textcolor{stringliteral}{        Parameters:}
00224 \textcolor{stringliteral}{            - lev\_i  upper level of transition (default= -1, returns complete array)}
00225 \textcolor{stringliteral}{            - lev\_j  lower level of transition (default= -1, returns complete array)}
00226 \textcolor{stringliteral}{            }
00227 \textcolor{stringliteral}{        """}
00228         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8e68300d05a33ee0bd949cbc5820e34c}{\_test\_lev}(lev\_i)
00229         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8e68300d05a33ee0bd949cbc5820e34c}{\_test\_lev}(lev\_j)
00230         \textcolor{keywordflow}{if} (lev\_i == -1):
00231             \textcolor{keywordflow}{if} (lev\_j == -1):
00232                 \textcolor{comment}{# Line below commented out because introduces bug if Nlevels(atom) > Nlevels(coll)}
00233                 \textcolor{comment}{#resultArray = np.zeros([self.NLevels, self.NLevels])}
00234                 resultArray = np.zeros([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}])
00235                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels} - 1):
00236                     lev\_i = i + 1
00237                     j = i + 1
00238                     \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ff73bfa251e1139692c2a60f9821315}{atomNLevels}):
00239                         lev\_j = j + 1
00240                         resultArray[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a4ecca5287d3b6bf0d6e44b9bb184db77}{getA}(lev\_j, lev\_i)
00241                         j += 1
00242                 \textcolor{keywordflow}{return} resultArray
00243 
00244             \textcolor{keywordflow}{return} (self.\_AtomData.field(\textcolor{stringliteral}{'A(*->\{0\})'}.format(lev\_j)))
00245         \textcolor{keywordflow}{else}:
00246             \textcolor{keywordflow}{return} (self.\_AtomData.field(\textcolor{stringliteral}{'A(*->\{0\})'}.format(lev\_j))[lev\_i - 1])
00247 
00248 
\hypertarget{pynebcore_8py_source_l00249}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ad0edb5ef48a2f1acdb0d02890aeeb4b6}{00249}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ad0edb5ef48a2f1acdb0d02890aeeb4b6}{getStatWeight}(self, level= -1):
00250         \textcolor{stringliteral}{"""}
00251 \textcolor{stringliteral}{        Returns the array of statistical weights of the ion (if no arguments are given) }
00252 \textcolor{stringliteral}{            or the statistical weight of level i (if i is given as an argument, }
00253 \textcolor{stringliteral}{            with the optional keyword level).}
00254 \textcolor{stringliteral}{            }
00255 \textcolor{stringliteral}{        Usage:}
00256 \textcolor{stringliteral}{            O3.getStatWeight()}
00257 \textcolor{stringliteral}{            O3.getStatWeight(level=4)}
00258 \textcolor{stringliteral}{            O3.getStatWeight(4)}
00259 \textcolor{stringliteral}{                      }
00260 \textcolor{stringliteral}{        Parameters:}
00261 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00262 \textcolor{stringliteral}{            }
00263 \textcolor{stringliteral}{        """}
00264         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8e68300d05a33ee0bd949cbc5820e34c}{\_test\_lev}(level)
00265         \textcolor{keywordflow}{if} (level == -1):
00266             \textcolor{keywordflow}{return} ((self.\_AtomData.field(\textcolor{stringliteral}{'Stat\_Weight'})) * 1.0)
00267         \textcolor{keywordflow}{elif} (level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}  \textcolor{keywordflow}{or} level < 1):
00268             self.log\_.warn(\textcolor{stringliteral}{'level \{0\} outside the [1-\{1\}] range: aborting'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels})
00269                                , calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00270 \textcolor{comment}{#                level = level % self.NLevels }
00271         \textcolor{keywordflow}{else}:
00272             \textcolor{keywordflow}{return} ((self.\_AtomData.field(\textcolor{stringliteral}{'Stat\_Weight'})[level - 1]) * 1.0)
00273     
00274 
\hypertarget{pynebcore_8py_source_l00275}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ade643ddf8307c8068ad52b9500d894ce}{00275}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_ade643ddf8307c8068ad52b9500d894ce}{getEnergy}(self, level= -1, unit='1/Ang'):
00276         \textcolor{stringliteral}{"""}
00277 \textcolor{stringliteral}{        Return energy level of selected level (or array of energy levels, if level not given) }
00278 \textcolor{stringliteral}{            in Angstrom^-1 (default) or another unit}
00279 \textcolor{stringliteral}{        }
00280 \textcolor{stringliteral}{        Usage:}
00281 \textcolor{stringliteral}{            O3.getEnergy(4, unit='eV')}
00282 \textcolor{stringliteral}{        Parameters:}
00283 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00284 \textcolor{stringliteral}{            - unit   [str] one of '1/Ang' (default), 'eV', or 'Ryd'    }
00285 \textcolor{stringliteral}{            }
00286 \textcolor{stringliteral}{        """}
00287         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a8e68300d05a33ee0bd949cbc5820e34c}{\_test\_lev}(level)
00288         unit\_dict = \{\textcolor{stringliteral}{'1/Ang'}: 1.,
00289                      \textcolor{stringliteral}{'Ryd'}: CST.RYD\_ANG,
00290                      \textcolor{stringliteral}{'eV'}: CST.RYD\_ANG * CST.RYD\_EV,
00291                      \textcolor{stringliteral}{'erg'}: CST.HPLANCK * CST.CLIGHT * 1e8\}
00292         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} unit\_dict:
00293             self.log\_.warn(\textcolor{stringliteral}{'Unit \{0\} unknown, using 1/Ang'}.format(unit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling} + \textcolor{stringliteral}{'.getEnergy'})
00294             unit = \textcolor{stringliteral}{'1/Ang'}
00295         \textcolor{keywordflow}{if} (level == -1):
00296             \textcolor{keywordflow}{return} self.\_AtomData.field(\textcolor{stringliteral}{'Energy'}) * unit\_dict[unit]
00297         \textcolor{keywordflow}{elif} (level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels}  \textcolor{keywordflow}{or} level < 1):
00298             self.log\_.warn(\textcolor{stringliteral}{'level \{0\} outside the [1-\{1\}] range: aborting'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a85c3a2d0c1cdbecc851be17237caff63}{NLevels})
00299                                , calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits_a70465eedf1ac0b8e43360bc423be9c93}{calling})
00300 \textcolor{comment}{#                level = level % self.NLevels }
00301         \textcolor{keywordflow}{else}:
00302             \textcolor{keywordflow}{return} self.\_AtomData.field(\textcolor{stringliteral}{'Energy'})[level - 1] * unit\_dict[unit]
00303 
00304 
\hypertarget{pynebcore_8py_source_l00305}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii}{00305} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii}{\_AtomDataAscii}(object):
00306     
\hypertarget{pynebcore_8py_source_l00307}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a18839ec771a0105ab111f8c6411c70e1}{00307}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a18839ec771a0105ab111f8c6411c70e1}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, NLevels=None):
\hypertarget{pynebcore_8py_source_l00308}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aaddba4bcc59a7a5e69c08b2545939737}{00308}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aaddba4bcc59a7a5e69c08b2545939737}{log\_} = log\_
00309         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00310}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{00310}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom} = atom
\hypertarget{pynebcore_8py_source_l00311}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{00311}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00312}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{00312}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[1])
00313         \textcolor{keywordflow}{else}:
00314             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem} = elem
00315             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec} = int(spec)
00316             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec})
\hypertarget{pynebcore_8py_source_l00317}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ab03fcf558862acb02a57ccd5accf155d}{00317}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ab03fcf558862acb02a57ccd5accf155d}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}]
\hypertarget{pynebcore_8py_source_l00318}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{00318}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}
\hypertarget{pynebcore_8py_source_l00319}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{00319}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels} = NLevels
00320         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aa3a0c51a83be02bbbb64bdd10b4ea61e}{\_loadAscii}()
00321         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a11e49056b635286cb2a72631dd7e29b5}{initWaves}()
00322         
\hypertarget{pynebcore_8py_source_l00323}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aa3a0c51a83be02bbbb64bdd10b4ea61e}{00323}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aa3a0c51a83be02bbbb64bdd10b4ea61e}{\_loadAscii}(self):
00324         
\hypertarget{pynebcore_8py_source_l00325}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{00325}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile} = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, data\_type=\textcolor{stringliteral}{'atom'})
00326         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00327             self.log\_.error(\textcolor{stringliteral}{'No atom data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00328             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00329         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom} \textcolor{keywordflow}{in} config.DataFiles:
00330             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}]:
00331                 config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile})
00332         \textcolor{keywordflow}{else}:
00333             config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}]
00334             
\hypertarget{pynebcore_8py_source_l00335}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae16a1eb022aac82bfee45f425a21ed90}{00335}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae16a1eb022aac82bfee45f425a21ed90}{atomPath} = atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile})
00336         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae16a1eb022aac82bfee45f425a21ed90}{atomPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile})
00337         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00338             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00339             
00340         self.log\_.message(\textcolor{stringliteral}{'Reading atom data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00341 
00342     
\hypertarget{pynebcore_8py_source_l00343}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{00343}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{E\_in\_vacuum} = \textcolor{keyword}{False}
00344         \textcolor{comment}{# Read data from ascii file}
00345         \textcolor{comment}{#}
00346         \textcolor{comment}{# Read energies and stat weights }
00347         f = open(file\_to\_open)
00348         data = f.readlines()
00349         f.close()
00350         \textcolor{keywordflow}{if} data[0].strip() == \textcolor{stringliteral}{'Aij'}:
00351             \textcolor{comment}{# This means that we are dealing with new format (no more energies nor stats weights}
00352             \textcolor{comment}{# so NIST data are needed}
00353             need\_NIST = \textcolor{keyword}{True}
00354             at\_data = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}][2::], dtype=\textcolor{stringliteral}{'float'})
00355             comments\_tab = [d \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]==\textcolor{stringliteral}{'***'}]
\hypertarget{pynebcore_8py_source_l00356}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{00356}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments} = \{\}
00357             \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} comments\_tab:
00358                 key = com.split()[1]
00359                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[key] = com.split(key)[1].strip()
00360             A = at\_data.copy()
00361             \textcolor{keywordflow}{if} A.shape[0] != A.shape[1]:
00362                 log\_.error(\textcolor{stringliteral}{'Atomic data must be a NxN matrix'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling}) 
00363             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00364                 A = A[0:self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}, 0:self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}]
00365             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels} = A.shape[0]
00366         \textcolor{keywordflow}{else}:
00367             \textcolor{comment}{# This is the old format}
00368             need\_NIST = \textcolor{keyword}{False}
00369             units = data[1].split()[0]
00370             at\_data = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}][2::], dtype=\textcolor{stringliteral}{'float'})
00371             comments\_tab = [d \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]==\textcolor{stringliteral}{'***'}]
00372             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments} = \{\}
00373             \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} comments\_tab:
00374                 key = com.split()[1]
00375                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[key] = com.split(key)[1].strip()
00376             A = at\_data.copy()
00377             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00378                 A = at\_data[0:self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}, 2:self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}+2]
00379             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels} = A.shape[0]
00380             
00381             
00382             \textcolor{comment}{# Read Es}
00383             energy = at\_data[:,0]
00384             \textcolor{keywordflow}{if} units == \textcolor{stringliteral}{'eV'}: 
00385                 energy /= CST.RYD\_EV * CST.RYD\_ANG
00386             \textcolor{keywordflow}{elif} units == \textcolor{stringliteral}{'Rydberg'}:
00387                 energy /= CST.RYD\_ANG
00388             \textcolor{keywordflow}{elif} units == \textcolor{stringliteral}{'cm-1'}:
00389                 energy /= 1e8
00390             \textcolor{comment}{# Read statistical weights}
00391             stat\_weight = at\_data[:,1]
00392             
00393             \textcolor{comment}{# Read As}
00394             A = np.zeros([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}])
00395             A[:,:] = at\_data[:,2:]
00396 
00397         
\hypertarget{pynebcore_8py_source_l00398}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{00398}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST} = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels})
00399         
00400         web = \textcolor{stringliteral}{'Ref. \{0\} of NIST 2014 (try this:
       http://physics.nist.gov/cgi-bin/ASBib1/get\_ASBib\_ref.cgi?db=el&db\_id=\{0\}&comment\_code=&element=\{1\}&spectr\_charge=\{2\}&'}
00401         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
00402             energy = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST}[\textcolor{stringliteral}{'energy'}] / 1e8
00403             stat\_weight = 1 + 2 * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST}[\textcolor{stringliteral}{'J'}]
00404             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'VACUUM'}] = \textcolor{stringliteral}{'1'}
00405             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'NOTE'}] = \textcolor{stringliteral}{'Energy levels'}
00406             source = \textcolor{stringliteral}{'\(\backslash\)n    '}
00407             \textcolor{keywordflow}{for} ref \textcolor{keywordflow}{in} np.unique(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a95b245a32e3666f6313e40a6ea8e627c}{NIST}[\textcolor{stringliteral}{'ref'}]):
00408                 source = source + web.format(ref[1:], self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec}) + \textcolor{stringliteral}{')\(\backslash\)n  + '} 
00409             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'SOURCE'}] = source[0:-5]
00410         \textcolor{keywordflow}{elif} need\_NIST:
00411             log\_.error(\textcolor{stringliteral}{'NIST data are needed for this format of atomic data'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling}) 
00412         
\hypertarget{pynebcore_8py_source_l00413}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{00413}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy} = energy
\hypertarget{pynebcore_8py_source_l00414}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{00414}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{\_StatWeight} = stat\_weight
\hypertarget{pynebcore_8py_source_l00415}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{00415}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A} = A
\hypertarget{pynebcore_8py_source_l00416}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a58e3b3de028fdda9d52cade8e378fe2d}{00416}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a58e3b3de028fdda9d52cade8e378fe2d}{atomNLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}
00417         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'GSCONFIG'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
\hypertarget{pynebcore_8py_source_l00418}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aed6d711337dfb385d65306e7f3c4d06d}{00418}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aed6d711337dfb385d65306e7f3c4d06d}{gs} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'GSCONFIG'}]
00419         \textcolor{keywordflow}{else}:
00420             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_aed6d711337dfb385d65306e7f3c4d06d}{gs} = \textcolor{stringliteral}{'unknown'}
00421         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00422             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec}:
00423                 log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.format(
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'SPECTRUM'}],
00424                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a6a8de35e7e1695c3dd670b46c776f45e}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00425         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00426             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}]:
00427                 log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}. Check
       the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1163ceae1cb5263c39055a9c02f5c051}{atomFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'ATOM'}],
00428                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a330140eda27048983020488e50c5858a}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00429         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'VACUUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00430             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[\textcolor{stringliteral}{'VACUUM'}] == \textcolor{stringliteral}{'1'}:
00431                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{E\_in\_vacuum} = \textcolor{keyword}{True}
00432     
\hypertarget{pynebcore_8py_source_l00433}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a11e49056b635286cb2a72631dd7e29b5}{00433}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a11e49056b635286cb2a72631dd7e29b5}{initWaves}(self):
00434         \textcolor{stringliteral}{"""}
00435 \textcolor{stringliteral}{        Initialization of wave\_Ang}
00436 \textcolor{stringliteral}{        }
00437 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l00438}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{00438}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{wave\_Ang} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}))
00439         
00440         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}):
00441             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
00442                 wave = 1. / abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy}[j])
00443                 \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a468f4b6f8f580799b9d4a2a81e79941a}{E\_in\_vacuum}:
00444                     wave = \hyperlink{namespacepyneb_1_1utils_1_1physics_ae7f2ba7fc89983bb4d9fa50eb37f4b36}{vactoair}(wave)
00445                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{wave\_Ang}[i, j] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1366f737e51b5a0f3706b68b0d06bfe5}{wave\_Ang}[j, i] = wave
00446         
\hypertarget{pynebcore_8py_source_l00447}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ad2a85bdc0d1803e4b5fe7b77aecc0ff9}{00447}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ad2a85bdc0d1803e4b5fe7b77aecc0ff9}{\_test\_lev}(self, level):
00448         \textcolor{stringliteral}{"""}
00449 \textcolor{stringliteral}{        Test whether selected level is legal}
00450 \textcolor{stringliteral}{}
00451 \textcolor{stringliteral}{        Parameters:}
00452 \textcolor{stringliteral}{            - level        selected atom level}
00453 \textcolor{stringliteral}{}
00454 \textcolor{stringliteral}{        """}       
00455         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}:
00456             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a1203cca412f63428b8ff106d608b8d83}{NLevels}),
00457                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling})
00458 
00459     
\hypertarget{pynebcore_8py_source_l00460}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a86085b5ba21ae2ce44663130af2bbf01}{00460}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a86085b5ba21ae2ce44663130af2bbf01}{getSources}(self):
00461         \textcolor{stringliteral}{"""}
00462 \textcolor{stringliteral}{        Return bibliographic sources for atomic data, as listed in the headers of the fits files}
00463 \textcolor{stringliteral}{        }
00464 \textcolor{stringliteral}{        """}
00465         sources = []
00466         sources\_str = \{\}
00467         notes = \{\}
00468         \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}:
00469             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} com:
00470                 number = com.split(\textcolor{stringliteral}{'SOURCE'})[1]
00471                 sources\_str[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[com]
00472             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'NOTE'} \textcolor{keywordflow}{in} com:
00473                 number = com.split(\textcolor{stringliteral}{'NOTE'})[1]
00474                 notes[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a935b1baf76c6450653d1ebb673bc8f08}{comments}[com]
00475         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} sources\_str:
00476             \textcolor{keywordflow}{try}:
00477                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}: \{2\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, notes[key], sources\_str[key])) 
00478             \textcolor{keywordflow}{except}:
00479                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a5c98b93fd3ae381abca175c8baee6c0e}{atom}, sources[key]))
00480         \textcolor{keywordflow}{return} sources
00481 
\hypertarget{pynebcore_8py_source_l00482}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a7b84583619c025fcd90d2d00308be250}{00482}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a7b84583619c025fcd90d2d00308be250}{printSources}(self):
00483         
00484         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a86085b5ba21ae2ce44663130af2bbf01}{getSources}():
00485             print(source)    
00486     
\hypertarget{pynebcore_8py_source_l00487}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a858e1ecef317c56f7f9e771ed0b5aca9}{00487}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a858e1ecef317c56f7f9e771ed0b5aca9}{getA}(self, lev\_i= -1, lev\_j= -1):
00488         \textcolor{stringliteral}{"""}
00489 \textcolor{stringliteral}{        Return the transition probability data. }
00490 \textcolor{stringliteral}{        If no arguments are given, the whole array of A is returned.}
00491 \textcolor{stringliteral}{        A specific A value can be obtained by giving either the upper and lower levels.}
00492 \textcolor{stringliteral}{            }
00493 \textcolor{stringliteral}{        Usage:}
00494 \textcolor{stringliteral}{            A\_O3 = O3.getA()          # The whole A array is stored in A\_O3}
00495 \textcolor{stringliteral}{            O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed}
00496 \textcolor{stringliteral}{            O3.getA(2, 4)      # Returns 0}
00497 \textcolor{stringliteral}{}
00498 \textcolor{stringliteral}{        Parameters:}
00499 \textcolor{stringliteral}{            - lev\_i  upper level of transition (default= -1, returns complete array)}
00500 \textcolor{stringliteral}{            - lev\_j  lower level of transition (default= -1, returns complete array)}
00501 \textcolor{stringliteral}{            }
00502 \textcolor{stringliteral}{        """}
00503         
00504         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ad2a85bdc0d1803e4b5fe7b77aecc0ff9}{\_test\_lev}(lev\_i)
00505         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ad2a85bdc0d1803e4b5fe7b77aecc0ff9}{\_test\_lev}(lev\_j)
00506         \textcolor{keywordflow}{if} (lev\_i == -1):
00507             \textcolor{keywordflow}{if} (lev\_j == -1):
00508                 \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A}
00509             \textcolor{keywordflow}{else}:
00510                 \textcolor{keywordflow}{return} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A}[lev\_i - 1])
00511         \textcolor{keywordflow}{else}:
00512             \textcolor{keywordflow}{return} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ae3bb56f0dd8397279d1e394768404903}{\_A}[lev\_i - 1, lev\_j - 1])       
00513     
\hypertarget{pynebcore_8py_source_l00514}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a0b913fd7ff9b235a699c735b33c96e85}{00514}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_a0b913fd7ff9b235a699c735b33c96e85}{getStatWeight}(self, level= -1):
00515         \textcolor{stringliteral}{"""}
00516 \textcolor{stringliteral}{        Returns the array of statistical weights of the ion (if no arguments are given) }
00517 \textcolor{stringliteral}{            or the statistical weight of level i (if i is given as an argument, }
00518 \textcolor{stringliteral}{            with the optional keyword level).}
00519 \textcolor{stringliteral}{            }
00520 \textcolor{stringliteral}{        Usage:}
00521 \textcolor{stringliteral}{            O3.getStatWeight()}
00522 \textcolor{stringliteral}{            O3.getStatWeight(level=4)}
00523 \textcolor{stringliteral}{            O3.getStatWeight(4)}
00524 \textcolor{stringliteral}{                      }
00525 \textcolor{stringliteral}{        Parameters:}
00526 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00527 \textcolor{stringliteral}{            }
00528 \textcolor{stringliteral}{        """}
00529         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ad2a85bdc0d1803e4b5fe7b77aecc0ff9}{\_test\_lev}(level)
00530         
00531         \textcolor{keywordflow}{if} level == -1:
00532             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{\_StatWeight}
00533         \textcolor{keywordflow}{else}:
00534             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ac3e956654089ac966a877dbaa003e3ea}{\_StatWeight}[level-1]
00535         
00536     
\hypertarget{pynebcore_8py_source_l00537}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af747dc13a858a4eacc6107aedad89bd0}{00537}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af747dc13a858a4eacc6107aedad89bd0}{getEnergy}(self, level= -1, unit='1/Ang'):
00538         \textcolor{stringliteral}{"""}
00539 \textcolor{stringliteral}{        Return energy level of selected level (or array of energy levels, if level not given) }
00540 \textcolor{stringliteral}{            in Angstrom^-1 (default) or another unit}
00541 \textcolor{stringliteral}{        }
00542 \textcolor{stringliteral}{        Usage:}
00543 \textcolor{stringliteral}{            O3.getEnergy(4, unit='eV')}
00544 \textcolor{stringliteral}{        Parameters:}
00545 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
00546 \textcolor{stringliteral}{            - unit   [str] one of '1/Ang' (default), 'eV', or 'Ryd'    }
00547 \textcolor{stringliteral}{            }
00548 \textcolor{stringliteral}{        """}
00549         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_ad2a85bdc0d1803e4b5fe7b77aecc0ff9}{\_test\_lev}(level)
00550 
00551         unit\_dict = \{\textcolor{stringliteral}{'1/Ang'}: 1.,
00552                      \textcolor{stringliteral}{'Ryd'}: CST.RYD\_ANG,
00553                      \textcolor{stringliteral}{'eV'}: CST.RYD\_ANG * CST.RYD\_EV,
00554                      \textcolor{stringliteral}{'cm-1'}: 1e8,
00555                      \textcolor{stringliteral}{'erg'}: CST.HPLANCK * CST.CLIGHT * 1e8\}
00556         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} unit\_dict:
00557             self.log\_.warn(\textcolor{stringliteral}{'Unit \{0\} unknown, using 1/Ang'}.format(unit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af5c364ae799620ff1af6870cf78ae19b}{calling} + \textcolor{stringliteral}{'.getEnergy'})
00558             unit = \textcolor{stringliteral}{'1/Ang'}        
00559         
00560         \textcolor{keywordflow}{if} level == -1:
00561             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy} * unit\_dict[unit]
00562         \textcolor{keywordflow}{else}:
00563             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii_af9153c0218e68a785d82510cb2ee6248}{\_Energy}[level-1] * unit\_dict[unit]
00564         
00565 
\hypertarget{pynebcore_8py_source_l00566}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_stout}{00566} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_stout}{\_AtomDataStout}(object):
00567     
\hypertarget{pynebcore_8py_source_l00568}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_stout_a7383c7e5520821be23b76ab0c5b3a942}{00568}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_stout_a7383c7e5520821be23b76ab0c5b3a942}{\_\_init\_\_}(self):
00569         \textcolor{keywordflow}{pass}
00570         
\hypertarget{pynebcore_8py_source_l00571}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits}{00571} \textcolor{keyword}{class }\_CollDataFits(object):
00572     
\hypertarget{pynebcore_8py_source_l00573}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34dd1c347e0328a9f282d418e14cf653}{00573}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34dd1c347e0328a9f282d418e14cf653}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, OmegaInterp='Cheb', noExtrapol = False, 
      NLevels=None):
\hypertarget{pynebcore_8py_source_l00574}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a42f3e78e841a8714f2602866843d77da}{00574}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a42f3e78e841a8714f2602866843d77da}{log\_} = log\_
00575         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00576}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{00576}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} = atom
\hypertarget{pynebcore_8py_source_l00577}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{00577}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00578}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{00578}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[1])
00579         \textcolor{keywordflow}{else}:
00580             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem} = elem
00581             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec} = int(spec)
00582             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec})
\hypertarget{pynebcore_8py_source_l00583}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a40d926369df2d46e0799a66e4c9d9a73}{00583}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a40d926369df2d46e0799a66e4c9d9a73}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem}]
\hypertarget{pynebcore_8py_source_l00584}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{00584}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{noExtrapol} = noExtrapol
\hypertarget{pynebcore_8py_source_l00585}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{00585}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}
\hypertarget{pynebcore_8py_source_l00586}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{00586}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} = NLevels
00587         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aaed9e4985dc03f6120dfc714a3595536}{\_loadFit}()
00588         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ab8bb7b193ca2b9ccf6adf11453347226}{initOmegas}(OmegaInterp=OmegaInterp)
\hypertarget{pynebcore_8py_source_l00589}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{00589}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TUNIT1'}]
00590         \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
00591             \textcolor{keyword}{def }transfo\_tem(x):
00592                 y = np.log10(x)
00593                 \textcolor{keywordflow}{if} np.ndim(y) == 0:
00594                     y = np.array(y)
00595                 \textcolor{keywordflow}{return} y
00596         \textcolor{keywordflow}{elif} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
00597                 \textcolor{keyword}{def }transfo\_tem(x):
00598                     y = x / 1e4
00599                     \textcolor{keywordflow}{if} np.ndim(y) == 0:
00600                         y = np.array(y)
00601                     \textcolor{keywordflow}{return} y
00602         \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
00603             \textcolor{keyword}{def }transfo\_tem(x):
00604                 y = x
00605                 \textcolor{keywordflow}{return} x
\hypertarget{pynebcore_8py_source_l00606}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afa9318fd2557709e968682f47cefa379}{00606}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afa9318fd2557709e968682f47cefa379}{\_transfo\_tem} = transfo\_tem
00607         
00608         
\hypertarget{pynebcore_8py_source_l00609}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aaed9e4985dc03f6120dfc714a3595536}{00609}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aaed9e4985dc03f6120dfc714a3595536}{\_loadFit}(self):
00610         \textcolor{stringliteral}{"""}
00611 \textcolor{stringliteral}{        Load fits file of atomic data.}
00612 \textcolor{stringliteral}{        The fits files names are defined in the atomicData Object}
00613 \textcolor{stringliteral}{}
00614 \textcolor{stringliteral}{        """}                 
\hypertarget{pynebcore_8py_source_l00615}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{00615}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}, data\_type=\textcolor{stringliteral}{'coll'})
\hypertarget{pynebcore_8py_source_l00616}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{00616}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} 
00617         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00618             self.log\_.error(\textcolor{stringliteral}{'No coll data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00619             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00620         
00621         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} \textcolor{keywordflow}{in} config.DataFiles:
00622             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}]:
00623                 config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile})
00624         \textcolor{keywordflow}{else}:
00625             config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}]
00626             
\hypertarget{pynebcore_8py_source_l00627}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{00627}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{collPath} = atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile})
\hypertarget{pynebcore_8py_source_l00628}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6a16fc5f5206b988d99be1511d158ada}{00628}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6a16fc5f5206b988d99be1511d158ada}{collFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{collPath} 
00629         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ad08da92d019bbc87139f04fb7d765411}{collPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile})
00630         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00631             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})        
00632         collFits = pyfits.open(file\_to\_open, ignore\_missing\_end=\textcolor{keyword}{True})
00633         self.log\_.message(\textcolor{stringliteral}{'Reading coll data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a2f7b35cc563095fb2a894b2cc994cfe5}{collFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00634         
00635         CollExt = collFits[1]
00636 
00637         \textcolor{comment}{#Read headers}
\hypertarget{pynebcore_8py_source_l00638}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{00638}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader} = CollExt.header
\hypertarget{pynebcore_8py_source_l00639}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a5526868efdb550fee08608f77262b106}{00639}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a5526868efdb550fee08608f77262b106}{CollExtNames} = CollExt.columns.names
00640 
00641         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}:
00642             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec}:
00643                 log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.format(
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'SPECTRUM'}],
00644                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a781126fa0e5b9bb0a4f6ae5afe4fd9a9}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00645         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}:
00646             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem}]:
00647                 log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}. Check
       the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'ATOM'}],
00648                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac34163e88a48564f05f1cf5aa8d4683a}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00649                 
00650         \textcolor{comment}{#Read data}
\hypertarget{pynebcore_8py_source_l00651}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34f70aba84a783d1a5a8633f797f7bb1}{00651}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a34f70aba84a783d1a5a8633f797f7bb1}{\_CollData} = CollExt.data
00652         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00653             \textcolor{keywordflow}{try}:
00654                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'N\_LEVELS'}]
00655             \textcolor{keywordflow}{except}:
00656                 log\_.error(\textcolor{stringliteral}{'N\_LEVELS is not set in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ae3c29d8fc35102d34f04c618f578cd86}{collFitsFile}))
00657             
00658         self.log\_.message(\textcolor{stringliteral}{'NLevels of collisional data: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}),
00659                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00660         collFits.close()
00661 
00662 
\hypertarget{pynebcore_8py_source_l00663}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ab8bb7b193ca2b9ccf6adf11453347226}{00663}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ab8bb7b193ca2b9ccf6adf11453347226}{initOmegas}(self, OmegaInterp='Cheb'):
00664         \textcolor{stringliteral}{"""}
00665 \textcolor{stringliteral}{        Initialization of the Chebishev orders and coefficients. This method is called by \_\_init\_\_ and when
       }
00666 \textcolor{stringliteral}{        OmegaInterp is changed.}
00667 \textcolor{stringliteral}{}
00668 \textcolor{stringliteral}{        Parameter:}
00669 \textcolor{stringliteral}{            - OmegaInterp   one of ('Cheb', 'Linear')}
00670 \textcolor{stringliteral}{        }
00671 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l00672}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{00672}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{OmegaInterp} = OmegaInterp
\hypertarget{pynebcore_8py_source_l00673}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{00673}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac2e555f92570ed4df42926d0c415ac4c}{getChebOrder}()
\hypertarget{pynebcore_8py_source_l00674}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_af8eaa90b2ddbf77c0a78b648e9f66971}{00674}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_af8eaa90b2ddbf77c0a78b648e9f66971}{ChebCoeffs} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6f9e4fd3e9196fe259da3175e14b88b9}{\_getChebCoeffArray}()
00675 
00676 
\hypertarget{pynebcore_8py_source_l00677}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{00677}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{\_test\_lev}(self, level):
00678         \textcolor{stringliteral}{"""}
00679 \textcolor{stringliteral}{        Test whether selected level is legal}
00680 \textcolor{stringliteral}{}
00681 \textcolor{stringliteral}{        Parameters:}
00682 \textcolor{stringliteral}{            - level        selected atom level}
00683 \textcolor{stringliteral}{}
00684 \textcolor{stringliteral}{        """}       
00685         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}:
00686             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\} (maximum: \{1\})'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}),
00687                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00688         
00689         
\hypertarget{pynebcore_8py_source_l00690}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aa5874082b04a926561f86ee86bc65531}{00690}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aa5874082b04a926561f86ee86bc65531}{getSources}(self):
00691         \textcolor{stringliteral}{"""}
00692 \textcolor{stringliteral}{        Return bibliographic sources for atomic data, as listed in the headers of the fits files.}
00693 \textcolor{stringliteral}{}
00694 \textcolor{stringliteral}{        """}
00695         sources = []
00696         header = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}
00697         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(header.items())):
00698             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} header.items()[i][0]:
00699                 number = header.items()[i][0].lstrip(\textcolor{stringliteral}{'SOURCE'})
00700                 \textcolor{keywordflow}{try}:
00701                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} + \textcolor{stringliteral}{': '} + header.get(\textcolor{stringliteral}{'NOTE'} + str(number)) + \textcolor{stringliteral}{':'}, 
      header.get(\textcolor{stringliteral}{'SOURCE'} + str(number)))
00702                 \textcolor{keywordflow}{except}:
00703                     sources.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a8bbd2e846954f94878e90ebdf0e51772}{atom} + \textcolor{stringliteral}{': '} + \textcolor{stringliteral}{'Collision strengths:'}, header.get(\textcolor{stringliteral}{'SOURCE'} + str
      (number)))
00704         \textcolor{keywordflow}{return} sources
00705     
\hypertarget{pynebcore_8py_source_l00706}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3bee57ecbbe7d4156299b385e7b0c624}{00706}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3bee57ecbbe7d4156299b385e7b0c624}{printSources}(self):
00707         
00708         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aa5874082b04a926561f86ee86bc65531}{getSources}():
00709             print(source)    
00710     
\hypertarget{pynebcore_8py_source_l00711}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac2e555f92570ed4df42926d0c415ac4c}{00711}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac2e555f92570ed4df42926d0c415ac4c}{getChebOrder}(self, lev\_i= -1, lev\_j= -1):
00712         \textcolor{stringliteral}{"""}
00713 \textcolor{stringliteral}{        Return order of Chebyshev polynomial fitting the collision strengths of selected transition.}
00714 \textcolor{stringliteral}{        If transition not specified, return result for all transitions.}
00715 \textcolor{stringliteral}{        }
00716 \textcolor{stringliteral}{        Usage:}
00717 \textcolor{stringliteral}{            O3.getChebOrder(4, 2)}
00718 \textcolor{stringliteral}{        }
00719 \textcolor{stringliteral}{        Parameters:}
00720 \textcolor{stringliteral}{            - lev\_i  upper level (default= -1, returns complete array)}
00721 \textcolor{stringliteral}{            - lev\_j  lower level (default= -1, returns complete array)}
00722 \textcolor{stringliteral}{}
00723 \textcolor{stringliteral}{        """}
00724         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{\_test\_lev}(lev\_i)
00725         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{\_test\_lev}(lev\_j)
00726         \textcolor{keywordflow}{if} (lev\_i == -1):
00727             \textcolor{keywordflow}{if} (lev\_j == -1):
00728                 ChebOrder = np.zeros([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}])
00729                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} - 1):
00730                     lev\_i = i + 1
00731                     j = i + 1
00732                     \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}):
00733                         lev\_j = j + 1
00734                         fieldName = \textcolor{stringliteral}{'Omega(\{0\}->\{1\})'}.format(lev\_j, lev\_i)
00735                         index = self.CollExtNames.index(fieldName)
00736                         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{OmegaInterp} == \textcolor{stringliteral}{'Linear'}:
00737                             ChebOrder[j][i] = -1
00738                         \textcolor{keywordflow}{else}:
00739                             ChebOrder[j][i] = int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TUNIT\{0\}'}.format(index + 1)])
00740                         j += 1
00741         \textcolor{keywordflow}{else}:   
00742             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a3e15df449393d23d1ac760671b5828cc}{OmegaInterp} == \textcolor{stringliteral}{'Linear'}:
00743                 ChebOrder = -1
00744             \textcolor{keywordflow}{else}:
00745                 fieldName = \textcolor{stringliteral}{'Omega(\{0\}->\{1\})'}.format(lev\_i, lev\_j)
00746                 index = self.CollExtNames.index(fieldName)
00747                 ChebOrder = int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TUNIT\{0\}'}.format(index + 1)])
00748         \textcolor{keywordflow}{return} ChebOrder
00749 
00750 
\hypertarget{pynebcore_8py_source_l00751}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6f9e4fd3e9196fe259da3175e14b88b9}{00751}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6f9e4fd3e9196fe259da3175e14b88b9}{\_getChebCoeffArray}(self):
00752         \textcolor{stringliteral}{"""}
00753 \textcolor{stringliteral}{        Return coefficients of Chebyshev fit of all transitions in a given atom}
00754 \textcolor{stringliteral}{            (3D array of Chebyshev fits; the first two dimensions are atomic levels,}
00755 \textcolor{stringliteral}{            the third is the array of coefficients of the Chebyshev polynomial}
00756 \textcolor{stringliteral}{            for the corresponding transition.}
00757 \textcolor{stringliteral}{}
00758 \textcolor{stringliteral}{        """}
00759 
00760         \textcolor{keyword}{def }\_chebyshevFit(temArray, omegaDict):
00761             \textcolor{stringliteral}{"""}
00762 \textcolor{stringliteral}{            Return coefficients of Chebyshev fit of a given transition}
00763 \textcolor{stringliteral}{            }
00764 \textcolor{stringliteral}{            Parameters:}
00765 \textcolor{stringliteral}{                - temArray    array of temperature points in collisional strengths data}
00766 \textcolor{stringliteral}{                - omegaDict   order of Chebyshev fit + array of collisional strengths }
00767 \textcolor{stringliteral}{                                of a given transition}
00768 \textcolor{stringliteral}{}
00769 \textcolor{stringliteral}{            """}
00770             warnings.filterwarnings(\textcolor{stringliteral}{'ignore'}, \textcolor{stringliteral}{"The fit may be poorly conditioned"})
00771 
00772             \textcolor{comment}{# -1 because (IRAF's order) = (polynomial degree + 1)}
00773             order = omegaDict[\textcolor{stringliteral}{'order'}] - 1
00774             data = omegaDict[\textcolor{stringliteral}{'data'}]
00775             coeffs = chebyshev.chebfit(temArray, data, order)
00776             \textcolor{keywordflow}{return} coeffs
00777         
00778         \textcolor{keywordflow}{if} np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}) == -1:
00779             \textcolor{keywordflow}{return} -1
00780         \textcolor{keywordflow}{else}:
00781             ChebCoeffArray = np.zeros([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, np.max(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder})])
00782             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} - 1):
00783                 lev\_i = i + 1
00784                 j = i + 1
00785                 \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}):
00786                     lev\_j = j + 1
00787                     \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1] == -1:
00788                         ChebCoeffArray[i, j, 0: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1]] = -1
00789                     \textcolor{keywordflow}{else}:
00790                         myOmega = \{\textcolor{stringliteral}{'order'}: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1],
00791                                    \textcolor{stringliteral}{'data'}: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{getOmegaArray}(lev\_j, lev\_i)\}
00792                         \textcolor{keywordflow}{if} myOmega[\textcolor{stringliteral}{'order'}] != 0.0:
00793                             ChebCoeffArray[i, j, 0: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_j - 1, lev\_i - 1]] = \(\backslash\)
00794                                 np.array(\_chebyshevFit(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}(), myOmega))
00795                     j += 1
00796             \textcolor{keywordflow}{return} ChebCoeffArray
00797 
00798 
00799 
\hypertarget{pynebcore_8py_source_l00800}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{00800}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{getOmegaArray}(self, lev\_i= -1, lev\_j= -1):
00801         \textcolor{stringliteral}{"""}
00802 \textcolor{stringliteral}{        Return array of original tabulated collision strengths for a given transition, }
00803 \textcolor{stringliteral}{            as a function of temperature.}
00804 \textcolor{stringliteral}{        }
00805 \textcolor{stringliteral}{        Usage:}
00806 \textcolor{stringliteral}{            O3.getOmegaArray()}
00807 \textcolor{stringliteral}{        }
00808 \textcolor{stringliteral}{        Parameters:}
00809 \textcolor{stringliteral}{            - lev\_j  lower level (default= -1, returns complete array)}
00810 \textcolor{stringliteral}{            - lev\_i  upper level (default= -1, returns complete array)}
00811 \textcolor{stringliteral}{}
00812 \textcolor{stringliteral}{        """}
00813         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{\_test\_lev}(lev\_i)
00814         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{\_test\_lev}(lev\_j)
00815         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
00816             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00817             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}            
00818         \textcolor{keywordflow}{elif} lev\_i == -1 \textcolor{keywordflow}{or} lev\_j == -1:
00819             result = []
00820             \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.\_CollData.names:
00821                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{'Omega'} \textcolor{keywordflow}{in} name:
00822                     result.append(name + \textcolor{stringliteral}{": "} + str(self.\_CollData.field(name)))
00823             \textcolor{keywordflow}{return} result
00824         \textcolor{keywordflow}{else}:
00825             \textcolor{keywordflow}{return} (self.\_CollData.field(\textcolor{stringliteral}{'Omega(\{0\}->\{1\})'}.format(lev\_i, lev\_j)))
00826 
00827 
\hypertarget{pynebcore_8py_source_l00828}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a07beca7cf9ee37f231754f0458fb8c2f}{00828}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a07beca7cf9ee37f231754f0458fb8c2f}{getOmega}(self, tem, lev\_i= -1, lev\_j= -1):
00829         \textcolor{stringliteral}{"""}
00830 \textcolor{stringliteral}{        Return interpolated value of the collision strength value at the given temperature }
00831 \textcolor{stringliteral}{            for the complete array or a specified transition.}
00832 \textcolor{stringliteral}{}
00833 \textcolor{stringliteral}{        Usage:}
00834 \textcolor{stringliteral}{            O3.getOmega(15000.)}
00835 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4])}
00836 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)}
00837 \textcolor{stringliteral}{        }
00838 \textcolor{stringliteral}{        Parameters:}
00839 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
00840 \textcolor{stringliteral}{            - lev\_i  upper level}
00841 \textcolor{stringliteral}{            - lev\_j  lower level}
00842 \textcolor{stringliteral}{}
00843 \textcolor{stringliteral}{        """}
00844         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{\_test\_lev}(lev\_i)
00845         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0654555565cc60412d6f639a9a3289ff}{\_test\_lev}(lev\_j)
00846         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
00847             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given: \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a43c9d096f9508cb475cb4fc3552e1979}{calling})
00848             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}            
00849         tem\_in\_file\_units = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_afa9318fd2557709e968682f47cefa379}{\_transfo\_tem}(tem)
00850         TemArray = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}()
00851         \textcolor{keywordflow}{if} (lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1):
00852             tem = np.asarray(tem)
00853             res\_shape = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}]
00854             \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
00855                 res\_shape.append(sh)
00856             Omega = np.zeros(res\_shape)
00857     
00858             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels} - 1):
00859                 j = i + 1
00860                 \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a64b97a86b4dfb53e4cba3ce8ac0fdf00}{NLevels}):
00861                     Omega[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a07beca7cf9ee37f231754f0458fb8c2f}{getOmega}(tem, j + 1, i + 1)
00862                     j += 1
00863         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_i - 1, lev\_j - 1] != -1:
00864             fit = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_af8eaa90b2ddbf77c0a78b648e9f66971}{ChebCoeffs}[lev\_j - 1, lev\_i - 1, 0: self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_aeb6a6f312ca21c1e1b3aa72225a0d442}{\_ChebOrder}[lev\_i - 1, lev\_j - 1]]
00865             tem\_eval = tem\_in\_file\_units
00866             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{noExtrapol} \textcolor{keywordflow}{or} config.get\_noExtrapol():
00867                 leftExtrapol = np.NAN
00868                 rightExtrapol = np.NAN
00869             \textcolor{keywordflow}{else}:
00870                 leftExtrapol = TemArray[0]
00871                 rightExtrapol = TemArray[-1]
00872             
00873             \textcolor{keywordflow}{if} np.ndim(tem\_eval) > 0:
00874                 left = (tem\_eval < TemArray[0])
00875                 tem\_eval[left] = leftExtrapol
00876                 right = (tem\_eval > TemArray[-1])
00877                 tem\_eval[right] = rightExtrapol
00878             \textcolor{keywordflow}{else}:
00879                 \textcolor{keywordflow}{if} tem\_eval < TemArray[0]:
00880                     tem\_eval = leftExtrapol
00881                 \textcolor{keywordflow}{elif} tem\_eval > TemArray[-1]:
00882                     tem\_eval = rightExtrapol
00883             Omega = chebyshev.chebval(tem\_eval, fit)
00884         \textcolor{keywordflow}{else}:
00885             OmegaArray = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_acca4425c4b7d2e08d0b1b9fe6e1846a7}{getOmegaArray}(lev\_i, lev\_j)
00886             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a97b30abb66948d40dc2077a3c3b15231}{noExtrapol} \textcolor{keywordflow}{or} config.get\_noExtrapol():
00887                 leftExtrapol = np.NAN
00888                 rightExtrapol = np.NAN
00889             \textcolor{keywordflow}{else}:
00890                 leftExtrapol = OmegaArray[0]
00891                 rightExtrapol = OmegaArray[-1]
00892             Omega = np.interp(tem\_in\_file\_units, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}(), OmegaArray,
00893                               left=leftExtrapol, right=rightExtrapol)
00894         \textcolor{keywordflow}{return} np.squeeze(Omega)
00895 
00896 
\hypertarget{pynebcore_8py_source_l00897}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{00897}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a6b53fa73abb34d16f1066dc52604f25c}{getTemArray}(self, keep\_unit=True):
00898         \textcolor{stringliteral}{"""}
00899 \textcolor{stringliteral}{        Return array of tabulated original temperature points (as in fits file) }
00900 \textcolor{stringliteral}{            of collision strengths.}
00901 \textcolor{stringliteral}{        }
00902 \textcolor{stringliteral}{        Parameters:}
00903 \textcolor{stringliteral}{            - keep\_unit   return temperature in file units (default) or change it to Kelvin (False)}
00904 \textcolor{stringliteral}{}
00905 \textcolor{stringliteral}{}
00906 \textcolor{stringliteral}{        """}
00907         tem\_in\_file = self.\_CollData.field(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_ac869d4a1a70ad7d42881b0e19a69ab4c}{CollHeader}[\textcolor{stringliteral}{'TTYPE1'}])
00908         \textcolor{keywordflow}{if} keep\_unit:
00909             \textcolor{keywordflow}{return} tem\_in\_file
00910         \textcolor{keywordflow}{else}:            
00911             \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
00912                 \textcolor{keywordflow}{return} pow(10., tem\_in\_file)
00913             \textcolor{keywordflow}{else}:
00914                 \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits_a0ec412b766393f099d604527da57c565}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
00915                     \textcolor{keywordflow}{return} tem\_in\_file * 1.e4
00916                 \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
00917                     \textcolor{keywordflow}{return} tem\_in\_file
00918 
\hypertarget{pynebcore_8py_source_l00919}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii}{00919} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii}{\_CollDataAscii}(object):
00920 
00921     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad4514c646ad1e65d9d5e10c80d215041}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, OmegaInterp='Linear', noExtrapol = False, 
\hypertarget{pynebcore_8py_source_l00922}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad4514c646ad1e65d9d5e10c80d215041}{00922}                  NLevels=\textcolor{keywordtype}{None}):
\hypertarget{pynebcore_8py_source_l00923}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a9277c108416ceb0bbdca484a4a246b5c}{00923}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a9277c108416ceb0bbdca484a4a246b5c}{log\_} = log\_
00924         
00925         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l00926}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{00926}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom} = atom
\hypertarget{pynebcore_8py_source_l00927}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{00927}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l00928}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{00928}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[1])
00929         \textcolor{keywordflow}{else}:
00930             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem} = elem
00931             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec} = int(spec)
00932             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec})
\hypertarget{pynebcore_8py_source_l00933}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{00933}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} = NLevels
\hypertarget{pynebcore_8py_source_l00934}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a39c9697691d3e8e8d7f99c05e0baa4a9}{00934}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a39c9697691d3e8e8d7f99c05e0baa4a9}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem}]
\hypertarget{pynebcore_8py_source_l00935}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa4f6c8d0a2a8e4ac6503d67b4a51188d}{00935}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa4f6c8d0a2a8e4ac6503d67b4a51188d}{noExtrapol} = noExtrapol
\hypertarget{pynebcore_8py_source_l00936}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{00936}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}
00937         \textcolor{keywordflow}{if} OmegaInterp != \textcolor{stringliteral}{'Linear'}:
00938             self.log\_.error(\textcolor{stringliteral}{'Ascii files does not support other interpolation than Linear'}, 
00939                             calling = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00940         
00941         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a55b8181b2259b06ceb5bc401834b276f}{\_loadAscii}()
00942         \textcolor{comment}{#self.initOmegas(OmegaInterp=OmegaInterp)}
00943         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'T\_UNIT'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
\hypertarget{pynebcore_8py_source_l00944}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{00944}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'T\_UNIT'}]
00945         \textcolor{keywordflow}{else}:
00946             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} = \textcolor{stringliteral}{"K/10000"} \textcolor{comment}{# Default value}
00947         \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
00948             \textcolor{keyword}{def }transfo\_tem(x):
00949                 y = np.log10(x)
00950                 \textcolor{keywordflow}{if} np.ndim(y) == 0:
00951                     y = np.array(y)
00952                 \textcolor{keywordflow}{return} y
00953         \textcolor{keywordflow}{elif} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
00954                 \textcolor{keyword}{def }transfo\_tem(x):
00955                     y = x / 1e4
00956                     \textcolor{keywordflow}{if} np.ndim(y) == 0:
00957                         y = np.array(y)
00958                     \textcolor{keywordflow}{return} y
00959         \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
00960                 \textcolor{keyword}{def }transfo\_tem(x):
00961                     y = x
00962                     \textcolor{keywordflow}{return} x
\hypertarget{pynebcore_8py_source_l00963}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf268c621d916f4ea71bb5825e249200}{00963}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf268c621d916f4ea71bb5825e249200}{\_transfo\_tem} = transfo\_tem
00964 
\hypertarget{pynebcore_8py_source_l00965}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a55b8181b2259b06ceb5bc401834b276f}{00965}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a55b8181b2259b06ceb5bc401834b276f}{\_loadAscii}(self):
00966         
\hypertarget{pynebcore_8py_source_l00967}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{00967}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile} = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}, data\_type=\textcolor{stringliteral}{'coll'})
00968         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00969             self.log\_.error(\textcolor{stringliteral}{'No coll data for ion \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00970             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
00971         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom} \textcolor{keywordflow}{in} config.DataFiles:
00972             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}]:
00973                 config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile})
00974         \textcolor{keywordflow}{else}:
00975             config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}]
00976             
\hypertarget{pynebcore_8py_source_l00977}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa407510c78da8c376cd7d82a2ec87ba4}{00977}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa407510c78da8c376cd7d82a2ec87ba4}{collPath} = atomicData.getDirForFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile})
00978         file\_to\_open = \textcolor{stringliteral}{'\{0\}/\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa407510c78da8c376cd7d82a2ec87ba4}{collPath}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile})
00979         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(file\_to\_open):
00980             self.log\_.error(\textcolor{stringliteral}{'File \{0\} not found'}.format(file\_to\_open), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00981             
00982         self.log\_.message(\textcolor{stringliteral}{'Reading coll data from \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
00983 
00984     
00985         \textcolor{comment}{# Read data from ascii file}
00986         \textcolor{comment}{#}
00987         \textcolor{comment}{# Read energies and stat weights }
00988         f = open(file\_to\_open)
00989         data = f.readlines()
00990         f.close()
00991     
00992         coll\_data = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}], dtype=\textcolor{stringliteral}{'float'})
00993         comments\_tab = [d \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]==\textcolor{stringliteral}{'***'}]
\hypertarget{pynebcore_8py_source_l00994}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{00994}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments} = \{\}
00995         \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} comments\_tab:
00996             key = com.split()[1]
00997             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[key] = com.split(key)[1].replace(\textcolor{stringliteral}{"'"}, \textcolor{stringliteral}{""}).replace(\textcolor{stringliteral}{'"'}, \textcolor{stringliteral}{''}).strip()
\hypertarget{pynebcore_8py_source_l00998}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{00998}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{\_lev\_is} = coll\_data[:,0]
\hypertarget{pynebcore_8py_source_l00999}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{00999}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{\_lev\_js} = coll\_data[:,1]
\hypertarget{pynebcore_8py_source_l01000}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{01000}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray} = coll\_data[0,2:]
01001         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01002             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} = int(np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{\_lev\_js}))
01003         \textcolor{keywordflow}{else}:
01004             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} = np.min((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}, int(np.max(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{\_lev\_js}))))
01005 
\hypertarget{pynebcore_8py_source_l01006}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{01006}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}, len(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray})))
01007         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{\_lev\_is})):
01008             lev\_i = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a87c7c234487963a3d9d015294637e59a}{\_lev\_is}[i]
01009             lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8c077039b4837a27b71583f26dd858a8}{\_lev\_js}[i]
01010             \textcolor{keywordflow}{if} (lev\_i != 0) \textcolor{keywordflow}{and} (lev\_j != 0) \textcolor{keywordflow}{and} (lev\_i <= self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}) \textcolor{keywordflow}{and} (lev\_j <= self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}):
01011                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray}[lev\_i-1, lev\_j-1, :] = coll\_data[i,2:]
01012            
01013         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SPECTRUM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
01014             \textcolor{keywordflow}{if} int(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'SPECTRUM'}]) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec}:
01015                 log\_.error(\textcolor{stringliteral}{'The spectrum I read in the file \{0\} is \{1\}, but you are requesting \{2\}'}.format(
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'SPECTRUM'}],
01016                                                                                                     self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a75f41e91e7eb224162912bedac22b342}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
01017         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'ATOM'} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
01018             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'ATOM'}] != sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem}]:
01019                 log\_.error(\textcolor{stringliteral}{'The element name I read in the file \{0\} is \{1\}, but I was expecting \{2\}. Check
       the keyword ATOM'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a8f7186365d566d4de80bf20b41b51c75}{collFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[\textcolor{stringliteral}{'ATOM'}],
01020                                                                                                     
      sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2e7f8f27e94e2aa068d869cd4dad2ee2}{elem}]), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})        
01021         
\hypertarget{pynebcore_8py_source_l01022}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a5de4640ac21cae33af4145c058dc62ef}{01022}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a5de4640ac21cae33af4145c058dc62ef}{getSources}(self):
01023         sources = []
01024         sources\_dic = \{\}
01025         notes = \{\}
01026         \textcolor{keywordflow}{for} com \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}:
01027             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} com:
01028                 number = com.split(\textcolor{stringliteral}{'SOURCE'})[1]
01029                 sources\_dic[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[com]
01030             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'NOTE'} \textcolor{keywordflow}{in} com:
01031                 number = com.split(\textcolor{stringliteral}{'NOTE'})[1]
01032                 notes[number] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ace4b313bdacd14dea0112b9ff7fe0b7c}{comments}[com]
01033         \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} sources\_dic:
01034             \textcolor{keywordflow}{try}:
01035                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}: \{2\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}, notes[key], sources\_dic[key])) 
01036             \textcolor{keywordflow}{except}:
01037                 sources.append(\textcolor{stringliteral}{'\{0\}: \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a47fdeb51513849a90f420296a0383d33}{atom}, sources[key]))
01038         \textcolor{keywordflow}{return} sources
01039                 
\hypertarget{pynebcore_8py_source_l01040}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a7080ede9cd690fb81537ca37c0286d78}{01040}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a7080ede9cd690fb81537ca37c0286d78}{printSources}(self):
01041         
01042         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a5de4640ac21cae33af4145c058dc62ef}{getSources}():
01043             print(source)
01044 
\hypertarget{pynebcore_8py_source_l01045}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ab0aa6c61eca4fb3b526265776caab5b4}{01045}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ab0aa6c61eca4fb3b526265776caab5b4}{\_test\_lev}(self, level):
01046         \textcolor{stringliteral}{"""}
01047 \textcolor{stringliteral}{        Test whether selected level is legal}
01048 \textcolor{stringliteral}{}
01049 \textcolor{stringliteral}{        Parameters:}
01050 \textcolor{stringliteral}{            - level        selected atom level}
01051 \textcolor{stringliteral}{}
01052 \textcolor{stringliteral}{        """}       
01053         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}:
01054             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\} (maximum: \{1\})'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}),
01055                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
01056 
01057     @profile
\hypertarget{pynebcore_8py_source_l01058}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ac78bf2ddca80543884f09c2924308351}{01058}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ac78bf2ddca80543884f09c2924308351}{getOmegaArray}(self, lev\_i= -1, lev\_j= -1):
01059         \textcolor{stringliteral}{"""}
01060 \textcolor{stringliteral}{        Return array of original tabulated collision strengths for a given transition, }
01061 \textcolor{stringliteral}{            as a function of temperature.}
01062 \textcolor{stringliteral}{        }
01063 \textcolor{stringliteral}{        Usage:}
01064 \textcolor{stringliteral}{            O3.getOmegaArray()}
01065 \textcolor{stringliteral}{        }
01066 \textcolor{stringliteral}{        Parameters:}
01067 \textcolor{stringliteral}{            - lev\_j  lower level (default= -1, returns complete array)}
01068 \textcolor{stringliteral}{            - lev\_i  upper level (default= -1, returns complete array)}
01069 \textcolor{stringliteral}{}
01070 \textcolor{stringliteral}{        """}
01071         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ab0aa6c61eca4fb3b526265776caab5b4}{\_test\_lev}(lev\_i)
01072         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ab0aa6c61eca4fb3b526265776caab5b4}{\_test\_lev}(lev\_j)
01073         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
01074             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
01075             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01076         \textcolor{keywordflow}{elif} lev\_i == -1 \textcolor{keywordflow}{or} lev\_j == -1:
01077             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray}
01078         \textcolor{keywordflow}{else}:
01079             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a01539063e6fade51b407dba1faa011c6}{\_CollArray}[lev\_j-1, lev\_i-1,:]
01080         
01081     @profile
\hypertarget{pynebcore_8py_source_l01082}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2f99c08a0f6a46d88b6e09b0a36495c2}{01082}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2f99c08a0f6a46d88b6e09b0a36495c2}{getOmega}(self, tem, lev\_i= -1, lev\_j= -1):
01083         \textcolor{stringliteral}{"""}
01084 \textcolor{stringliteral}{        Return interpolated value of the collision strength value at the given temperature }
01085 \textcolor{stringliteral}{            for the complete array or a specified transition.}
01086 \textcolor{stringliteral}{}
01087 \textcolor{stringliteral}{        Usage:}
01088 \textcolor{stringliteral}{            O3.getOmega(15000.)}
01089 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4])}
01090 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)}
01091 \textcolor{stringliteral}{        }
01092 \textcolor{stringliteral}{        Parameters:}
01093 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
01094 \textcolor{stringliteral}{            - lev\_i  upper level}
01095 \textcolor{stringliteral}{            - lev\_j  lower level}
01096 \textcolor{stringliteral}{}
01097 \textcolor{stringliteral}{        """}
01098         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ab0aa6c61eca4fb3b526265776caab5b4}{\_test\_lev}(lev\_i)
01099         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ab0aa6c61eca4fb3b526265776caab5b4}{\_test\_lev}(lev\_j)
01100         \textcolor{keywordflow}{if} (lev\_i <= lev\_j) \textcolor{keywordflow}{and} (lev\_i != -1):
01101             self.log\_.warn(\textcolor{stringliteral}{"wrong levels given \{0\} <= \{1\}"}.format(lev\_i, lev\_j), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a08efc5898f4e03a1b7702d85f909e188}{calling})
01102             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}            
01103         tem\_in\_file\_units = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf268c621d916f4ea71bb5825e249200}{\_transfo\_tem}(tem)
01104         \textcolor{keywordflow}{if} (lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1):
01105             tem = np.asarray(tem)
01106             res\_shape = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}]
01107             \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01108                 res\_shape.append(sh)
01109             Omega = np.zeros(res\_shape)
01110     
01111             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels} - 1):
01112                 j = i + 1
01113                 \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a718c85715ee6ef5dfdd4136e2031030b}{NLevels}):
01114                     Omega[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_a2f99c08a0f6a46d88b6e09b0a36495c2}{getOmega}(tem, j + 1, i + 1)
01115                     j += 1
01116         \textcolor{keywordflow}{else}:
01117             OmegaArray = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ac78bf2ddca80543884f09c2924308351}{getOmegaArray}(lev\_i, lev\_j)
01118             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aa4f6c8d0a2a8e4ac6503d67b4a51188d}{noExtrapol} \textcolor{keywordflow}{or} config.get\_noExtrapol():
01119                 leftExtrapol = np.NAN
01120                 rightExtrapol = np.NAN
01121             \textcolor{keywordflow}{else}:
01122                 leftExtrapol = OmegaArray[0]
01123                 rightExtrapol = OmegaArray[-1]
01124             Omega = np.interp(tem\_in\_file\_units, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf234dd4932c7f789eb8eaaf6a16cfc9}{getTemArray}(), OmegaArray,
01125                               left=leftExtrapol, right=rightExtrapol)
01126         
01127         \textcolor{keywordflow}{return} np.squeeze(Omega)
01128     
\hypertarget{pynebcore_8py_source_l01129}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf234dd4932c7f789eb8eaaf6a16cfc9}{01129}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_aaf234dd4932c7f789eb8eaaf6a16cfc9}{getTemArray}(self, keep\_unit=True):
01130         \textcolor{stringliteral}{"""}
01131 \textcolor{stringliteral}{        Return array of tabulated original temperature points (as in fits file) }
01132 \textcolor{stringliteral}{            of collision strengths.}
01133 \textcolor{stringliteral}{        }
01134 \textcolor{stringliteral}{        Parameters:}
01135 \textcolor{stringliteral}{            - keep\_unit   return temperature in file units (default) or change it to Kelvin (False)}
01136 \textcolor{stringliteral}{}
01137 \textcolor{stringliteral}{}
01138 \textcolor{stringliteral}{        """}
01139         \textcolor{keywordflow}{if} keep\_unit:
01140             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray}
01141         \textcolor{keywordflow}{else}:            
01142             \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"log(K)"}):
01143                 \textcolor{keywordflow}{return} pow(10., self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray})
01144             \textcolor{keywordflow}{else}:
01145                 \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_ad026d62c0262a257b38f70a1d7b88c9b}{tem\_units} == \textcolor{stringliteral}{"K/10000"}):
01146                     \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray} * 1.e4
01147                 \textcolor{keywordflow}{else}: \textcolor{comment}{#T in Kelvin in the fits file}
01148                     \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii_adb47c4cf2b9f3b82a281d0277e136693}{\_TemArray}
01149 
01150 
\hypertarget{pynebcore_8py_source_l01151}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout}{01151} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout}{\_CollDataStout}(object):
01152     
01153     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a15869c8881752274731f25e266799fdb}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, OmegaInterp='Linear', noExtrapol = False, 
\hypertarget{pynebcore_8py_source_l01154}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a15869c8881752274731f25e266799fdb}{01154}                  NLevelsMax=\textcolor{keywordtype}{None}):
\hypertarget{pynebcore_8py_source_l01155}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ad21811cb16e520be7d23e1dfa2f5e69e}{01155}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ad21811cb16e520be7d23e1dfa2f5e69e}{log\_} = log\_
\hypertarget{pynebcore_8py_source_l01156}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_af1c874d02f6c090c5c14163376c1701b}{01156}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_af1c874d02f6c090c5c14163376c1701b}{calling} = \textcolor{stringliteral}{'\_CollDataStout'}
01157         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} config.INSTALLED[\textcolor{stringliteral}{'Stout'}]:
01158             log\_.error(\textcolor{stringliteral}{'The STOUT\_DIR environment variable is not defined'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_af1c874d02f6c090c5c14163376c1701b}{calling})
01159             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01160         
01161         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l01162}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a1fe16083e478f9ce45d551b551ccd568}{01162}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a1fe16083e478f9ce45d551b551ccd568}{atom} = atom
\hypertarget{pynebcore_8py_source_l01163}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ac1ed6cedfba5c86095c716447baeda97}{01163}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ac1ed6cedfba5c86095c716447baeda97}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[0]
\hypertarget{pynebcore_8py_source_l01164}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0743e2c77bed655d91b9acb90a88bec4}{01164}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0743e2c77bed655d91b9acb90a88bec4}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)[1])
01165         \textcolor{keywordflow}{else}:
01166             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ac1ed6cedfba5c86095c716447baeda97}{elem} = elem
01167             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0743e2c77bed655d91b9acb90a88bec4}{spec} = int(spec)
01168             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a1fe16083e478f9ce45d551b551ccd568}{atom} = elem + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0743e2c77bed655d91b9acb90a88bec4}{spec})
\hypertarget{pynebcore_8py_source_l01169}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a9d90195eaa7582a810147418f74d27b0}{01169}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a9d90195eaa7582a810147418f74d27b0}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ac1ed6cedfba5c86095c716447baeda97}{elem}]
\hypertarget{pynebcore_8py_source_l01170}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ac667fd4b690c971793f133ce1da8ac1c}{01170}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_ac667fd4b690c971793f133ce1da8ac1c}{noExtrapol} = noExtrapol
01171         
01172         \textcolor{keywordflow}{if} OmegaInterp != \textcolor{stringliteral}{'Linear'}:
01173             self.log\_.error(\textcolor{stringliteral}{'Stout files does not support other interpolation than Linear'}, 
01174                             calling = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_af1c874d02f6c090c5c14163376c1701b}{calling})
01175         
01176         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0d40686c81525a46dd88f4c37f55b46c}{\_loadStout}()
01177     
\hypertarget{pynebcore_8py_source_l01178}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0d40686c81525a46dd88f4c37f55b46c}{01178}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0d40686c81525a46dd88f4c37f55b46c}{\_loadStout}(self):
01179         st\_ion = \textcolor{stringliteral}{'\{\}\_\{\}'}.format(self.atom.lower(), self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a0743e2c77bed655d91b9acb90a88bec4}{spec})
\hypertarget{pynebcore_8py_source_l01180}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a95d38a8c77361abb7fa6dc0471d2abaa}{01180}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a95d38a8c77361abb7fa6dc0471d2abaa}{fullFileName} = \textcolor{stringliteral}{'\{0\}/\{1\}/\{1\}.coll'}.format(config.Stout\_dir, st\_ion)
01181         
\hypertarget{pynebcore_8py_source_l01182}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a92c3b6478daa6c8d6e58a4d6fc0d8dc5}{01182}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a92c3b6478daa6c8d6e58a4d6fc0d8dc5}{collFile} = self.fullFileName.split(\textcolor{stringliteral}{'/'})[-1]
\hypertarget{pynebcore_8py_source_l01183}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a2c2bb8281971401fb1bd457d594a81c4}{01183}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a2c2bb8281971401fb1bd457d594a81c4}{collPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a95d38a8c77361abb7fa6dc0471d2abaa}{fullFileName}[:-len(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout_a92c3b6478daa6c8d6e58a4d6fc0d8dc5}{collFile})]
01184         
01185         
01186 
\hypertarget{pynebcore_8py_source_l01187}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom}{01187} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom}{Atom}(object):
01188     \textcolor{stringliteral}{"""}
01189 \textcolor{stringliteral}{    Define the atom object, fill it with data, explore the data, and }
01190 \textcolor{stringliteral}{    compute quantities such as level populations and line emissivities.}
01191 \textcolor{stringliteral}{}
01192 \textcolor{stringliteral}{    """}
01193     \textcolor{comment}{# This following Class variable will hold the (unique) references of every Atom instance created.}
01194     \textcolor{comment}{# This allows to list all the references used in a project.}
01195     
01196     
01197     @profile
\hypertarget{pynebcore_8py_source_l01198}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad92916e464a9e193eb3e49b84f253a35}{01198}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad92916e464a9e193eb3e49b84f253a35}{\_\_init\_\_}(self, elem=None, spec=None, atom=None, OmegaInterp='Linear', noExtrapol = False, 
      NLevels=None):
01199         \textcolor{stringliteral}{"""}
01200 \textcolor{stringliteral}{        Atom constructor}
01201 \textcolor{stringliteral}{        }
01202 \textcolor{stringliteral}{        Parameters:}
01203 \textcolor{stringliteral}{            - elem          symbol of the selected element}
01204 \textcolor{stringliteral}{            - spec          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
01205 \textcolor{stringliteral}{            - atom          ion (e.g. 'O3').}
01206 \textcolor{stringliteral}{            - OmegaInterp   one of ('Cheb', 'Linear'). Default is Linear. "Cheb" works only for fits files.
       }
01207 \textcolor{stringliteral}{            - noExtrapol    if set to False (default), Omega will be extrapolated above and below}
01208 \textcolor{stringliteral}{                            the highest and lowest temperatures where it is defined. If set to True}
01209 \textcolor{stringliteral}{                            a NaN will be return.}
01210 \textcolor{stringliteral}{            }
01211 \textcolor{stringliteral}{        Usage:}
01212 \textcolor{stringliteral}{            O3 = pn.Atom('O',3)}
01213 \textcolor{stringliteral}{            N2 = pn.Atom(atom='N2')}
01214 \textcolor{stringliteral}{            S2 = pn.Atom(atom='S2', OmegaInterp='Linear')}
01215 \textcolor{stringliteral}{        """}        
\hypertarget{pynebcore_8py_source_l01216}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9e2e5b5402bb9cf14c1b08684bccbf6b}{01216}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9e2e5b5402bb9cf14c1b08684bccbf6b}{log\_} = log\_
01217         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l01218}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{01218}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom} = str.capitalize(atom)
\hypertarget{pynebcore_8py_source_l01219}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{01219}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})[0]
\hypertarget{pynebcore_8py_source_l01220}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{01220}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})[1])
01221         \textcolor{keywordflow}{else}:
01222             \textcolor{keywordflow}{if} elem[0].isalpha():
01223                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} = str.capitalize(elem)
01224             \textcolor{keywordflow}{else}:
01225                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} = elem
01226             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec} = int(spec)
01227             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec})
\hypertarget{pynebcore_8py_source_l01228}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa8b43e1441b80824954f2f2fac4f2eba}{01228}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa8b43e1441b80824954f2f2fac4f2eba}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}]
\hypertarget{pynebcore_8py_source_l01229}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{01229}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}
01230         self.log\_.message(\textcolor{stringliteral}{'Making atom object for \{0\} \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
\hypertarget{pynebcore_8py_source_l01231}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{01231}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels} = NLevels
01232         dataFile = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, data\_type=\textcolor{stringliteral}{'atom'})
01233         \textcolor{keywordflow}{if} dataFile \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l01234}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{01234}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} = \textcolor{keywordtype}{None}
01235         \textcolor{keywordflow}{else}:
01236             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} = dataFile.split(\textcolor{stringliteral}{'.'})[-1]
01237         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} == \textcolor{stringliteral}{'fits'}:
\hypertarget{pynebcore_8py_source_l01238}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{01238}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_fits}{\_AtomDataFits}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, NLevels=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01239         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} == \textcolor{stringliteral}{'dat'}:
01240             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_ascii}{\_AtomDataAscii}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, NLevels=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01241         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} == \textcolor{stringliteral}{'chianti'}:
01242             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \_AtomChianti(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, NLevels=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01243         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} == \textcolor{stringliteral}{'stout'}:
01244             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_stout}{\_AtomDataStout}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, NLevels=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01245         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acb3c11139568e31337ac4c26d6aa57b8}{atomFileType} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01246             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___atom_data_none}{\_AtomDataNone}()
01247         \textcolor{keywordflow}{else}:
01248             log\_.error(\textcolor{stringliteral}{'Atom file extensions must be fits, dat or chianti'})
01249                     
\hypertarget{pynebcore_8py_source_l01250}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{01250}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{atomFile} = self.AtomData.atomFile
\hypertarget{pynebcore_8py_source_l01251}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8c2ddffd0cd3f7ce2a089e87746e909f}{01251}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8c2ddffd0cd3f7ce2a089e87746e909f}{atomPath} = self.AtomData.atomPath
\hypertarget{pynebcore_8py_source_l01252}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ada464bba6971f03f7fc1a51228b35f5d}{01252}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ada464bba6971f03f7fc1a51228b35f5d}{atomFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{atomFile} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01253}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8919c61156a1cbc2cfac6a6d9ee3b1f7}{01253}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8919c61156a1cbc2cfac6a6d9ee3b1f7}{atomFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8c2ddffd0cd3f7ce2a089e87746e909f}{atomPath} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01254}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{01254}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang} = self.AtomData.wave\_Ang
\hypertarget{pynebcore_8py_source_l01255}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{01255}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight} = self.AtomData.getStatWeight
\hypertarget{pynebcore_8py_source_l01256}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{01256}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy} = self.AtomData.getEnergy
\hypertarget{pynebcore_8py_source_l01257}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{01257}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{atomNLevels} = self.AtomData.NLevels
01258 
01259 
01260         dataFile = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, data\_type=\textcolor{stringliteral}{'coll'})
01261         \textcolor{keywordflow}{if} dataFile \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l01262}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{01262}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} = \textcolor{keywordtype}{None}
01263         \textcolor{keywordflow}{else}:
01264             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} = dataFile.split(\textcolor{stringliteral}{'.'})[-1]
01265         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} == \textcolor{stringliteral}{'fits'}:
\hypertarget{pynebcore_8py_source_l01266}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{01266}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_fits}{\_CollDataFits}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, 
01267                                          OmegaInterp=OmegaInterp, noExtrapol = noExtrapol, NLevels=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01268         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} == \textcolor{stringliteral}{'dat'}:
01269             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_ascii}{\_CollDataAscii}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, 
01270                                           OmegaInterp=\textcolor{stringliteral}{'Linear'}, noExtrapol = noExtrapol, NLevels=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01271         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} == \textcolor{stringliteral}{'chianti'}:
01272             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \_CollChianti(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, NLevels=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01273         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} == \textcolor{stringliteral}{'stout'}:
01274             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_stout}{\_CollDataStout}(elem=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, spec=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, atom=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, NLevels=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})            
01275         \textcolor{keywordflow}{elif} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8b68fc84abe84aa0b498c7dd995117db}{collFileType} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01276             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData} = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1___coll_data_none}{\_CollDataNone}()
01277         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01278}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acc4393c4ba0bba2e8d5b1cb49682d488}{01278}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_acc4393c4ba0bba2e8d5b1cb49682d488}{CollHeader} = self.CollData.CollHeader
01279         \textcolor{keywordflow}{except}:
01280             \textcolor{keywordflow}{pass}
01281         \textcolor{keywordflow}{if} \textcolor{stringliteral}{"comments"} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.CollData.\_\_dict\_\_.keys():
01282             self.CollData.comments = []
\hypertarget{pynebcore_8py_source_l01283}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a82067d384b463179a274711b618f03b5}{01283}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a82067d384b463179a274711b618f03b5}{getOmegaArray} = self.CollData.getOmegaArray
\hypertarget{pynebcore_8py_source_l01284}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{01284}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{getTemArray} = self.CollData.getTemArray
\hypertarget{pynebcore_8py_source_l01285}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{01285}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{collFile} = self.CollData.collFile
\hypertarget{pynebcore_8py_source_l01286}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7afd231b8a40f04aff5d61b8cc20c387}{01286}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7afd231b8a40f04aff5d61b8cc20c387}{collPath} = self.CollData.collPath
\hypertarget{pynebcore_8py_source_l01287}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a60a9c79fb04bee36371a0123fb5ae842}{01287}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a60a9c79fb04bee36371a0123fb5ae842}{collFitsFile} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{collFile} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01288}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a386b3ef5e37abd539dbe36eeadfbeca5}{01288}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a386b3ef5e37abd539dbe36eeadfbeca5}{collFitsPath} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7afd231b8a40f04aff5d61b8cc20c387}{collPath} \textcolor{comment}{# Obsolete}
\hypertarget{pynebcore_8py_source_l01289}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{01289}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels} = self.CollData.NLevels
\hypertarget{pynebcore_8py_source_l01290}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a218d09913e06d074a86466946eb221f5}{01290}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a218d09913e06d074a86466946eb221f5}{tem\_units} = self.CollData.tem\_units
01291 
01292         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels} = np.min((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a16e5ede01345c370f0893b19ffb20c5c}{atomNLevels}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}))
01293             
01294         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01295}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{01295}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs} = self.AtomData.gs
01296         \textcolor{keywordflow}{except}:
01297             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs} = \hyperlink{namespacepyneb_1_1utils_1_1physics_ad8bb8a1415a2efcc6512044ac8e883f8}{gsFromAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom})
01298         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01299}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5d9daf69b08c0f60714095f34d0bb0f5}{01299}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5d9daf69b08c0f60714095f34d0bb0f5}{AtomHeader} = self.AtomData.AtomHeader
01300         \textcolor{keywordflow}{except}:
01301             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5d9daf69b08c0f60714095f34d0bb0f5}{AtomHeader} = \textcolor{keywordtype}{None}
01302         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l01303}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{01303}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} = self.AtomData.NIST
01304         \textcolor{keywordflow}{except}:
01305             \textcolor{keywordflow}{try}:
01306                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels})
01307             \textcolor{keywordflow}{except}:
01308                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} = \textcolor{keywordtype}{None}
01309         
\hypertarget{pynebcore_8py_source_l01310}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{01310}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList} = []
01311         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}):
01312             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} np.arange(i):
01313                 self.lineList.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i][j])
01314         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList} = np.array(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList})
01315         
\hypertarget{pynebcore_8py_source_l01316}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4198e6d7ab28c6973dd0f567e285ac3b}{01316}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4198e6d7ab28c6973dd0f567e285ac3b}{energy\_Ryd} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a852d66d22ba9e872484b3346dc28249e}{quiet\_divide}(CST.RYD\_ANG, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang})
\hypertarget{pynebcore_8py_source_l01317}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a07f2923aa90cd65d395812bf5cfd5fe3}{01317}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a07f2923aa90cd65d395812bf5cfd5fe3}{energy\_eV} = CST.RYD\_EV * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4198e6d7ab28c6973dd0f567e285ac3b}{energy\_Ryd}
01318         
\hypertarget{pynebcore_8py_source_l01319}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{01319}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}() \textcolor{comment}{# index = quantum number - 1}
\hypertarget{pynebcore_8py_source_l01320}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{01320}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}() \textcolor{comment}{# Angstrom^-1}
\hypertarget{pynebcore_8py_source_l01321}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{01321}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{\_StatWeight} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}()
\hypertarget{pynebcore_8py_source_l01322}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a03277bf57e7056ec2199cc89f2a007aa}{01322}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a03277bf57e7056ec2199cc89f2a007aa}{EnergyNLevels} = len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy})
01323         
\hypertarget{pynebcore_8py_source_l01324}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{01324}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{getOmega}(self, tem, lev\_i= -1, lev\_j= -1, wave= -1):
01325         \textcolor{stringliteral}{"""}
01326 \textcolor{stringliteral}{        Return interpolated value of the collision strength value at the given temperature }
01327 \textcolor{stringliteral}{            for the complete array or a specified transition.}
01328 \textcolor{stringliteral}{        If kappa is not None (non-maxwellian distribution of e-velocities), the collision }
01329 \textcolor{stringliteral}{            strength is corrected as in Mendoza & Bautista, 2014 ApJ 785, 91.}
01330 \textcolor{stringliteral}{}
01331 \textcolor{stringliteral}{        Usage:}
01332 \textcolor{stringliteral}{            O3.getOmega(15000.)}
01333 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4])}
01334 \textcolor{stringliteral}{            O3.getOmega([8e3, 1e4, 1.2e4], 5, 4)}
01335 \textcolor{stringliteral}{        }
01336 \textcolor{stringliteral}{        Parameters:}
01337 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
01338 \textcolor{stringliteral}{            - lev\_i  upper level}
01339 \textcolor{stringliteral}{            - lev\_j  lower level}
01340 \textcolor{stringliteral}{}
01341 \textcolor{stringliteral}{        """}
01342         \textcolor{stringliteral}{"""}
01343 \textcolor{stringliteral}{        """}
01344         
01345         
01346         
01347         \textcolor{keywordflow}{if} wave != -1:
01348             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
01349         kappa = config.kappa 
01350         \textcolor{keywordflow}{if} kappa \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01351             to\_return = self.CollData.getOmega(tem, lev\_i, lev\_j)
01352         \textcolor{keywordflow}{else}:
01353             \textcolor{comment}{#ToDo The Kappa correction should come AFTER the transformation into CS unit}
01354             \textcolor{keywordflow}{if} (lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1):
01355                 tem = np.asarray(tem)
01356                 res\_shape = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}]
01357                 \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01358                     res\_shape.append(sh)
01359                 Omega = np.zeros(res\_shape)
01360         
01361                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels} - 1):
01362                     j = i + 1
01363                     \textcolor{keywordflow}{while} (j < self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}):
01364                         Omega[j][i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{getOmega}(tem, j + 1, i + 1)
01365                         j += 1
01366             \textcolor{keywordflow}{else}:
01367                 OmegaMB = self.CollData.getOmega(tem, lev\_i, lev\_j)
01368                 delta\_E = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_i, unit=\textcolor{stringliteral}{'eV'}) - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_j, unit=\textcolor{stringliteral}{'eV'})
01369                 correc = ((kappa - 3./2.)**(-0.5) / kappa * gamma(kappa+1) / gamma(kappa-0.5) * 
01370                           (1 + delta\_E/((kappa-1.5)*CST.BOLTZMANN\_eVK*tem))**(-kappa)) * np.exp(delta\_E/
      CST.BOLTZMANN\_eVK/tem)
01371     
01372                 Omega = correc * OmegaMB
01373                 log\_.message(\textcolor{stringliteral}{'Correcting for Kappa=\{0\} by \{1\}'}.format(kappa, correc), self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01374 
01375             to\_return = np.squeeze(Omega)
01376         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'COEFF'} \textcolor{keywordflow}{in} self.CollData.comments:
01377             to\_return *= float(self.CollData.comments[\textcolor{stringliteral}{'COEFF'}])
01378         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'O\_UNIT'} \textcolor{keywordflow}{in} self.CollData.comments:
01379             \textcolor{keywordflow}{if} self.CollData.comments[\textcolor{stringliteral}{'O\_UNIT'}] == \textcolor{stringliteral}{'DEEX RATE COEFF'}:
01380                 to\_return /= CST.KCOLLRATE / tem ** 0.5 / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i)
01381             \textcolor{keywordflow}{elif} self.CollData.comments[\textcolor{stringliteral}{'O\_UNIT'}] == \textcolor{stringliteral}{'RATE COEFF'}:
01382                 deltaE = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_i, unit=\textcolor{stringliteral}{'erg'}) - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_j, unit=\textcolor{stringliteral}{'erg'})
01383                 to\_return *= (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_j) / self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i) * np.exp(deltaE /(CST.BOLTZMANN * tem))) \textcolor{comment}{#q21}
01384                 to\_return /= CST.KCOLLRATE / tem ** 0.5 / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i)
01385             \textcolor{keywordflow}{elif} self.CollData.comments[\textcolor{stringliteral}{'O\_UNIT'}] == \textcolor{stringliteral}{'COOLING'}:
01386                 deltaE = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_i, unit=\textcolor{stringliteral}{'erg'}) - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(lev\_j, unit=\textcolor{stringliteral}{'erg'})
01387                 to\_return /= deltaE \textcolor{comment}{# Loss to q12                }
01388                 to\_return *= (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_j) / self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i) * np.exp(deltaE /(CST.BOLTZMANN * tem))) \textcolor{comment}{#q21}
01389                 to\_return /= (CST.KCOLLRATE / np.sqrt(tem) / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i)) \textcolor{comment}{#
       Omega}
01390                 
01391         \textcolor{keywordflow}{return} to\_return
01392     
01393     @profile
\hypertarget{pynebcore_8py_source_l01394}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{01394}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{getCollRates}(self, tem, NLevels=None):
01395         \textcolor{stringliteral}{"""}
01396 \textcolor{stringliteral}{        Return (n\_levels x n\_levels) array of collision rates at given temperature. }
01397 \textcolor{stringliteral}{        }
01398 \textcolor{stringliteral}{        Usage:}
01399 \textcolor{stringliteral}{            O3.getCollRates(tem=10000)}
01400 \textcolor{stringliteral}{            O3.getCollRates([8e3, 1e4, 1.2e4])}
01401 \textcolor{stringliteral}{        }
01402 \textcolor{stringliteral}{        Parameters:}
01403 \textcolor{stringliteral}{            - tem     electronic temperature in K. May be an array.}
01404 \textcolor{stringliteral}{}
01405 \textcolor{stringliteral}{}
01406 \textcolor{stringliteral}{        """}
01407         tem = np.asarray(tem)
01408         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01409             NLevels = np.min((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8beaa0244d575054b3e2748a5e00d8db}{collNLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a03277bf57e7056ec2199cc89f2a007aa}{EnergyNLevels}))
01410         res\_shape = [NLevels, NLevels]
01411         \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01412             res\_shape.append(sh)
01413         resultArray = np.zeros(res\_shape)
01414         Omegas = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae133eed382e284df01f2183da341534b}{getOmega}(tem)
01415         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(NLevels - 1):
01416             lev\_i = i + 1
01417             j = i + 1
01418             energy\_i = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i]
01419             stat\_weight\_i = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{\_StatWeight}[i]
01420             \textcolor{keywordflow}{while} (j < NLevels):
01421                 lev\_j = j + 1 
01422                 energy\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]
01423                 stat\_weight\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1e76c66b89eb327aeb4cdb1d8bd46fb5}{\_StatWeight}[j]
01424                 resultArray[j][i] = CST.KCOLLRATE / tem ** 0.5 / stat\_weight\_j * Omegas[lev\_j-1, lev\_i-1]
01425                 resultArray[i][j] = ((stat\_weight\_j) / (stat\_weight\_i) * 
01426                                       np.exp((energy\_i - energy\_j) / (CST.BOLTZMANN\_ANGK * tem)) * 
01427                                       resultArray[j][i])
01428                 j += 1
01429         
01430         \textcolor{keywordflow}{return} np.squeeze(resultArray)
01431 
01432     
\hypertarget{pynebcore_8py_source_l01433}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{01433}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{\_Transition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
01434         \textcolor{stringliteral}{"""}
01435 \textcolor{stringliteral}{        Return an array with computed upper level, computed lower level, computed wavelength, }
01436 \textcolor{stringliteral}{            input wavelength}
01437 \textcolor{stringliteral}{        }
01438 \textcolor{stringliteral}{        Parameters:}
01439 \textcolor{stringliteral}{            - wave       wavelength either in Angstrom (a float or a label: e.g., 5007, '5007A') }
01440 \textcolor{stringliteral}{                            or in micron (a label: '51.5m')}
01441 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
01442 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
01443 \textcolor{stringliteral}{                            }
01444 \textcolor{stringliteral}{        """}
01445         \textcolor{keywordflow}{if} str(wave)[-1] == \textcolor{stringliteral}{'A'}:
01446             inputWave = float(wave[:-1])
01447             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave)
01448             maxError = maxErrorA
01449         \textcolor{keywordflow}{elif} str(wave)[-1] == \textcolor{stringliteral}{'m'}:
01450             inputWave = float(wave[:-1]) * 1e4
01451             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave)
01452             maxError = maxErrorm
01453         \textcolor{keywordflow}{else}:
01454             inputWave = wave
01455             label = \textcolor{stringliteral}{'\{0\}\_\{1\}A'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, int(wave))
01456             maxError = maxErrorA
01457             
01458         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{in} label2levelDict:
01459             result = [label2levelDict[label][0], label2levelDict[label][1], inputWave, inputWave]
01460             return(result)
01461         
01462         j, i = np.unravel\_index(np.argmin(abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang} - inputWave)), self.wave\_Ang.shape)
01463         bestWave = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j]
01464         error = np.abs(bestWave - inputWave) / inputWave
01465         result = [i + 1, j + 1, bestWave, inputWave]
01466         \textcolor{keywordflow}{if} error > maxError:
01467             self.log\_.warn(\textcolor{stringliteral}{'\_Transition: wavelengths differ by more than \{0:.2f\}%: input = \{1:.2f\}, output
       = \{2:.2f\}'}\(\backslash\)
01468                            .format(100 * maxError, inputWave, bestWave), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01469         return(result)
01470 
01471 
\hypertarget{pynebcore_8py_source_l01472}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{01472}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
01473         \textcolor{stringliteral}{"""}
01474 \textcolor{stringliteral}{        Return the indexes (upper level, lower level) of a transition for a given atom }
01475 \textcolor{stringliteral}{            from the wavelength.}
01476 \textcolor{stringliteral}{        }
01477 \textcolor{stringliteral}{        Usage:}
01478 \textcolor{stringliteral}{            O3.getTransition(4959)}
01479 \textcolor{stringliteral}{            }
01480 \textcolor{stringliteral}{        Parameters:}
01481 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
01482 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
01483 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
01484 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
01485 \textcolor{stringliteral}{                }
01486 \textcolor{stringliteral}{        """} 
01487         res = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{\_Transition}(wave, maxErrorA = maxErrorA, maxErrorm = maxErrorm)
01488         return(res[0], res[1])
01489         
01490 
\hypertarget{pynebcore_8py_source_l01491}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a32f644fb6c648326e3422984b614b63c}{01491}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a32f644fb6c648326e3422984b614b63c}{printTransition}(self, wave):
01492         \textcolor{stringliteral}{"""}
01493 \textcolor{stringliteral}{        Print info on transition associated to input wavelength.}
01494 \textcolor{stringliteral}{        }
01495 \textcolor{stringliteral}{        Usage:}
01496 \textcolor{stringliteral}{            O3.printTransition(4959)}
01497 \textcolor{stringliteral}{            }
01498 \textcolor{stringliteral}{        Parameters:}
01499 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
01500 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
01501 \textcolor{stringliteral}{                }
01502 \textcolor{stringliteral}{        """}
01503         closestTransition = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a69f29cc10c77910841f9e3ff8ddef250}{\_Transition}(wave)
01504         relativeError = closestTransition[3] / closestTransition[2] - 1
01505         print(\textcolor{stringliteral}{'Input wave: \{0:.1F\}'}.format(closestTransition[3]))
01506         print(\textcolor{stringliteral}{'Closest wave found: \{0:.1F\}'}.format(closestTransition[2]))
01507         print(\textcolor{stringliteral}{'Relative error: \{0:.0E\} '}.format(relativeError))
01508         print(\textcolor{stringliteral}{'Transition: \{0[0]\} -> \{0[1]\}'}.format(closestTransition))
01509         \textcolor{keywordflow}{return}
01510     
\hypertarget{pynebcore_8py_source_l01511}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a09c7f821dd9cf7ab09477fc80906e769}{01511}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a09c7f821dd9cf7ab09477fc80906e769}{printSources}(self):
01512         
01513         \textcolor{keywordflow}{for} source \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a494480eb44909d9a13ed1fb2e808b4a2}{getSources}():
01514             print(source)    
01515     
\hypertarget{pynebcore_8py_source_l01516}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a494480eb44909d9a13ed1fb2e808b4a2}{01516}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a494480eb44909d9a13ed1fb2e808b4a2}{getSources}(self):
01517         sources = []
01518         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7246a8b1ce71eb9d38f580a6ca9fe09e}{AtomData} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a976816067ec07396b4e27cfccbf15573}{CollData}:
01519             sources.extend(self.AtomData.getSources())
01520             sources.extend(self.CollData.getSources())
01521         \textcolor{keywordflow}{else}:
01522             sources.extend(self.AtomData.getSources())
01523         \textcolor{keywordflow}{return} sources
01524     
\hypertarget{pynebcore_8py_source_l01525}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{01525}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(self, level):
01526         \textcolor{stringliteral}{"""}
01527 \textcolor{stringliteral}{        Test whether selected level is legal}
01528 \textcolor{stringliteral}{}
01529 \textcolor{stringliteral}{        Parameters:}
01530 \textcolor{stringliteral}{            - level        selected atom level}
01531 \textcolor{stringliteral}{}
01532 \textcolor{stringliteral}{        """}       
01533         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}:
01534             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}),
01535                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01536 
\hypertarget{pynebcore_8py_source_l01537}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{01537}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(self, lev\_i= -1, lev\_j= -1, wave= -1):
01538         \textcolor{stringliteral}{"""}
01539 \textcolor{stringliteral}{        Return the transition probability data. }
01540 \textcolor{stringliteral}{        If no arguments are given, the whole array of A is returned.}
01541 \textcolor{stringliteral}{        A specific A value can be obtained by giving either the upper and lower levels or }
01542 \textcolor{stringliteral}{            the wavelength of the transition (keyword wave).}
01543 \textcolor{stringliteral}{            }
01544 \textcolor{stringliteral}{        Usage:}
01545 \textcolor{stringliteral}{            A\_O3 = O3.getA()          # The whole A array is stored in A\_O3}
01546 \textcolor{stringliteral}{            O3.getA(4, 2)      # A(4, 2) of the O3 atom is printed}
01547 \textcolor{stringliteral}{            O3.getA(2, 4)      # Returns 0}
01548 \textcolor{stringliteral}{            O3.getA(wave=4959)      }
01549 \textcolor{stringliteral}{}
01550 \textcolor{stringliteral}{        Parameters:}
01551 \textcolor{stringliteral}{            - lev\_i  upper level of transition (default= -1, returns complete array)}
01552 \textcolor{stringliteral}{            - lev\_j  lower level of transition (default= -1, returns complete array)}
01553 \textcolor{stringliteral}{            - wave   wavelength of transition. Takes precedence on lev\_i and lev\_j. Ignored if not set.}
01554 \textcolor{stringliteral}{            }
01555 \textcolor{stringliteral}{        """}
01556         \textcolor{keywordflow}{if} wave != -1:
01557             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
01558         
01559         \textcolor{keywordflow}{return} self.AtomData.getA(lev\_i= lev\_i, lev\_j= lev\_j)
01560         
01561     @profile
\hypertarget{pynebcore_8py_source_l01562}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{01562}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(self, tem, den, product=True, NLevels=None):
01563         \textcolor{stringliteral}{"""}
01564 \textcolor{stringliteral}{        Return array of populations at given temperature and density.}
01565 \textcolor{stringliteral}{        The method returns a 1-, 2- or 3-D array containing the population of each level }
01566 \textcolor{stringliteral}{            for all temperatures and densities specified in the input vectors tem and den }
01567 \textcolor{stringliteral}{            (which can be n-element or 1-element vectors).}
01568 \textcolor{stringliteral}{        If either quantity (tem or den) is a 1-element vector -that is, a single value-, }
01569 \textcolor{stringliteral}{            the resulting population array is collapsed along that dimension; }
01570 \textcolor{stringliteral}{            as a result, the result population array can be a 1-D, 2-D or 3-D array }
01571 \textcolor{stringliteral}{            (the three cases corresponding to situations in which both tem and den are single values; }
01572 \textcolor{stringliteral}{            one of them is a single value and the other an n-element vector; or both are multielement }
01573 \textcolor{stringliteral}{            vectors, respectively). In the general case, the level index is the first }
01574 \textcolor{stringliteral}{            [WARNING! It is not in physical unit, i.e. ground level = 0; to be normalized], }
01575 \textcolor{stringliteral}{            followed by the temperature index (if it exists) and the density index. }
01576 \textcolor{stringliteral}{}
01577 \textcolor{stringliteral}{        Usage:}
01578 \textcolor{stringliteral}{            O3.getPopulations(1e4, 1e2)}
01579 \textcolor{stringliteral}{            tem=np.array([10000., 12000., 15000., 20000]) # An array of four temperatures}
01580 \textcolor{stringliteral}{            den=np.array([600., 800., 1000])      # An array of three densities}
01581 \textcolor{stringliteral}{            O3.getPopulations(tem, den)           # is a (6, 4, 3) array}
01582 \textcolor{stringliteral}{            O3.getPopulations(tem, den)[0,2,1]    # Returns the population of level 1 for T = 15000 }
01583 \textcolor{stringliteral}{                                                    and Ne = 800}
01584 \textcolor{stringliteral}{            tem = 20000                           # tem is no longer an array}
01585 \textcolor{stringliteral}{            O3.getPopulations(tem, den)[0,2,1]  # Crashes: one index too much}
01586 \textcolor{stringliteral}{            O3.getPopulations(tem, den)[0,1]    # Returns the population of level 1 for T = 20000 }
01587 \textcolor{stringliteral}{                                                    and Ne = 800 [see warning]}
01588 \textcolor{stringliteral}{            tem=np.array([10000., 15000., 20000]) # An array of three temperatures}
01589 \textcolor{stringliteral}{            O3.getPopulations(tem, den, product = False)# is a (6, 3) array, tem and den beeing }
01590 \textcolor{stringliteral}{                                                            taken 2 by 2.}
01591 \textcolor{stringliteral}{        }
01592 \textcolor{stringliteral}{        Parameters:}
01593 \textcolor{stringliteral}{            - tem       electronic temperature in K}
01594 \textcolor{stringliteral}{            - den       electronic density in cm^-3}
01595 \textcolor{stringliteral}{            - product   operate on all possible combinations of temperature and density }
01596 \textcolor{stringliteral}{                      (product = True, default case) or on those resulting from combining }
01597 \textcolor{stringliteral}{                      the i-th value of tem with the i-th value of den (product = False).}
01598 \textcolor{stringliteral}{                      If product = False, then tem and den must be the same size.}
01599 \textcolor{stringliteral}{}
01600 \textcolor{stringliteral}{        """}
01601         tem = np.asarray(tem)
01602         den = np.asarray(den)
01603         \textcolor{keywordflow}{if} NLevels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01604             n\_level = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}
01605         \textcolor{keywordflow}{else}:
01606             n\_level = NLevels
01607         \textcolor{keywordflow}{if} product:
01608             n\_tem = tem.size
01609             n\_den = den.size
01610             tem\_ones = np.ones(n\_tem)
01611             den\_ones = np.ones(n\_den)
01612             \textcolor{comment}{# q is vector-indexed (q(0, 1) = rate between levels 1 and 2)}
01613             q = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{getCollRates}(tem, n\_level)
01614             Atem = np.outer(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[:n\_level, :n\_level], tem\_ones).reshape(n\_level, n\_level, n\_tem)
01615             pop\_result = np.zeros((n\_level, n\_tem, n\_den))
01616             sum\_q\_up = np.zeros((n\_level, n\_tem))
01617             sum\_q\_down = np.zeros((n\_level, n\_tem))
01618             sum\_A = np.squeeze(Atem.sum(axis=1))
\hypertarget{pynebcore_8py_source_l01619}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{01619}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity} = sum\_A / q.sum(axis=1)
01620             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, n\_level):
01621                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i + 1, n\_level):
01622                     sum\_q\_up[i] = sum\_q\_up[i] + q[i, j]
01623                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(0, i):
01624                     sum\_q\_down[i] = sum\_q\_down[i] + q[i, j]
01625             coeff\_matrix = ((np.outer(np.swapaxes(q, 0, 1), den) + 
01626                              np.outer(np.swapaxes(Atem, 0, 1), den\_ones)).reshape(n\_level, n\_level, n\_tem, 
      n\_den))
01627             coeff\_matrix[0, :] = 1.
01628             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, n\_level):
01629                 coeff\_matrix[i, i] = (-(np.outer((sum\_q\_up[i] + sum\_q\_down[i]), den) + 
01630                                         np.outer(sum\_A[i], den\_ones)).reshape(1, 1, n\_tem, n\_den))
01631             vect = np.zeros(n\_level)
01632             vect[0] = 1.
01633     
01634             \textcolor{keywordflow}{for} i\_tem \textcolor{keywordflow}{in} range(n\_tem):
01635                 \textcolor{keywordflow}{for} i\_den \textcolor{keywordflow}{in} range(n\_den):
01636                     \textcolor{keywordflow}{try}:
01637                         pop\_result[:, i\_tem, i\_den] = \hyperlink{namespacepyneb_1_1utils_1_1misc_aa5d9daf83958e9b6bd123954d495e94c}{solve}(np.squeeze(coeff\_matrix[:, :, i\_tem, i\_den
      ]), vect)
01638                     \textcolor{comment}{#except np.linalg.LinAlgError:}
01639                     \textcolor{comment}{#    pop\_result[:, i\_tem, i\_den] = np.nan}
01640                     \textcolor{keywordflow}{except}:
01641                         self.log\_.error(\textcolor{stringliteral}{'Error solving population matrix'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01642             pop = np.squeeze(pop\_result)
01643         \textcolor{keywordflow}{else}:
01644             \textcolor{keywordflow}{if} tem.shape != den.shape:
01645                 self.log\_.error(\textcolor{stringliteral}{'tem and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01646                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01647             res\_shape1 = [n\_level]
01648             res\_shape\_rav1 = [n\_level, tem.size]
01649             res\_shape\_rav2 = [n\_level, n\_level, tem.size]
01650             \textcolor{keywordflow}{for} sh \textcolor{keywordflow}{in} tem.shape:
01651                 res\_shape1.append(sh)
01652             tem\_rav = tem.ravel()
01653             den\_rav = den.ravel()
01654             q = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a34711ea989baf7bde752a68255d32098}{getCollRates}(tem\_rav, n\_level)
01655             A = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[:n\_level, :n\_level]
01656             pop\_result = np.zeros(res\_shape\_rav1)
01657             coeff\_matrix = np.ones(res\_shape\_rav2)
01658             sum\_q\_up = np.zeros(res\_shape\_rav1)
01659             sum\_q\_down = np.zeros(res\_shape\_rav1)
01660             sum\_A = A.sum(axis=1)
01661             n\_tem = tem\_rav.size
01662             \textcolor{comment}{# Following line changed 29/11/2012. It made the code crash when atom\_nlevels diff coll\_nlevels}
01663             \textcolor{comment}{#Atem = np.outer(self.\_A, np.ones(n\_tem)).reshape(n\_level, n\_level, n\_tem)}
01664             Atem = np.outer(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[:n\_level, :n\_level], np.ones(n\_tem)).reshape(n\_level, n\_level, n\_tem)
01665             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity} = Atem.sum(axis=1) / q.sum(axis=1)
01666 
01667             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, n\_level):
01668                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i + 1, n\_level):
01669                     sum\_q\_up[i] = sum\_q\_up[i] + q[i, j]
01670                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(0, i):
01671                     sum\_q\_down[i] = sum\_q\_down[i] + q[i, j]
01672             \textcolor{keywordflow}{for} row \textcolor{keywordflow}{in} range(1, n\_level):
01673                 \textcolor{comment}{# upper right half            }
01674                 \textcolor{keywordflow}{for} col \textcolor{keywordflow}{in} range(row + 1, n\_level):
01675                     coeff\_matrix[row, col] = den\_rav * q[col, row] + A[col, row]
01676                 \textcolor{comment}{# lower left half}
01677                 \textcolor{keywordflow}{for} col \textcolor{keywordflow}{in} range(0, row):
01678                     coeff\_matrix[row, col] = den\_rav * q[col, row]
01679                 \textcolor{comment}{# diagonal}
01680                 coeff\_matrix[row, row] = -(den\_rav * (sum\_q\_up[row] + sum\_q\_down[row]) + sum\_A[row])
01681 
01682             vect = np.zeros(n\_level)
01683             vect[0] = 1.
01684             
01685             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(tem.size):
01686                 \textcolor{keywordflow}{try}:
01687                     pop\_result[:, i] = \hyperlink{namespacepyneb_1_1utils_1_1misc_aa5d9daf83958e9b6bd123954d495e94c}{solve}(np.squeeze(coeff\_matrix[:, :, i]), vect)
01688                 \textcolor{keywordflow}{except} np.linalg.LinAlgError:
01689                     pop\_result[:, i] = np.nan
01690                 \textcolor{keywordflow}{except}:
01691                     self.log\_.error(\textcolor{stringliteral}{'Error solving population matrix'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01692             
01693             pop = np.squeeze(pop\_result.reshape(res\_shape1))
01694             
01695         \textcolor{keywordflow}{return} pop
01696 
01697     
\hypertarget{pynebcore_8py_source_l01698}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6db2a3425e5a35f0bd04f05bcb25ee1}{01698}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6db2a3425e5a35f0bd04f05bcb25ee1}{getLowDensRatio}(self, lev\_i1=-1, lev\_i2=-1, wave1=-1, wave2=-1, to\_eval=None):
01699         
01700         \textcolor{stringliteral}{"""}
01701 \textcolor{stringliteral}{        Return the value of a diagostic ratio at the low density limit}
01702 \textcolor{stringliteral}{        S2.getLowDensRatio(lev\_i1 = 3, lev\_i2 = 2)}
01703 \textcolor{stringliteral}{        S2.getLowDensRatio(wave1 = 6716, wave2 = 6731)}
01704 \textcolor{stringliteral}{        S2.getLowDensRatio(to\_eval = 'L(6716)/L(6731)')}
01705 \textcolor{stringliteral}{        """}
01706         
01707         \textcolor{keywordflow}{if} wave1 != -1:
01708             lev\_i1, lev\_j1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave1)
01709         \textcolor{keywordflow}{if} wave2 != -1:
01710             lev\_i2, lev\_j2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave2)
01711             
01712         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
01713             L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0])
01714             \textcolor{keywordflow}{return} eval(to\_eval)
01715             
01716         \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i1) / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i2)
01717         
01718         
\hypertarget{pynebcore_8py_source_l01719}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ac2e1509a2acc642c00696f3787e95f95}{01719}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ac2e1509a2acc642c00696f3787e95f95}{getHighDensRatio}(self, lev\_i1=-1, lev\_i2=-1, lev\_j1=-1, lev\_j2=-1, wave1=-1, 
      wave2=-1, to\_eval=None):
01720         
01721         \textcolor{stringliteral}{"""}
01722 \textcolor{stringliteral}{        Return the value of a diagostic ratio at the high density limit}
01723 \textcolor{stringliteral}{        S2.getHighDensRatio(lev\_i1 = 3, lev\_i2 = 2)}
01724 \textcolor{stringliteral}{        S2.getHighDensRatio(wave1 = 6716, wave2 = 6731)}
01725 \textcolor{stringliteral}{        S2.getHighDensRatio(to\_eval = 'L(6716)/L(6731)')}
01726 \textcolor{stringliteral}{        """}
01727         
01728         \textcolor{keywordflow}{if} wave1 != -1:
01729             lev\_i1, lev\_j1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave1)
01730         \textcolor{keywordflow}{if} wave2 != -1:
01731             lev\_i2, lev\_j2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave2)
01732             
01733         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
01734             L = \textcolor{keyword}{lambda} wave: (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0]) * 
01735                               self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0], self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1]))
01736             \textcolor{keywordflow}{return} eval(to\_eval)
01737             
01738         \textcolor{keywordflow}{return} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i1) / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}(lev\_i2) *
01739                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(lev\_i1, lev\_j1) / self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(lev\_i2, lev\_j2))
01740            
01741     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a30ea60641df87c5eaf8af392d31da920}{getDensityRange}(self, lev\_i1=-1, lev\_i2=-1, lev\_j1=-1, lev\_j2=-1, wave1=-1, 
      wave2=-1, 
\hypertarget{pynebcore_8py_source_l01742}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a30ea60641df87c5eaf8af392d31da920}{01742}                         to\_eval=\textcolor{keywordtype}{None}, tol=0.1, tem=1e4):
01743         \textcolor{stringliteral}{"""}
01744 \textcolor{stringliteral}{        Return the range of density where a given line ratio is between 10% and 90% of the low and high
       density limits}
01745 \textcolor{stringliteral}{        """}
01746         LowLim = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6db2a3425e5a35f0bd04f05bcb25ee1}{getLowDensRatio}(lev\_i1, lev\_i2, wave1, wave2, to\_eval)
01747         HighLim = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ac2e1509a2acc642c00696f3787e95f95}{getHighDensRatio}(lev\_i1, lev\_i2, lev\_j1, lev\_j2, wave1, wave2, 
      to\_eval)
01748         
01749         delta = abs(LowLim - HighLim)
01750         minRatio = min((LowLim, HighLim)) + tol * delta
01751         maxRatio = max((LowLim, HighLim)) - tol * delta
01752         dens1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(minRatio, tem=tem, lev\_i1= lev\_i1, lev\_j1= lev\_j1, lev\_i2= lev\_i2, 
      lev\_j2= lev\_j2,
01753                   wave1= wave1, wave2= wave2, to\_eval=to\_eval)
01754         dens2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(maxRatio, tem=tem, lev\_i1= lev\_i1, lev\_j1= lev\_j1, lev\_i2= lev\_i2, 
      lev\_j2= lev\_j2,
01755                   wave1= wave1, wave2= wave2, to\_eval=to\_eval)
01756         return(np.sort((dens1, dens2)))
01757                
01758     @profile
\hypertarget{pynebcore_8py_source_l01759}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aae95b1cb36defadad24cf94459203eb3}{01759}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aae95b1cb36defadad24cf94459203eb3}{getCritDensity}(self, tem, level= -1):
01760         \textcolor{stringliteral}{"""}
01761 \textcolor{stringliteral}{        Return the critical density of selected level at given temperature. }
01762 \textcolor{stringliteral}{        If no transition is selected, return complete array.}
01763 \textcolor{stringliteral}{        }
01764 \textcolor{stringliteral}{        Usage:}
01765 \textcolor{stringliteral}{            O3.getCritDensity(12000)}
01766 \textcolor{stringliteral}{            O3.getCritDensity(12000, 4)}
01767 \textcolor{stringliteral}{        }
01768 \textcolor{stringliteral}{        Parameters:}
01769 \textcolor{stringliteral}{            - tem    electronic temperature in K. May be an array.}
01770 \textcolor{stringliteral}{            - level  selected atomic level (default= -1)}
01771 \textcolor{stringliteral}{}
01772 \textcolor{stringliteral}{        """}
01773         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(level)
01774         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den=100.) \textcolor{comment}{# Any density would do}
01775         \textcolor{keywordflow}{if} level != -1:
01776             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity}[level - 1]
01777         \textcolor{keywordflow}{else}:
01778             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a1d0823a36ca030fd149522fe72908631}{\_critDensity}
01779         
01780         
01781     @profile
\hypertarget{pynebcore_8py_source_l01782}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{01782}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(self, tem, den, lev\_i= -1, lev\_j= -1, wave= -1, product=True):
01783         \textcolor{stringliteral}{"""}
01784 \textcolor{stringliteral}{        Return the line emissivity of selected transition or complete array of emissivities}
01785 \textcolor{stringliteral}{        The transition is selected by the argument wave (if given); }
01786 \textcolor{stringliteral}{        if wave is not supplied, it is selected by the upper and lower levels (lev\_i and lev\_j); }
01787 \textcolor{stringliteral}{        if neither is given, the whole array is computed}
01788 \textcolor{stringliteral}{        }
01789 \textcolor{stringliteral}{        Usage:      }
01790 \textcolor{stringliteral}{            O3.getEmissivity(12000, 100, 4, 2)         # (4, 2) transition}
01791 \textcolor{stringliteral}{            O3.getEmissivity(10000, 10000, wave=5007)  # (4, 2) transition}
01792 \textcolor{stringliteral}{            O3.getEmissivity(12000, 100)               # all transitions}
01793 \textcolor{stringliteral}{            O3.getEmissivity([10000, 12000], [100, 500], 4, 2)}
01794 \textcolor{stringliteral}{            O3.getEmissivity([10000, 12000], [100, 500])}
01795 \textcolor{stringliteral}{            }
01796 \textcolor{stringliteral}{        Parameters:}
01797 \textcolor{stringliteral}{            - tem      electronic temperature in K. May be an array.}
01798 \textcolor{stringliteral}{            - den      electronic density in cm^-3. May be an array.}
01799 \textcolor{stringliteral}{            - lev\_i    upper level (default= -1)}
01800 \textcolor{stringliteral}{            - lev\_j    lower level (default= -1)}
01801 \textcolor{stringliteral}{            - wave     wavelength of transition. Takes precedence on lev\_i and lev\_j if set, }
01802 \textcolor{stringliteral}{                        ignored otherwise. It can also be a blend label.}
01803 \textcolor{stringliteral}{            - product  Boolean. If True (default), all the combination of (tem, den) are used. }
01804 \textcolor{stringliteral}{                         If False, tem and den must have the same size and are joined.}
01805 \textcolor{stringliteral}{}
01806 \textcolor{stringliteral}{        """}
01807         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave) \textcolor{keywordflow}{in} BLEND\_LIST:
01808             L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, wave=wave, product=product)
01809             I = \textcolor{keyword}{lambda} lev\_i, lev\_j: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, lev\_i=lev\_i, lev\_j=lev\_j, 
      product=product)
01810             \textcolor{keywordflow}{try}:
01811                 res = eval(BLEND\_LIST[\textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, wave)])
01812             \textcolor{keywordflow}{except}:
01813                 log\_.warn(\textcolor{stringliteral}{'\{0\} is not understood'}.format(wave), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'getEmissivity'})
01814                 res = \textcolor{keywordtype}{None}
01815             \textcolor{keywordflow}{return} res
01816         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_i)
01817         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_j)
01818         tem = np.asarray(tem)
01819         den = np.asarray(den)
01820         \textcolor{keywordflow}{if} wave != -1:
01821             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
01822         NLevels = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}
01823         \textcolor{keywordflow}{if} lev\_i > NLevels \textcolor{keywordflow}{or} lev\_j > NLevels:
01824             log\_.error(\textcolor{stringliteral}{'The number of levels \{\} does not allow getting this emissivity. Consider changing
       the atomic data'}.format(NLevels),
01825                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling}) 
01826         \textcolor{keywordflow}{if} product:
01827             n\_tem = tem.size
01828             n\_den = den.size
01829             tem\_ones = np.ones(n\_tem)
01830             populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den, product=\textcolor{keyword}{True})
01831             \textcolor{keywordflow}{if} ((lev\_i == -1) \textcolor{keywordflow}{and} (lev\_j == -1)):
01832                 resultArray = np.zeros((NLevels, NLevels, n\_tem, n\_den))
01833                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(NLevels):
01834                     lev\_i = i + 1
01835                     j = i - 1 
01836                     \textcolor{keywordflow}{while} (j >= 0):
01837                         lev\_j = j + 1
01838                         deltaE = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]) * CST.HPLANCK * 
      CST.CLIGHT * 1.e8 
01839                         resultArray[i][j] = (deltaE * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[i, j] * populations[i].reshape(1, 1, n\_tem,
       n\_den) / 
01840                                              np.outer(tem\_ones, den).reshape(1, 1, n\_tem, n\_den))
01841                         j -= 1
01842                 \textcolor{keywordflow}{return} np.squeeze(resultArray)
01843             \textcolor{keywordflow}{else}:
01844                 \textcolor{keywordflow}{if} (lev\_i <= lev\_j):
01845                     \textcolor{keywordflow}{return} 0.
01846                 \textcolor{keywordflow}{else}:
01847                     i = lev\_i - 1
01848                     j = lev\_j - 1
01849                     deltaE = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]) * CST.HPLANCK * CST.CLIGHT *
       1.e8 
01850                     \textcolor{keywordflow}{return} np.squeeze((populations[i] * deltaE * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[i, j]).reshape(1, 1, n\_tem, 
      n\_den) / 
01851                                       np.outer(tem\_ones, den).reshape(1, 1, n\_tem, n\_den))
01852         \textcolor{keywordflow}{else}:
01853             \textcolor{keywordflow}{if} tem.shape != den.shape:
01854                 self.log\_.error(\textcolor{stringliteral}{'tem and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01855                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01856             populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den, product=\textcolor{keyword}{False})
01857             \textcolor{keywordflow}{if} (lev\_i <= lev\_j):
01858                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01859             \textcolor{keywordflow}{else}:
01860                 i = lev\_i - 1
01861                 j = lev\_j - 1
01862                 deltaE = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[j]) * CST.HPLANCK * CST.CLIGHT * 1.
      e8 
01863                 \textcolor{keywordflow}{return} populations[i] * deltaE * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[i, j] / den
01864 
01865         
01866     @profile
01867     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, 
      lev\_j2= -1,
01868                   wave1= -1, wave2= -1, maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x=
       -1,
\hypertarget{pynebcore_8py_source_l01869}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{01869}                   to\_eval=\textcolor{keywordtype}{None}, nCut=30, maxIter=20):
01870 
01871         \textcolor{comment}{##}
01872         \textcolor{comment}{# @todo manage blends}
01873         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_i1)
01874         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_j1)
01875         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_i2)
01876         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_j2)
01877         tem = np.asarray(tem)
01878         den = np.asarray(den)
01879         \textcolor{keywordflow}{if} np.asarray(int\_ratio).size != 1:
01880             shape = np.asarray(int\_ratio).shape
01881             size = np.asarray(int\_ratio).size
01882             result = np.zeros(size) 
01883             \textcolor{keywordflow}{if} np.asarray(tem).size != 1:
01884                 \textcolor{keywordflow}{if} np.asarray(tem).shape != shape:
01885                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01886                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01887                 tem\_ravel = np.asarray(tem).ravel()
01888                 den\_ravel = np.zeros(size) + den
01889             \textcolor{keywordflow}{elif} np.asarray(den).size != 1:
01890                 \textcolor{keywordflow}{if} np.asarray(den).shape != shape:
01891                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01892                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
01893                 den\_ravel = np.asarray(den).ravel()
01894                 tem\_ravel = np.zeros(size) + tem
01895             \textcolor{keywordflow}{else}:
01896                 den\_ravel = np.zeros(size) + den
01897                 tem\_ravel = np.zeros(size) + tem
01898             int\_ratio\_ravel = np.asarray(int\_ratio).ravel()
01899             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(size):
01900                 result[i] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(int\_ratio\_ravel[i], tem=tem\_ravel[i], den=
      den\_ravel[i],
01901                                            lev\_i1=lev\_i1, lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
01902                                            wave1=wave1, wave2=wave2, maxError=maxError, method=method,
01903                                            log=log, start\_x=start\_x, end\_x=end\_x,
01904                                            to\_eval=to\_eval)
01905             \textcolor{keywordflow}{return} result.reshape(shape)
01906             
01907         \textcolor{keywordflow}{if} wave1 != -1:
01908             lev\_i1, lev\_j1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave1)
01909         \textcolor{keywordflow}{if} wave2 != -1:
01910             lev\_i2, lev\_j2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave2)
01911 
01912         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
01913             to\_eval = \textcolor{stringliteral}{'I('} + str(lev\_i1) + \textcolor{stringliteral}{','} + str(lev\_j1) + \textcolor{stringliteral}{')/I('} + str(lev\_i2) + \textcolor{stringliteral}{','} + str(lev\_j2) + \textcolor{stringliteral}{'
      )'}
01914 
01915 
01916         \textcolor{keywordflow}{if} tem == -1:
01917             \textcolor{keywordflow}{if} start\_x == -1:
01918                 start\_x = min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{getTemArray}(keep\_unit=\textcolor{keyword}{False}))
01919                 \textcolor{keywordflow}{if} log:
01920                     start\_x = np.log10(start\_x)
01921             \textcolor{keywordflow}{if} end\_x == -1:
01922                 end\_x = max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a764cc048a87d3d89204a616774bdaac6}{getTemArray}(keep\_unit=\textcolor{keyword}{False}))
01923                 \textcolor{keywordflow}{if} log:
01924                     end\_x = np.log10(end\_x)
01925             
01926             @profile
01927             \textcolor{keyword}{def }\_func(x):
01928                 \textcolor{stringliteral}{"""}
01929 \textcolor{stringliteral}{                The function for which a root is looked for.}
01930 \textcolor{stringliteral}{                It must return an array if x is an array, if an nsect-like method is used.}
01931 \textcolor{stringliteral}{                The returned value is already normalized to the intensity ratio.}
01932 \textcolor{stringliteral}{}
01933 \textcolor{stringliteral}{                """}
01934                 \textcolor{keywordflow}{if} log:
01935                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(10.**x, den)
01936                 \textcolor{keywordflow}{else}:
01937                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(x, den)
01938                 I = \textcolor{keyword}{lambda} lev\_i, lev\_j: (populations[lev\_i - 1] * 
01939                                           (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[lev\_i - 1, lev\_j - 1] * 
01940                                            (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_i - 1] - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_j - 1])))
01941                 L = \textcolor{keyword}{lambda} wave: (populations[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] * 
01942                                   (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1] * 
01943                                    (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] - 
01944                                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1])))
01945                 result = eval(to\_eval)
01946                 \textcolor{keywordflow}{return} \hyperlink{namespacepyneb_1_1utils_1_1misc_a852d66d22ba9e872484b3346dc28249e}{quiet\_divide}((result - int\_ratio), int\_ratio)
01947             
01948         \textcolor{keywordflow}{elif} den == -1:
01949             \textcolor{keywordflow}{if} start\_x == -1:
01950                 start\_x = 1.e0
01951                 \textcolor{keywordflow}{if} log: start\_x = np.log10(start\_x)
01952             \textcolor{keywordflow}{if} end\_x == -1:
01953                 end\_x = 1e8
01954                 \textcolor{keywordflow}{if} log: end\_x = np.log10(end\_x)
01955 
01956             @profile
01957             \textcolor{keyword}{def }\_func(x):
01958                 \textcolor{stringliteral}{"""}
01959 \textcolor{stringliteral}{                The function for which a root is looked for.}
01960 \textcolor{stringliteral}{                It must return an array if x is an array, if an nsect-like method is used.}
01961 \textcolor{stringliteral}{                The returned value is already normalized to the intensity ratio.}
01962 \textcolor{stringliteral}{                }
01963 \textcolor{stringliteral}{                """}
01964                 \textcolor{keywordflow}{if} log:
01965                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, pow(10., x))
01966                 \textcolor{keywordflow}{else}:
01967                     populations = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, x)
01968                 I = \textcolor{keyword}{lambda} lev\_i, lev\_j: (populations[lev\_i - 1] * 
01969                                           (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[lev\_i - 1, lev\_j - 1] * 
01970                                            (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_i - 1] - self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[lev\_j - 1])))
01971                 L = \textcolor{keyword}{lambda} wave: (populations[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] * 
01972                                   (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aa6416fe661b8deaa008179314727e025}{\_A}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1] * 
01973                                    (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[0] - 1] - 
01974                                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a52e68715246d258bf0a14f4bd06e89e4}{\_Energy}[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)[1] - 1])))
01975                 result = eval(to\_eval)
01976                 \textcolor{keywordflow}{return} \hyperlink{namespacepyneb_1_1utils_1_1misc_a852d66d22ba9e872484b3346dc28249e}{quiet\_divide}((result - int\_ratio), int\_ratio)
01977         \textcolor{comment}{# improve exception handling (we must include cases where both tem, den = -1) }
01978         \textcolor{keywordflow}{else}:
01979             self.log\_.error(\textcolor{stringliteral}{'ERROR in getTemDen: temperature and density cannot be simultaneously given'},
01980                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
01981 
01982         \textcolor{keywordflow}{if} method == \textcolor{stringliteral}{'nsect\_recur'}:
01983             \textcolor{stringliteral}{"""}
01984 \textcolor{stringliteral}{            Recursive n-section method for finding a root}
01985 \textcolor{stringliteral}{            It works by looking for the minumum of abs(f) using the fact that f(array) }
01986 \textcolor{stringliteral}{                returns an array}
01987 \textcolor{stringliteral}{}
01988 \textcolor{stringliteral}{            """}
01989             @profile
01990             \textcolor{keyword}{def }nsect\_recur(f, x1, x2, nCut, maxIter, \_iter=0):
01991                 \textcolor{keywordflow}{if} \_iter > maxIter:
01992                     \textcolor{keywordflow}{return} np.nan
01993                 x = np.linspace(x1, x2, nCut)
01994                 y = abs(\hyperlink{namespacepyneb_1_1utils_1_1_fortran_format_af94352584eced016c14d524330879115}{f}(x))
01995                 x\_min = np.argmin(y)
01996                 \textcolor{keywordflow}{if} y[x\_min] < maxError:
01997                     \textcolor{keywordflow}{return} x[x\_min]
01998                 \textcolor{keywordflow}{else}:
01999                     \textcolor{keywordflow}{if} x\_min == 0:
02000                         x\_min = 1
02001                     \textcolor{keywordflow}{if} x\_min == nCut - 1:
02002                         x\_min = nCut - 2
02003                     x1 = x[x\_min - 1]
02004                     x2 = x[x\_min + 1]
02005                     \_iter = \_iter + 1
02006                     \textcolor{keywordflow}{return} nsect\_recur(f, x1, x2, nCut=nCut, maxIter=maxIter, \_iter=\_iter)
02007 
02008             result = nsect\_recur(\_func, start\_x, end\_x, nCut, maxIter)
02009 
02010         \textcolor{keywordflow}{elif} method == \textcolor{stringliteral}{'nsect\_iter'}:
02011             \textcolor{stringliteral}{"""}
02012 \textcolor{stringliteral}{            Iterative n-section method for finding a root (analogous to the bisection method)}
02013 \textcolor{stringliteral}{            It works by looking for the minimum of abs(f) using the fact that f(array) returns an array}
02014 \textcolor{stringliteral}{}
02015 \textcolor{stringliteral}{            """}
02016             
02017             @profile
02018             \textcolor{keyword}{def }nsect\_iter(f, x1, x2, nCut, maxIter):
02019                 \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(maxIter):
02020                     x = np.linspace(x1, x2, nCut)
02021                     y = abs(\hyperlink{namespacepyneb_1_1utils_1_1_fortran_format_af94352584eced016c14d524330879115}{f}(x))
02022                     x\_min = np.argmin(y)
02023                     \textcolor{keywordflow}{if} y[x\_min] < maxError:
02024                         \textcolor{keywordflow}{return} x[x\_min]
02025                     \textcolor{keywordflow}{else}:
02026                         \textcolor{keywordflow}{if} x\_min == 0: x\_min = 1
02027                         \textcolor{keywordflow}{if} x\_min == nCut - 1: x\_min = nCut - 2
02028                         x1 = x[x\_min - 1]
02029                         x2 = x[x\_min + 1]
02030                 \textcolor{keywordflow}{return} np.nan
02031 
02032             result = nsect\_iter(\_func, start\_x, end\_x, nCut, maxIter)
02033             
02034         \textcolor{keywordflow}{else}:
02035             self.log\_.error(\textcolor{stringliteral}{'ERROR in getTemDen: no valid method given'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02036             result = \textcolor{keywordtype}{None}
02037 
02038         \textcolor{keywordflow}{if} (log \textcolor{keywordflow}{is} \textcolor{keyword}{True}) \textcolor{keywordflow}{and} (result \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
02039             \textcolor{keywordflow}{return} pow(10., result)
02040         \textcolor{keywordflow}{else}:
02041             \textcolor{keywordflow}{return} result
02042 
02043 
02044     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3a7c4f43d58a5988d04cbe23ed9593ba}{\_getTemDen\_MP}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, 
      lev\_j2= -1,
02045                   wave1= -1, wave2= -1, maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x=
       -1,
\hypertarget{pynebcore_8py_source_l02046}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3a7c4f43d58a5988d04cbe23ed9593ba}{02046}                   to\_eval=\textcolor{keywordtype}{None}, nCut=30, maxIter=20):
02047         
02048         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} config.INSTALLED[\textcolor{stringliteral}{'mp'}]:
02049             log\_.error(\textcolor{stringliteral}{'\_getTemDen\_MP cannot be used in absence of multiprocessing package'},
02050                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02051             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02052         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_i1)
02053         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_j1)
02054         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_i2)
02055         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_j2)
02056         tem = np.asarray(tem)
02057         den = np.asarray(den)
02058         \textcolor{keywordflow}{if} np.asarray(int\_ratio).size != 1:
02059             shape = np.asarray(int\_ratio).shape
02060             size = np.asarray(int\_ratio).size
02061             result = np.zeros(size) 
02062             \textcolor{keywordflow}{if} np.asarray(tem).size != 1:
02063                 \textcolor{keywordflow}{if} np.asarray(tem).shape != shape:
02064                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02065                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02066                 tem\_ravel = np.asarray(tem).ravel()
02067                 den\_ravel = np.zeros(size) + den
02068             \textcolor{keywordflow}{elif} np.asarray(den).size != 1:
02069                 \textcolor{keywordflow}{if} np.asarray(den).shape != shape:
02070                     self.log\_.error(\textcolor{stringliteral}{'getTemDen: int\_ratio and tem/den must have the same size'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02071                     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02072                 den\_ravel = np.asarray(den).ravel()
02073                 tem\_ravel = np.zeros(size) + tem
02074             \textcolor{keywordflow}{else}:
02075                 den\_ravel = np.zeros(size) + den
02076                 tem\_ravel = np.zeros(size) + tem
02077             int\_ratio\_ravel = np.asarray(int\_ratio).ravel()
02078         \textcolor{keywordflow}{else}:
02079             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(int\_ratio=int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, 
      lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
02080                   wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, start\_x=start\_x,
02081                   end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02082         
02083         Nprocs = config.Nprocs
02084         log\_.message(\textcolor{stringliteral}{'number of CPUs = \{0\}'}.format(Nprocs), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02085         gTDWorkerQ = Queue()
02086         gTDDoneQ = Queue()
02087         log\_.message(\textcolor{stringliteral}{'Queues initialized'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02088         jobid = 0
02089         \textcolor{keywordflow}{for} int\_rat1, tem1, den1 \textcolor{keywordflow}{in} zip(int\_ratio\_ravel, tem\_ravel, den\_ravel):
02090             gTDWorkerQ.put((jobid, int\_rat1, tem1, den1))
02091             jobid += 1
02092         log\_.message(\textcolor{stringliteral}{'put done'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02093         \textcolor{comment}{#gTDWorkerQSize = gTDWorkerQ.qsize() # this crash on OSX}
02094         gTDWorkerQSize = size
02095         log\_.message(\textcolor{stringliteral}{'Queue size \{0\}'}.format(gTDWorkerQSize), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02096 
02097         
02098         gTDProcesses = []
02099         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(Nprocs):
02100             p = Process(target=getTemDen\_helper, args=(gTDWorkerQ, gTDDoneQ, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, lev\_i1, lev\_j1, lev\_i2, lev\_j2,
02101                   wave1, wave2, maxError, method, log, start\_x, end\_x, to\_eval, nCut, maxIter))
02102             p.start()
02103             gTDProcesses.append(p)
02104         log\_.message(\textcolor{stringliteral}{'processes started'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02105 
02106         \textcolor{comment}{#}
02107         result = []
02108         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(gTDWorkerQSize):
02109             result.append(gTDDoneQ.get())
02110         log\_.message(\textcolor{stringliteral}{'Result obtained'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02111 
02112         \textcolor{keywordflow}{for} p \textcolor{keywordflow}{in} gTDProcesses:
02113             p.join(timeout=0.1)
02114         log\_.message(\textcolor{stringliteral}{'Joined'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.getTemDenMP'})
02115 
02116         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(Nprocs):
02117             gTDWorkerQ.put(\textcolor{stringliteral}{'STOP'})
02118         result.sort()
02119         to\_return = np.array(result)[:, 1]
02120         \textcolor{keywordflow}{return} to\_return.reshape(int\_ratio.shape)
02121 
02122     
02123     @profile
02124     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, lev\_j2= 
      -1,
02125                   wave1= -1, wave2= -1, maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x=
       -1,
\hypertarget{pynebcore_8py_source_l02126}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{02126}                   to\_eval=\textcolor{keywordtype}{None}, nCut=30, maxIter=20):
02127         \textcolor{stringliteral}{"""}
02128 \textcolor{stringliteral}{        Return either the temperature or the density given the other variable for a selected line ratio }
02129 \textcolor{stringliteral}{            of known intensity.}
02130 \textcolor{stringliteral}{        The line ratio can involve two or more than two lines. }
02131 \textcolor{stringliteral}{        In the first case (only two lines), it can be specified giving either two transitions }
02132 \textcolor{stringliteral}{            (four atomic levels, i.e. two for each transition), or two wavelengths.}
02133 \textcolor{stringliteral}{        In the general case (any number of lines), it can be specified as an algebraic expression }
02134 \textcolor{stringliteral}{            to be evaluated, involving either atomic levels or wavelengths.}
02135 \textcolor{stringliteral}{        An array of values, rather than a single value, can also be given, in which case the result }
02136 \textcolor{stringliteral}{            will also be an array.}
02137 \textcolor{stringliteral}{            }
02138 \textcolor{stringliteral}{        Usage: }
02139 \textcolor{stringliteral}{            O3.getTemDen(150., den=100., wave1=5007, wave2=4363, maxError=1.e-2)}
02140 \textcolor{stringliteral}{            O3.getTemDen(150., den=100., to\_eval = '(I(4,3) + I(4,2) + I(4,1)) / I(5,4)')}
02141 \textcolor{stringliteral}{            N2.getTemDen(150., den=100., to\_eval = '(L(6584) + L(6548)) / L(5755)')}
02142 \textcolor{stringliteral}{            O3.getTemDen([0.02, 0.04], den=[1.e4, 1.1e4], to\_eval="I(5, 4) / (I(4, 3) + I(4, 2))")}
02143 \textcolor{stringliteral}{}
02144 \textcolor{stringliteral}{        Parameters:}
02145 \textcolor{stringliteral}{            - int\_ratio    intensity ratio of the selected transition}
02146 \textcolor{stringliteral}{            - tem          electronic temperature}
02147 \textcolor{stringliteral}{            - den          electronic density}
02148 \textcolor{stringliteral}{            - lev\_i1       upper level of 1st transition}
02149 \textcolor{stringliteral}{            - lev\_j1       lower level of 1st transition}
02150 \textcolor{stringliteral}{            - lev\_i2       upper level of 2nd transition}
02151 \textcolor{stringliteral}{            - lev\_j2       lower level of 2nd transition}
02152 \textcolor{stringliteral}{            - wave1        wavelength of 1st transition}
02153 \textcolor{stringliteral}{            - wave2        wavelength of 2nd transition}
02154 \textcolor{stringliteral}{            - maxError     tolerance on difference between input and computed ratio }
02155 \textcolor{stringliteral}{            - method       numerical method for finding the root (nsect\_recur, nsect\_iter)}
02156 \textcolor{stringliteral}{            - log          switch of log (default = True). start\_x and end\_x are using this parameter.}
02157 \textcolor{stringliteral}{            - start\_x      lower end of the interval to explore. (default: lower end of collision }
02158 \textcolor{stringliteral}{                            strength temperature array for temperature, 1 if density)}
02159 \textcolor{stringliteral}{            - end\_x        higher end of the interval to explore. (default: higher end of collision }
02160 \textcolor{stringliteral}{                            strength temperature array for temperature, 1e8 if density)}
02161 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated, using either I (for transitions identified }
02162 \textcolor{stringliteral}{                            through atomic levels) or L (for transitions identified through wavelengths)}
02163 \textcolor{stringliteral}{            - nCut        number of sections in which each step is cut. 2 would be dichotomy.}
02164 \textcolor{stringliteral}{            - maxIter     maximum number of iterations}
02165 \textcolor{stringliteral}{}
02166 \textcolor{stringliteral}{        """}        
02167         \textcolor{keywordflow}{if} config.\_use\_mp:
02168             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3a7c4f43d58a5988d04cbe23ed9593ba}{\_getTemDen\_MP}(int\_ratio=int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, 
      lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
02169                   wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, start\_x=start\_x,
02170                   end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02171         \textcolor{keywordflow}{else}:
02172             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad1d75f64b27a6acee079b5738b69dabe}{\_getTemDen\_1}(int\_ratio=int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, 
      lev\_j1=lev\_j1, lev\_i2=lev\_i2, lev\_j2=lev\_j2,
02173                   wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, start\_x=start\_x,
02174                   end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02175 
\hypertarget{pynebcore_8py_source_l02176}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a95230eab8816f670306adceffe6f6a48}{02176}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a95230eab8816f670306adceffe6f6a48}{getIonAbundance}(self, int\_ratio, tem, den, lev\_i= -1, lev\_j= -1, wave= -1, 
      to\_eval=None, Hbeta=100.):
02177         \textcolor{stringliteral}{"""}
02178 \textcolor{stringliteral}{        Compute the ionic abundance relative to H+ given the intensity of a line or sum of lines, }
02179 \textcolor{stringliteral}{        the temperature, and the density. }
02180 \textcolor{stringliteral}{        The line can be specified as a transition (i.e., giving the two atomic level involved), }
02181 \textcolor{stringliteral}{        as a wavelength, or as an algebraic expression. In the last case, a sum of lines }
02182 \textcolor{stringliteral}{        can also be supplied.}
02183 \textcolor{stringliteral}{}
02184 \textcolor{stringliteral}{        Usage:}
02185 \textcolor{stringliteral}{            O3.getIonAbundance(100, 1.5e4, 100., wave=5007)}
02186 \textcolor{stringliteral}{            O3.getIonAbundance(130, 1.5e4, 100., to\_eval='I(4,3) + I(4,2)')}
02187 \textcolor{stringliteral}{            O3.getIonAbundance(np.array([100, 150]), np.array([1.5e4, 1.2e4]), np.array([100., 120]), }
02188 \textcolor{stringliteral}{                wave=5007)}
02189 \textcolor{stringliteral}{            O2.getIonAbundance(int\_ratio=100, tem=1.5e4, den=100., to\_eval='L(3726)+L(3729)')}
02190 \textcolor{stringliteral}{}
02191 \textcolor{stringliteral}{            }
02192 \textcolor{stringliteral}{        Parameters:}
02193 \textcolor{stringliteral}{            - int\_ratio    relative line intensity (default normalization: Hbeta = 100). }
02194 \textcolor{stringliteral}{                            May be an array.}
02195 \textcolor{stringliteral}{            - tem          electronic temperature in K. May be an array.}
02196 \textcolor{stringliteral}{            - den          electronic density in cm^-3. May be an array.}
02197 \textcolor{stringliteral}{            - lev\_i        upper level of transition}
02198 \textcolor{stringliteral}{            - lev\_j        lower level of transition}
02199 \textcolor{stringliteral}{            - wave         wavelength of transition. Takes precedence on lev\_i and lev\_j if set, }
02200 \textcolor{stringliteral}{                            ignored otherwise }
02201 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated. Takes precedence on wave if set, }
02202 \textcolor{stringliteral}{                            ignored otherwise.}
02203 \textcolor{stringliteral}{            - Hbeta        line intensity normalization at Hbeta (default Hbeta = 100)}
02204 \textcolor{stringliteral}{        }
02205 \textcolor{stringliteral}{        """}
02206         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_i)
02207         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_afa4b9737dcd5bed31e25e8f0b6dc4730}{\_test\_lev}(lev\_j)
02208         \textcolor{keywordflow}{if} np.ndim(tem) != np.ndim(den):
02209             self.log\_.error(\textcolor{stringliteral}{'ten and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02210             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02211         \textcolor{keywordflow}{if} ((np.squeeze(np.asarray(int\_ratio)).shape != np.squeeze(np.asarray(tem)).shape) | 
02212             (np.squeeze(np.asarray(den)).shape != np.squeeze(np.asarray(tem)).shape)):
02213             self.log\_.warn(\textcolor{stringliteral}{'int\_ratio, tem and den must does not have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02214         \textcolor{keywordflow}{if} (lev\_i == -1) & (lev\_j == -1) & (wave == -1) & (to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}):
02215             self.log\_.error(\textcolor{stringliteral}{'At least one of lev\_i, lev\_j, wave or to\_eval must be supplied'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02216             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02217         \textcolor{keywordflow}{if} to\_eval == \textcolor{keywordtype}{None}:
02218             \textcolor{keywordflow}{if} wave != -1:
02219                 lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)     
02220             to\_eval = \textcolor{stringliteral}{'I('} + str(lev\_i) + \textcolor{stringliteral}{','} + str(lev\_j) + \textcolor{stringliteral}{')'} 
02221         I = \textcolor{keyword}{lambda} lev\_i, lev\_j: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, lev\_i, lev\_j, product=\textcolor{keyword}{False})
02222         L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, wave=wave, product=\textcolor{keyword}{False})
02223         \textcolor{keywordflow}{try}:
02224             emis = eval(to\_eval)
02225         \textcolor{keywordflow}{except}:
02226             self.log\_.error(\textcolor{stringliteral}{'Unable to eval \{0\}'}.format(to\_eval), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02227             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02228         \textcolor{comment}{#int\_ratio is in units of Hb = Hbeta keyword}
02229         ionAbundance = ((int\_ratio / Hbeta) * (\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{getRecEmissivity}(tem, den, 4, 2, atom=\textcolor{stringliteral}{'H1'}, 
      product=\textcolor{keyword}{False}) / emis))
02230         \textcolor{keywordflow}{return} ionAbundance
02231     
02232 
\hypertarget{pynebcore_8py_source_l02233}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4be768ed1460bb448207b470551ef2ed}{02233}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4be768ed1460bb448207b470551ef2ed}{printIonic}(self, tem=None, den=None, printA=False, printPop=True, printCrit=True):
02234         \textcolor{stringliteral}{""" }
02235 \textcolor{stringliteral}{        Print miscellaneous information (wavelengths, level populations, emissivities, }
02236 \textcolor{stringliteral}{            critical densities) for given physical conditions.}
02237 \textcolor{stringliteral}{        If an electron temperature is given, level critical densities can be printed }
02238 \textcolor{stringliteral}{            (using printCrit=True)}
02239 \textcolor{stringliteral}{        If an electron density is also given, line emissivities (also for Hbeta) are printed and level }
02240 \textcolor{stringliteral}{            populations can be printed (using printPop=True)}
02241 \textcolor{stringliteral}{        }
02242 \textcolor{stringliteral}{        Usage:}
02243 \textcolor{stringliteral}{            O3.printIonic()}
02244 \textcolor{stringliteral}{            O3.printIonic(printA=True)}
02245 \textcolor{stringliteral}{            O3.printIonic(tem=10000., printCrit=True)}
02246 \textcolor{stringliteral}{            O3.printIonic(tem=10000., den=1e3, printA=True, printPop=True, printCrit=True)}
02247 \textcolor{stringliteral}{}
02248 \textcolor{stringliteral}{        Parameters:}
02249 \textcolor{stringliteral}{            - tem          temperature}
02250 \textcolor{stringliteral}{            - den          density}
02251 \textcolor{stringliteral}{            - printA       also print transition probabilities (default=False)}
02252 \textcolor{stringliteral}{            - printPop     also print level populations (needs tem and den)}
02253 \textcolor{stringliteral}{            - printCrit    also print critical densities (needs tem)}
02254 \textcolor{stringliteral}{}
02255 \textcolor{stringliteral}{        """}
02256         print(\textcolor{stringliteral}{'elem = %s'} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem})
02257         print(\textcolor{stringliteral}{'spec = %i'} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec})
02258         \textcolor{keywordflow}{if} tem \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
02259             print(\textcolor{stringliteral}{'temperature = %6.1f K'} % tem)
02260         \textcolor{keywordflow}{if} den \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
02261             print(\textcolor{stringliteral}{'density = %6.1f cm-3'} % den)
02262         print(\textcolor{stringliteral}{""})
02263         \textcolor{keywordflow}{if} printPop \textcolor{keywordflow}{and} ((tem \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{or} (den \textcolor{keywordflow}{is} \textcolor{keywordtype}{None})):
02264             log\_.warn(\textcolor{stringliteral}{'Cannot print populations as tem or den is missing'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02265             printPop = \textcolor{keyword}{False}
02266         \textcolor{keywordflow}{if} printCrit \textcolor{keywordflow}{and} (tem \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}):
02267             log\_.warn(\textcolor{stringliteral}{'Cannot print critical densities as tem is missing'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling})
02268             printCrit = \textcolor{keyword}{False}
02269         to\_print = \textcolor{stringliteral}{''}
02270         \textcolor{keywordflow}{if} printPop:
02271             to\_print += \textcolor{stringliteral}{'Level   Populations  '}
02272         \textcolor{keywordflow}{if} printCrit:
02273             to\_print += \textcolor{stringliteral}{'Critical densities'}
02274         \textcolor{keywordflow}{if} to\_print != \textcolor{stringliteral}{''}:
02275             print(to\_print)
02276         \textcolor{keywordflow}{if} printCrit:
02277             critdens = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aae95b1cb36defadad24cf94459203eb3}{getCritDensity}(tem)
02278         \textcolor{keywordflow}{if} printPop:
02279             pop = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aab7496403c8aaef40ab3b20b5c00e9f0}{getPopulations}(tem, den)
02280         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(0, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}):
02281             lev\_i = i + 1
02282             to\_print = \textcolor{stringliteral}{'Level %1i:  '} % (lev\_i)
02283             \textcolor{keywordflow}{if} printPop:
02284                 to\_print += \textcolor{stringliteral}{"%.3E  "} % (pop[i])
02285             \textcolor{keywordflow}{if} printCrit:
02286                 to\_print += \textcolor{stringliteral}{"%.3E"} % critdens[i]
02287             \textcolor{keywordflow}{if} printPop \textcolor{keywordflow}{or} printCrit:
02288                 print(to\_print)
02289         \textcolor{keywordflow}{if} printPop \textcolor{keywordflow}{or} printCrit:
02290             print(\textcolor{stringliteral}{''})
02291             
02292         \textcolor{keywordflow}{if} (tem \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (den \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
02293             emis = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den)
02294         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}):
02295             \textcolor{keywordflow}{if} printA:
02296                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02297                     to\_print = \textcolor{stringliteral}{"\{0:.3E\}   "}.format(np.float(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a4b3ea50d7c77fdf645c2cea97243c17e}{getA}(i + 1, j + 1)))
02298                     print(to\_print, end=\textcolor{stringliteral}{""})
02299                 print(\textcolor{stringliteral}{""})
02300             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02301                 \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j] > 10000.:
02302                     to\_print = \textcolor{stringliteral}{"%10.2fm "} % (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j] / 1e4)
02303                 \textcolor{keywordflow}{else}:
02304                     to\_print = \textcolor{stringliteral}{"%10.2fA "} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[i, j]
02305                 print(to\_print, end=\textcolor{stringliteral}{""})
02306             print(\textcolor{stringliteral}{""})
02307             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02308                 print(\textcolor{stringliteral}{"    (%1i-->%1i) "} % (i + 1, j + 1), end=\textcolor{stringliteral}{""})
02309             print(\textcolor{stringliteral}{""})
02310             \textcolor{keywordflow}{if} (tem \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (den \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
02311                 \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02312                     print(\textcolor{stringliteral}{"  %.3E "} % emis[i,j], end=\textcolor{stringliteral}{""})
02313             print(\textcolor{stringliteral}{"\(\backslash\)n"})
02314         \textcolor{keywordflow}{if} (tem \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (den \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
02315             \textcolor{keywordflow}{try}:
02316                 H1 = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{RecAtom}(\textcolor{stringliteral}{'H'}, 1)
02317                 print(\textcolor{stringliteral}{"# H-beta volume emissivity:"})
02318                 print(\textcolor{stringliteral}{"%.3E N(H+) * N(e-)  (erg/s)"} % H1.getEmissivity(tem, den, 4, 2))
02319             \textcolor{keywordflow}{except}:
02320                 \textcolor{keywordflow}{pass}
02321 
02322     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0b95239f3b76bbd0e42da220370ff866}{printTemDen}(self, int\_ratio, tem= -1, den= -1, lev\_i1= -1, lev\_j1= -1, lev\_i2= -1, 
      lev\_j2= -1, wave1= -1, wave2= -1,
02323                     maxError=1.e-3, method=\textcolor{stringliteral}{'nsect\_recur'}, log=\textcolor{keyword}{True}, start\_x= -1, end\_x= -1, to\_eval=\textcolor{keywordtype}{None},
\hypertarget{pynebcore_8py_source_l02324}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0b95239f3b76bbd0e42da220370ff866}{02324}                     nCut=30, maxIter=20):
02325         \textcolor{stringliteral}{""" }
02326 \textcolor{stringliteral}{        Print result of getTemDen function. See getTemDen for more details.}
02327 \textcolor{stringliteral}{        }
02328 \textcolor{stringliteral}{        Usage:}
02329 \textcolor{stringliteral}{            O3.printTemDen(100, tem=10000, wave1=5007, wave2=4363)}
02330 \textcolor{stringliteral}{        }
02331 \textcolor{stringliteral}{        Parameters:}
02332 \textcolor{stringliteral}{            - int\_ratio    intensity ratio of the selected transition}
02333 \textcolor{stringliteral}{            - tem          electronic temperature}
02334 \textcolor{stringliteral}{            - den          electronic density}
02335 \textcolor{stringliteral}{            - lev\_i1       upper level of 1st transition}
02336 \textcolor{stringliteral}{            - lev\_j1       lower level of 1st transition}
02337 \textcolor{stringliteral}{            - lev\_i2       upper level of 2nd transition}
02338 \textcolor{stringliteral}{            - lev\_j2       lower level of 2nd transition}
02339 \textcolor{stringliteral}{            - wave1        wavelength of 1st transition}
02340 \textcolor{stringliteral}{            - wave2        wavelength of 2nd transition}
02341 \textcolor{stringliteral}{            - maxError     tolerance on difference between input and computed ratio }
02342 \textcolor{stringliteral}{            - method       numerical method for finding the root (nsect\_recur, nsect\_iter)}
02343 \textcolor{stringliteral}{            - log          log switch (default = True)}
02344 \textcolor{stringliteral}{            - start\_x      lower end of the interval to explore (default: lower end of collision }
02345 \textcolor{stringliteral}{                            strength temperature array)}
02346 \textcolor{stringliteral}{            - end\_x        higher end of the interval to explore (default: higher end of collision }
02347 \textcolor{stringliteral}{                            strength temperature array)}
02348 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated, using either I (for transitions identified through }
02349 \textcolor{stringliteral}{                            atomic levels) or L (for transitions identified through wavelengths)}
02350 \textcolor{stringliteral}{            - nCut        number of sections in which each step is cut. 2 would be dichotomy.}
02351 \textcolor{stringliteral}{            - maxIter     maximum number of iterations}
02352 \textcolor{stringliteral}{}
02353 \textcolor{stringliteral}{        """}
02354         \textcolor{keywordflow}{if} tem == -1:
02355             option = \textcolor{stringliteral}{'temperature'}
02356             assume = den
02357             assume\_str = \textcolor{stringliteral}{'density'}
02358             assume\_unit = \textcolor{stringliteral}{'cm-3'}
02359             unit = \textcolor{stringliteral}{'K'}
02360         \textcolor{keywordflow}{if} den == -1:
02361             option = \textcolor{stringliteral}{'density'}
02362             assume = tem
02363             assume\_str = \textcolor{stringliteral}{'temperature'}
02364             assume\_unit = \textcolor{stringliteral}{'K'}
02365             unit = \textcolor{stringliteral}{'cm-3'}
02366 
02367         result = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a5e1aa59c92bf62bae8bd756a4405eb25}{getTemDen}(int\_ratio, tem=tem, den=den, lev\_i1=lev\_i1, lev\_j1=lev\_j1, lev\_i2=
      lev\_i2, lev\_j2=lev\_j2,
02368                                 wave1=wave1, wave2=wave2, maxError=maxError, method=method, log=log, 
      start\_x=start\_x,
02369                                 end\_x=end\_x, to\_eval=to\_eval, nCut=nCut, maxIter=maxIter)
02370         print(\textcolor{stringliteral}{'Ion = %s'} % self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem} + \textcolor{stringliteral}{" "} + \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}))
02371         print(\textcolor{stringliteral}{'Option = %s'} % option)
02372         print(\textcolor{stringliteral}{'Assumed %s = %.0f %s'} % (assume\_str, assume, assume\_unit))
02373         \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02374             print(\textcolor{stringliteral}{'Assumed I(%i)/I(%i) ratio = %.0f'} % (wave1, wave2, int\_ratio))
02375         \textcolor{keywordflow}{else}:
02376             print(\textcolor{stringliteral}{'Assumed %s = %.0f'} % (to\_eval, int\_ratio))
02377 \textcolor{comment}{#        print 'method = %s' % method}
02378 \textcolor{comment}{#        print 'maxError on ratio %f' % maxError}
02379         print(\textcolor{stringliteral}{'Calculated %s = %.0f %s'} % (option, result, unit))
02380 
02381 
02382     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_adc2de658da17347204f430aff728650b}{plotEmiss}(self, tem\_min=1000, tem\_max=30000, ionic\_abund=1.0, den=1e3, style='-',
02383                   legend\_loc=4, temLog=\textcolor{keyword}{False}, plot\_total=\textcolor{keyword}{False}, plot\_only\_total=\textcolor{keyword}{False}, legend=\textcolor{keyword}{True},
\hypertarget{pynebcore_8py_source_l02384}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_adc2de658da17347204f430aff728650b}{02384}                   total\_color=\textcolor{stringliteral}{'black'}, total\_label=\textcolor{stringliteral}{'TOTAL'}, ax=\textcolor{keywordtype}{None}):
02385         \textcolor{stringliteral}{""" }
02386 \textcolor{stringliteral}{        Plot the emissivity as a function of temperature of all the lines of the selected atom.  }
02387 \textcolor{stringliteral}{}
02388 \textcolor{stringliteral}{        Usage: }
02389 \textcolor{stringliteral}{            O3.plotEmiss(tem\_min=10000, tem\_max=20000)}
02390 \textcolor{stringliteral}{        }
02391 \textcolor{stringliteral}{        Parameters:}
02392 \textcolor{stringliteral}{            - tem\_min         minimum value of the temperature range to span (default=1000)}
02393 \textcolor{stringliteral}{            - tem\_max         maximum value of the temperature range to span (default=30000)}
02394 \textcolor{stringliteral}{            - ionic\_abund     relative ionic abundance (default = 1.0)}
02395 \textcolor{stringliteral}{            - den             electron density}
02396 \textcolor{stringliteral}{            - style           line style of the plot (default: '-' [solid line])}
02397 \textcolor{stringliteral}{            - legend\_loc      localization of the legend (default: 4 = lower right; see plt.legend }
02398 \textcolor{stringliteral}{                                for more details)}
02399 \textcolor{stringliteral}{            - temLog          linear (False) or logarithmic temperature axis (default = False)}
02400 \textcolor{stringliteral}{            - plot\_total      flag to also plot total emissivity (default = False)}
02401 \textcolor{stringliteral}{            - plot\_only\_total flag to only plot total emissivity (default = False)}
02402 \textcolor{stringliteral}{            - legend          flag to place legend (default = True)}
02403 \textcolor{stringliteral}{            - total\_color     color of the total emissivity (default = 'black')}
02404 \textcolor{stringliteral}{            - total\_label     label of the total emissivity (default = 'TOTAL')}
02405 \textcolor{stringliteral}{            - ax              axis where to send the plot. If None, a new axis is done}
02406 \textcolor{stringliteral}{}
02407 \textcolor{stringliteral}{        """}
02408         \textcolor{keywordflow}{if} ax \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02409             f, ax = plt.subplots()
02410         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} config.INSTALLED[\textcolor{stringliteral}{'plt'}]: 
02411             log\_.error(\textcolor{stringliteral}{'Matplotlib not available, no plot'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.plot'})
02412             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02413         tem = np.logspace(np.log10(tem\_min), np.log10(tem\_max), 1000)
02414         total\_emis = np.zeros\_like(tem)
02415         \textcolor{keywordflow}{for} wave \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList}:
02416             lev\_i, lev\_j = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a7c9f17a3d9e841267add92377d9d1ede}{getTransition}(wave)
02417             \textcolor{keywordflow}{if} (lev\_i <= self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}) \textcolor{keywordflow}{and} (lev\_j <= self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels}):
02418                 color = ((np.log10(wave) - np.log10(np.min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList}))) / 
02419                          (np.log10(np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList})) - np.log10(np.min(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a8280ef5632977a7cf7e8fe4c63127703}{lineList})))) ** 0.4
02420                 c = cm.jet(color, 1)
02421                 \textcolor{keywordflow}{if} temLog:
02422                     x\_to\_plot = np.log10(tem)
02423                 \textcolor{keywordflow}{else}:
02424                     x\_to\_plot = tem
02425                 y\_to\_plot = ionic\_abund * self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, wave=wave)
02426                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} plot\_only\_total:
02427                     \textcolor{keywordflow}{if} (y\_to\_plot[0] > 0.):
02428                         ax.plot(x\_to\_plot, np.log10(y\_to\_plot),
02429                              label=\textcolor{stringliteral}{'\{0:.0f\}'}.format(wave), color=c, linestyle=style)
02430                 total\_emis += y\_to\_plot
02431         \textcolor{keywordflow}{if} plot\_total:
02432             ax.plot(x\_to\_plot, np.log10(total\_emis),
02433                      label=total\_label, color=total\_color, linewidth=3, linestyle=style)
02434         \textcolor{keywordflow}{if} legend:
02435             ax.legend(loc=legend\_loc)
02436         \textcolor{keywordflow}{if} temLog:
02437             ax.set\_xlabel(\textcolor{stringliteral}{'log(T[K])'})
02438         \textcolor{keywordflow}{else}:
02439             ax.set\_xlabel(\textcolor{stringliteral}{'T[K]'})
02440         ax.set\_ylabel(\textcolor{stringliteral}{'log [erg.cm3/s]'})
02441         ax.set\_title(\textcolor{stringliteral}{'Line emissivities'})
02442 
\hypertarget{pynebcore_8py_source_l02443}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad18adec8faaf694fbff55656efea719d}{02443}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ad18adec8faaf694fbff55656efea719d}{plotGrotrian}(self, tem=1e4, den=1e2, thresh\_int=1e-3, unit='eV', detailed=False, 
      ax=None):
02444         \textcolor{stringliteral}{"""}
02445 \textcolor{stringliteral}{        Draw a Grotrian plot of the selected atom, labelling only lines above a}
02446 \textcolor{stringliteral}{        pecified intensity threshold (relative to the most intense line). }
02447 \textcolor{stringliteral}{        For ground state levels, the Russell-Saunders term symbol is also given.}
02448 \textcolor{stringliteral}{        }
02449 \textcolor{stringliteral}{        Usage:}
02450 \textcolor{stringliteral}{            O3.plotGrotrian()}
02451 \textcolor{stringliteral}{        }
02452 \textcolor{stringliteral}{        Parameters:}
02453 \textcolor{stringliteral}{            - tem          temperature at which the intensity threshold is to be computed }
02454 \textcolor{stringliteral}{            - den          density at which the intensity threshold is to be computed }
02455 \textcolor{stringliteral}{            - thresh\_int   intensity threshold (relative to the most intense line, default: 1.e-3)}
02456 \textcolor{stringliteral}{            - unit         one of 'eV' (default), '1/Ang' or 'Ryd'}
02457 \textcolor{stringliteral}{            - ax           axis where to plot the result}
02458 \textcolor{stringliteral}{}
02459 \textcolor{stringliteral}{        """}
02460         \textcolor{keywordflow}{if} ax \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02461             f, ax = plt.subplots()
02462         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} [\textcolor{stringliteral}{'eV'}, \textcolor{stringliteral}{'Ryd'}, \textcolor{stringliteral}{'1/Ang'}]:
02463             log\_.error(\textcolor{stringliteral}{'Unit \{0\} not available'}.format(unit))
02464             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02465         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} config.INSTALLED[\textcolor{stringliteral}{'plt'}]: 
02466             log\_.error(\textcolor{stringliteral}{'Matplotlib not available, no plot'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.plot'})
02467             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02468         color\_list = [\textcolor{stringliteral}{'b'}, \textcolor{stringliteral}{'}\textcolor{stringliteral}{r', '}y', 'c', 'm', 'g']
02469         energies = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(unit=unit)
02470          
02471         \textcolor{comment}{# VL 16 Jul 2013 - Detect level inversion, just for warning        }
02472         level\_multiplet = [0]
02473         multiplets = []
02474         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
02475             term = []; j = []; en = []
02476             \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST}:
02477                 term.append(item[1])
02478                 j.append(item[2])
02479                 en.append(item[3])
02480             sorted\_indx = np.argsort(en) 
02481             term = np.array(term)[sorted\_indx]
02482             j = np.array(j)[sorted\_indx]
02483             en = np.array(en)[sorted\_indx]
02484             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(1, len(en)):
02485                 \textcolor{keywordflow}{if} (term[i] == term[i-1]):
02486                     level\_multiplet.append(i)
02487                 \textcolor{keywordflow}{else}:
02488                     multiplets.append(level\_multiplet) 
02489                     level\_multiplet = [i]
02490             multiplets.append(level\_multiplet) \textcolor{comment}{# append last multiplet}
02491 \textcolor{comment}{# Mistakenly rounds off fractional J values. Corrected 26/12/2014            }
02492 \textcolor{comment}{#            levelLabels = ['$^\{\{\{0\}\}\}$\{1\}$\_\{\{\{2:.0f\}\}\}$'.format(l['term'][0],l['term'][1],l['J']) for l in
       self.NIST]}
02493             levelLabels = [\textcolor{stringliteral}{'$^\{\{\{0\}\}\}$\{1\}$\_\{\{\{2\}/\{3\}\}\}$'}.format(l[\textcolor{stringliteral}{'term'}][0], l[\textcolor{stringliteral}{'term'}][1], Fraction(l[\textcolor{stringliteral}{'J'}]
      ).numerator, Fraction(l[\textcolor{stringliteral}{'J'}]).denominator) \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a65e03e79fb1cde1b00580042f3303538}{NIST}]
02494         \textcolor{keywordflow}{else}:
02495             delta\_e\_max = 1.e-5  \textcolor{comment}{# Arbitrary limit to define hyperfine structure and identify multiplets }
02496             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(1, len(energies)):
02497                 \textcolor{keywordflow}{if} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}()[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}()[i - 1] < delta\_e\_max):
02498                     \textcolor{comment}{# if levels close, append level to multiplet}
02499                     level\_multiplet.append(i) 
02500                 \textcolor{keywordflow}{else}:
02501                     \textcolor{comment}{# if levels separated, add current multiplet to array and start a new multiplet}
02502                     multiplets.append(level\_multiplet) 
02503                     level\_multiplet = [i]
02504             multiplets.append(level\_multiplet) \textcolor{comment}{# append last multiplet}
02505             warn\_label = []
02506             levelLabels = gsLevelDict[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs}]
02507             \textcolor{keywordflow}{for} i\_multi \textcolor{keywordflow}{in} np.arange(len(multiplets)):
02508                 stat\_weights = []
02509                 \textcolor{comment}{# check each multiplet for inversion separately}
02510                 \textcolor{keywordflow}{for} i\_level \textcolor{keywordflow}{in} multiplets[i\_multi]:
02511                     latex\_sw = levelLabels[i\_level]
02512                     sw = eval(latex\_sw.split(\textcolor{stringliteral}{'$'})[-2].replace(\textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{''}).replace(\textcolor{stringliteral}{'\{'}, \textcolor{stringliteral}{''}).replace(\textcolor{stringliteral}{'\}'}, \textcolor{stringliteral}{'.'}) +
       \textcolor{stringliteral}{'*2.+1.'})
02513                     stat\_weights.append(sw)
02514                 \textcolor{keywordflow}{if} (stat\_weights != [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}()[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} multiplets[i\_multi]]):
02515                     warn\_label.append(i\_multi)
02516                     to\_print = \textcolor{stringliteral}{'\(\backslash\)nLevel inversion in multiplet \{0\} of \{1\}'}\(\backslash\)
02517                              \textcolor{stringliteral}{'\(\backslash\)nThe labels of levels \{2\} are displayed in the wrong order'} + \(\backslash\)
02518                              \textcolor{stringliteral}{'\(\backslash\)nAssumed statistical weights: \{3\}'} + \(\backslash\)
02519                              \textcolor{stringliteral}{'\(\backslash\)nStatistical weights of data: \{4\}\(\backslash\)n'}
02520                     log\_.warn(to\_print.format(i\_multi + 1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a192f3e20446d7fba81d789bc705d6c71}{atom}, multiplets[i\_multi], 
02521                                                  stat\_weights, [self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0f2483487115f19556586b9e422bd5fb}{getStatWeight}()[k] \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} multiplets[i\_multi]]), 
02522                                  calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a373b7735acf4f528b54bddf373ad67a1}{calling} + \textcolor{stringliteral}{'.plot'})
02523 
02524         \textcolor{comment}{# where level starts in the plot}
02525        
02526         x\_span = 0.75
02527         x\_0 = (1 - x\_span) / 4.    
02528         dx = 0.005
02529         max\_en = np.max(energies)
02530         blow = 0.02 * max\_en \textcolor{comment}{# blowup scale for multiplets}
02531         ax.set\_xlim((0, 1.))
02532         ax.set\_ylim((np.max(energies) * -0.05, max\_en * 1.05))
02533         ax.set\_title(\textcolor{stringliteral}{'[\{0\} \{1\}]'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec})))
02534 
02535         \textcolor{comment}{# Blow up of multiplets in the plot}
02536         i\_tot = 0
02537         \textcolor{keywordflow}{for} i\_multi \textcolor{keywordflow}{in} np.arange(len(multiplets)):
02538             shift = (1-len(multiplets[i\_multi])) / 2.
02539             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(len(multiplets[i\_multi])):
02540                 y = energies[multiplets[i\_multi][i]] + shift * blow
02541                 ax.plot([x\_0, 1.5 * x\_0, 1.6 * x\_0, x\_0 + x\_span], 
02542                          [y, y, energies[multiplets[i\_multi][i]], 
02543                           energies[multiplets[i\_multi][i]]], lw = 1.2, 
02544                          color = color\_list[np.mod(multiplets[i\_multi][i], len(color\_list))])
02545                 ax.text(x\_span + x\_0 + dx, y, \textcolor{stringliteral}{'\{0:7.4f\}'}.format(energies[multiplets[i\_multi][i]]), size=\textcolor{stringliteral}{'
      small'}, 
02546                          horizontalalignment=\textcolor{stringliteral}{'left'}, verticalalignment=\textcolor{stringliteral}{'center'})
02547                 \textcolor{keywordflow}{try}:
02548                     \textcolor{keywordflow}{if} (detailed \textcolor{keywordflow}{is} \textcolor{keyword}{False}):
02549                         ax.text(dx, y, levelLabels[i\_tot], size=\textcolor{stringliteral}{'medium'}, verticalalignment=\textcolor{stringliteral}{'center'})
02550                     \textcolor{keywordflow}{else}:
02551                         ax.text(dx, y, str(i\_tot+1) + \textcolor{stringliteral}{": "} + levelLabels[i\_tot] , size=\textcolor{stringliteral}{'medium'}, 
      verticalalignment=\textcolor{stringliteral}{'center'}, color = color\_list[np.mod(multiplets[i\_multi][i], len(color\_list))])
02552                     i\_tot += 1
02553                 \textcolor{keywordflow}{except}:
02554                     \textcolor{keywordflow}{pass}
02555                 shift += 1
02556         ax.text(1 - dx / 2., max(energies) * 0.5, \textcolor{stringliteral}{'E [\{0:s\}] '}.format(unit), horizontalalignment=\textcolor{stringliteral}{'right'}, 
      color=\textcolor{stringliteral}{'blue'})
02557         plt.xlabel(\textcolor{stringliteral}{'Ground-state configuration: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a3e6bcb66f905475145b261ae797096e3}{gs}), color=\textcolor{stringliteral}{"#004400"})
02558                
02559         ax.xaxis.set\_ticks\_position(\textcolor{stringliteral}{"none"})
02560         ax.yaxis.set\_ticks\_position(\textcolor{stringliteral}{"none"})
02561         ax.xaxis.set\_ticklabels([])
02562         ax.yaxis.set\_ticklabels([])
02563         
02564         emis\_max = np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den))
02565         N\_lines = (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(1e4, 1e3) > (emis\_max * thresh\_int)).sum() \textcolor{comment}{# number of
       lines plotted}
02566         x\_pad = 0.1 * (x\_span - 0.6 * x\_0)     
02567         \textcolor{keywordflow}{if} N\_lines > 1:
02568             delta\_x = (x\_span - 2 * x\_pad) / (N\_lines - 1)
02569             x = 1.6 * x\_0 + 0.5 * x\_pad
02570         \textcolor{keywordflow}{else}:
02571             delta\_x = 0
02572             x = (1.6 * x\_0 + x\_span) / 2.
02573         cc = colors.ColorConverter()
02574         \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a6b43c1e6431a6786c1b4267f704fb4e8}{NLevels} - 1) + 2:
02575             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(j - 1) + 1:
02576                 emis = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_aaf4e84a9d5f835e6284bd9302314f775}{getEmissivity}(tem, den, j, i)
02577                 \textcolor{keywordflow}{if} emis > (emis\_max * thresh\_int):
02578                     N\_seg = 1000. \textcolor{comment}{#number of segments to draw emission line, to make it look smooth}
02579                     xx = np.ones(N\_seg+1) * x  \textcolor{comment}{# x coord of segmente making up one line}
02580                     yy = np.linspace(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(i, unit=unit), self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(j, unit=unit), N\_seg+1)
02581                     scale = np.linspace(0, 1, N\_seg+1)
02582                     alpha =  np.tanh((2*scale-1)+1)  \textcolor{comment}{# to make alpha vary as a smooth step function}
02583                     points = np.array([xx, yy]).T.reshape(-1, 1, 2) 
02584                     segments = np.concatenate([points[:-1], points[1:]], axis=1) 
02585                     cmap1 = []
02586                     cmap2 = []
02587                     \textcolor{keywordflow}{for} seg \textcolor{keywordflow}{in} segments:
02588                             yy0 = seg.mean(0)[1] 
02589                             alpha0 = np.interp(yy0, yy, alpha)
02590                             rgb1 = cc.to\_rgb(color\_list[np.mod(j-1, len(color\_list))]) 
02591                             rgb2 = cc.to\_rgb(color\_list[np.mod(i-1, len(color\_list))]) 
02592                             cmap1.append([rgb1[0], rgb1[1], rgb1[2], alpha0]) 
02593                             cmap2.append([rgb2[0], rgb2[1], rgb2[2], 1-alpha0])
02594                     lc1 = LineCollection(segments, linewidths=3.5)
02595                     lc1.set\_color(cmap1) 
02596                     lc2 = LineCollection(segments, linewidths=3.5)
02597                     lc2.set\_color(cmap2) 
02598                     ax.add\_collection(lc1) 
02599                     ax.add\_collection(lc2) 
02600                     \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[j - 1, i - 1] > 1e4:
02601                         to\_print = \textcolor{stringliteral}{'\{0:.1f\}m'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[j - 1, i - 1] / 1e4) + \textcolor{stringliteral}{' '}
02602                     \textcolor{keywordflow}{else}:
02603                         to\_print = \textcolor{stringliteral}{'\{0:.1f\}A'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a044e1349bb63766a5f3d25fbf04b5c2c}{wave\_Ang}[j - 1, i - 1]) + \textcolor{stringliteral}{' '}
02604                     ax.text(x + 0.05 * delta\_x, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(j, unit=unit)-blow/2., to\_print, 
      size=\textcolor{stringliteral}{'small'}, rotation=90, verticalalignment=\textcolor{stringliteral}{'top'})
02605                     x = x + delta\_x
02606 
02607         \textcolor{comment}{# issue warning on plot if level inversion }
02608         \textcolor{keywordflow}{try}:
02609             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} warn\_label:
02610                 ax.text(0, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a9940acb2999e864edf9761d822e65d7f}{getEnergy}(multiplets[i][0]+1, unit=unit), \textcolor{stringliteral}{'Warning '}, ha=\textcolor{stringliteral}{'right'}, 
      color=\textcolor{stringliteral}{'red'})
02611         \textcolor{keywordflow}{except}:
02612             \textcolor{keywordflow}{pass}
02613 
02614     
\hypertarget{pynebcore_8py_source_l02615}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae99ada552ec3065d60877f8c3aa6c6f2}{02615}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae99ada552ec3065d60877f8c3aa6c6f2}{\_\_repr\_\_}(self):
02616         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Atom \{0\}\{1\} from \{2\} and \{3\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_ae722bd0e35e1c8cdc0018d56c34171cf}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a02c0f7146a2f5b8eac765a453c763797}{spec}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a0d74c41b1e0ac1a9cd5591467769d07f}{atomFile}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom_a356995bd5cadff6ea70cacb74f5c49e1}{collFile})
02617 
02618 
\hypertarget{pynebcore_8py_source_l02619}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{02619} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{RecAtom}(object):
02620     
\hypertarget{pynebcore_8py_source_l02621}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abf13c53bf46bd7330bebd9397b4f8774}{02621}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abf13c53bf46bd7330bebd9397b4f8774}{\_\_init\_\_}(self, elem, spec, atom=None):
02622         \textcolor{stringliteral}{"""}
02623 \textcolor{stringliteral}{        RecAtom class. Used to manage recombination data and compute emissivities.}
02624 \textcolor{stringliteral}{        }
02625 \textcolor{stringliteral}{        Usage:}
02626 \textcolor{stringliteral}{            H1 = pn.RecAtom('H', 1)}
02627 \textcolor{stringliteral}{        }
02628 \textcolor{stringliteral}{        Parameters:}
02629 \textcolor{stringliteral}{            - elem          symbol of the selected element}
02630 \textcolor{stringliteral}{            - spec          ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
02631 \textcolor{stringliteral}{         }
02632 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l02633}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad901cd583cbb6a4008bc41013e16d82f}{02633}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad901cd583cbb6a4008bc41013e16d82f}{log\_} = log\_
02634         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l02635}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{02635}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} = str.capitalize(atom)
\hypertarget{pynebcore_8py_source_l02636}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{02636}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem} = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom})[0]
\hypertarget{pynebcore_8py_source_l02637}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{02637}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec} = int(\hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom})[1])
02638         \textcolor{keywordflow}{else}:
02639             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem} = str.capitalize(elem)
02640             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec} = int(spec)
02641             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec})
\hypertarget{pynebcore_8py_source_l02642}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abde95b732830df56b3d7713313f83060}{02642}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abde95b732830df56b3d7713313f83060}{name} = sym2name[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}]
\hypertarget{pynebcore_8py_source_l02643}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{02643}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling} = \textcolor{stringliteral}{'Atom '} + self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}
02644         self.log\_.message(\textcolor{stringliteral}{'Making rec-atom object for \{0\} \{1:d\}'}.format(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02645         
\hypertarget{pynebcore_8py_source_l02646}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{02646}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'rec'})
02647         file\_type = self.recFitsFile.split(\textcolor{stringliteral}{'.'})[-1]
02648         \textcolor{keywordflow}{if} file\_type == \textcolor{stringliteral}{'fits'}:
02649             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1403c9bfa72c8c9e0369cb9e06703f70}{\_loadFit}()
02650         \textcolor{keywordflow}{elif} file\_type == \textcolor{stringliteral}{'hdf5'}:
02651             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a71029d3d5f2a3df53427419fb11f1626}{\_loadHDF5}()
02652         
02653         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'trc'} \textcolor{keywordflow}{in} atomicData.getDataFile()[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}].keys():
02654             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a25210efd7f504d58269a52ca14b4c0fc}{\_loadTotRecombination}()
02655         
\hypertarget{pynebcore_8py_source_l02656}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad8b22dbde0d9861d94cf7aeacf0d93be}{02656}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad8b22dbde0d9861d94cf7aeacf0d93be}{E\_in\_vacuum} = \textcolor{keyword}{True}
\hypertarget{pynebcore_8py_source_l02657}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{02657}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST} = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom})
\hypertarget{pynebcore_8py_source_l02658}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{02658}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments} = \{\}
02659         web = \textcolor{stringliteral}{'Ref. \{0\} of NIST 2014 (try this:
       http://physics.nist.gov/cgi-bin/ASBib1/get\_ASBib\_ref.cgi?db=el&db\_id=\{0\}&comment\_code=&element=\{1\}&spectr\_charge=\{2\}&'}
02660         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST} \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l02661}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{02661}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels} = len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST})
\hypertarget{pynebcore_8py_source_l02662}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{02662}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST}[\textcolor{stringliteral}{'energy'}] / 1e8
02663             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments}[\textcolor{stringliteral}{'VACUUM'}] = \textcolor{stringliteral}{'1'}
02664             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments}[\textcolor{stringliteral}{'NOTE'}] = \textcolor{stringliteral}{'Energy levels'}
02665             source = \textcolor{stringliteral}{'\(\backslash\)n    '}
02666             \textcolor{keywordflow}{for} ref \textcolor{keywordflow}{in} np.unique(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afe5a91d97ffefced34fb2f2c271736ec}{NIST}[\textcolor{stringliteral}{'ref'}]):
02667                 source = source + web.format(ref[1:], self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec}) + \textcolor{stringliteral}{')\(\backslash\)n  + '} 
02668             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ada8efc5b9724d1c0e76bd7c63508803e}{comments}[\textcolor{stringliteral}{'SOURCE'}] = source[0:-5]
02669         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0ba65ab1a02525bf8ae4c6e0e795db1a}{initWaves}()
02670 
02671 
\hypertarget{pynebcore_8py_source_l02672}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a573ceb5efc64c479d5b1fe73373bc033}{02672}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a573ceb5efc64c479d5b1fe73373bc033}{\_test\_lev}(self, level):
02673         \textcolor{stringliteral}{"""}
02674 \textcolor{stringliteral}{        Test whether selected level is legal}
02675 \textcolor{stringliteral}{}
02676 \textcolor{stringliteral}{        Parameters:}
02677 \textcolor{stringliteral}{            - level        selected atom level}
02678 \textcolor{stringliteral}{}
02679 \textcolor{stringliteral}{        """}       
02680         \textcolor{keywordflow}{if} level < -1 \textcolor{keywordflow}{or} level == 0 \textcolor{keywordflow}{or} level > self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}:
02681             self.log\_.error(\textcolor{stringliteral}{'Wrong value for level: \{0\}, maximum = \{1\}'}.format(level, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}),
02682                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02683 
\hypertarget{pynebcore_8py_source_l02684}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0ba65ab1a02525bf8ae4c6e0e795db1a}{02684}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0ba65ab1a02525bf8ae4c6e0e795db1a}{initWaves}(self):
02685         \textcolor{stringliteral}{"""}
02686 \textcolor{stringliteral}{        Initialization of wave\_Ang}
02687 \textcolor{stringliteral}{        }
02688 \textcolor{stringliteral}{        """}
\hypertarget{pynebcore_8py_source_l02689}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{02689}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang} = np.zeros((self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}))
02690         
02691         \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(1, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a37c93c0fbaad583a1019f5930bc51999}{NLevels}):
02692             \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} range(i):
02693                 wave = 1. / abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy}[i] - self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy}[j])
02694                 \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad8b22dbde0d9861d94cf7aeacf0d93be}{E\_in\_vacuum}:
02695                     wave = \hyperlink{namespacepyneb_1_1utils_1_1physics_ae7f2ba7fc89983bb4d9fa50eb37f4b36}{vactoair}(wave)
02696                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[i, j] = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[j, i] = wave
02697 
02698 
\hypertarget{pynebcore_8py_source_l02699}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a4c99566f33409cee77076ca8735568f0}{02699}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a4c99566f33409cee77076ca8735568f0}{getWave}(self, lev\_i=None, lev\_j=None):
02700         \textcolor{stringliteral}{"""}
02701 \textcolor{stringliteral}{        Return the wavelength of a transition given the levels}
02702 \textcolor{stringliteral}{        }
02703 \textcolor{stringliteral}{        Usage:}
02704 \textcolor{stringliteral}{            He2.getWave(4, 3) }
02705 \textcolor{stringliteral}{            }
02706 \textcolor{stringliteral}{        Parameters:}
02707 \textcolor{stringliteral}{            - lev\_i, lev\_j: upper and lower levels of the transition}
02708 \textcolor{stringliteral}{                }
02709 \textcolor{stringliteral}{        """} 
02710         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a573ceb5efc64c479d5b1fe73373bc033}{\_test\_lev}(lev\_i)
02711         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a573ceb5efc64c479d5b1fe73373bc033}{\_test\_lev}(lev\_j)
02712         return(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[lev\_i-1, lev\_j-1])
02713         
\hypertarget{pynebcore_8py_source_l02714}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a71029d3d5f2a3df53427419fb11f1626}{02714}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a71029d3d5f2a3df53427419fb11f1626}{\_loadHDF5}(self):
02715         \textcolor{stringliteral}{"""}
02716 \textcolor{stringliteral}{        Method to read the atomic data hdf5 file and store the data}
02717 \textcolor{stringliteral}{        Called by \_\_init\_\_}
02718 \textcolor{stringliteral}{        """}
02719         
02720         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} config.INSTALLED[\textcolor{stringliteral}{'h5py'}]:
02721             log\_.error(\textcolor{stringliteral}{'You need to install h5py'}, calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02722         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'rec'})
02723         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02724             log\_.error(\textcolor{stringliteral}{'No hdf5 data for atom: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02725             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
\hypertarget{pynebcore_8py_source_l02726}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{02726}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath} = atomicData.getDataFullPath(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'rec'})
02727         \textcolor{keywordflow}{try}:
02728             hf5 = h5py.File(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath}, \textcolor{stringliteral}{'}\textcolor{stringliteral}{r')}
02729 \textcolor{stringliteral}{        }\textcolor{keywordflow}{except}:
02730             log\_.error(\textcolor{stringliteral}{'\{0\} recombination file not read'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
\hypertarget{pynebcore_8py_source_l02731}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{02731}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData} = hf5[\textcolor{stringliteral}{'updated\_data'}].value
02732         hf5.close()
02733         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} \textcolor{keywordflow}{in} config.DataFiles:
02734             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}]:
02735                 config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile})
02736         \textcolor{keywordflow}{else}:
02737             config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}]
02738         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l02739}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{02739}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{temp} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[\textcolor{stringliteral}{'TEMP'}]
02740         \textcolor{keywordflow}{except}:
02741             log\_.error(\textcolor{stringliteral}{'No TEMP field in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}))
02742         \textcolor{keywordflow}{try}:
\hypertarget{pynebcore_8py_source_l02743}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{02743}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{log\_dens} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[\textcolor{stringliteral}{'DENS'}]
02744         \textcolor{keywordflow}{except}:
02745             log\_.error(\textcolor{stringliteral}{'No DENS field in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}))
\hypertarget{pynebcore_8py_source_l02746}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{02746}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels} = self.\_RecombData.dtype.names
02747         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels} = tuple([l \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels} \textcolor{keywordflow}{if} l \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} (\textcolor{stringliteral}{'TEMP'}, \textcolor{stringliteral}{'DENS'})])
02748         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'\_'} \textcolor{keywordflow}{in} self.\_RecombData.dtype.names[0]:
\hypertarget{pynebcore_8py_source_l02749}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{02749}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} = \textcolor{stringliteral}{'transitions'}
02750         \textcolor{keywordflow}{else}:
02751             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} = \textcolor{stringliteral}{'wavelengths'}
02752         log\_.message(\textcolor{stringliteral}{'\{0\} recombination data read from \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02753        
\hypertarget{pynebcore_8py_source_l02754}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1403c9bfa72c8c9e0369cb9e06703f70}{02754}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1403c9bfa72c8c9e0369cb9e06703f70}{\_loadFit}(self):
02755         \textcolor{stringliteral}{"""}
02756 \textcolor{stringliteral}{        Method to read the atomic data fits file and store the data}
02757 \textcolor{stringliteral}{        Called by \_\_init\_\_}
02758 \textcolor{stringliteral}{}
02759 \textcolor{stringliteral}{        """}
02760         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} = atomicData.getDataFile(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'rec'})
02761         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
02762             log\_.error(\textcolor{stringliteral}{'No fits data for atom: \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02763             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02764         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath} = atomicData.getDataFullPath(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'rec'})
02765         \textcolor{keywordflow}{try}:
02766             hdu = pyfits.open(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath})
02767         \textcolor{keywordflow}{except}:
02768             log\_.error(\textcolor{stringliteral}{'\{0\} recombination file not read'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02769         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData} = hdu[1].data
02770         hdu.close()
02771         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} \textcolor{keywordflow}{in} config.DataFiles:
02772             \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}]:
02773                 config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}].append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile})
02774         \textcolor{keywordflow}{else}:
02775             config.DataFiles[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}] = [self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}]
02776         \textcolor{keywordflow}{try}:
02777             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{temp} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[\textcolor{stringliteral}{'TEMP'}]
02778         \textcolor{keywordflow}{except}:
02779             log\_.error(\textcolor{stringliteral}{'No TEMP field in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}))
02780         \textcolor{keywordflow}{try}:
02781             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{log\_dens} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[\textcolor{stringliteral}{'DENS'}]
02782         \textcolor{keywordflow}{except}:
02783             log\_.error(\textcolor{stringliteral}{'No DENS field in \{0\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}))
02784         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels} = self.\_RecombData.names
02785         del self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels}[self.labels.index(\textcolor{stringliteral}{'TEMP'})]
02786         del self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels}[self.labels.index(\textcolor{stringliteral}{'DENS'})]
02787         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'\_'} \textcolor{keywordflow}{in} self.\_RecombData.names[0]:
02788             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} = \textcolor{stringliteral}{'transitions'}
02789         \textcolor{keywordflow}{else}:
02790             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} = \textcolor{stringliteral}{'wavelengths'}
02791         log\_.message(\textcolor{stringliteral}{'\{0\} recombination data read from \{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02792 
02793 
\hypertarget{pynebcore_8py_source_l02794}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a25210efd7f504d58269a52ca14b4c0fc}{02794}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a25210efd7f504d58269a52ca14b4c0fc}{\_loadTotRecombination}(self):
02795         \textcolor{stringliteral}{"""}
02796 \textcolor{stringliteral}{        Load the total recombination coefficient table. The case (A or B) is set by selecting the
       corresponding trc file.}
02797 \textcolor{stringliteral}{            }
02798 \textcolor{stringliteral}{        Parameters:}
02799 \textcolor{stringliteral}{            None}
02800 \textcolor{stringliteral}{                }
02801 \textcolor{stringliteral}{        """} 
\hypertarget{pynebcore_8py_source_l02802}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a3654e24299df680fe969486399e27880}{02802}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a3654e24299df680fe969486399e27880}{TotRecFile} = atomicData.getDataFullPath(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, \textcolor{stringliteral}{'trc'})
02803         f = open(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a3654e24299df680fe969486399e27880}{TotRecFile})
02804         data = f.readlines()
02805         f.close()
02806         den\_points = [np.float(d) \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data[0].split()]
02807         tem\_points = [np.float(d) \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data[1].split()]
\hypertarget{pynebcore_8py_source_l02808}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad253222149ed56462daddaa2b9287cbb}{02808}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad253222149ed56462daddaa2b9287cbb}{alpha\_grid} = np.array([d.split() \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} d[0:3]!=\textcolor{stringliteral}{'***'}][2::], dtype=\textcolor{stringliteral}{'float'}
      )
\hypertarget{pynebcore_8py_source_l02809}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a6c6ed37093cbb2b2cf5a48df56357879}{02809}         self.lg\_den\_grid, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a6c6ed37093cbb2b2cf5a48df56357879}{lg\_tem\_grid} = np.meshgrid(np.log10(den\_points), np.log10(
      tem\_points))
02810 
02811         
\hypertarget{pynebcore_8py_source_l02812}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{02812}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{\_Transition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
02813         \textcolor{stringliteral}{"""}
02814 \textcolor{stringliteral}{        Return an array with computed upper level, computed lower level, computed wavelength, }
02815 \textcolor{stringliteral}{            input wavelength}
02816 \textcolor{stringliteral}{        }
02817 \textcolor{stringliteral}{        Parameters:}
02818 \textcolor{stringliteral}{            - wave       wavelength either in Angstrom (a float or a label: e.g., 5007, '5007A') }
02819 \textcolor{stringliteral}{                            or in micron (a label: '51.5m')}
02820 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
02821 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
02822 \textcolor{stringliteral}{                            }
02823 \textcolor{stringliteral}{        """}
02824         \textcolor{keywordflow}{if} str(wave)[-1] == \textcolor{stringliteral}{'A'}:
02825             inputWave = float(wave[:-1])
02826             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, wave)
02827             maxError = maxErrorA
02828         \textcolor{keywordflow}{elif} str(wave)[-1] == \textcolor{stringliteral}{'m'}:
02829             inputWave = float(wave[:-1]) * 1e4
02830             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, wave)
02831             maxError = maxErrorm
02832         \textcolor{keywordflow}{else}:
02833             inputWave = wave
02834             label = \textcolor{stringliteral}{'\{0\}\_\{1\}A'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}, int(wave))
02835             maxError = maxErrorA
02836             
02837         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{in} label2levelDict:
02838             result = [label2levelDict[label][0], label2levelDict[label][1], inputWave, inputWave]
02839             return(result)
02840         
02841         j, i = np.unravel\_index(np.argmin(abs(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang} - inputWave)), self.wave\_Ang.shape)
02842         bestWave = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aa2fd61021ea3067af77e7ee0053ace11}{wave\_Ang}[i, j]
02843         error = np.abs(bestWave - inputWave) / inputWave
02844         result = [i + 1, j + 1, bestWave, inputWave]
02845         \textcolor{keywordflow}{if} error > maxError:
02846             self.log\_.warn(\textcolor{stringliteral}{'\_Transition: wavelengths differ by more than \{0:.2f\}%: input = \{1:.2f\}, output
       = \{2:.2f\}'}\(\backslash\)
02847                            .format(100 * maxError, inputWave, bestWave), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02848         return(result)
02849 
02850 
\hypertarget{pynebcore_8py_source_l02851}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ab7e0b11cdc85dade76528fe5de9886c0}{02851}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ab7e0b11cdc85dade76528fe5de9886c0}{getTotRecombination}(self, tem, den, method='linear'):
02852         \textcolor{stringliteral}{"""}
02853 \textcolor{stringliteral}{        Return the total recombination coefficient. The case (A or B) is set by selecting the corresponding
       trc file.}
02854 \textcolor{stringliteral}{        }
02855 \textcolor{stringliteral}{        Usage:}
02856 \textcolor{stringliteral}{            atomicData.setDataFile('h\_i\_trc\_SH95-caseA.dat')}
02857 \textcolor{stringliteral}{            h1.getTotRecombination(tem=10000, den=5.e3)}
02858 \textcolor{stringliteral}{            }
02859 \textcolor{stringliteral}{        Parameters:}
02860 \textcolor{stringliteral}{            - tem, den  temperature and density}
02861 \textcolor{stringliteral}{            - method    interpolation method in the grid ('linear' = default, 'nearest', 'cubic')    }
02862 \textcolor{stringliteral}{                }
02863 \textcolor{stringliteral}{        """} 
02864         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling} = \textcolor{stringliteral}{'getTotRecombination'}
02865         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'trc'} \textcolor{keywordflow}{in} atomicData.getDataFile()[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}].keys():
02866             \textcolor{keywordflow}{return} interpolate.griddata((self.lg\_den\_grid.ravel(), self.lg\_tem\_grid.ravel()), 
      self.alpha\_grid.ravel(), (np.log10(den), np.log10(tem)), method=method)
02867         \textcolor{keywordflow}{else}:
02868             self.log\_.warn(\textcolor{stringliteral}{'No recombination data available for \{0\} in the adopted dictionary (but data may
       exist: please query atomicData.getAllAvailableFiles("<atom>") for trc files)'}.format(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02869             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02870         
02871         
\hypertarget{pynebcore_8py_source_l02872}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abc77497db8e5d888d8424e4a82d50c2e}{02872}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abc77497db8e5d888d8424e4a82d50c2e}{getTransition}(self, wave, maxErrorA = 5.e-3, maxErrorm = 5.e-2):
02873         \textcolor{stringliteral}{"""}
02874 \textcolor{stringliteral}{        Return the indexes (upper level, lower level) of a transition for a given atom }
02875 \textcolor{stringliteral}{            from the wavelength.}
02876 \textcolor{stringliteral}{        }
02877 \textcolor{stringliteral}{        Usage:}
02878 \textcolor{stringliteral}{            O3.getTransition(4959)}
02879 \textcolor{stringliteral}{            }
02880 \textcolor{stringliteral}{        Parameters:}
02881 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
02882 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
02883 \textcolor{stringliteral}{            - maxErrorA: tolerance if the input wavelength is in Angstrom}
02884 \textcolor{stringliteral}{            - maxErrorm: tolerance if the input wavelength is in micron}
02885 \textcolor{stringliteral}{                }
02886 \textcolor{stringliteral}{        """} 
02887         res = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{\_Transition}(wave, maxErrorA = maxErrorA, maxErrorm = maxErrorm)
02888         return(res[0], res[1])
02889         
02890         
\hypertarget{pynebcore_8py_source_l02891}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aea8927d7a4c6e507ad7239760e5b41c8}{02891}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_aea8927d7a4c6e507ad7239760e5b41c8}{printTransition}(self, wave):
02892         \textcolor{stringliteral}{"""}
02893 \textcolor{stringliteral}{        Print info on transition associated to input wavelength.}
02894 \textcolor{stringliteral}{        }
02895 \textcolor{stringliteral}{        Usage:}
02896 \textcolor{stringliteral}{            O3.printTransition(4959)}
02897 \textcolor{stringliteral}{            }
02898 \textcolor{stringliteral}{        Parameters:}
02899 \textcolor{stringliteral}{            - wave      wavelength in Angstrom (a float or a label: e.g., 5007, '5007A') }
02900 \textcolor{stringliteral}{                or in micron (a label: '51.5m')}
02901 \textcolor{stringliteral}{                }
02902 \textcolor{stringliteral}{        """}
02903         closestTransition = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a32b31a371f3b6ecc5bbbc4d0c5d2a855}{\_Transition}(wave)
02904         relativeError = closestTransition[3] / closestTransition[2] - 1
02905         print(\textcolor{stringliteral}{'Input wave: \{0:.1F\}'}.format(closestTransition[3]))
02906         print(\textcolor{stringliteral}{'Closest wave found: \{0:.1F\}'}.format(closestTransition[2]))
02907         print(\textcolor{stringliteral}{'Relative error: \{0:.0E\} '}.format(relativeError))
02908         print(\textcolor{stringliteral}{'Transition: \{0[0]\} -> \{0[1]\}'}.format(closestTransition))
02909         \textcolor{keywordflow}{return}
02910     
02911               
\hypertarget{pynebcore_8py_source_l02912}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ae8f411260ec12f4469c43d327750801a}{02912}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ae8f411260ec12f4469c43d327750801a}{printSources}(self):
02913         \textcolor{stringliteral}{"""}
02914 \textcolor{stringliteral}{        Print bibliographic sources for atomic data, as listed in the headers of the fits files.}
02915 \textcolor{stringliteral}{        }
02916 \textcolor{stringliteral}{        """}       
02917         header = pyfits.open(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_af74fe68ebe037be119ac2f136485782b}{recFitsFullPath}, ignore\_missing\_end=\textcolor{keyword}{True})[1].header
02918         \textcolor{keywordflow}{for} record \textcolor{keywordflow}{in} header.items():
02919             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} record[0]:
02920                 number = record[0].lstrip(\textcolor{stringliteral}{'SOURCE'})
02921                 \textcolor{keywordflow}{try}:
02922                     print(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} + \textcolor{stringliteral}{': '} + header.get(\textcolor{stringliteral}{'NOTE'} + str(number)) + \textcolor{stringliteral}{':'}, header.get(\textcolor{stringliteral}{'SOURCE
      '} + str(number)))
02923                 \textcolor{keywordflow}{except}:
02924                     print(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1a2aa175da6b5b8847f409e37437e3d3}{atom} + \textcolor{stringliteral}{': '} + \textcolor{stringliteral}{'Atomic data:'}, header.get(\textcolor{stringliteral}{'SOURCE'} + str(number)))
02925 
02926 
\hypertarget{pynebcore_8py_source_l02927}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a664340029b0a067b459cae45e13d50c5}{02927}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a664340029b0a067b459cae45e13d50c5}{getEnergy}(self, level= -1, unit='1/Ang'):
02928         \textcolor{stringliteral}{"""}
02929 \textcolor{stringliteral}{        Return energy level of selected level (or array of energy levels, if level not given) }
02930 \textcolor{stringliteral}{            in Angstrom^-1 (default) or another unit}
02931 \textcolor{stringliteral}{        }
02932 \textcolor{stringliteral}{        Usage:}
02933 \textcolor{stringliteral}{            O3.getEnergy(4, unit='eV')}
02934 \textcolor{stringliteral}{        Parameters:}
02935 \textcolor{stringliteral}{            - level  selected atomic level (default= -1, returns complete array)}
02936 \textcolor{stringliteral}{            - unit   [str] one of '1/Ang' (default), 'eV', or 'Ryd'    }
02937 \textcolor{stringliteral}{            }
02938 \textcolor{stringliteral}{        """}
02939         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a573ceb5efc64c479d5b1fe73373bc033}{\_test\_lev}(level)
02940 
02941         unit\_dict = \{\textcolor{stringliteral}{'1/Ang'}: 1.,
02942                      \textcolor{stringliteral}{'Ryd'}: CST.RYD\_ANG,
02943                      \textcolor{stringliteral}{'eV'}: CST.RYD\_ANG * CST.RYD\_EV,
02944                      \textcolor{stringliteral}{'cm-1'}: 1e8\}
02945         \textcolor{keywordflow}{if} unit \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} unit\_dict:
02946             self.log\_.warn(\textcolor{stringliteral}{'Unit \{0\} unknown, using 1/Ang'}.format(unit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling} + \textcolor{stringliteral}{'.getEnergy'})
02947             unit = \textcolor{stringliteral}{'1/Ang'}        
02948         
02949         \textcolor{keywordflow}{if} level == -1:
02950             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy} * unit\_dict[unit]
02951         \textcolor{keywordflow}{else}:
02952             \textcolor{keywordflow}{return} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a652daa9311973780fd44f61e09bc650f}{\_Energy}[level-1] * unit\_dict[unit]
02953 
02954     
\hypertarget{pynebcore_8py_source_l02955}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ae43d7773b11884138df2cf89cd483708}{02955}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ae43d7773b11884138df2cf89cd483708}{\_checkLabel}(self, label):
02956         \textcolor{stringliteral}{"""}
02957 \textcolor{stringliteral}{        Return True if the label is compatible with the type of labels read form the data file}
02958 \textcolor{stringliteral}{        'transitions' labels are of the form "J\_I"}
02959 \textcolor{stringliteral}{        'wavelengths' labels are of the form "1234.5" (dot is mandatory)}
02960 \textcolor{stringliteral}{}
02961 \textcolor{stringliteral}{        """}
02962         \textcolor{keywordflow}{if} (\textcolor{stringliteral}{'\_'} \textcolor{keywordflow}{in} label) \textcolor{keywordflow}{and} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} == \textcolor{stringliteral}{'transitions'}):
02963             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
02964         \textcolor{keywordflow}{elif} (\textcolor{stringliteral}{'.'} \textcolor{keywordflow}{in} label) \textcolor{keywordflow}{and} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a054cc66819a590792e6a2478136e2143}{label\_type} == \textcolor{stringliteral}{'wavelengths'}):
02965             \textcolor{keywordflow}{return} \textcolor{keyword}{True}
02966         \textcolor{keywordflow}{else}:
02967             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
02968    
02969             
\hypertarget{pynebcore_8py_source_l02970}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afecb53ee6cdd96699b3b9250fbcc957e}{02970}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afecb53ee6cdd96699b3b9250fbcc957e}{\_getLabelStr}(self, label, warn=True):
02971         \textcolor{stringliteral}{"""}
02972 \textcolor{stringliteral}{        Returns a string containing the label. }
02973 \textcolor{stringliteral}{        If label is a float, it is transormed into a string .}
02974 \textcolor{stringliteral}{        If label is not in the self.labels list, None is returned}
02975 \textcolor{stringliteral}{}
02976 \textcolor{stringliteral}{        """}
02977         \textcolor{keywordflow}{if} np.isreal(label):
02978             label\_str = \textcolor{stringliteral}{'\{0:.1f\}'}.format(label)
02979         \textcolor{keywordflow}{else}:
02980             label\_str = str(label)
02981         \textcolor{keywordflow}{if} label\_str \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a0a758f4eb5a1b0780542eda87dcaeed3}{labels}:
02982             \textcolor{keywordflow}{if} warn:
02983                 log\_.warn(\textcolor{stringliteral}{'Label \{0\} not in \{1\}.'}.format(label\_str, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
02984             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
02985         \textcolor{keywordflow}{else}:
02986             \textcolor{keywordflow}{return} label\_str
02987         
02988         
02989     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(self, tem, den, lev\_i=None, lev\_j=None, wave=None, label=None,
\hypertarget{pynebcore_8py_source_l02990}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{02990}                       method=\textcolor{stringliteral}{'linear'}, product=\textcolor{keyword}{True}):
02991         \textcolor{stringliteral}{"""}
02992 \textcolor{stringliteral}{        Return the emissivity of a recombination line. The arguments used to }
02993 \textcolor{stringliteral}{        define the line depend on whether the atom is an hydrogenoid or not. }
02994 \textcolor{stringliteral}{        In the first case, the transition can be specified either as a pair }
02995 \textcolor{stringliteral}{        of levels lev\_i, lev\_j or as a label. }
02996 \textcolor{stringliteral}{        In the second case, the transition can be specified either as a wavelength }
02997 \textcolor{stringliteral}{        or as a label.}
02998 \textcolor{stringliteral}{        In either case, enter <atom>.labels to display the valid labels.}
02999 \textcolor{stringliteral}{        }
03000 \textcolor{stringliteral}{        Usage:}
03001 \textcolor{stringliteral}{            H1 = pn.RecAtom('H', 1)}
03002 \textcolor{stringliteral}{            H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], lev\_i = 4, lev\_j = 2)}
03003 \textcolor{stringliteral}{            H1.getEmissivity([1e4, 1.2e4], [1e3, 1e2], label='4\_2', product=False)}
03004 \textcolor{stringliteral}{            tem = np.linspace(5000, 20000, 100)}
03005 \textcolor{stringliteral}{            den = np.logspace(2, 6, 100)}
03006 \textcolor{stringliteral}{            imHab = H1.getEmissivity(tem, den, label='3\_2') / H1.getEmissivity(tem, den, label='4\_2')}
03007 \textcolor{stringliteral}{}
03008 \textcolor{stringliteral}{            He1 = pn.RecAtom('He', 1)}
03009 \textcolor{stringliteral}{            He1.getEmissivity(1e4, 1e2, wave=4471.0)}
03010 \textcolor{stringliteral}{            He1.getEmissivity(1e4, 1e2, label='4471.0')}
03011 \textcolor{stringliteral}{            }
03012 \textcolor{stringliteral}{        Parameters:}
03013 \textcolor{stringliteral}{            - tem            temperature (K)}
03014 \textcolor{stringliteral}{            - den            density (cm-3)}
03015 \textcolor{stringliteral}{            - lev\_i, lev\_j   levels of the transition}
03016 \textcolor{stringliteral}{            - wave           wavelength of the transition}
03017 \textcolor{stringliteral}{            - label          label of the transition (e.g. "50\_3", "1234.5")}
03018 \textcolor{stringliteral}{            - method         interpolation method ('linear', 'nearest', 'cubic'), }
03019 \textcolor{stringliteral}{                             sent to scipy.interpolate.griddata    }
03020 \textcolor{stringliteral}{            - product        Boolean. If True (default), all the combination of (tem, den) are used. }
03021 \textcolor{stringliteral}{                             If False, tem and den must have the same size and are joined.}
03022 \textcolor{stringliteral}{        """}
03023         
03024         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} config.INSTALLED[\textcolor{stringliteral}{'scipy'}]:
03025             log\_.error(\textcolor{stringliteral}{'Scipy not installed, no RecAtom emissivities available'},
03026                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03027             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03028         tem = np.asarray(tem)
03029         den = np.asarray(den)
03030         \textcolor{keywordflow}{if} product:
03031             \textcolor{keywordflow}{if} tem.size == 1 \textcolor{keywordflow}{or} den.size == 1:
03032                 temg = tem
03033                 deng = den
03034             \textcolor{keywordflow}{else}:
03035                 temg, deng = np.meshgrid(tem, den)
03036         \textcolor{keywordflow}{else}:
03037             \textcolor{keywordflow}{if} tem.size != den.size:
03038                 log\_.error(\textcolor{stringliteral}{'tem and den must have the same size'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03039                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03040             \textcolor{keywordflow}{else}:
03041                 temg = tem
03042                 deng = den
03043         \textcolor{keywordflow}{if} (lev\_i \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (lev\_j \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
03044             label = \textcolor{stringliteral}{'\{0\}\_\{1\}'}.format(lev\_i, lev\_j)
03045         \textcolor{keywordflow}{if} wave \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03046             label = \textcolor{stringliteral}{'\{0:.1f\}'}.format(wave)
03047             label\_str = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afecb53ee6cdd96699b3b9250fbcc957e}{\_getLabelStr}(label, warn=\textcolor{keyword}{False})
03048             \textcolor{keywordflow}{if} label\_str \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03049                 ij = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_abc77497db8e5d888d8424e4a82d50c2e}{getTransition}(wave)
03050                 label = \textcolor{stringliteral}{'\{\}\_\{\}'}.format(ij[0], ij[1])
03051         label\_str = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afecb53ee6cdd96699b3b9250fbcc957e}{\_getLabelStr}(label, warn=\textcolor{keyword}{False})
03052         \textcolor{keywordflow}{if} label\_str \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03053             log\_.warn(\textcolor{stringliteral}{'Wrong label \{0\}'}.format(label), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03054             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03055         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ae43d7773b11884138df2cf89cd483708}{\_checkLabel}(label\_str):
03056             log\_.warn(\textcolor{stringliteral}{'Wrong label \{0\}'}.format(label\_str), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03057             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03058         enu = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1f483d9d99af479ef137489ccefe35e9}{\_RecombData}[label\_str]
03059             
03060         logd = np.log10(deng)
03061         temp\_min = np.min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{temp})
03062         temp\_max = np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_afdcfb955b81391dabcb298fe4990e33c}{temp})
03063         log\_dens\_min = np.min(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{log\_dens})
03064         log\_dens\_max = np.max(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac93e76934d279878d4f1f6d961df5488}{log\_dens})
03065         tt = (logd < log\_dens\_min)
03066         \textcolor{keywordflow}{if} np.ndim(logd) == 0: 
03067             \textcolor{keywordflow}{if} tt == \textcolor{keyword}{True}:
03068                 logd = log\_dens\_min
03069         \textcolor{keywordflow}{else}:
03070             logd[tt] = log\_dens\_min
03071         tt = (logd > log\_dens\_max)
03072         \textcolor{keywordflow}{if} np.ndim(logd) == 0:
03073             \textcolor{keywordflow}{if} tt == \textcolor{keyword}{True}:
03074                 logd = log\_dens\_max
03075         \textcolor{keywordflow}{else}:
03076             logd[tt] = log\_dens\_max
03077         res = interpolate.griddata((self.temp.ravel(), self.log\_dens.ravel()), enu.ravel(),
03078                                    (temg, logd), method=method)
03079         \textcolor{keywordflow}{return} res.T
03080 
03081 
03082     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a250ec6b99eedd84bdb8eae97cbd4beef}{getIonAbundance}(self, int\_ratio, tem, den, lev\_i= -1, lev\_j= -1, wave= -1, 
      label=None,
\hypertarget{pynebcore_8py_source_l03083}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a250ec6b99eedd84bdb8eae97cbd4beef}{03083}                         to\_eval=\textcolor{keywordtype}{None}, Hbeta=100.):
03084         \textcolor{stringliteral}{"""}
03085 \textcolor{stringliteral}{        Compute the ionic abundance relative to H+ given the temperature, the density and the }
03086 \textcolor{stringliteral}{            intensity of a line or sum of lines.}
03087 \textcolor{stringliteral}{        The arguments used to define the line depend on whether the atom is an hydrogenoid or not. }
03088 \textcolor{stringliteral}{        For hydrogenoids, the transition can be specified either as a pair of levels }
03089 \textcolor{stringliteral}{            lev\_i, lev\_j, as a label, or as an I-type expression as the argument of to\_eval }
03090 \textcolor{stringliteral}{            (e.g. to\_eval='I(50, 19)' for the 50->19 transition). Wavelengths or L-type expressions }
03091 \textcolor{stringliteral}{            will not work in this case. }
03092 \textcolor{stringliteral}{        For non-hydrogenoids, the transition can be specified either as an integer wavelength, }
03093 \textcolor{stringliteral}{            as a label, or as an A-type expression as the argument of to\_eval (e.g. to\_eval='A(4471)' }
03094 \textcolor{stringliteral}{            for the lambda=4471 transition). Note that all these alternatives imply that the wavelength}
03095 \textcolor{stringliteral}{            is known. Pairs of levels and I or L-type expressions would not work.}
03096 \textcolor{stringliteral}{}
03097 \textcolor{stringliteral}{        The preferred method are the label and the I-type expressions, as the remaining parameters }
03098 \textcolor{stringliteral}{            are inherently fragile.}
03099 \textcolor{stringliteral}{}
03100 \textcolor{stringliteral}{        Usage:}
03101 \textcolor{stringliteral}{            He2.getIonAbundance(130, 1.5e4, 100., lev\_i=5, lev\_j=4)}
03102 \textcolor{stringliteral}{            He2.getIonAbundance(130, 1.5e4, 100., label="5\_4")}
03103 \textcolor{stringliteral}{            He2.getIonAbundance(130, 1.5e4, 100., to\_eval='I(4,3) + I(4,2)')}
03104 \textcolor{stringliteral}{            He1.getIonAbundance(100, 1.5e4, 100., wave=5016)}
03105 \textcolor{stringliteral}{            He1.getIonAbundance(100, 1.5e4, 100., label="5016.0")}
03106 \textcolor{stringliteral}{            He1.getIonAbundance(100, 1.5e4, 100., to\_eval='A(5016)')}
03107 \textcolor{stringliteral}{            He1.getIonAbundance(np.array([100, 150]), np.array([1.5e4, 1.2e4]), np.array([100., 120]), }
03108 \textcolor{stringliteral}{                label="10830.0")}
03109 \textcolor{stringliteral}{            }
03110 \textcolor{stringliteral}{        Parameters:}
03111 \textcolor{stringliteral}{            - int\_ratio    relative line intensity (default normalization: Hbeta = 100). }
03112 \textcolor{stringliteral}{                            May be an array.}
03113 \textcolor{stringliteral}{            - tem          electronic temperature in K. May be an array.}
03114 \textcolor{stringliteral}{            - den          electronic density in cm^-3. May be an array.}
03115 \textcolor{stringliteral}{            - lev\_i        upper level of transition}
03116 \textcolor{stringliteral}{            - lev\_j        lower level of transition}
03117 \textcolor{stringliteral}{            - wave         wavelength of transition. Takes precedence on lev\_i and lev\_j if set, }
03118 \textcolor{stringliteral}{                            ignored otherwise }
03119 \textcolor{stringliteral}{            - to\_eval      expression to be evaluated. Takes precedence on wave if set, }
03120 \textcolor{stringliteral}{                            ignored otherwise.}
03121 \textcolor{stringliteral}{            - Hbeta        line intensity normalization at Hbeta (default Hbeta = 100)}
03122 \textcolor{stringliteral}{}
03123 \textcolor{stringliteral}{        }
03124 \textcolor{stringliteral}{        """}
03125         \textcolor{keywordflow}{if} np.ndim(tem) != np.ndim(den):
03126             self.log\_.error(\textcolor{stringliteral}{'ten and den must have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03127             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03128         \textcolor{keywordflow}{if} ((np.squeeze(np.asarray(int\_ratio)).shape != np.squeeze(np.asarray(tem)).shape) | 
03129             (np.squeeze(np.asarray(den)).shape != np.squeeze(np.asarray(tem)).shape)):
03130             self.log\_.warn(\textcolor{stringliteral}{'int\_ratio, tem and den must does not have the same shape'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03131         \textcolor{keywordflow}{if} (lev\_i == -1) & (lev\_j == -1) & (wave == -1) & (to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}) & (label \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}):
03132             self.log\_.error(\textcolor{stringliteral}{'At least one of lev\_i, lev\_j, or wave, or to\_eval must be supplied'}, calling=
      self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03133             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03134         \textcolor{keywordflow}{if} to\_eval == \textcolor{keywordtype}{None}:
03135             \textcolor{keywordflow}{if} wave != -1:
03136                 to\_eval = \textcolor{stringliteral}{'L(\{0\})'}.format(wave)
03137             \textcolor{keywordflow}{elif} label \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03138                 to\_eval = \textcolor{stringliteral}{'A("\{0\}")'}.format(label)
03139             \textcolor{keywordflow}{else}:
03140                 to\_eval = \textcolor{stringliteral}{'I(\{0\}, \{1\})'}.format(lev\_i, lev\_j)
03141         I = \textcolor{keyword}{lambda} lev\_i, lev\_j: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(tem, den, lev\_i, lev\_j, product=\textcolor{keyword}{False})
03142         L = \textcolor{keyword}{lambda} wave: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(tem, den, wave=wave, product=\textcolor{keyword}{False})
03143         A = \textcolor{keyword}{lambda} label: self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac03957666aff1955387fcc03c6187ad3}{getEmissivity}(tem, den, label=label, product=\textcolor{keyword}{False})
03144         \textcolor{keywordflow}{try}:
03145             emis = eval(to\_eval)
03146         \textcolor{keywordflow}{except}:
03147             self.log\_.error(\textcolor{stringliteral}{'Unable to eval \{0\}'}.format(to\_eval), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a82ec425ebba32b73a5d9ae52717d47c4}{calling})
03148             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03149         \textcolor{comment}{#int\_ratio is in units of Hb = Hbeta keyword}
03150         ionAbundance = ((int\_ratio / Hbeta) * (\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{getRecEmissivity}(tem, den, 4, 2, atom=\textcolor{stringliteral}{'H1'}, 
      product=\textcolor{keyword}{False}) / emis))
03151         \textcolor{keywordflow}{return} ionAbundance
03152     
03153     
\hypertarget{pynebcore_8py_source_l03154}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad2f1efa1d2c3e839a9e7db30319cdb82}{03154}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ad2f1efa1d2c3e839a9e7db30319cdb82}{\_\_repr\_\_}(self):
03155         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Atom \{0\}\{1\} from \{2\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a1325fff2854658752d522c7284df5a8a}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_ac2485287f7694915959ba49b9b82e483}{spec}, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom_a2108a27da329b8599357e990a446faae}{recFitsFile})
03156         
03157 
\hypertarget{pynebcore_8py_source_l03158}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{03158} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_aba9d4a5306330dd47f8a51455514c017}{getRecEmissivity}(tem, den, lev\_i=None, lev\_j=None, atom='H1', method='linear', 
      wave=None, product=True):
03159     \textcolor{stringliteral}{"""}
03160 \textcolor{stringliteral}{    The function instantiates a RecAtom and store it into atomicData.\_RecombData for a further use.}
03161 \textcolor{stringliteral}{    More possibilities are obtained using the RecAtom class.}
03162 \textcolor{stringliteral}{}
03163 \textcolor{stringliteral}{    Usage:}
03164 \textcolor{stringliteral}{        print(getRecEmissivity(1e4, 1e3, 3, 2, atom='H1') / getRecEmissivity(1e4, 1e3, 4, 2, atom='H1')) }
03165 \textcolor{stringliteral}{            # return Ha/Hb }
03166 \textcolor{stringliteral}{}
03167 \textcolor{stringliteral}{    Parameters:}
03168 \textcolor{stringliteral}{        - tem           temperature in K}
03169 \textcolor{stringliteral}{        - den           density in cm-3}
03170 \textcolor{stringliteral}{        - lev\_i, lev\_j  levels (lev\_i>lev\_j, i\_min=1)}
03171 \textcolor{stringliteral}{        - atom          atom (e.g. 'H1', 'He1')}
03172 \textcolor{stringliteral}{        - method        interpolation method ('linear', 'nearest', 'cubic'), sent to
       scipy.interpolate.griddata}
03173 \textcolor{stringliteral}{        - wave          alternative way of identifying emision line.}
03174 \textcolor{stringliteral}{        }
03175 \textcolor{stringliteral}{    """}
03176     calling = \textcolor{stringliteral}{'getRecEmissivity'}
03177     
03178     \textcolor{keywordflow}{if} config.INSTALLED[\textcolor{stringliteral}{'scipy'}]:
03179         elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)
03180     
03181         \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} atomicData.\_RecombData:
03182             atomicData.\_RecombData[atom] = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_rec_atom}{RecAtom}(elem, spec)
03183         \textcolor{keywordflow}{return} atomicData.\_RecombData[atom].getEmissivity(tem=tem, den=den, lev\_i=lev\_i, lev\_j=lev\_j,
03184                                                              method=method, wave=wave, product=product)
03185     \textcolor{keywordflow}{else}:
03186         \textcolor{keywordflow}{if} (atom == \textcolor{stringliteral}{'H1'}) \textcolor{keywordflow}{and} (lev\_i == 4) \textcolor{keywordflow}{and} (lev\_j == 2):
03187             log\_.warn(\textcolor{stringliteral}{'Scipy is missing, \{0\} returning Hbeta'}.format(calling), calling)
03188             \textcolor{keywordflow}{return} \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a027537ead17492a35c3e4e940cd95223}{getHbEmissivity}(tem)
03189         \textcolor{keywordflow}{else}:
03190             log\_.error(\textcolor{stringliteral}{'Only Hbeta emissivity available, as scipy not installed'}, calling)
03191 
03192 
\hypertarget{pynebcore_8py_source_l03193}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a027537ead17492a35c3e4e940cd95223}{03193} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a027537ead17492a35c3e4e940cd95223}{getHbEmissivity}(tem= -1):
03194     \textcolor{stringliteral}{""" }
03195 \textcolor{stringliteral}{    Compute Hbeta emissivity in erg/s/(N(H+)*N(e-)) for a given temperature with the formula }
03196 \textcolor{stringliteral}{        by Aller (1984)}
03197 \textcolor{stringliteral}{}
03198 \textcolor{stringliteral}{    Usage:}
03199 \textcolor{stringliteral}{        getHbemissivity(tem=10000)}
03200 \textcolor{stringliteral}{}
03201 \textcolor{stringliteral}{    Parameters:}
03202 \textcolor{stringliteral}{        - tem     electronic temperature in K}
03203 \textcolor{stringliteral}{}
03204 \textcolor{stringliteral}{    """} 
03205     tem4 = np.asarray(tem) * 1.0e-4
03206     j\_hb = 1.387 / pow(tem4, 0.983) / pow(10., 0.0424 / tem4) * 1.e-25
03207 
03208     \textcolor{comment}{# Remove jhb for tem4 < 0 or tem4 > 1e2}
03209     ((tem4 < 0.) | (tem4 > 1e2)).choose(j\_hb, -1)
03210 
03211     \textcolor{keywordflow}{return} j\_hb
03212 
03213 
\hypertarget{pynebcore_8py_source_l03214}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a827f434ffd7a142d4ee91740b0174c1a}{03214} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a827f434ffd7a142d4ee91740b0174c1a}{getAtomDict}(atom\_list=None, elem\_list=None, spec\_list=None, **kwargs):
03215     \textcolor{stringliteral}{""" }
03216 \textcolor{stringliteral}{    Initializes all atoms, according to the atomic files available.}
03217 \textcolor{stringliteral}{    The elem objects are given conventional names elem+spec (e.g., O III is O3)}
03218 \textcolor{stringliteral}{}
03219 \textcolor{stringliteral}{    Usage:}
03220 \textcolor{stringliteral}{        all = pn.getAtomDict()}
03221 \textcolor{stringliteral}{        print(all['S2'].name)}
03222 \textcolor{stringliteral}{        some = pn.getAtomDict(elem\_list=['C', 'N', 'O'])}
03223 \textcolor{stringliteral}{        some = pn.getAtomDict(atom\_list=['O2', 'O3', 'Ar3'])}
03224 \textcolor{stringliteral}{    }
03225 \textcolor{stringliteral}{    Parameters:}
03226 \textcolor{stringliteral}{        - atom\_list     a list of the ions for which the elem is to be computed }
03227 \textcolor{stringliteral}{                        Takes precedence on elem\_list and spec\_list}
03228 \textcolor{stringliteral}{        - elem\_list     a list of all the elements for which the elem is to be computed (all by default)}
03229 \textcolor{stringliteral}{        - spec\_list     a list of the spectra for which the elem is to be computed (all by default)}
03230 \textcolor{stringliteral}{        \_ **kwargs      argumentas passed to Atom, e.g. OmegaInterp}
03231 \textcolor{stringliteral}{}
03232 \textcolor{stringliteral}{    """} 
03233     all\_atoms = \{\}
03234 
03235     \textcolor{keywordflow}{if} atom\_list \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:       
03236         \textcolor{keywordflow}{if} spec\_list \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03237             spec\_list = SPEC\_LIST
03238         \textcolor{keywordflow}{if} elem\_list \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03239             atom\_list = atomicData.getAllAtoms()
03240         \textcolor{keywordflow}{else}:
03241             atom\_list = []
03242             \textcolor{keywordflow}{for} elem \textcolor{keywordflow}{in} elem\_list:
03243                 \textcolor{keywordflow}{for} spec \textcolor{keywordflow}{in} spec\_list:
03244                     atom\_list.append(elem + str(spec)) 
03245 
03246     \textcolor{keywordflow}{for} atom \textcolor{keywordflow}{in} atom\_list:
03247         elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(atom)        
03248         \textcolor{keywordflow}{try}:
03249             all\_atoms[atom] = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_atom}{Atom}(elem, spec, **kwargs)
03250             log\_.message(\textcolor{stringliteral}{'Including '} + atom, calling=\textcolor{stringliteral}{'getAtomDict'})
03251         \textcolor{keywordflow}{except}:
03252             log\_.message(atom + \textcolor{stringliteral}{' not found'}, calling=\textcolor{stringliteral}{'getAtomDict'})
03253     \textcolor{keywordflow}{return} all\_atoms
03254 
03255 
\hypertarget{pynebcore_8py_source_l03256}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{03256} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{getLineLabel}(elem, spec, wave, blend=False):
03257     \textcolor{stringliteral}{"""}
03258 \textcolor{stringliteral}{    Build a line label in the standard PyNeb format. Return atom\_label, wave\_label, and line\_label }
03259 \textcolor{stringliteral}{            (strings representing the atom and wave fragments of the line label and the }
03260 \textcolor{stringliteral}{                complete line label)}
03261 \textcolor{stringliteral}{    }
03262 \textcolor{stringliteral}{    Parameters:}
03263 \textcolor{stringliteral}{        - elem      symbol of the selected element}
03264 \textcolor{stringliteral}{        - spec      ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
03265 \textcolor{stringliteral}{        - wave      wavelength of the line}
03266 \textcolor{stringliteral}{        - blend     blend flag (default = False)}
03267 \textcolor{stringliteral}{}
03268 \textcolor{stringliteral}{    @see parseLineLabel}
03269 \textcolor{stringliteral}{    }
03270 \textcolor{stringliteral}{    """}    
03271     \textcolor{keywordflow}{if} isinstance(wave, str):
03272         wave\_label = wave
03273     \textcolor{keywordflow}{else}:
03274         wave4 = wave / 1.e4
03275         \textcolor{keywordflow}{if} wave < 10000.:
03276             wave\_label = \textcolor{stringliteral}{"\{0:.0f\}A"}.format(wave)
03277         \textcolor{keywordflow}{else}:
03278             wave\_label = \textcolor{stringliteral}{"\{0:.1f\}m"}.format(wave4)
03279     atom\_label = elem + str(spec)
03280     \textcolor{keywordflow}{if} blend:
03281         blend\_flag = \textcolor{stringliteral}{'+'}
03282     \textcolor{keywordflow}{else}:
03283         blend\_flag = \textcolor{stringliteral}{''}
03284     line\_label = atom\_label + \textcolor{stringliteral}{'\_'} + wave\_label + blend\_flag
03285 
03286     \textcolor{keywordflow}{return} atom\_label, wave\_label, line\_label
03287 
03288 
\hypertarget{pynebcore_8py_source_l03289}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a15b88e2a4daeae68052060cb425c7a1c}{03289} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_a15b88e2a4daeae68052060cb425c7a1c}{parseLineLabel}(lineLabel):
03290     \textcolor{stringliteral}{"""}
03291 \textcolor{stringliteral}{    Parse the line label to extract the substrings referring to the atom (elem, spec and atom)}
03292 \textcolor{stringliteral}{    and the numerical value of the wave}
03293 \textcolor{stringliteral}{    }
03294 \textcolor{stringliteral}{    Parameters:}
03295 \textcolor{stringliteral}{        - label    line label in the standard PyNeb format}
03296 \textcolor{stringliteral}{    }
03297 \textcolor{stringliteral}{    Returns:}
03298 \textcolor{stringliteral}{        - elem, spec, atom\_label, wave, wave\_label, blend  strings containing the elem, spec, atom and }
03299 \textcolor{stringliteral}{                                                              wave; numerical value of the wave, }
03300 \textcolor{stringliteral}{                                                              in Angstrom; and blend flag }
03301 \textcolor{stringliteral}{    """}
03302     \textcolor{comment}{##}
03303     \textcolor{comment}{# @todo maybe rearrange the order so 1) it is compatible with getLineLabel, or 2) it lists all the
       strings first }
03304 
03305     \textcolor{comment}{# determine if the line is a blend or not}
03306     \textcolor{keywordflow}{if} lineLabel[-1] == \textcolor{stringliteral}{'+'}  \textcolor{keywordflow}{or} lineLabel[-2] == \textcolor{stringliteral}{'+'}:
03307         blend = \textcolor{keyword}{True}
03308     \textcolor{keywordflow}{else}:
03309         blend = \textcolor{keyword}{False}
03310     \textcolor{comment}{# extract information on the atom}
03311     elem\_spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel, \textcolor{stringliteral}{' '}, \textcolor{stringliteral}{'\_'})
03312     elem, spec = \hyperlink{namespacepyneb_1_1utils_1_1misc_a2bb6f906a75f26a882093e9ce9272507}{parseAtom}(elem\_spec)
03313     atom\_label = elem + str(spec)
03314     \textcolor{keywordflow}{if} len(elem\_spec) > 0:
03315         \textcolor{keywordflow}{if} elem\_spec[-1] == \textcolor{stringliteral}{'}\textcolor{stringliteral}{r':}
03316 \textcolor{stringliteral}{            atom\_label += }\textcolor{stringliteral}{'}\textcolor{stringliteral}{r'}
03317 \textcolor{stringliteral}{    }\textcolor{comment}{# extract information on the wave}
03318     \textcolor{keywordflow}{if} blend:
03319         \textcolor{keywordflow}{try}:
03320             wave = float(\hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel[:-2], \textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{' '}))
03321         \textcolor{keywordflow}{except}:
03322             wave = 0.
03323     \textcolor{keywordflow}{else}:
03324         \textcolor{keywordflow}{try}:
03325             wave = float(\hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel[:-1], \textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{' '}))
03326         \textcolor{keywordflow}{except}:
03327             wave = 0.
03328     wave\_label = \hyperlink{namespacepyneb_1_1utils_1_1misc_aaf9c5249e3c3104e38854ca30f9df4b7}{strExtract}(lineLabel, \textcolor{stringliteral}{'\_'}, \textcolor{stringliteral}{' '})
03329     \textcolor{keywordflow}{if} lineLabel[-1] == \textcolor{stringliteral}{'m'}:
03330         wave = wave * 1.e4
03331     
03332     \textcolor{keywordflow}{return} elem, spec, atom\_label, wave, wave\_label, blend
03333 
03334     
\hypertarget{pynebcore_8py_source_l03335}{}\hyperlink{namespacepyneb_1_1core_1_1pynebcore_af6bc1553900518f0f154cafda868e1e4}{03335} \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1core_1_1pynebcore_af6bc1553900518f0f154cafda868e1e4}{isValid}(line\_label):
03336     \textcolor{stringliteral}{"""}
03337 \textcolor{stringliteral}{    Return True if the line label correspond to a valid line from LINE\_LABEL\_LIST or BLEND\_LIST}
03338 \textcolor{stringliteral}{    }
03339 \textcolor{stringliteral}{    Usage:}
03340 \textcolor{stringliteral}{        isValid('O3\_5007A')}
03341 \textcolor{stringliteral}{}
03342 \textcolor{stringliteral}{    Parameters:}
03343 \textcolor{stringliteral}{        - line\_label    label to be tested}
03344 \textcolor{stringliteral}{}
03345 \textcolor{stringliteral}{    """}
03346     elem, spec, atom, wave, waveLabel, blend = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a15b88e2a4daeae68052060cb425c7a1c}{parseLineLabel}(line\_label)
03347     \textcolor{keywordflow}{if} atom \textcolor{keywordflow}{in} LINE\_LABEL\_LIST:
03348             \textcolor{keywordflow}{if} (waveLabel \textcolor{keywordflow}{in} LINE\_LABEL\_LIST[atom]) \textcolor{keywordflow}{or} (line\_label \textcolor{keywordflow}{in} BLEND\_LIST):
03349                 is\_valid = \textcolor{keyword}{True}
03350             \textcolor{keywordflow}{else}:
03351                 is\_valid = \textcolor{keyword}{False}
03352     \textcolor{keywordflow}{else}:
03353         is\_valid = \textcolor{keyword}{False}
03354     \textcolor{keywordflow}{return} is\_valid
03355 
03356 
\hypertarget{pynebcore_8py_source_l03357}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{03357} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{EmissionLine}(object):
03358     \textcolor{stringliteral}{"""}
03359 \textcolor{stringliteral}{    Define the emission line object, which is defined by the line parameters and the intensity }
03360 \textcolor{stringliteral}{        parameters.}
03361 \textcolor{stringliteral}{    The line parameters define the emitting ion, the wavelength or the transition, the label }
03362 \textcolor{stringliteral}{        in PyNeb format, and a flag defining whether the line is a blend or a single transition. }
03363 \textcolor{stringliteral}{    The intensity parameters describe the observed intensity, the observed uncertainty and }
03364 \textcolor{stringliteral}{        the corrected uncertainty}
03365 \textcolor{stringliteral}{        }
03366 \textcolor{stringliteral}{    Usage:}
03367 \textcolor{stringliteral}{        line = pn.EmissionLine('O', 3, 5007, obsIntens=[1.4, 1.3])}
03368 \textcolor{stringliteral}{        line = pn.EmissionLine(label = 'O3\_5007A', obsIntens=320, corrected = True)}
03369 \textcolor{stringliteral}{    }
03370 \textcolor{stringliteral}{    Parameters:}
03371 \textcolor{stringliteral}{        - elem        symbol of the selected element}
03372 \textcolor{stringliteral}{        - spec        ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
03373 \textcolor{stringliteral}{        - wave        wavelength of the line}
03374 \textcolor{stringliteral}{        - blend       blend flag (boolean)}
03375 \textcolor{stringliteral}{        - to\_eval     algebraic expression describing the emission line in terms of single transitions}
03376 \textcolor{stringliteral}{        - label       line label in the standard PyNeb format}
03377 \textcolor{stringliteral}{        - obsIntens   observed intensity}
03378 \textcolor{stringliteral}{        - obsError    uncertainty on the observed intensity}
03379 \textcolor{stringliteral}{    }
03380 \textcolor{stringliteral}{    """} 
03381     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4966db926181349d90594f0b6d170c45}{\_\_init\_\_}(self, elem=None, spec=None, wave=None, blend=False, to\_eval=None, label=None,
\hypertarget{pynebcore_8py_source_l03382}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4966db926181349d90594f0b6d170c45}{03382}                  obsIntens=\textcolor{keywordtype}{None}, obsError=\textcolor{keywordtype}{None}, corrected=\textcolor{keyword}{False}, \_unit=\textcolor{keywordtype}{None}):
03383         
\hypertarget{pynebcore_8py_source_l03384}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a85c9edd5e884b93ab84fd6507159e401}{03384}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a85c9edd5e884b93ab84fd6507159e401}{log\_} = log\_ 
\hypertarget{pynebcore_8py_source_l03385}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{03385}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling} = \textcolor{stringliteral}{'EmissionLine'}
\hypertarget{pynebcore_8py_source_l03386}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{03386}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected} = corrected
03387         
03388         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l03389}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{03389}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{elem} = elem
\hypertarget{pynebcore_8py_source_l03390}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{03390}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{spec} = int(spec)
\hypertarget{pynebcore_8py_source_l03391}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{03391}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{elem} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{spec})
\hypertarget{pynebcore_8py_source_l03392}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{03392}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave} = wave
\hypertarget{pynebcore_8py_source_l03393}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{03393}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{blend} = blend
\hypertarget{pynebcore_8py_source_l03394}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{03394}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}, self.waveLabel, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label} = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{getLineLabel}(elem, spec, wave, 
      blend)
03395         \textcolor{keywordflow}{else}:
03396             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label} = label
03397             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a2ae6c54e37a06730bf2b382c966a4694}{elem}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a6de8a145c1cb80aff621c95dc4caabe1}{spec}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}, self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave}, self.waveLabel, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{blend} = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a15b88e2a4daeae68052060cb425c7a1c}{parseLineLabel}(label)
03398             \textcolor{keywordflow}{if} wave \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03399                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave} = wave
03400 
03401         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom} \textcolor{keywordflow}{in} LINE\_LABEL\_LIST:
03402             \textcolor{keywordflow}{if} (self.waveLabel \textcolor{keywordflow}{in} LINE\_LABEL\_LIST[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}]) \textcolor{keywordflow}{or} (self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label} \textcolor{keywordflow}{in} BLEND\_LIST):
\hypertarget{pynebcore_8py_source_l03403}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{03403}                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{is\_valid} = \textcolor{keyword}{True}
03404                 \textcolor{keywordflow}{if} to\_eval \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03405                     \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a44f73379aadc3e6231d66dd7a6ebae6b}{blend}:
\hypertarget{pynebcore_8py_source_l03406}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{03406}                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = BLEND\_LIST[self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a90efae6a674334d10cbda0a1369c9b61}{label}]
03407                     \textcolor{keywordflow}{else}: 
03408                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = \textcolor{stringliteral}{'L('} + str(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave}) + \textcolor{stringliteral}{')'}
03409                 \textcolor{keywordflow}{else}:
03410                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = to\_eval
03411             \textcolor{keywordflow}{else}:
03412                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{is\_valid} = \textcolor{keyword}{False}
03413                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = \textcolor{keywordtype}{None}
03414                 self.log\_.warn(\textcolor{stringliteral}{'line \{0\} for atom \{1\} not valid'}.format(self.waveLabel, self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}), calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling})
03415         \textcolor{keywordflow}{else}:
03416                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_af2bba01ef12f8df4e0e8109a45657d0a}{is\_valid} = \textcolor{keyword}{False}
03417                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8b0ab342a873f8ace6c69ed093da5cfa}{to\_eval} = \textcolor{keywordtype}{None}
03418                 self.log\_.warn(\textcolor{stringliteral}{'Atom \{0\} not valid'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4792ac5b02cda998caaf42203e4541e9}{atom}), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling})
03419             
03420             
\hypertarget{pynebcore_8py_source_l03421}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{03421}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens} = np.asarray(obsIntens, dtype=float)
03422         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected}:
\hypertarget{pynebcore_8py_source_l03423}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{03423}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.asarray(obsIntens, dtype=float)
03424         \textcolor{keywordflow}{else}:
03425             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.zeros\_like(obsIntens)
03426             
03427         \textcolor{comment}{# the following is not public, as we still have to think about it. }
03428         \textcolor{comment}{# Don't une it...}
\hypertarget{pynebcore_8py_source_l03429}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a87753879f7fa6ac6a40e05bc0e5c3c72}{03429}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a87753879f7fa6ac6a40e05bc0e5c3c72}{\_obsIntens\_n} = np.zeros\_like(obsIntens)
\hypertarget{pynebcore_8py_source_l03430}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_aa1f44ce8f6be439b590589c08da84fc2}{03430}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_aa1f44ce8f6be439b590589c08da84fc2}{\_corrIntens\_n} = np.zeros\_like(obsIntens)
\hypertarget{pynebcore_8py_source_l03431}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1828e90dccac2948129b7052c54eedf5}{03431}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1828e90dccac2948129b7052c54eedf5}{\_unit} = \_unit
03432 
03433         \textcolor{keywordflow}{if} obsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
\hypertarget{pynebcore_8py_source_l03434}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{03434}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.zeros\_like(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens})
03435         \textcolor{keywordflow}{else}:
03436             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.asarray(obsError, dtype=float)
03437 
03438         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected}:
\hypertarget{pynebcore_8py_source_l03439}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{03439}             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.asarray(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}, dtype=float)
03440         \textcolor{keywordflow}{else}:
03441             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.zeros\_like(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError})
03442     \textcolor{comment}{##            }
03443     \textcolor{comment}{# @var elem}
03444     \textcolor{comment}{# Symbol of the element}
03445 
03446     
\hypertarget{pynebcore_8py_source_l03447}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a7e915a1443ed01912b44052900b2e581}{03447}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a7e915a1443ed01912b44052900b2e581}{correctIntens}(self, RC, normWave=None):
03448         \textcolor{stringliteral}{"""}
03449 \textcolor{stringliteral}{        Correct from extinction. The corrIntens and corrError values of the line }
03450 \textcolor{stringliteral}{        are updated according to the RedCorr object}
03451 \textcolor{stringliteral}{}
03452 \textcolor{stringliteral}{}
03453 \textcolor{stringliteral}{        Parameters:}
03454 \textcolor{stringliteral}{            - RC        an instantiation of the pn.RedCorr class }
03455 \textcolor{stringliteral}{            - normWave  a wavelength for the normalisation of the correction, e.g. 4861.  }
03456 \textcolor{stringliteral}{}
03457 \textcolor{stringliteral}{        """}
03458         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(RC, RedCorr):
03459             log\_.error(\textcolor{stringliteral}{'Trying to correct with something that is not a RedCor object'},
03460                           calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_ac14a01c0f8aac44c5e2381cadfacf2cf}{calling})
03461             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03462         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave} > 0.0:
03463             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens} * RC.getCorr(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a32755b006f794c0759c7b7da330b2dc1}{wave}, normWave)     
03464         \textcolor{keywordflow}{else}:
03465             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens}
03466         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}
03467         
03468         
\hypertarget{pynebcore_8py_source_l03469}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1669e4e38ca70d04d3a1395bd6bf237e}{03469}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a1669e4e38ca70d04d3a1395bd6bf237e}{addObs}(self, newObsIntens, newObsError=None):
03470         \textcolor{stringliteral}{"""}
03471 \textcolor{stringliteral}{        Add observed values to an existing line. }
03472 \textcolor{stringliteral}{        }
03473 \textcolor{stringliteral}{        Parameters:}
03474 \textcolor{stringliteral}{            - newObsIntens    observed intensity of the line}
03475 \textcolor{stringliteral}{            - newObsError     error on the observed intensity (optional)}
03476 \textcolor{stringliteral}{            }
03477 \textcolor{stringliteral}{        """}
03478         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a8ac6d9eaaf4eb17606577a858edb1d71}{obsIntens}, newObsIntens)
03479         \textcolor{keywordflow}{if} newObsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03480             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}, np.zeros\_like(newObsIntens))
03481         \textcolor{keywordflow}{else}:
03482             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a4434ba9895df707a62bf375cd0e6e9c0}{obsError}, newObsError)
03483         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a5af607e131b5677bff4589562605fe26}{corrected}:
03484             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens}, newObsIntens)
03485             \textcolor{keywordflow}{if} newObsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03486                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError}, np.zeros\_like(newObsIntens))
03487             \textcolor{keywordflow}{else}:
03488                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError}, newObsError) 
03489         \textcolor{keywordflow}{else}:
03490             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a903ce14847b8b13f154d734ffe85c93a}{corrIntens}, np.zeros\_like(newObsIntens))
03491             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError} = np.append(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_adc12988469a310bf5ecaabf299669fc1}{corrError}, np.zeros\_like(newObsIntens))
03492     
03493     
\hypertarget{pynebcore_8py_source_l03494}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a30c40fa492a3b74ad4c85b07f89fab25}{03494}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a30c40fa492a3b74ad4c85b07f89fab25}{printLine}(self):
03495         \textcolor{stringliteral}{"""}
03496 \textcolor{stringliteral}{        Provide information on the line: atom, label, to\_eval, as well as the intensities and errors}
03497 \textcolor{stringliteral}{        }
03498 \textcolor{stringliteral}{        Usage:}
03499 \textcolor{stringliteral}{            line.printLine()}
03500 \textcolor{stringliteral}{            }
03501 \textcolor{stringliteral}{        """}
03502         print(\textcolor{stringliteral}{"""Line \{0.atom\} \{0.label\} evaluated as \{0.to\_eval\}}
03503 \textcolor{stringliteral}{Observed intensity: \{0.obsIntens\}}
03504 \textcolor{stringliteral}{Observed error: \{0.obsError\}}
03505 \textcolor{stringliteral}{Corrected intensity: \{0.corrIntens\}}
03506 \textcolor{stringliteral}{Corrected error: \{0.corrError\}"""}.format(self))
03507      
03508      
\hypertarget{pynebcore_8py_source_l03509}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a0765acf2ba023a1e5fa5833a7a108635}{03509}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line_a0765acf2ba023a1e5fa5833a7a108635}{\_\_repr\_\_}(self):
03510         \textcolor{keywordflow}{return} \textcolor{stringliteral}{'Line \{0.atom\} \{0.label\}'}.format(self)
03511 
03512 
\hypertarget{pynebcore_8py_source_l03513}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation}{03513} \textcolor{keyword}{class }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation}{Observation}(object):
03514     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a4f72b542ac93dd5376e05c7c44015409}{\_\_init\_\_}(self, obsFile=None, fileFormat='lines\_in\_cols', delimiter=None, err\_default=0.10,
\hypertarget{pynebcore_8py_source_l03515}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a4f72b542ac93dd5376e05c7c44015409}{03515}                  corrected=\textcolor{keyword}{False}, errIsRelative=\textcolor{keyword}{True}):
03516         \textcolor{stringliteral}{"""}
03517 \textcolor{stringliteral}{        Define the observation object, which is a collection of observated intensities of one or more}
03518 \textcolor{stringliteral}{        emission lines for one or more objects, with the corresponding errors.}
03519 \textcolor{stringliteral}{        The observed intensities are read from a file or filled in by the addLine method.}
03520 \textcolor{stringliteral}{        Includes an extinction correction object (pyneb.RedCorr) as Observation.extinction.}
03521 \textcolor{stringliteral}{        }
03522 \textcolor{stringliteral}{        Parameters:}
03523 \textcolor{stringliteral}{            - obsFile       name of the file containing the observations. May be a file object or a file
       name }
03524 \textcolor{stringliteral}{            - fileFormat    lines\_in\_cols or lines\_in\_row depending on how the wavelengths are ordered }
03525 \textcolor{stringliteral}{                                (default: lines\_in\_cols)}
03526 \textcolor{stringliteral}{            - delimiter     character separating entries }
03527 \textcolor{stringliteral}{            - err\_default   default uncertainty assumed on intensities. Will overwrite the error from the
       file.}
03528 \textcolor{stringliteral}{            - corrected     Boolean. True if the observed intensities are already corrected from extinction}
03529 \textcolor{stringliteral}{                                (default: False)}
03530 \textcolor{stringliteral}{            - errIsRelative Boolean. True if the errors are relative to the intensities, False if they}
03531 \textcolor{stringliteral}{                                are in the same unit as the intensity (default: True)}
03532 \textcolor{stringliteral}{}
03533 \textcolor{stringliteral}{        Example:}
03534 \textcolor{stringliteral}{            Read a file containing corrected intensities:}
03535 \textcolor{stringliteral}{                obs = pn.Observation('obs.dat', corrected = True)}
03536 \textcolor{stringliteral}{            to obtain a dictionary with the observed  corrected intensities:}
03537 \textcolor{stringliteral}{                i\_cor = \{label: obs.getLine(label = label).corrIntens for label in obs.lineLabels\}}
03538 \textcolor{stringliteral}{        }
03539 \textcolor{stringliteral}{        """}        
\hypertarget{pynebcore_8py_source_l03540}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a882b7909bc881e0c212dd5085305f4d4}{03540}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a882b7909bc881e0c212dd5085305f4d4}{log\_} = log\_ 
\hypertarget{pynebcore_8py_source_l03541}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{03541}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling} = \textcolor{stringliteral}{'Observation'}
\hypertarget{pynebcore_8py_source_l03542}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{03542}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines} = []
\hypertarget{pynebcore_8py_source_l03543}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{03543}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = []
\hypertarget{pynebcore_8py_source_l03544}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_acdd6227c32bd92ec4a15b83110bcb570}{03544}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_acdd6227c32bd92ec4a15b83110bcb570}{extinction} = RedCorr()
\hypertarget{pynebcore_8py_source_l03545}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{03545}         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{corrected} = corrected
03546         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{corrected}:
03547             self.extinction.law = \textcolor{stringliteral}{'No correction'}
03548         \textcolor{keywordflow}{if} obsFile \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03549             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa33f35ce2f56f5b8a5666601b24a1107}{readData}(obsFile=obsFile, fileFormat=fileFormat, delimiter=delimiter,
03550                           err\_default=err\_default, corrected=corrected, errIsRelative=errIsRelative)
03551     \textcolor{comment}{##            }
03552     \textcolor{comment}{# @var log\_}
03553     \textcolor{comment}{# myloggin object}
03554     \textcolor{comment}{# @var extinction}
03555     \textcolor{comment}{# RedCor object}
03556 
03557 
\hypertarget{pynebcore_8py_source_l03558}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a17ddf1c03fd1859cafe36d0593ec5f01}{03558}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a17ddf1c03fd1859cafe36d0593ec5f01}{addLine}(self, line):
03559         \textcolor{stringliteral}{"""}
03560 \textcolor{stringliteral}{        Add a line to an existing observation}
03561 \textcolor{stringliteral}{}
03562 \textcolor{stringliteral}{        Parameters:}
03563 \textcolor{stringliteral}{            - line    the selected emission line (an instance of EmissionLine)}
03564 \textcolor{stringliteral}{            }
03565 \textcolor{stringliteral}{        """}
03566         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(line, EmissionLine):            
03567             self.log\_.error(\textcolor{stringliteral}{'Trying to add an inappropriate record to observations'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03568             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03569         \textcolor{keywordflow}{if} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a7eef3176d082009fa850a9d364d44625}{corrected}:
03570             line.corrected = \textcolor{keyword}{True}
03571             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}(line)
03572         self.lines.append(line)
03573 
\hypertarget{pynebcore_8py_source_l03574}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a106a6b30219b5d9778713936c2a3064d}{03574}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a106a6b30219b5d9778713936c2a3064d}{fillObs}(self, lineLabel, default=np.nan):
03575         \textcolor{stringliteral}{"""}
03576 \textcolor{stringliteral}{        Create a fake observation of a given line, filled with a given value.}
03577 \textcolor{stringliteral}{        Parameters:}
03578 \textcolor{stringliteral}{            - lineLabel: the label of the new line. If the label corresponds to an already }
03579 \textcolor{stringliteral}{                defined observation, nothing is done and a warning is issued.}
03580 \textcolor{stringliteral}{            - default: the value of the fake observations. Default is np.nan}
03581 \textcolor{stringliteral}{        """}
03582 
03583         \textcolor{keywordflow}{if} lineLabel \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6ec53301ec68e138d4347f501ff7f711}{lineLabels}:
03584             newLine = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{EmissionLine}(label=lineLabel, obsIntens=default*np.ones(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3c9122167ef525b73a62d39d4b5c4239}{n\_obs}))
03585             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a17ddf1c03fd1859cafe36d0593ec5f01}{addLine}(newLine)
03586         \textcolor{keywordflow}{else}:
03587             log\_.warn(\textcolor{stringliteral}{'Line \{0\} already in obs'}.format(lineLabel), calling = self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03588 
\hypertarget{pynebcore_8py_source_l03589}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a301e67ff50a467e97cd929039607a5d0}{03589}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a301e67ff50a467e97cd929039607a5d0}{addObs}(self, name, newObsIntens, newObsError=None):
03590         \textcolor{stringliteral}{"""}
03591 \textcolor{stringliteral}{        Add an observation (i.e. a list of intensities corresponding to a new object) to the existing set.}
03592 \textcolor{stringliteral}{}
03593 \textcolor{stringliteral}{        Parameters:}
03594 \textcolor{stringliteral}{            - name            name of the new observation/object}
03595 \textcolor{stringliteral}{            - newObsIntens    value(s) of the line intensities. Length must match Observation.n\_lines}
03596 \textcolor{stringliteral}{                }
03597 \textcolor{stringliteral}{        """}
03598         \textcolor{keywordflow}{if} np.ndim(newObsIntens) == 0:
03599             newObsIntens = [newObsIntens]
03600         \textcolor{keywordflow}{if} len(newObsIntens) != self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a784301f3cabf9c7dbe4e7dcef0700ae8}{n\_lines}:
03601             self.log\_.error(\textcolor{stringliteral}{'Length of observations to be added does not match n\_lines = \{0\}'}.format(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a784301f3cabf9c7dbe4e7dcef0700ae8}{n\_lines}),
03602                             calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03603             \textcolor{keywordflow}{return}
03604         \textcolor{keywordflow}{if} name \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03605             self.log\_.error(\textcolor{stringliteral}{'Name \{0\} already exists'}.format(name))
03606             \textcolor{keywordflow}{return}
03607         \textcolor{keywordflow}{for} i, line \textcolor{keywordflow}{in} enumerate(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}):
03608             \textcolor{keywordflow}{if} newObsError \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03609                 line.addObs(newObsIntens[i])
03610             \textcolor{keywordflow}{else}:
03611                 line.addObs(newObsIntens[i], newObsError[i])
03612         self.names.append(name)
03613 
03614     @property
\hypertarget{pynebcore_8py_source_l03615}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6ec53301ec68e138d4347f501ff7f711}{03615}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6ec53301ec68e138d4347f501ff7f711}{lineLabels}(self):
03616         \textcolor{stringliteral}{"""}
03617 \textcolor{stringliteral}{        Property}
03618 \textcolor{stringliteral}{        Array of labels of the lines }
03619 \textcolor{stringliteral}{        }
03620 \textcolor{stringliteral}{        """}
03621         \textcolor{keywordflow}{return} np.asarray([line.label \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}])   
03622 
03623     @property
\hypertarget{pynebcore_8py_source_l03624}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a784301f3cabf9c7dbe4e7dcef0700ae8}{03624}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a784301f3cabf9c7dbe4e7dcef0700ae8}{n\_lines}(self):
03625         \textcolor{stringliteral}{"""}
03626 \textcolor{stringliteral}{        Property}
03627 \textcolor{stringliteral}{        Number of lines}
03628 \textcolor{stringliteral}{        }
03629 \textcolor{stringliteral}{        """}
03630         \textcolor{keywordflow}{return} len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines})
03631 
03632     @property
\hypertarget{pynebcore_8py_source_l03633}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aff6380f5f386282310ec1937b683e25f}{03633}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aff6380f5f386282310ec1937b683e25f}{n\_valid\_lines}(self):
03634         \textcolor{stringliteral}{"""}
03635 \textcolor{stringliteral}{        Property}
03636 \textcolor{stringliteral}{        Number of valid lines (i.e., lines with labels recognized by PyNeb)}
03637 \textcolor{stringliteral}{        }
03638 \textcolor{stringliteral}{        """}
03639         \textcolor{keywordflow}{return} len([line \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines} \textcolor{keywordflow}{if} line.is\_valid])
03640 
03641     @property
\hypertarget{pynebcore_8py_source_l03642}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3c9122167ef525b73a62d39d4b5c4239}{03642}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3c9122167ef525b73a62d39d4b5c4239}{n\_obs}(self):
03643         \textcolor{stringliteral}{"""}
03644 \textcolor{stringliteral}{        Property}
03645 \textcolor{stringliteral}{        Number of observations. If the number of observations varies from one line to the other,}
03646 \textcolor{stringliteral}{            returns the number of observations for each line as an array.}
03647 \textcolor{stringliteral}{            }
03648 \textcolor{stringliteral}{        """}
03649         n\_obs = np.asarray([l.obsIntens.size \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}])
03650         \textcolor{keywordflow}{for} n \textcolor{keywordflow}{in} n\_obs:
03651             \textcolor{keywordflow}{if} n != n\_obs[0]:
03652                 \textcolor{keywordflow}{return} n\_obs
03653                 
03654         \textcolor{keywordflow}{return} n\_obs[0]
03655     
03656     
03657     @property
\hypertarget{pynebcore_8py_source_l03658}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa0044049cd44807364a0c0957e5c3740}{03658}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa0044049cd44807364a0c0957e5c3740}{n\_obs\_origin}(self):
03659         \textcolor{stringliteral}{"""}
03660 \textcolor{stringliteral}{        Property}
03661 \textcolor{stringliteral}{        Number of observations which are not from MonteCarlo (i.e. without -MC- in the name)}
03662 \textcolor{stringliteral}{        """}
03663         \textcolor{keywordflow}{return} len([n \textcolor{keywordflow}{for} n \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} \textcolor{keywordflow}{if} \textcolor{stringliteral}{'-MC-'} \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} n])
03664 
\hypertarget{pynebcore_8py_source_l03665}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{03665}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(self, elem=None, spec=None, wave=None, label=None, blend=False, i=None, j=None):
03666         \textcolor{stringliteral}{"""}
03667 \textcolor{stringliteral}{        Return the lines corresponding to elem-spec-wave or to the label.}
03668 \textcolor{stringliteral}{        }
03669 \textcolor{stringliteral}{        """}
03670         \textcolor{keywordflow}{if} label \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03671             label = \hyperlink{namespacepyneb_1_1core_1_1pynebcore_a14c882fc308d727f77ed33c1f56212e4}{getLineLabel}(elem, spec, wave, blend)[2]
03672         lines = [line \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines} \textcolor{keywordflow}{if} line.label == label.strip()]
03673         n\_lines = len(lines)
03674         \textcolor{keywordflow}{if} n\_lines == 0:
03675             self.log\_.warn(\textcolor{stringliteral}{'No line for \{0\} from \{1\}\{2\} at wavelength \{3\} (blend=\{4\})'}.format(label, elem, 
      spec, wave, blend),
03676                            calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03677             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03678         \textcolor{keywordflow}{elif} n\_lines == 1:
03679             \textcolor{keywordflow}{return} lines[0]
03680         \textcolor{keywordflow}{else}:
03681             \textcolor{keywordflow}{return} np.asarray(lines)
03682  
03683 
\hypertarget{pynebcore_8py_source_l03684}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2b18c06854c5492b53b7e91311bf1cff}{03684}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2b18c06854c5492b53b7e91311bf1cff}{getSortedLines}(self, crit='atom'):
03685         \textcolor{stringliteral}{"""}
03686 \textcolor{stringliteral}{        Return a list of lines sorted by atoms or wavelengths.}
03687 \textcolor{stringliteral}{        }
03688 \textcolor{stringliteral}{        Parameters:}
03689 \textcolor{stringliteral}{            - crit   criterion to sort the line list ('atom' [default] or 'wave')}
03690 \textcolor{stringliteral}{}
03691 \textcolor{stringliteral}{        """}
03692         \textcolor{keywordflow}{if} crit == \textcolor{stringliteral}{'atom'}:
03693             \textcolor{keywordflow}{return} sorted(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}, key=\textcolor{keyword}{lambda} line: line.atom + str(line.wave))
03694         \textcolor{keywordflow}{elif} crit == \textcolor{stringliteral}{'wave'}:
03695             \textcolor{keywordflow}{return} sorted(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}, key=\textcolor{keyword}{lambda} line: line.wave)
03696         \textcolor{keywordflow}{else}:
03697             self.log\_.error(\textcolor{stringliteral}{'crit = \{0\} is not valid'}.format(crit), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling} + \textcolor{stringliteral}{'.getSortedLines'})
03698 
03699     
\hypertarget{pynebcore_8py_source_l03700}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a786ab364c468b851c4438354235e988a}{03700}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a786ab364c468b851c4438354235e988a}{getUniqueAtoms}(self):
03701         \textcolor{stringliteral}{"""}
03702 \textcolor{stringliteral}{        Return a numpy.ndarray of the atoms of the observed lines. If an atom emits }
03703 \textcolor{stringliteral}{        more than one line, it is returned only once (numpy.unique is applied }
03704 \textcolor{stringliteral}{        to the list before returning).}
03705 \textcolor{stringliteral}{}
03706 \textcolor{stringliteral}{        """}
03707         \textcolor{keywordflow}{return} np.unique([l.atom \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}])
03708 
03709     
03710     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa33f35ce2f56f5b8a5666601b24a1107}{readData}(self, obsFile, fileFormat='lines\_in\_cols', delimiter=None, err\_default=0.10, 
      corrected=False,
\hypertarget{pynebcore_8py_source_l03711}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa33f35ce2f56f5b8a5666601b24a1107}{03711}                  errIsRelative=\textcolor{keyword}{True}):
03712         \textcolor{stringliteral}{"""}
03713 \textcolor{stringliteral}{        Read observational data from an ascii file. The lines can be listed either in columns or in rows}
03714 \textcolor{stringliteral}{        and the observed objects vary in the other direction. The uncertainty on the line intensities}
03715 \textcolor{stringliteral}{        can be read from the file, or a constant relative value can be assumed.}
03716 \textcolor{stringliteral}{        The lines must be identified by a label in PyNeb's format ion\_wave (e.g., 'O3\_5007'); the list of
       ions and}
03717 \textcolor{stringliteral}{        corresponding wavelengths can also be found in pn.LINE\_LABEL\_LIST.}
03718 \textcolor{stringliteral}{        The following optional fields may also be included (without quotes): 'NAME' (object's name, in one
       string), }
03719 \textcolor{stringliteral}{        'E(B-V)', 'cHbeta', and 'e' (observational error).}
03720 \textcolor{stringliteral}{        }
03721 \textcolor{stringliteral}{ }
03722 \textcolor{stringliteral}{        Parameters:}
03723 \textcolor{stringliteral}{            - obsFile        file containing the observations. May be a file object or a string }
03724 \textcolor{stringliteral}{            - fileFormat     emission lines vary across columns ('lines\_in\_cols', default) or }
03725 \textcolor{stringliteral}{                                across rows ('lines\_in\_rows'), or across rows with errors in columns }
03726 \textcolor{stringliteral}{                                ('lines\_in\_rows\_err\_cols')m in which case the column label must start with 
      "err"}
03727 \textcolor{stringliteral}{            - delimiter      field delimiter (default: None)  }
03728 \textcolor{stringliteral}{            - err\_default    default uncertainty on the line intensities}
03729 \textcolor{stringliteral}{            - corrected      Boolean. True if the observed intensities are already corrected from
       extinction}
03730 \textcolor{stringliteral}{                                 (default: False)}
03731 \textcolor{stringliteral}{            - errIsRelative  Boolean. True if the errors are relative to the intensities, False if they}
03732 \textcolor{stringliteral}{                                 are in the same unit as the intensity (default: False)}
03733 \textcolor{stringliteral}{}
03734 \textcolor{stringliteral}{        """}    
03735         format\_list = [\textcolor{stringliteral}{'lines\_in\_cols'}, \textcolor{stringliteral}{'lines\_in\_cols2'}, \textcolor{stringliteral}{'lines\_in\_rows'}, \textcolor{stringliteral}{'lines\_in\_rows\_err\_cols'}]
03736         \textcolor{keywordflow}{if} fileFormat \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} format\_list:
03737             self.log\_.error(\textcolor{stringliteral}{'unknown format \{0\}'}.format(fileFormat), calling=\textcolor{stringliteral}{'Observation.readData'})
03738 
03739         \textcolor{keywordflow}{if} type(obsFile) \textcolor{keywordflow}{is} file:
03740             f = obsFile
03741             closeAfterUse = \textcolor{keyword}{False}
03742         \textcolor{keywordflow}{else}:
03743             f = open(obsFile, \textcolor{stringliteral}{'}\textcolor{stringliteral}{r')}
03744 \textcolor{stringliteral}{            closeAfterUse = }\textcolor{keyword}{True}
03745             
03746         \textcolor{keywordflow}{if} fileFormat == \textcolor{stringliteral}{'lines\_in\_cols'}:
03747             hdr = f.readline()
03748             labels = hdr.split(delimiter)
03749             labels = [l.strip() \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} labels]
03750             data = f.readlines()
03751             \textcolor{keywordflow}{if} closeAfterUse:
03752                 f.close()
03753             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = [dd.split(delimiter)[0].strip() \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data]
03754             data\_tab = np.asarray([[dd.split(delimiter)[i] \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data] \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} np.arange(len(labels))]
      )
03755             
03756             \textcolor{keywordflow}{for} i, label \textcolor{keywordflow}{in} enumerate(labels):
03757                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'NAME'}:
03758                     \textcolor{keywordflow}{pass}
03759                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'cHbeta'}:
03760                     self.extinction.cHbeta = data\_tab[i].astype(np.float32)
03761                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03762                     self.extinction.E\_BV = data\_tab[i].astype(np.float32)         
03763                 \textcolor{keywordflow}{elif} label[-1] != \textcolor{stringliteral}{'e'}:
03764                     intens = data\_tab[i].astype(np.float32)
03765                     \textcolor{keywordflow}{try}:
03766                         i\_error = labels.index(label + \textcolor{stringliteral}{'e'})
03767                         error = data\_tab[i\_error].astype(np.float32)
03768                         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03769                             error = \hyperlink{namespacepyneb_1_1utils_1_1misc_a852d66d22ba9e872484b3346dc28249e}{quiet\_divide}(error, intens)
03770                     \textcolor{keywordflow}{except}:
03771                         self.log\_.message(\textcolor{stringliteral}{'No error found for line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03772                         error = data\_tab[1].astype(np.float32) * 0. + err\_default
03773                     \textcolor{keywordflow}{try}:
03774                         line2add = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{EmissionLine}(label=label, obsIntens=intens, obsError=error)
03775                     \textcolor{keywordflow}{except}:
03776                         self.log\_.warn(\textcolor{stringliteral}{'Unknown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03777                     \textcolor{keywordflow}{try}:
03778                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a17ddf1c03fd1859cafe36d0593ec5f01}{addLine}(line2add)
03779                         self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03780                     \textcolor{keywordflow}{except}:
03781                         self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03782                         
03783         \textcolor{keywordflow}{elif} fileFormat == \textcolor{stringliteral}{'lines\_in\_cols2'}:
03784             \textcolor{keywordflow}{if} closeAfterUse:
03785                 f.close()
03786             data\_tab = np.genfromtxt(obsFile, dtype=\textcolor{keywordtype}{None}, delimiter=delimiter, names=\textcolor{keyword}{True}, deletechars=\textcolor{stringliteral}{''})
03787             \textcolor{keywordflow}{for} label \textcolor{keywordflow}{in} data\_tab.dtype.names:
03788                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'cHbeta'}:
03789                     self.extinction.cHbeta = data\_tab[label]
03790                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03791                     self.extinction.E\_BV = data\_tab[label]
03792                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'NAME'}:
03793                     self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = list(data\_tab[label])
03794                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'NAME2'}:
03795                     \textcolor{keywordflow}{try}:
03796                         names2 = list(data\_tab[label])
03797                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = [n1 + \textcolor{stringliteral}{'\_'} + n2 \textcolor{keywordflow}{for} n1, n2 \textcolor{keywordflow}{in} zip(self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}, names2)]
03798                     \textcolor{keywordflow}{except}:
03799                         \textcolor{keywordflow}{pass}
03800                 \textcolor{keywordflow}{elif} label[-1] != \textcolor{stringliteral}{'e'}:
03801                     \textcolor{keywordflow}{if} data\_tab[label].dtype.type != np.string\_:
03802                         intens = data\_tab[label]
03803                         \textcolor{keywordflow}{try}:
03804                             error = data\_tab[label + \textcolor{stringliteral}{'e'}]
03805                             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03806                                 error = error / intens
03807                         \textcolor{keywordflow}{except}:
03808                             self.log\_.message(\textcolor{stringliteral}{'No error found for line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03809                             error = np.ones\_like(data\_tab[label]) * err\_default
03810                         \textcolor{keywordflow}{try}:
03811                             line2add = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{EmissionLine}(label=label, obsIntens=intens, obsError=
      error)
03812                         \textcolor{keywordflow}{except}:
03813                             self.log\_.warn(\textcolor{stringliteral}{'unkown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03814                             print(label, intens, error)
03815                         \textcolor{keywordflow}{try}:
03816                             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a17ddf1c03fd1859cafe36d0593ec5f01}{addLine}(line2add)
03817                             self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03818                         \textcolor{keywordflow}{except}:
03819                             self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03820                             print(label, intens, error)
03821                     \textcolor{keywordflow}{else}:
03822                         self.log\_.warn(\textcolor{stringliteral}{'Skipped \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03823             
03824         \textcolor{keywordflow}{elif} fileFormat == \textcolor{stringliteral}{'lines\_in\_rows'}:
03825             hdr = f.readline()
03826             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = hdr.split(delimiter)[1:]
03827             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} =  [l.strip() \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}]
03828             data = f.readlines()
03829             \textcolor{keywordflow}{if} closeAfterUse:
03830                 f.close()
03831 
03832             labels = [dd.split(delimiter)[0].strip() \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} len(dd.strip()) > 0]
03833             data\_tab = np.asarray([[dd.split(delimiter)[i + 1] \textcolor{keywordflow}{for} dd \textcolor{keywordflow}{in} data \textcolor{keywordflow}{if} len(dd.strip()) > 0] \textcolor{keywordflow}{for} i
       \textcolor{keywordflow}{in} np.arange(len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}))])
03834             data\_tab = data\_tab.astype(np.float32)
03835             \textcolor{keywordflow}{for} i, label \textcolor{keywordflow}{in} enumerate(labels):
03836                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'cHbeta'}:
03837                     self.extinction.cHbeta = data\_tab[:, i]
03838                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03839                     self.extinction.E\_BV = data\_tab[:, i]
03840                 \textcolor{keywordflow}{elif} label[-1] != \textcolor{stringliteral}{'e'}:
03841                     intens = data\_tab[:, i]
03842                     \textcolor{keywordflow}{try}:
03843                         i\_error = labels.index(label + \textcolor{stringliteral}{'e'})
03844                         error = data\_tab[:, i\_error]
03845                         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03846                             error = error / intens
03847                     \textcolor{keywordflow}{except}:
03848                         self.log\_.message(\textcolor{stringliteral}{'No error found for line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03849                         error = np.ones\_like(data\_tab[:, 1]) * err\_default
03850                     \textcolor{keywordflow}{try}:
03851                         line2add = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{EmissionLine}(label=label, obsIntens=intens, obsError=error)
03852                     \textcolor{keywordflow}{except}:
03853                         self.log\_.warn(\textcolor{stringliteral}{'unkown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03854                         print(label, intens, error)
03855                     \textcolor{keywordflow}{try}:
03856                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a17ddf1c03fd1859cafe36d0593ec5f01}{addLine}(line2add)
03857                         self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03858                     \textcolor{keywordflow}{except}:
03859                         self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03860                         print(label, intens, error)
03861                         
03862         \textcolor{keywordflow}{elif} fileFormat == \textcolor{stringliteral}{'lines\_in\_rows\_err\_cols'}:
03863             
03864             \textcolor{keywordflow}{if} closeAfterUse:
03865                 f.close()
03866                 
03867             data\_tab = np.genfromtxt(obsFile, dtype=\textcolor{keywordtype}{None}, delimiter=delimiter, names=\textcolor{keyword}{True})
03868             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names} = [name \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} data\_tab.dtype.names[1::] \textcolor{keywordflow}{if} name[0:3] != \textcolor{stringliteral}{'err'}]
03869             error\_names = [name \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} data\_tab.dtype.names \textcolor{keywordflow}{if} name[0:3] == \textcolor{stringliteral}{'err'}]
03870             \textcolor{keywordflow}{if} len(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}) != len(error\_names):
03871                 log\_.error(\textcolor{stringliteral}{'Number of columns for intensities <> number of columns for errors'},
03872                               calling=self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03873                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03874             \textcolor{comment}{#names\_locations = [name in self.names for name in data\_tab.dtype.names]}
03875             \textcolor{comment}{#errors\_locations = [name[0:3] == 'err' for name in data\_tab.dtype.names]}
03876             \textcolor{keywordflow}{for} i, label \textcolor{keywordflow}{in} enumerate(data\_tab[\textcolor{stringliteral}{'LINE'}]):
03877                 label = label.strip()
03878                 \textcolor{keywordflow}{if} label == \textcolor{stringliteral}{'cHbeta'}:
03879                     self.extinction.cHbeta = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}])
03880                 \textcolor{keywordflow}{elif} label == \textcolor{stringliteral}{'E(B-V)'}:
03881                     self.extinction.E\_BV = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}])
03882                 \textcolor{keywordflow}{else}:
03883                     intens = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}])
03884                     error = np.array([data\_tab[i][name] \textcolor{keywordflow}{for} name \textcolor{keywordflow}{in} error\_names])
03885                     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} errIsRelative:
03886                         error = error / intens
03887                     \textcolor{keywordflow}{try}:
03888                         line2add = \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_emission_line}{EmissionLine}(label=label, obsIntens=intens, obsError=error)
03889                     \textcolor{keywordflow}{except}:
03890                         self.log\_.warn(\textcolor{stringliteral}{'unkown line label \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03891                         print(label, intens, error)
03892                     \textcolor{keywordflow}{try}:
03893                         self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a17ddf1c03fd1859cafe36d0593ec5f01}{addLine}(line2add)
03894                         self.log\_.message(\textcolor{stringliteral}{'adding line \{0\}'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03895                     \textcolor{keywordflow}{except}:
03896                         self.log\_.warn(\textcolor{stringliteral}{'Impossible to add line'}.format(label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03897                         print(label, intens, error)
03898         
03899             
03900         \textcolor{keywordflow}{if} corrected:
03901             self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}()
03902             
03903             
\hypertarget{pynebcore_8py_source_l03904}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac380b22660411926b90f935f5123494b}{03904}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac380b22660411926b90f935f5123494b}{getIntens}(self, returnObs=False, obsName=None):
03905         \textcolor{stringliteral}{"""}
03906 \textcolor{stringliteral}{        Return the line intensities in form of a dictionary with line labels as keys.}
03907 \textcolor{stringliteral}{        }
03908 \textcolor{stringliteral}{        Parameters:}
03909 \textcolor{stringliteral}{            - returnObs  Boolean. If False (default), prints the corrected values. }
03910 \textcolor{stringliteral}{                            If True, prints the observed value. }
03911 \textcolor{stringliteral}{            - obsName    name of an observation. If not set or None, all the observations are printed}
03912 \textcolor{stringliteral}{}
03913 \textcolor{stringliteral}{        """}
03914         \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03915             \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03916                 obsIndex = self.names.index(obsName)
03917             \textcolor{keywordflow}{else}:
03918                 self.log\_.error(\textcolor{stringliteral}{'Name \{\} is not an Observation name'}.format(obsName))
03919                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03920         \textcolor{keywordflow}{else}:
03921             obsIndex = np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3c9122167ef525b73a62d39d4b5c4239}{n\_obs})
03922         to\_return = \{\}
03923         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03924             \textcolor{keywordflow}{if} returnObs:
03925                 to\_return[line.label] = line.obsIntens[obsIndex]
03926             \textcolor{keywordflow}{else}:
03927                 to\_return[line.label] = line.corrIntens[obsIndex]
03928         \textcolor{keywordflow}{return} to\_return
03929     
03930     
\hypertarget{pynebcore_8py_source_l03931}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a96cf2360b9b568a675d2c8177d47b3d2}{03931}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a96cf2360b9b568a675d2c8177d47b3d2}{getError}(self, returnObs=False, obsName=None):
03932         \textcolor{stringliteral}{"""}
03933 \textcolor{stringliteral}{        Return the line intensity error in form of a dictionary with line labels as keys.}
03934 \textcolor{stringliteral}{        }
03935 \textcolor{stringliteral}{        Parameters:}
03936 \textcolor{stringliteral}{            - returnObs  if False (default), prints the corrected values. }
03937 \textcolor{stringliteral}{                            If True, prints the observed value. }
03938 \textcolor{stringliteral}{            - obsName    name of an observation. If not set or None, all the observations are printed}
03939 \textcolor{stringliteral}{            }
03940 \textcolor{stringliteral}{        """}
03941         \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03942             \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03943                 obsIndex = self.names.index(obsName)
03944             \textcolor{keywordflow}{else}:
03945                 self.log\_.error(\textcolor{stringliteral}{'Name \{\} is not an Observation name'}.format(obsName))
03946                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03947         \textcolor{keywordflow}{else}:
03948             obsIndex = np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3c9122167ef525b73a62d39d4b5c4239}{n\_obs})
03949         to\_return = \{\}
03950         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03951             \textcolor{keywordflow}{if} returnObs:
03952                 to\_return[line.label] = line.obsError[obsIndex]
03953             \textcolor{keywordflow}{else}:
03954                 to\_return[line.label] = line.corrError[obsIndex]
03955         \textcolor{keywordflow}{return} to\_return
03956     
03957     
\hypertarget{pynebcore_8py_source_l03958}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa3d4a178539eaf7fe431ef1dbd347430}{03958}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_aa3d4a178539eaf7fe431ef1dbd347430}{printIntens}(self, returnObs=False, obsName=None):
03959         \textcolor{stringliteral}{"""}
03960 \textcolor{stringliteral}{        Print the line intensities.}
03961 \textcolor{stringliteral}{        }
03962 \textcolor{stringliteral}{        Parameters:}
03963 \textcolor{stringliteral}{            - returnObs   if False (default), prints the corrected values. }
03964 \textcolor{stringliteral}{                            If True, prints the observed value. }
03965 \textcolor{stringliteral}{            - obsName     name of an observation. Is unset or None, all the observations are printed}
03966 \textcolor{stringliteral}{}
03967 \textcolor{stringliteral}{        """}    
03968         \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
03969             \textcolor{keywordflow}{if} obsName \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}:
03970                 obsIndex = self.names.index(obsName)
03971             \textcolor{keywordflow}{else}:
03972                 self.log\_.error(\textcolor{stringliteral}{'Name \{\} is not an Observation name'}.format(obsName))
03973                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03974         \textcolor{keywordflow}{else}:
03975             obsIndex = np.arange(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3c9122167ef525b73a62d39d4b5c4239}{n\_obs})
03976         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
03977             \textcolor{keywordflow}{if} returnObs:
03978                 print(line.label, line.obsIntens[obsIndex])
03979             \textcolor{keywordflow}{else}:
03980                 print(line.label, line.corrIntens[obsIndex])
03981     
03982             
\hypertarget{pynebcore_8py_source_l03983}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ab01150e82809bd712a1b1f09d250db94}{03983}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ab01150e82809bd712a1b1f09d250db94}{def\_EBV}(self, label1="H1\_6563A", label2="H1\_4861A", r\_theo=2.85):
03984         \textcolor{stringliteral}{"""}
03985 \textcolor{stringliteral}{        Define the extinction parameter using the ratio of 2 lines.}
03986 \textcolor{stringliteral}{        Calls extinction.setCorr to set the EBV and cHbeta according to the parameters.}
03987 \textcolor{stringliteral}{        Once this is done, one may call correctData to compute the EmissionLine.corrIntens}
03988 \textcolor{stringliteral}{        }
03989 \textcolor{stringliteral}{        Parameters:}
03990 \textcolor{stringliteral}{            - label1 and label2 [EmissionLine.label] observed line whose intensities are used}
03991 \textcolor{stringliteral}{            - r\_theo [float] theoretical line ratio}
03992 \textcolor{stringliteral}{}
03993 \textcolor{stringliteral}{        """}
03994         line1 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(label=label1)
03995         line2 = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(label=label2)
03996         \textcolor{keywordflow}{if} line1 \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
03997             log\_.error(\textcolor{stringliteral}{'\{0\} is not a valid label or is not observed'}.format(line1), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
03998             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
03999         \textcolor{keywordflow}{if} line2 \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
04000             log\_.error(\textcolor{stringliteral}{'\{0\} is not a valid label or is not observed'}.format(line2), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
04001             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
04002 
04003         obs\_over\_theo = (line1.obsIntens / line2.obsIntens) / r\_theo 
04004         self.extinction.setCorr(obs\_over\_theo, line1.wave, line2.wave)
04005         
04006  
\hypertarget{pynebcore_8py_source_l04007}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a04ce20073b375a6dd7d4282933adbd93}{04007}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a04ce20073b375a6dd7d4282933adbd93}{\_\_normalize}(self, label='H1\_4861A'):
04008         \textcolor{stringliteral}{"""}
04009 \textcolor{stringliteral}{        Normalize the line intensities to a reference line (Hbeta by default).}
04010 \textcolor{stringliteral}{        Not yet implemented}
04011 \textcolor{stringliteral}{        }
04012 \textcolor{stringliteral}{        """}
04013         \textcolor{keywordflow}{if} \textcolor{stringliteral}{"="} \textcolor{keywordflow}{in} label:
04014             line\_label, factor = label.split(\textcolor{stringliteral}{'='})
04015             factor = np.float(factor)
04016         \textcolor{keywordflow}{else}:
04017             line\_label = label
04018             factor = 1.
04019         line\_norm = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a9994c84a500a6a31a5376ed6c7782ce3}{getLine}(label=line\_label) 
04020         \textcolor{keywordflow}{if} line\_norm \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
04021             log\_.warn(\textcolor{stringliteral}{'No normalization possible as \{0\} not found'}.format(line\_label), calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
04022             \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}
04023         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
04024             line.\_obsIntens\_n = line.obsIntens / (line\_norm.obsIntens * factor)
04025             line.\_unit = line\_label.strip()
04026     
04027     
\hypertarget{pynebcore_8py_source_l04028}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{04028}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}(self, line=None, normWave=None):
04029         \textcolor{stringliteral}{"""}
04030 \textcolor{stringliteral}{        Correct the line intensities with the correction computed with the RedCorr class (extinction.py)}
04031 \textcolor{stringliteral}{        The result is stored in line.corrIntens (corrected intensity in absolute units).}
04032 \textcolor{stringliteral}{}
04033 \textcolor{stringliteral}{        """}
04034         \textcolor{keywordflow}{if} line \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
04035             line = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}
04036         \textcolor{keywordflow}{if} np.ndim(line) != 0:
04037             \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in} line:
04038                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a823a1fa51f042f2734cbc323c6a7d4bb}{correctData}(l, normWave=normWave)
04039         \textcolor{keywordflow}{else}:
04040             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} isinstance(line, EmissionLine):
04041                 log\_.error(\textcolor{stringliteral}{'Trying to correct something that is not a line'}, calling=self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2639fad9af4fefad20e4097295bd40e7}{calling})
04042                 \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}  
04043             line.correctIntens(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_acdd6227c32bd92ec4a15b83110bcb570}{extinction}, normWave=normWave)
04044 
04045             \textcolor{stringliteral}{"""            }
04046 \textcolor{stringliteral}{            # the following is commented for now, we'll see latter how to implement normalized intensities.}
04047 \textcolor{stringliteral}{            if line.\_unit is not None:}
04048 \textcolor{stringliteral}{                try:}
04049 \textcolor{stringliteral}{                    line\_norm = self.getLine(label=line.\_unit)}
04050 \textcolor{stringliteral}{                    line.\_corrIntens\_n = line.obsIntens\_n * self.extinction.getCorr(line.wave,
       line\_norm.wave)}
04051 \textcolor{stringliteral}{                except:}
04052 \textcolor{stringliteral}{                    log\_.warn('No normalized correction for \{0\}'.format(line), calling='
      Observation.correctData')}
04053 \textcolor{stringliteral}{                    line.\_corrIntens\_n = None}
04054 \textcolor{stringliteral}{            """}
04055             
\hypertarget{pynebcore_8py_source_l04056}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2c0cec305d120daeeb9857c979fbec85}{04056}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a2c0cec305d120daeeb9857c979fbec85}{setAllErrors}(self, err\_default):
04057         \textcolor{stringliteral}{"""}
04058 \textcolor{stringliteral}{        Set the relative uncertainty of all emission lines to a common constant value}
04059 \textcolor{stringliteral}{        }
04060 \textcolor{stringliteral}{        Parameters:}
04061 \textcolor{stringliteral}{            - err\_default     default value of the relative uncertainty}
04062 \textcolor{stringliteral}{        }
04063 \textcolor{stringliteral}{        """}
04064         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a78332043ca9f290590edf6b8a1e5b767}{lines}:
04065             line.obs\_err = np.ones\_like(line.obs\_err) * err\_default
04066 
04067     
04068     
\hypertarget{pynebcore_8py_source_l04069}{}\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a8005a1ad8167e96e117d4b81d6e919ff}{04069}     \textcolor{keyword}{def }\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a8005a1ad8167e96e117d4b81d6e919ff}{addMonteCarloObs}(self, N=0, i\_obs=None):
04070         \textcolor{stringliteral}{"""}
04071 \textcolor{stringliteral}{        Adding MonteCarlo random-gauss values of fake observations to an obs object.}
04072 \textcolor{stringliteral}{        The names of the fake observations will be OriginalName-MC-n, n ranging from 0 to N-1}
04073 \textcolor{stringliteral}{        }
04074 \textcolor{stringliteral}{        Parameters:}
04075 \textcolor{stringliteral}{        N: number of new observations to be added for each original observation.}
04076 \textcolor{stringliteral}{        i\_obs: used in case only a given observations needs to be treated}
04077 \textcolor{stringliteral}{        """}
04078         n\_lines = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a784301f3cabf9c7dbe4e7dcef0700ae8}{n\_lines}
04079         n\_obs = self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3c9122167ef525b73a62d39d4b5c4239}{n\_obs}
04080         \textcolor{keywordflow}{if} i\_obs \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
04081             log\_.message(\textcolor{stringliteral}{'Entering'}, calling=\textcolor{stringliteral}{'addMonteCarloObs'})
04082             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} xrange(n\_obs):
04083                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a8005a1ad8167e96e117d4b81d6e919ff}{addMonteCarloObs}(i\_obs=i, N=N)
04084             log\_.message(\textcolor{stringliteral}{'Leaving'}, calling=\textcolor{stringliteral}{'addMonteCarloObs'})
04085         \textcolor{keywordflow}{else}:
04086             intens = np.array([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_ac380b22660411926b90f935f5123494b}{getIntens}()[label] \textcolor{keywordflow}{for} label \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6ec53301ec68e138d4347f501ff7f711}{lineLabels}])[:,i\_obs] \textcolor{comment}{# n\_lines}
04087             error = np.array([self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a96cf2360b9b568a675d2c8177d47b3d2}{getError}()[label] \textcolor{keywordflow}{for} label \textcolor{keywordflow}{in} self.
      \hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a6ec53301ec68e138d4347f501ff7f711}{lineLabels}])[:,i\_obs]
04088             all\_new\_obs = np.random.standard\_normal((N, n\_lines))
04089             
04090             \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} xrange(N):
04091                 new\_obs = intens * (all\_new\_obs[i,:] * error + 1)
04092                 new\_obs[new\_obs < 0.] = 0.
04093                 self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a301e67ff50a467e97cd929039607a5d0}{addObs}(\textcolor{stringliteral}{'\{0\}-MC-\{1\}'}.format(self.\hyperlink{classpyneb_1_1core_1_1pynebcore_1_1_observation_a3f365d0b1488b2eba300bf71caf23c17}{names}[i\_obs], i), new\_obs, error)
04094     
\end{DoxyCode}
