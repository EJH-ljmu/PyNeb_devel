\hypertarget{namespacepyneb_1_1utils_1_1fits}{\section{pyneb.\-utils.\-fits Namespace Reference}
\label{namespacepyneb_1_1utils_1_1fits}\index{pyneb.\-utils.\-fits@{pyneb.\-utils.\-fits}}
}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classpyneb_1_1utils_1_1fits_1_1_hdr}{Hdr}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{\-\_\-update\-Header}
\item 
def \hyperlink{namespacepyneb_1_1utils_1_1fits_a8055efc148e2aef26439d0a79a26549b}{write\-Atom}
\item 
def \hyperlink{namespacepyneb_1_1utils_1_1fits_a468ecdfaa21de61a1037128ee889fd76}{write\-Coll}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{\index{pyneb\-::utils\-::fits@{pyneb\-::utils\-::fits}!\-\_\-update\-Header@{\-\_\-update\-Header}}
\index{\-\_\-update\-Header@{\-\_\-update\-Header}!pyneb::utils::fits@{pyneb\-::utils\-::fits}}
\subsubsection[{\-\_\-update\-Header}]{\setlength{\rightskip}{0pt plus 5cm}def pyneb.\-utils.\-fits.\-\_\-update\-Header (
\begin{DoxyParamCaption}
\item[{}]{hdu, }
\item[{}]{input\-\_\-file, }
\item[{}]{content, }
\item[{}]{elem, }
\item[{}]{spec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}}\label{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}
\begin{DoxyVerb}Update the header of the output fits file

Parameters: 
    - hdu          pyfits file
    - input_file   name of the ascii files containing the original data
    - content      type of physical quantities contained in the file
    - elem         symbol of the selected element
    - spec         ionization stage in spectroscopic notation (I = 1, II = 2, etc.)\end{DoxyVerb}
 

Definition at line \hyperlink{fits_8py_source_l00015}{15} of file \hyperlink{fits_8py_source}{fits.\-py}.



References \hyperlink{misc_8py_source_l00095}{pyneb.\-utils.\-misc.\-roman\-\_\-to\-\_\-int()}.



Referenced by \hyperlink{fits_8py_source_l00040}{pyneb.\-utils.\-fits.\-write\-Atom()}, and \hyperlink{fits_8py_source_l00114}{pyneb.\-utils.\-fits.\-write\-Coll()}.


\begin{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1fits_l00015}{}\hyperlink{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{00015} 
00016 \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{\_updateHeader}(hdu, input\_file, content, elem, spec):
00017     \textcolor{stringliteral}{"""}
00018 \textcolor{stringliteral}{    Update the header of the output fits file}
00019 \textcolor{stringliteral}{}
00020 \textcolor{stringliteral}{    Parameters: }
00021 \textcolor{stringliteral}{        - hdu          pyfits file}
00022 \textcolor{stringliteral}{        - input\_file   name of the ascii files containing the original data}
00023 \textcolor{stringliteral}{        - content      type of physical quantities contained in the file}
00024 \textcolor{stringliteral}{        - elem         symbol of the selected element}
00025 \textcolor{stringliteral}{        - spec         ionization stage in spectroscopic notation (I = 1, II = 2, etc.)}
00026 \textcolor{stringliteral}{        }
00027 \textcolor{stringliteral}{    """}
00028     hdu.header.update(\textcolor{stringliteral}{'ORIGIN'}, \textcolor{stringliteral}{'File \{0\}, PyNeb v\{1\}'}.format(input\_file, pn.\_\_version\_\_))
00029     hdu.header.update(\textcolor{stringliteral}{'CONTENT'}, content)
00030     hdu.header.update(\textcolor{stringliteral}{'ATOM'}, sym2name[elem.capitalize()])
00031     hdu.header.update(\textcolor{stringliteral}{'SPECTRUM'}, \hyperlink{namespacepyneb_1_1utils_1_1misc_ae67dbd6bb48d64216bc162ebdc25a183}{roman\_to\_int}(spec))
00032     atom = elem.capitalize() + str(\hyperlink{namespacepyneb_1_1utils_1_1misc_ae67dbd6bb48d64216bc162ebdc25a183}{roman\_to\_int}(spec))
00033     \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} gsDict.keys():
00034         \textcolor{keywordflow}{if} (atom \textcolor{keywordflow}{in} gsDict[key]):
00035             gs = key
00036         \textcolor{keywordflow}{else}:
00037             gs = \textcolor{stringliteral}{'unknown'}
00038     hdu.header.update(\textcolor{stringliteral}{'GSCONFIG'}, gs)
00039     

\end{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1fits_a8055efc148e2aef26439d0a79a26549b}{\index{pyneb\-::utils\-::fits@{pyneb\-::utils\-::fits}!write\-Atom@{write\-Atom}}
\index{write\-Atom@{write\-Atom}!pyneb::utils::fits@{pyneb\-::utils\-::fits}}
\subsubsection[{write\-Atom}]{\setlength{\rightskip}{0pt plus 5cm}def pyneb.\-utils.\-fits.\-write\-Atom (
\begin{DoxyParamCaption}
\item[{}]{input\-\_\-file}
\end{DoxyParamCaption}
)}}\label{namespacepyneb_1_1utils_1_1fits_a8055efc148e2aef26439d0a79a26549b}
\begin{DoxyVerb}Write the Es and As read from an ascii file into a fits file in PyNeb format.
The bibliographic references are read from comment lines in the file.
    
Parameters:
    - input_file    name of the ascii input file containing the energy levels (in 1/A or eV) and the Aij,
                    in the format elem_spec_atom_REF-STRING.dat

Example: 
writeAtom('o_iii_atom_AB01-CD02-EFG03.dat')\end{DoxyVerb}
 

Definition at line \hyperlink{fits_8py_source_l00040}{40} of file \hyperlink{fits_8py_source}{fits.\-py}.



References \hyperlink{fits_8py_source_l00015}{pyneb.\-utils.\-fits.\-\_\-update\-Header()}.


\begin{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1fits_l00040}{}\hyperlink{namespacepyneb_1_1utils_1_1fits_a8055efc148e2aef26439d0a79a26549b}{00040} 
00041 \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1fits_a8055efc148e2aef26439d0a79a26549b}{writeAtom}(input\_file):
00042     \textcolor{stringliteral}{""" }
00043 \textcolor{stringliteral}{    Write the Es and As read from an ascii file into a fits file in PyNeb format.}
00044 \textcolor{stringliteral}{    The bibliographic references are read from comment lines in the file.}
00045 \textcolor{stringliteral}{        }
00046 \textcolor{stringliteral}{    Parameters:}
00047 \textcolor{stringliteral}{        - input\_file    name of the ascii input file containing the energy levels (in 1/A or eV) and the
       Aij,}
00048 \textcolor{stringliteral}{                        in the format elem\_spec\_atom\_REF-STRING.dat}
00049 \textcolor{stringliteral}{}
00050 \textcolor{stringliteral}{    Example: }
00051 \textcolor{stringliteral}{    writeAtom('o\_iii\_atom\_AB01-CD02-EFG03.dat')}
00052 \textcolor{stringliteral}{}
00053 \textcolor{stringliteral}{    """}
00054     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(input\_file):
00055         pn.log\_.error(\textcolor{stringliteral}{'\{0\} not found.'}.format(input\_file), calling=\textcolor{stringliteral}{'writeAtom'})
00056         sys.exit(0)
00057     data\_type = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[2]
00058     \textcolor{keywordflow}{if} (data\_type != \textcolor{stringliteral}{'atom'}):
00059         pn.log\_.error(\textcolor{stringliteral}{'The name of \{0\} does not conform to the prescribed format.'}.format(input\_file), 
      calling=\textcolor{stringliteral}{'writeAtom'})
00060         sys.exit(0)
00061     elem = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[0]
00062     spec = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[1]
00063     ref = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[-1]
00064     out\_fits = \textcolor{stringliteral}{'\{0\}\_\{1\}\_\{2\}\_\{3\}.fits'}.format(elem.lower(), spec.lower(), data\_type, ref)
00065     atom\_dat = []
00066 
00067     \textcolor{comment}{# Read data from ascii file}
00068     \textcolor{comment}{#}
00069     \textcolor{comment}{# Read energies and stat weights }
00070     f = open(input\_file)
00071     units = f.readlines()[1].split()[0]
00072     all\_data = np.genfromtxt(input\_file, comments=\textcolor{stringliteral}{'***'}, skip\_header=2, unpack=\textcolor{keyword}{True})
00073     \textcolor{comment}{# Read Es}
00074     energy = all\_data[0, :]
00075     NLevels = len(energy)
00076     \textcolor{keywordflow}{if} units[0] \textcolor{keywordflow}{is} \textcolor{stringliteral}{'eV'}: 
00077         energy = energy / (pn.CST.RYD\_EV * pn.CST.RYD\_ANG)
00078     \textcolor{comment}{# Read statistical weights}
00079     stat\_weight = all\_data[1, :]
00080     atom\_dat.append(pyfits.Column(name=\textcolor{stringliteral}{'Energy'}, format=\textcolor{stringliteral}{'1D'}, unit=\textcolor{stringliteral}{'1/Ang'}, array=energy))
00081     atom\_dat.append(pyfits.Column(name=\textcolor{stringliteral}{'Stat\_Weight'}, format=\textcolor{stringliteral}{'1J'}, unit=\textcolor{stringliteral}{'none'}, array=stat\_weight))    
00082     \textcolor{comment}{# Read As}
00083     \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} np.arange(NLevels - 1):
00084         lev\_j = j + 1
00085         fieldName = \textcolor{stringliteral}{'A(*->\{0\})'}.format(lev\_j)
00086         atom\_dat.append(pyfits.Column(name=fieldName, format=\textcolor{stringliteral}{'1D'}, unit=\textcolor{stringliteral}{'1/sec'}, array=all\_data[1 + lev\_j, 
      :]))
00087 
00088     \textcolor{comment}{# Create fits file and start adding info to the header}
00089     atom\_hdu = pyfits.new\_table(atom\_dat)   
00090             
00091     \textcolor{comment}{# Primary header (extension 0)}
00092     hdu = pyfits.PrimaryHDU()
00093     hdu.header.update(\textcolor{stringliteral}{'FILENAME'}, out\_fits)
00094     hdu.header.update(\textcolor{stringliteral}{'NEXTEND'}, 1)
00095  
00096     \textcolor{comment}{# Write references in the header}
00097     refs = []
00098     \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} open(input\_file):
00099         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'***'} \textcolor{keywordflow}{in} line:
00100             text = line.strip(\textcolor{stringliteral}{"***"}).split(\textcolor{stringliteral}{"'"})
00101             \textcolor{keywordflow}{if} (\textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} text[0]) \textcolor{keywordflow}{or} (\textcolor{stringliteral}{'NOTE'} \textcolor{keywordflow}{in} text[0]):
00102                 refs.append((text[0], text[1]))
00103 
00104     \hyperlink{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{\_updateHeader}(atom\_hdu, input\_file, \textcolor{stringliteral}{'Energy levels and transition probabilities'}, elem, 
      spec)
00105     \hyperlink{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{\_updateHeader}(hdu, input\_file, \textcolor{stringliteral}{'Energy levels and transition probabilities'}, elem, spec)
00106     atom\_hdu.header.update(\textcolor{stringliteral}{'N\_LEVELS'}, NLevels)
00107     \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} refs:
00108         atom\_hdu.header.update(item[0], item[1])
00109 
00110     hdulist = pyfits.HDUList([hdu])
00111     hdulist.append(atom\_hdu)
00112     hdulist.writeto(out\_fits, clobber=\textcolor{keyword}{True})
00113 

\end{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1fits_a468ecdfaa21de61a1037128ee889fd76}{\index{pyneb\-::utils\-::fits@{pyneb\-::utils\-::fits}!write\-Coll@{write\-Coll}}
\index{write\-Coll@{write\-Coll}!pyneb::utils::fits@{pyneb\-::utils\-::fits}}
\subsubsection[{write\-Coll}]{\setlength{\rightskip}{0pt plus 5cm}def pyneb.\-utils.\-fits.\-write\-Coll (
\begin{DoxyParamCaption}
\item[{}]{input\-\_\-file, }
\item[{}]{temp\-\_\-in\-\_\-cols = {\ttfamily True}, }
\item[{}]{cheb\-Order = {\ttfamily None}}
\end{DoxyParamCaption}
)}}\label{namespacepyneb_1_1utils_1_1fits_a468ecdfaa21de61a1037128ee889fd76}
\begin{DoxyVerb}Write the Omegas read from an ascii file into a fits file in PyNeb format.
The bibliographic references are read from comment lines in the file.
    
Parameters:
    - input_file    name of the ascii input file containing the Omegas,
                    in the format elem_spec_coll_REF-STRING.dat
    - temp_in_cols  If True, each column of the input file corresponds to a given Te, 
                     otherwise each rows corresponds to a given Te (a transposition is 
                     thus applied to the data)
Example: 
writeColl('o_iii_coll_AB01-CD02-EFG03.dat')\end{DoxyVerb}
 

Definition at line \hyperlink{fits_8py_source_l00114}{114} of file \hyperlink{fits_8py_source}{fits.\-py}.



References \hyperlink{fits_8py_source_l00015}{pyneb.\-utils.\-fits.\-\_\-update\-Header()}.


\begin{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1fits_l00114}{}\hyperlink{namespacepyneb_1_1utils_1_1fits_a468ecdfaa21de61a1037128ee889fd76}{00114} 
00115 \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1fits_a468ecdfaa21de61a1037128ee889fd76}{writeColl}(input\_file, temp\_in\_cols = True, chebOrder = None):
00116     \textcolor{stringliteral}{""" }
00117 \textcolor{stringliteral}{    Write the Omegas read from an ascii file into a fits file in PyNeb format.}
00118 \textcolor{stringliteral}{    The bibliographic references are read from comment lines in the file.}
00119 \textcolor{stringliteral}{        }
00120 \textcolor{stringliteral}{    Parameters:}
00121 \textcolor{stringliteral}{        - input\_file    name of the ascii input file containing the Omegas,}
00122 \textcolor{stringliteral}{                        in the format elem\_spec\_coll\_REF-STRING.dat}
00123 \textcolor{stringliteral}{        - temp\_in\_cols  If True, each column of the input file corresponds to a given Te, }
00124 \textcolor{stringliteral}{                         otherwise each rows corresponds to a given Te (a transposition is }
00125 \textcolor{stringliteral}{                         thus applied to the data)}
00126 \textcolor{stringliteral}{    Example: }
00127 \textcolor{stringliteral}{    writeColl('o\_iii\_coll\_AB01-CD02-EFG03.dat')}
00128 \textcolor{stringliteral}{}
00129 \textcolor{stringliteral}{    """}
00130     \textcolor{keyword}{def }\_omegaArray(lev\_j, lev\_i):
00131         \textcolor{stringliteral}{"""}
00132 \textcolor{stringliteral}{        Return the array of collision strength values for given levels}
00133 \textcolor{stringliteral}{ }
00134 \textcolor{stringliteral}{        """}       
00135         ij = (cs[:, 0] == lev\_j) & (cs[:, 1] == lev\_i)
00136         \textcolor{keywordflow}{if} ij.sum() == 0.:
00137             \textcolor{keywordflow}{return} np.zeros(n\_temp)
00138         \textcolor{keywordflow}{else}:
00139             \textcolor{keywordflow}{return} cs[ij, 2::].reshape(n\_temp)
00140 
00141     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} os.path.exists(input\_file):
00142         pn.log\_.error(\textcolor{stringliteral}{'\{0\} not found.'}.format(input\_file), calling=\textcolor{stringliteral}{'writeColl'})
00143         sys.exit(0)
00144     data\_type = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[2]
00145     \textcolor{keywordflow}{if} (data\_type != \textcolor{stringliteral}{'coll'}):
00146         pn.log\_.error(\textcolor{stringliteral}{'The name of \{0\} does not conform to the prescribed format.'}.format(input\_file), 
      calling=\textcolor{stringliteral}{'writeColl'})
00147         sys.exit(0)
00148     elem = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[0]
00149     spec = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[1]
00150     ref = input\_file.split(\textcolor{stringliteral}{"."})[0].split(\textcolor{stringliteral}{"\_"})[-1]
00151     out\_fits = \textcolor{stringliteral}{'\{0\}\_\{1\}\_\{2\}\_\{3\}.fits'}.format(elem.lower(), spec.lower(), data\_type, ref)
00152     coll\_dat = []
00153 
00154     \textcolor{comment}{# Read Omegas}
00155     cs = np.genfromtxt(input\_file, comments=\textcolor{stringliteral}{'***'})
00156     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} temp\_in\_cols:
00157         cs = cs.transpose()
00158     n\_temp = np.size(cs[0]) - 2
00159     temArray = cs[0, 2::]
00160     NLevels = int(np.max(cs[:, 1]))
00161     \textcolor{keywordflow}{if} chebOrder \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00162         chebOrder = n\_temp
00163     coll\_dat.append(pyfits.Column(name=\textcolor{stringliteral}{'Te'}, format=\textcolor{stringliteral}{'1E'}, unit=\textcolor{stringliteral}{'log(K)'}, array=temArray)) \textcolor{comment}{# Change if
       linear T used (see below)}
00164     \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} np.arange(NLevels - 1):
00165         lev\_j = j + 1
00166         lev\_i = lev\_j + 1
00167         \textcolor{keywordflow}{while} (lev\_i < NLevels + 1):
00168             fieldName = \textcolor{stringliteral}{'Omega(\{0\}->\{1\})'}.format(int(lev\_i), int(lev\_j))
00169             omegaArray = \_omegaArray(lev\_j, lev\_i)
00170             coll\_dat.append(pyfits.Column(name=fieldName, format=\textcolor{stringliteral}{'1E'}, unit=chebOrder, array=omegaArray))
00171             lev\_i += 1
00172     coll\_hdu = pyfits.new\_table(coll\_dat)        
00173             
00174     \textcolor{comment}{# Primary header (extension 0)}
00175     hdu = pyfits.PrimaryHDU()
00176     hdu.header.update(\textcolor{stringliteral}{'FILENAME'}, out\_fits)
00177     hdu.header.update(\textcolor{stringliteral}{'NEXTEND'}, 1)
00178  
00179     \textcolor{comment}{# Write references in the header}
00180     refs = []
00181     \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} open(input\_file):
00182         \textcolor{keywordflow}{if} \textcolor{stringliteral}{'***'} \textcolor{keywordflow}{in} line:
00183             text = line.strip(\textcolor{stringliteral}{"***"}).split(\textcolor{stringliteral}{"'"})
00184             \textcolor{keywordflow}{if} (\textcolor{stringliteral}{'SOURCE'} \textcolor{keywordflow}{in} text[0]) \textcolor{keywordflow}{or} (\textcolor{stringliteral}{'NOTE'} \textcolor{keywordflow}{in} text[0]):
00185                 refs.append((text[0], text[1]))
00186 
00187     \hyperlink{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{\_updateHeader}(coll\_hdu, input\_file, \textcolor{stringliteral}{'Collision strengths'}, elem, spec)
00188     \hyperlink{namespacepyneb_1_1utils_1_1fits_a40031d2d7de219b95d7475243b3888eb}{\_updateHeader}(hdu, input\_file, \textcolor{stringliteral}{'Collision strengths'}, elem, spec)
00189     coll\_hdu.header.update(\textcolor{stringliteral}{'N\_LEVELS'}, NLevels)
00190     \textcolor{keywordflow}{for} item \textcolor{keywordflow}{in} refs:
00191         coll\_hdu.header.update(item[0], item[1])
00192 
00193     hdulist = pyfits.HDUList([hdu])
00194     hdulist.append(coll\_hdu)
00195     hdulist.writeto(out\_fits, clobber=\textcolor{keyword}{True})
00196 

\end{DoxyCode}
