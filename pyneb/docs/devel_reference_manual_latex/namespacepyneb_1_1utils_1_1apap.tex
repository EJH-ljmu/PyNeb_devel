\hypertarget{namespacepyneb_1_1utils_1_1apap}{\section{pyneb.\-utils.\-apap Namespace Reference}
\label{namespacepyneb_1_1utils_1_1apap}\index{pyneb.\-utils.\-apap@{pyneb.\-utils.\-apap}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}{conv\-\_\-apap}
\item 
def \hyperlink{namespacepyneb_1_1utils_1_1apap_ad24a246526c0913b752319c5a2846412}{read\-\_\-apap}
\item 
def \hyperlink{namespacepyneb_1_1utils_1_1apap_a4fccb2b8771d515b0be6f8a1921c0c58}{apap2ascii}
\item 
def \hyperlink{namespacepyneb_1_1utils_1_1apap_ac957f753a8fc1c667044b4324868753e}{make\-\_\-all}
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
dictionary \hyperlink{namespacepyneb_1_1utils_1_1apap_aba49aa2681eafa29fc85cb550e4ce28a}{term2\-\_\-dic} = \{'0'\-:'S', '1'\-:'P', '2'\-:'D', '3'\-:'F', '4'\-:'G', '5'\-:'H', '6'\-:'I'\}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{namespacepyneb_1_1utils_1_1apap_a4fccb2b8771d515b0be6f8a1921c0c58}{\index{pyneb\-::utils\-::apap@{pyneb\-::utils\-::apap}!apap2ascii@{apap2ascii}}
\index{apap2ascii@{apap2ascii}!pyneb::utils::apap@{pyneb\-::utils\-::apap}}
\subsubsection[{apap2ascii}]{\setlength{\rightskip}{0pt plus 5cm}def pyneb.\-utils.\-apap.\-apap2ascii (
\begin{DoxyParamCaption}
\item[{}]{apap\-\_\-file, }
\item[{}]{max\-\_\-levels = {\ttfamily 10}, }
\item[{}]{source = {\ttfamily 'http\-://www.apap-\/network.org/'}}
\end{DoxyParamCaption}
)}}\label{namespacepyneb_1_1utils_1_1apap_a4fccb2b8771d515b0be6f8a1921c0c58}


Definition at line \hyperlink{apap_8py_source_l00078}{78} of file \hyperlink{apap_8py_source}{apap.\-py}.



References \hyperlink{manage__atomic__data_8py_source_l00606}{pyneb.\-utils.\-manage\-\_\-atomic\-\_\-data.\-get\-Levels\-N\-I\-S\-T()}, \hyperlink{misc_8py_source_l00055}{pyneb.\-utils.\-misc.\-int\-\_\-to\-\_\-roman()}, and \hyperlink{apap_8py_source_l00022}{pyneb.\-utils.\-apap.\-read\-\_\-apap()}.



Referenced by \hyperlink{apap_8py_source_l00139}{pyneb.\-utils.\-apap.\-make\-\_\-all()}.


\begin{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1apap_l00078}{}\hyperlink{namespacepyneb_1_1utils_1_1apap_a4fccb2b8771d515b0be6f8a1921c0c58}{00078} 
00079 \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1apap_a4fccb2b8771d515b0be6f8a1921c0c58}{apap2ascii}(apap\_file, max\_levels=10, source='http://www.apap-network.org/\textcolor{stringliteral}{'):}
00080 \textcolor{stringliteral}{    }
00081 \textcolor{stringliteral}{    atom = apap\_file.split(}\textcolor{stringliteral}{'#'})[1].split(\textcolor{stringliteral}{'.'})[0]
00082     spectrum = int(re.findall(\textcolor{stringliteral}{r'\(\backslash\)d+'}, atom)[0]) + 1
00083     ioniz = \hyperlink{namespacepyneb_1_1utils_1_1misc_a7a4c4b4ba1c884da72e0ea05aa8fb90b}{int\_to\_roman}(spectrum).lower()
00084     elem = re.findall(\textcolor{stringliteral}{'[a-zA-Z]+'}, atom)[0]
00085     ion\_str = \textcolor{stringliteral}{'\{0\}\{1\}'}.format(elem.capitalize(), spectrum)
00086     print(\textcolor{stringliteral}{'Reading NIST data for \{0\}'}.format(ion\_str))
00087     NIST\_levels = \hyperlink{namespacepyneb_1_1utils_1_1manage__atomic__data_ad09376e8676854d44680ae14210b5589}{getLevelsNIST}(ion\_str)
00088     NIST\_full\_term = [\textcolor{stringliteral}{'\{0:2s\}\{1:.1f\}'}.format(l[\textcolor{stringliteral}{'term'}][0:2],float(l[\textcolor{stringliteral}{'J'}])) \textcolor{keywordflow}{for} l \textcolor{keywordflow}{in}  NIST\_levels]
00089     
00090     term, energy, J, lev\_i, lev\_j, As, Omegas, temp\_array = \hyperlink{namespacepyneb_1_1utils_1_1apap_ad24a246526c0913b752319c5a2846412}{read\_apap}(apap\_file, max\_levels=
      max\_levels)
00091     N\_temp = len(temp\_array)
00092 
00093     APAP\_full\_term = [\textcolor{stringliteral}{'\{0:2s\}\{1:.1f\}'}.format(t,float(j)) \textcolor{keywordflow}{for} t, j \textcolor{keywordflow}{in} zip(term, J)]
00094     
00095     N\_levels = len(energy)
00096     stat\_weight = J * 2 + 1
00097         
00098     Omega3d = np.zeros((N\_levels, N\_levels, N\_temp))
00099     \textcolor{keywordflow}{for} i, j, Omega \textcolor{keywordflow}{in} zip(lev\_i, lev\_j, Omegas):
00100         \textcolor{keywordflow}{try}:
00101             i\_NIST = NIST\_full\_term.index(APAP\_full\_term[i-1])
00102         \textcolor{keywordflow}{except}:
00103             i\_NIST = \textcolor{keywordtype}{None}
00104         \textcolor{keywordflow}{try}:
00105             j\_NIST = NIST\_full\_term.index(APAP\_full\_term[j-1])
00106         \textcolor{keywordflow}{except}:
00107             j\_NIST = \textcolor{keywordtype}{None}
00108         \textcolor{keywordflow}{if} (i\_NIST \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}) \textcolor{keywordflow}{and} (j\_NIST \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}):
00109             Omega3d[i\_NIST, j\_NIST] = Omega
00110         \textcolor{keywordflow}{else}:
00111             pn.log\_.warn(\textcolor{stringliteral}{'Levels not found in NIST: \{0\} \{1\}'}.format(APAP\_full\_term[i-1], 
00112                                                                     APAP\_full\_term[j-1]))
00113             
00114     f\_coll = open(\textcolor{stringliteral}{'\{0\}\_\{1\}\_coll\_APAP14.dat'}.format(elem, ioniz),\textcolor{stringliteral}{'w'})
00115     str\_ = \textcolor{stringliteral}{'0   0 '}
00116     str\_ += \textcolor{stringliteral}{''}.join(\textcolor{stringliteral}{' \{0:10.4e\}'}.format(T) \textcolor{keywordflow}{for} T \textcolor{keywordflow}{in} temp\_array)
00117     str\_ += \textcolor{stringliteral}{'\(\backslash\)n'}
00118     f\_coll.write(str\_)
00119     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} 1+np.arange(N\_levels):
00120         \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} i+1+np.arange(N\_levels-i):
00121             str\_ = \textcolor{stringliteral}{'\{0\} \{1\} '}.format(i, j)
00122             str\_ += \textcolor{stringliteral}{''}.join(\textcolor{stringliteral}{' \{0:10.8e\}'}.format(O) \textcolor{keywordflow}{for} O \textcolor{keywordflow}{in} Omega3d[j-1, i-1])
00123             str\_ += \textcolor{stringliteral}{'\(\backslash\)n'}
00124             f\_coll.write(str\_)
00125     \textcolor{keywordflow}{try}:
00126         f\_coll.write(\textcolor{stringliteral}{"*** ATOM \{0\}\(\backslash\)n"}.format(sym2name[elem.capitalize()]))
00127     \textcolor{keywordflow}{except}:
00128         pn.log\_.warn(\textcolor{stringliteral}{'No full name for element \{0\}'}.format(elem.capitalize()))
00129 
00130     f\_coll.write(\textcolor{stringliteral}{"""*** SPECTRUM \{0\}}
00131 \textcolor{stringliteral}{*** N\_LEVELS \{1\}}
00132 \textcolor{stringliteral}{*** T\_UNIT 'K'}
00133 \textcolor{stringliteral}{*** NOTE1 'Collision strengths'}
00134 \textcolor{stringliteral}{*** SOURCE1 '\{2\}'}
00135 \textcolor{stringliteral}{"""}.format(spectrum, N\_levels, source))
00136     
00137     f\_coll.close()
00138 

\end{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}{\index{pyneb\-::utils\-::apap@{pyneb\-::utils\-::apap}!conv\-\_\-apap@{conv\-\_\-apap}}
\index{conv\-\_\-apap@{conv\-\_\-apap}!pyneb::utils::apap@{pyneb\-::utils\-::apap}}
\subsubsection[{conv\-\_\-apap}]{\setlength{\rightskip}{0pt plus 5cm}def pyneb.\-utils.\-apap.\-conv\-\_\-apap (
\begin{DoxyParamCaption}
\item[{}]{str\-\_\-in}
\end{DoxyParamCaption}
)}}\label{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}
\begin{DoxyVerb}transform "1.3-01" into 1.3e-01 
\end{DoxyVerb}
 

Definition at line \hyperlink{apap_8py_source_l00012}{12} of file \hyperlink{apap_8py_source}{apap.\-py}.



Referenced by \hyperlink{apap_8py_source_l00022}{pyneb.\-utils.\-apap.\-read\-\_\-apap()}.


\begin{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1apap_l00012}{}\hyperlink{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}{00012} 
00013 \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}{conv\_apap}(str\_in):
00014     \textcolor{stringliteral}{"""}
00015 \textcolor{stringliteral}{    transform "1.3-01" into 1.3e-01 }
00016 \textcolor{stringliteral}{    """}
00017     a, b = re.split(\textcolor{stringliteral}{'\(\backslash\)+|-'},str\_in)
00018     \textcolor{keywordflow}{if} \textcolor{stringliteral}{'-'} \textcolor{keywordflow}{in} str\_in:
00019         \textcolor{keywordflow}{return} float(a) / 10**float(b)
00020     \textcolor{keywordflow}{else}:
00021         \textcolor{keywordflow}{return} float(a) * 10**float(b)

\end{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1apap_ac957f753a8fc1c667044b4324868753e}{\index{pyneb\-::utils\-::apap@{pyneb\-::utils\-::apap}!make\-\_\-all@{make\-\_\-all}}
\index{make\-\_\-all@{make\-\_\-all}!pyneb::utils::apap@{pyneb\-::utils\-::apap}}
\subsubsection[{make\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}def pyneb.\-utils.\-apap.\-make\-\_\-all (
\begin{DoxyParamCaption}
\item[{}]{dir\-\_\- = {\ttfamily '.'}, }
\item[{}]{max\-\_\-levels = {\ttfamily 8}}
\end{DoxyParamCaption}
)}}\label{namespacepyneb_1_1utils_1_1apap_ac957f753a8fc1c667044b4324868753e}


Definition at line \hyperlink{apap_8py_source_l00139}{139} of file \hyperlink{apap_8py_source}{apap.\-py}.



References \hyperlink{apap_8py_source_l00078}{pyneb.\-utils.\-apap.\-apap2ascii()}.


\begin{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1apap_l00139}{}\hyperlink{namespacepyneb_1_1utils_1_1apap_ac957f753a8fc1c667044b4324868753e}{00139} 
00140 \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1apap_ac957f753a8fc1c667044b4324868753e}{make\_all}(dir\_ = '.', max\_levels=8):
00141     file\_liste = os.listdir(\textcolor{stringliteral}{'.'})
00142     \textcolor{keywordflow}{for} file\_ \textcolor{keywordflow}{in} file\_liste:
00143         \textcolor{keywordflow}{if} file\_[-1] == \textcolor{stringliteral}{'z'}:
00144             atom = file\_.split(\textcolor{stringliteral}{'#'})[1].split(\textcolor{stringliteral}{'.'})[0]
00145             \textcolor{keywordflow}{if} atom == \textcolor{stringliteral}{'fe'}:
00146                 \hyperlink{namespacepyneb_1_1utils_1_1apap_a4fccb2b8771d515b0be6f8a1921c0c58}{apap2ascii}(file\_, 34)
00147             \textcolor{keywordflow}{else}:
00148                 \hyperlink{namespacepyneb_1_1utils_1_1apap_a4fccb2b8771d515b0be6f8a1921c0c58}{apap2ascii}(file\_, max\_levels)
            print(\textcolor{stringliteral}{'\{0\}\end{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1apap_ad24a246526c0913b752319c5a2846412}{\index{pyneb\-::utils\-::apap@{pyneb\-::utils\-::apap}!read\-\_\-apap@{read\-\_\-apap}}
\index{read\-\_\-apap@{read\-\_\-apap}!pyneb::utils::apap@{pyneb\-::utils\-::apap}}
\subsubsection[{read\-\_\-apap}]{\setlength{\rightskip}{0pt plus 5cm}def pyneb.\-utils.\-apap.\-read\-\_\-apap (
\begin{DoxyParamCaption}
\item[{}]{apap\-\_\-file, }
\item[{}]{max\-\_\-levels = {\ttfamily 10}}
\end{DoxyParamCaption}
)}}\label{namespacepyneb_1_1utils_1_1apap_ad24a246526c0913b752319c5a2846412}


Definition at line \hyperlink{apap_8py_source_l00022}{22} of file \hyperlink{apap_8py_source}{apap.\-py}.



References \hyperlink{apap_8py_source_l00012}{pyneb.\-utils.\-apap.\-conv\-\_\-apap()}.



Referenced by \hyperlink{apap_8py_source_l00078}{pyneb.\-utils.\-apap.\-apap2ascii()}.


\begin{DoxyCode}
\hypertarget{namespacepyneb_1_1utils_1_1apap_l00022}{}\hyperlink{namespacepyneb_1_1utils_1_1apap_ad24a246526c0913b752319c5a2846412}{00022} 
00023 \textcolor{keyword}{def }\hyperlink{namespacepyneb_1_1utils_1_1apap_ad24a246526c0913b752319c5a2846412}{read\_apap}(apap\_file, max\_levels=10):
00024     \textcolor{keywordflow}{if} max\_levels \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
00025         max\_levels = np.Inf
00026         
00027     term1 = []
00028     term2 = []
00029     energy = []
00030     J = []
00031     \textcolor{keywordflow}{if} apap\_file.split(\textcolor{stringliteral}{'.'})[-1] == \textcolor{stringliteral}{'gz'}:
00032         f = gzip.open(apap\_file)
00033     \textcolor{keywordflow}{else}:
00034         f = open(apap\_file)
00035     foo = f.readline()
00036     \textcolor{keywordflow}{while} \textcolor{keyword}{True}:
00037         line = f.readline()
00038         \textcolor{keywordflow}{if} line[0:5] == \textcolor{stringliteral}{"   -1"}:
00039             \textcolor{keywordflow}{break}
00040         lev = int(line[0:5])
00041         \textcolor{keywordflow}{if} lev <= max\_levels:
00042             term1.append(line[25:26])
00043             term2.append(line[27:28])
00044             J.append(line[29:33])
00045             energy.append(line[34::])
00046     term = [t1+term2\_dic[t2] \textcolor{keywordflow}{for} t1,t2 \textcolor{keywordflow}{in} zip(term1, term2)]
00047     
00048     lev\_i = []
00049     lev\_j = []
00050     As = []
00051     Omegas = []
00052     
00053     temps\_str = f.readline().split()[2::]
00054     temp\_array = np.array([\hyperlink{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}{conv\_apap}(temp) \textcolor{keywordflow}{for} temp \textcolor{keywordflow}{in} temps\_str])
00055     N\_temp = len(temp\_array)
00056     \textcolor{keywordflow}{while} \textcolor{keyword}{True}:
00057         line = f.readline()
00058         \textcolor{keywordflow}{if} line[0:4] == \textcolor{stringliteral}{"  -1"}:
00059             \textcolor{keywordflow}{break}
00060         i = int(line[1:4])
00061         j = int(line[4:8])
00062         \textcolor{keywordflow}{if} (i <= max\_levels) \textcolor{keywordflow}{and} (j <= max\_levels):
00063             lev\_i.append(i)
00064             lev\_j.append(j)
00065             strg5 = line[8:8+(N\_temp+1)*8].split()
00066             As.append(\hyperlink{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}{conv\_apap}(strg5[0]))
00067             Omegas.append([\hyperlink{namespacepyneb_1_1utils_1_1apap_ac3d6e43ef2ad84632e9b5a101e115cb1}{conv\_apap}(omega) \textcolor{keywordflow}{for} omega \textcolor{keywordflow}{in} strg5[1::]])
00068     f.close()
00069     
00070     return(term, 
00071            np.array(energy, dtype=\textcolor{stringliteral}{'float'}), 
00072            np.array(J, dtype=\textcolor{stringliteral}{'float'}), 
00073            np.array(lev\_i, dtype=\textcolor{stringliteral}{'int'}), 
00074            np.array(lev\_j, dtype=\textcolor{stringliteral}{'int'}), 
00075            np.array(As, dtype=\textcolor{stringliteral}{'float'}), 
00076            np.array(Omegas, dtype=\textcolor{stringliteral}{'float'}), 
00077            temp\_array)

\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{namespacepyneb_1_1utils_1_1apap_aba49aa2681eafa29fc85cb550e4ce28a}{\index{pyneb\-::utils\-::apap@{pyneb\-::utils\-::apap}!term2\-\_\-dic@{term2\-\_\-dic}}
\index{term2\-\_\-dic@{term2\-\_\-dic}!pyneb::utils::apap@{pyneb\-::utils\-::apap}}
\subsubsection[{term2\-\_\-dic}]{\setlength{\rightskip}{0pt plus 5cm}dictionary pyneb.\-utils.\-apap.\-term2\-\_\-dic = \{'0'\-:'S', '1'\-:'P', '2'\-:'D', '3'\-:'F', '4'\-:'G', '5'\-:'H', '6'\-:'I'\}}}\label{namespacepyneb_1_1utils_1_1apap_aba49aa2681eafa29fc85cb550e4ce28a}


Definition at line \hyperlink{apap_8py_source_l00010}{10} of file \hyperlink{apap_8py_source}{apap.\-py}.

